!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports={chromeCanary:"epnpbkpfpmpbheinimppjadpcbkechhk",environment:"development",fdetect:!0,icons:!0,logger:{level:"DEBUG",enable:"*"}}},{}],2:[function(require,module,exports){module.exports={chromeCanary:"epnpbkpfpmpbheinimppjadpcbkechhk",environment:"production",fdetect:!0,icons:!1,logger:{level:"ERROR",enable:""}}},{}],3:[function(require,module,exports){(function(process){function parseQueryProperty(prop){var res=prop;return res=JSON.parse(JSON.stringify(res).replace(/[\[\]]/g,"")),"true"===prop?res=!0:"false"===prop&&(res=!1),res}function saveOverrides(overrides){"object"==typeof chrome&&chrome.storage&&chrome.storage.local?(logger.log("config","udpating overrides in localstorage"),chrome.storage.local.set({overrides:overrides})):persistenceUtils.setItem("overrides",JSON.stringify(overrides))}var UrlParser=require("url-parser"),_=require("underscore"),logger=require("../logger"),persistenceUtils=require("../persistence/utils.js"),configuration=require("./env/production");"development"===process.env.CS_ENV&&(configuration=require("./env/development"));var QUERY_PREFIX=exports.QUERY_PREFIX="pb_";exports=module.exports=configuration,exports.processQuery=function(query){logger.log("config","processsing query params"),query=query||UrlParser.parse(location.href,!0).query;var overrides=exports.queryToConfig(query);_.keys(overrides).length&&(logger.info("config","overriding configuration from query: ",overrides),_.extend(configuration,overrides),saveOverrides(overrides))},exports.processLocalStorage=function(callback){function applyOverrides(overrides,callback){_.keys(overrides).length&&(logger.info("config","overriding configuration from localstorage: ",overrides),_.extend(configuration,overrides)),callback&&callback(configuration)}if(logger.log("config","processing localstorage"),"object"==typeof chrome&&chrome.storage&&chrome.storage.local)chrome.storage.local.get("overrides",function(result){applyOverrides(result.overrides,callback)});else if(persistenceUtils.getItem("overrides")){var overrides={};try{overrides=JSON.parse(persistenceUtils.getItem("overrides"))}catch(e){logger.warn("config","can't parse localStorage.overrides",persistenceUtils.getItem("overrides"),"error",e)}finally{applyOverrides(overrides,callback)}}else callback&&callback(configuration)},exports.queryToConfig=function(query){return _.keys(query).filter(function(key){return 0===key.indexOf(QUERY_PREFIX)}).reduce(function(config,key){return config[key.replace(QUERY_PREFIX,"")]=parseQueryProperty(query[key]),config},{})}}).call(this,require("_process"))},{"../logger":130,"../persistence/utils.js":140,"./env/development":1,"./env/production":2,_process:218,underscore:"underscore","url-parser":233}],4:[function(require,module,exports){function getUniquePath(node,optimized,ctx){if(ctx=ctx||document,!node||1!==node.nodeType)return"";for(var formNode,steps=[],contextNode=node,chainingValue=" > ";contextNode;){var step=_cssPathStep(contextNode,!!optimized,ctx);if(!step)break;if(steps.push(step),steps.length>1&&"form"===contextNode.nodeName.toLowerCase()){if(chainingValue=" ",!step.optimized){var unqiueFormPath=getUniquePath(contextNode,!1);steps[steps.length-1].value=unqiueFormPath}break}if(step.optimized)break;if(1===steps.length){var forms=$(node,ctx).parents("form");formNode=forms.length&&forms[0]}contextNode=formNode||contextNode.parentNode}return steps.reverse(),steps.join(chainingValue)}function _cssPathStep(node,optimized,ctx){function areMultipleElementsWithSameId(id){return id=escapeIdentifierIfNeeded(id),$('[id="'+id+'"]',ctx).length>1}function isDynamicId(id){return/[0-9]/.test(id)}function isValidId(id){return!isDynamicId(id)&&!areMultipleElementsWithSameId(id)}function prefixedElementClassNames(node){var classAttribute=node.getAttribute("class");return classAttribute?classAttribute.split(/\s+/g).filter(Boolean).map(function(name){return"$"+name}):[]}function idSelector(id){return"#"+escapeIdentifierIfNeeded(id)}function escapeIdentifierIfNeeded(ident){if(isCSSIdentifier(ident))return ident;var shouldEscapeFirst=/^(?:[0-9]|-[0-9-]?)/.test(ident),lastIndex=ident.length-1;return ident.replace(/./g,function(c,i){return shouldEscapeFirst&&0===i||!isCSSIdentChar(c)?escapeAsciiChar(c,i===lastIndex):c})}function escapeAsciiChar(c,isLast){return"\\"+toHexByte(c)+(isLast?"":" ")}function toHexByte(c){var hexByte=c.charCodeAt(0).toString(16);return 1===hexByte.length&&(hexByte="0"+hexByte),hexByte}function isCSSIdentChar(c){return!!/[a-zA-Z0-9_-]/.test(c)||c.charCodeAt(0)>=160}function isCSSIdentifier(value){return/^-?[a-zA-Z_][a-zA-Z0-9_-]*$/.test(value)}if(1!==node.nodeType)return null;var id=node.getAttribute("id");if(optimized){if(id&&isValidId(id))return new DOMNodePathStep(idSelector(id),!0);var nodeNameLower=node.nodeName.toLowerCase();if("body"===nodeNameLower||"head"===nodeNameLower||"html"===nodeNameLower)return new DOMNodePathStep(node.nodeName.toLowerCase(),!0)}var nodeName=node.nodeName.toLowerCase();if(id&&isValidId(id))return new DOMNodePathStep(nodeName+idSelector(id),!0);var parent=node.parentNode;if(!parent||9===parent.nodeType)return new DOMNodePathStep(nodeName,!0);var result=nodeName,isGoodEnoughSelector=!1;if("input"===nodeName.toLowerCase()||"button"===nodeName.toLowerCase()?node.getAttribute("name")?(result+='[name="'+node.getAttribute("name")+'"]',isGoodEnoughSelector=!0):node.getAttribute("type")&&(result+='[type="'+node.getAttribute("type")+'"]'):"form"===nodeName.toLowerCase()&&node.getAttribute("name")&&!isDynamicId(node.getAttribute("name"))&&(result+='[name="'+node.getAttribute("name")+'"]',isGoodEnoughSelector=!0),$(result).length>1&&(isGoodEnoughSelector=!1),isGoodEnoughSelector)return new DOMNodePathStep(result,!0);for(var prefixedOwnClassNamesArray=prefixedElementClassNames(node),needsClassNames=!1,needsNthChild=!1,ownIndex=-1,elementIndex=-1,siblings=parent.children||0,i=0;(ownIndex===-1||!needsNthChild)&&i<siblings.length;++i){var sibling=siblings[i];if(1===sibling.nodeType)if(elementIndex+=1,sibling!==node){if(!needsNthChild&&sibling.nodeName.toLowerCase()===nodeName){needsClassNames=!0;var ownClassNames=keySet(prefixedOwnClassNamesArray),ownClassNameCount=0;for(var name in ownClassNames)++ownClassNameCount;if(0!==ownClassNameCount)for(var siblingClassNamesArray=prefixedElementClassNames(sibling),j=0;j<siblingClassNamesArray.length;++j){var siblingClass=siblingClassNamesArray[j];if(ownClassNames.hasOwnProperty(siblingClass)&&(delete ownClassNames[siblingClass],!--ownClassNameCount)){needsNthChild=!0;break}}else needsNthChild=!0}}else ownIndex=elementIndex}if(needsNthChild)result+=":nth-child("+(ownIndex+1)+")";else if(needsClassNames)for(var prefixedName in keySet(prefixedOwnClassNamesArray))result+="."+escapeIdentifierIfNeeded(prefixedName.substr(1));return new DOMNodePathStep(result,!1)}function keySet(array){for(var keys={},i=0;i<array.length;++i)keys[array[i]]=!0;return keys}var $=require("jquery");module.exports=function(node,optimized,ctx){return getUniquePath(node,optimized,ctx)};var DOMNodePathStep=function(value,optimized){this.value=value,this.optimized=optimized||!1};DOMNodePathStep.prototype={toString:function(){return this.value}}},{jquery:"jquery"}],5:[function(require,module,exports){function hasNonDivChildren($element){var hasNonDiv=!1;return $element.children().toArray().some(function(el){return $(el).is("div")?$(el).children().length>0&&(hasNonDiv=hasNonDivChildren($(el))):hasNonDiv=!0,hasNonDiv})}var $=require("jquery"),UrlParser=require("url-parser"),DomHelpers={};DomHelpers._activeTimers={},DomHelpers._timerIndex=0,module.exports=DomHelpers,DomHelpers.waitFor=function(selector,opts,callback){var timerIndex=DomHelpers._timerIndex;DomHelpers._timerIndex++,"function"==typeof opts&&(callback=opts,opts={}),opts=opts||{},opts.interval=opts.interval||500;var selectorFinder=DomHelpers._createSelectorFinder(selector,opts,timerIndex,callback);if(!selectorFinder()){var intervalID=setInterval(selectorFinder,opts.interval);DomHelpers._activeTimers[timerIndex]=intervalID}},DomHelpers.waitForElementToDissapear=function(element,interval,callback){interval=interval||500;var timerIndex=DomHelpers._timerIndex;DomHelpers._timerIndex++;var elementFinder=DomHelpers._createElementWatcher(element,timerIndex,callback);if(elementFinder()){var intervalID=setInterval(elementFinder,interval);DomHelpers._activeTimers[timerIndex]=intervalID}},DomHelpers._createElementWatcher=function(element,timerIndex,callback){return function(){var isInDom=$.contains(document.documentElement,element);return isInDom||(clearInterval(DomHelpers._activeTimers[timerIndex]),callback(!0)),isInDom}},DomHelpers._createSelectorFinder=function(selector,opts,timerIndex,callback){return function(){var result;opts.getAll?(result=$(selector).toArray(),result.length||(result=!1)):result=$(selector).get(0);var doCallback;return doCallback=opts&&opts.invert?!result:result,doCallback&&(clearInterval(DomHelpers._activeTimers[timerIndex]),callback(result)),!!result}},DomHelpers.matchesIPv4=function(test){return!!test.match(/(?:\d{1,3}\.){3}\d{1,3}/)},DomHelpers.getPageRequestTime=function(){return window.performance&&window.performance.timing?window.performance.timing.responseEnd-window.performance.timing.requestStart:-1},DomHelpers.getElement=function(selector){var el;try{el=$(selector).get(0)}catch(e){}return el},DomHelpers.getElements=function(selector){var els=[];try{els=$(selector).toArray()}catch(e){}return els},DomHelpers.getjQueryElement=function(selector){var $el=$();try{$el=$(selector)}catch(e){}return $el},DomHelpers.isValidSelector=function(selector){try{$(selector)}catch(error){return!1}return!0},DomHelpers.isEmpty=function(selector){var $element=$(selector);return!$element.length||(0===$element.children().length||!hasNonDivChildren($element))},DomHelpers.removeQueryString=function(url){var parsed=UrlParser.parse(url);return parsed.protocol+"//"+parsed.host+parsed.pathname},DomHelpers.addImportantStyleAttribute=function($element,styleProperty,styleValue){var oldStyle,newStyle=styleProperty+": "+styleValue+" !important;";$element.css(styleProperty,""),oldStyle=$element.attr("style"),oldStyle=oldStyle?oldStyle+" ":"",$element.attr("style",oldStyle+newStyle)}},{jquery:"jquery","url-parser":233}],6:[function(require,module,exports){function DomMessenger(localName,remoteName){function sendRawMessage(className,attrs){var el=$("<div>").addClass(className).attr(attrs).css({display:"none"}).appendTo("body");setTimeout(function(){el.click()},0),setTimeout(function(){el.remove()},3e3)}function sendMessage(){var args=Array.prototype.slice.call(arguments);receiverReady?sendMessageImmediate.apply(this,args):queue.push(args)}function isChannelEstablished(){return receiverReady}function onReceiverReady(){for(receiverReady=!0;queue.length>0;)sendMessageImmediate.apply(this,queue.pop())}function sendMessageImmediate(messageName,payload,callback){void 0===callback&&"function"==typeof payload&&(callback=payload,payload=null),void 0===payload&&(payload=null);var callbackId=newCallbackId();callback&&(callbacks[callbackId]=callback),sendRawMessage(outgoingRequestClassName,{"data-callback":callbackId,"data-payload":JSON.stringify(payload),"data-message":messageName})}function newCallbackId(){return(""+Math.random()).replace("0.","")}function setHandler(messageName,handler){handlers[messageName]=handler}function setHandlers(map){for(key in map)setHandler(key,map[key])}function handleIncomingRequest(e){function replyCallback(response){sendRawMessage(outgoingResponseClassName,{"data-callback":callbackId,"data-payload":JSON.stringify(response)})}var $el=$(e.currentTarget),callbackId=$el.attr("data-callback"),payloadString=$el.attr("data-payload")||"null",message=$el.attr("data-message");if($el.remove(),e.preventDefault(),e.stopPropagation(),"__ready__"===message)return void onReceiverReady();var payload=JSON.parse(payloadString),handler=handlers[message];if(null==handler)return void console.error("No handler for message:",message);handler(payload,replyCallback)}function handleIncomingResponse(e){var $el=$(e.currentTarget),callbackId=$el.attr("data-callback"),payloadString=$el.attr("data-payload")||"null",payload=JSON.parse(payloadString),callback=callbacks[callbackId];delete callbacks[callbackId],"function"==typeof callback&&callback(payload),$el.remove()}function initMessaging(localName,remoteName){var $body=$("body");$body.on("click","."+incomingRequestClassName,handleIncomingRequest),$body.on("click","."+incomingResponseClassName,handleIncomingResponse),$body.attr("data-messenger-"+localName,"1"),sendRawMessage(outgoingRequestClassName,{"data-message":"__ready__"}),$("body").attr("data-messenger-"+remoteName)&&(receiverReady=!0,console.log("We loaded second"),onReceiverReady())}var incomingRequestClassName="messaging-"+remoteName+"-to-"+localName,outgoingRequestClassName="messaging-"+localName+"-to-"+remoteName,incomingResponseClassName=outgoingRequestClassName+"-reply",outgoingResponseClassName=incomingRequestClassName+"-reply",handlers={},callbacks={},receiverReady=!1,queue=[];return $(document).ready(function(){initMessaging(localName,remoteName)}),{sendMessage:sendMessage,setHandler:setHandler,setHandlers:setHandlers,isChannelEstablished:isChannelEstablished}}var $=require("jquery");module.exports=DomMessenger},{jquery:"jquery"}],7:[function(require,module,exports){var EventEmitter2=require("eventemitter2").EventEmitter2;module.exports=function(){return new EventEmitter2({delimiter:":"})}()},{eventemitter2:151}],8:[function(require,module,exports){function filterAssets(assets,userName,appendString,compareCase){return assets.filter(function(asset){var assetUserName=compareCase?asset.login:asset.login.toLowerCase();return userName=compareCase?userName:userName.toLowerCase(),assetUserName===userName||assetUserName===userName+appendString||assetUserName+appendString===userName})}function selExists(selector){var $sel=sanitizeSelector(selector);return $sel?$sel.length>0:void 0}function sanitizeSelector(selector){return"string"!=typeof selector||matchHTML(selector)||!isSelectorSyntaxValid(selector)?void 0:$(selector)}function isSelectorSyntaxValid(selector){try{$(selector)}catch(e){return utils.sendMixpanelFailure({atlas_error_type:"jQuery selector syntax threw an error on initialization",invalid_selector:selector,website_url:metrics.url}),!1}return!0}function matchHTML(selector){return!!(selector.match(/<script[^>]*?>.*?<\/script>/gi,"")||selector.match(/<[\/\!]*?[^<>]*?>/gi,"")||selector.match(/<style[^>]*?>.*?<\/style>/gi,"")||selector.match(/<![\s\S]*?--[ \t\n\r]*>/gi,""))&&(utils.sendMixpanelFailure({atlas_error_type:"jQuery selector contains HTML",invalid_selector:selector,website_url:metrics.url}),!0)}var $=require("jquery"),logger=require("../logger"),utils=require("./utils"),whiteListCrossDomainUrls=["https://feedback.truekey.com/truekey"],_=require("underscore"),metrics=require("../metrics"),Target=require("../target"),triggerClick=require("../form-manager/events.js").triggerClick,getFieldsByType=require("../form-manager/helpers").getFieldsByType,framework={handleCookieForm:function(usernameTextSelector,params,appendString,callback){var selectedCookieAsset,$username=sanitizeSelector(usernameTextSelector);if($username.length){if(selectedCookieAsset=$($username[0]).html()||$username[0].value,!selectedCookieAsset)return;params.saved_assets=filterAssets(params.saved_assets,selectedCookieAsset,appendString),callback(params)}},forcePasswordFieldType:function(form){var passwordField;form&&form.fields&&(passwordField=getFieldsByType(form.fields,"password"),_.each(passwordField,function(field){field.el.setAttribute("type","password")}))},appendHiddenInput:function(formSelector,inputId,type,pbRole){var pbRoleFormatted,newInput,$form=sanitizeSelector(formSelector);$form&&!selExists("input#"+inputId)&&(pbRoleFormatted=pbRole?'pb-role="'+pbRole+'"':"",newInput=$('<input type="'+type+'" id="'+inputId+'"'+pbRoleFormatted+" />").hide(),$form.append(newInput))},transferFragmentedInput:function(formSelector,fragmentSelector,inputSelector){var $fragments,$form=sanitizeSelector(formSelector),$inputToFill=sanitizeSelector(inputSelector);$inputToFill&&$form&&sanitizeSelector(fragmentSelector)&&($fragments=$form.find(fragmentSelector),$fragments.on("blur",function(e){var inputValue="";$fragments.each(function(){inputValue+=$(this).val()}),$inputToFill.val(inputValue)}))},ignoreIfExists:function(formType,selector){var options,$sel=sanitizeSelector(selector);$sel&&$sel.length&&(options=PB.contentscript.intelForUrl.settings.detect,options[formType]={ignore:selector},PB.contentscript.intelForUrl.settings.detect=options)},hasClass:function(selector,className){var $sel=sanitizeSelector(selector);if($sel)return $sel.hasClass(className)},forEach:function(list,callback){_.each(list,callback)},filterFormFields:function(form,fieldTypeString){return selExists(form.selector)?(form.fields=form.fields.filter(function(field){return field.fieldType!==fieldTypeString}),form):form},filterAssets:function(assets,userName,appendString,compareCase){return filterAssets(assets,userName,appendString,compareCase)},getStringLength:function(string){return string.length},debug:function(msg){logger.log("exceptions",msg)},getAutoLoginType:function(){return PBCS.assets.auto_login_type},isIframe:function(){return PBCS.currentLocation.isIframe},getWindowHref:function(){return location.href},waitForSelector:function(selector,callback){sanitizeSelector(selector)&&PBCS.DomHelpers.waitFor(selector,callback)},redirect:function(url){var redirectUrlParsed=PB.contentscript.urlParser.parse(encodeURI(url)),urlTabParsed=PB.contentscript.urlParser.parse(window.location.href);~whiteListCrossDomainUrls.indexOf(url)||urlTabParsed.domain&&urlTabParsed.domain===redirectUrlParsed.domain?location.href=url:utils.sendMixpanelFailure({atlas_error_type:"redirect to a different domain",pi_redirection_url:url,website_url:metrics.url})},bind:function(selector,action,callback){var $sel=sanitizeSelector(selector);$sel&&$sel.on(action,function(e){callback()})},css:function(selector,property,value){var $sel=sanitizeSelector(selector);if($sel)return void 0===value?$sel.css(property):$sel.css(property,value)},setCssPropertyEach:function(selector,property,value){var $sel=sanitizeSelector(selector);$sel&&$sel.each(function(index){$(this).css(property,value)})},click:function(selector){var $sel=sanitizeSelector(selector);$sel&&$sel.length>0&&triggerClick($sel[0])},getHTML:function(selector){var $sel=sanitizeSelector(selector);return $sel?$sel.html():void 0},getVal:function(selector){var $sel=sanitizeSelector(selector);return $sel?$sel.val():void 0},setVal:function(selector,value){var $sel=sanitizeSelector(selector);$sel&&$sel.val(value)},getAttr:function(selector,attr){var $sel=sanitizeSelector(selector);return $sel?$sel.attr(attr):void 0},removeAttr:function(selector,attr){var $sel=sanitizeSelector(selector);return $sel?$sel.removeAttr(attr):void 0},setAttr:function(selector,attr,value){var $sel=sanitizeSelector(selector);$sel&&$sel.attr(attr,value)},exists:function(selector){return selExists(selector)},getLinkHref:function(selector){var sel;return selector instanceof Element?selector.getAttribute("href"):(sel=sanitizeSelector(selector),sel?sel.attr("href"):void 0)},hideElement:function(selector){var $sel=sanitizeSelector(selector);$sel&&$sel.hide()},showElement:function(selector){var $sel=sanitizeSelector(selector);$sel&&$sel.show()},getTarget:function(){return Target.Name},isLegacy:function(){return Target.LEGACY}};module.exports=framework},{"../form-manager/events.js":83,"../form-manager/helpers":86,"../logger":130,"../metrics":135,"../target":142,"./utils":11,jquery:"jquery",underscore:"underscore"}],9:[function(require,module,exports){function EM(){if(!(this instanceof EM))return new EM;this.userActions={}}var safeEval,$=require("jquery"),framework=require("./framework"),logger=require("../logger"),UrlParser=require("url-parser"),utils=require("./utils"),_=require("underscore"),metrics=require("../metrics"),remoteExceptionsLoaded=!1;module.exports=EM;var HOOKS=["pb:cs:disableCs","pb:cs:intelready","pb:cs:init","pb:cs:loginDetect","pb:cs:initFillForms","pb:cs:formManager:atlasForms","pb:cs:formManager:processForms","pb:cs:formManager:findForms","pb:cs:formManager:getFormData","pb:cs:formManager:detect","pb:cs:formManager:roles","pb:cs:formManager:selectAsset","pb:cs:formManager:fillForm","pb:cs:formManager:submitForm","pb:cs:formManager:autoLoginVisibilityCheck","pb:cs:formManager:userSubmitedForm","pb:cs:formManager:handleSubmitClick","pb:cs:formManager:sendDataToBackground","pb:cs:formManager:handleAjaxSubmit","pb:cs:lastChance:start","pb:cs:ensureOneClick"];EM.prototype._exceptionsForUrl=function(moment,options){return options=options||{},this._getExceptions(options.url).filter(function(obj){return obj.moment===moment})},EM.prototype._getExceptions=function(url){var that=this;url||(url=window.location.href);var hostname=UrlParser.parse(url).hostname;return _.flatten(_.keys(this.userActions).map(function(key){var validExceptions=that.userActions[key].filter(function(exception){return new RegExp(key,"i").test("hardcoded"===exception.type?hostname:url)});return validExceptions.length?validExceptions:void 0}).filter(Boolean))},EM.prototype._processRoles=function(params){var roles=PB.contentscript&&PB.contentscript.intelForUrl&&PB.contentscript.intelForUrl.settings&&PB.contentscript.intelForUrl.settings.roles||{};Object.keys(roles).forEach(function(type){var el=$(params.el).find(roles[type]);"captcha"===type&&(el=el.filter(":visible")),el.length&&(params.roles[type]=el.toArray()),logger.log("exceptions","processing roles",type)})},EM.prototype._executeExceptions=function(name,options){options=options||{},"pb:cs:formManager:roles"===name&&this._processRoles(options.params);var exceptions=this._exceptionsForUrl(name,options),remote=exceptions.filter(function(e){return"remote"===e.type}),hardcoded=exceptions.filter(function(e){return"hardcoded"===e.type});exceptions=remote.length?remote:hardcoded,remote.length&&!safeEval&&(safeEval=require("notevil")),exceptions.forEach(function(act){if(logger.log("exceptions","executing exception",{moment:name,action:act.action.toString()}),"function"==typeof act.action)return act.action(options.params);framework.params=options.params;try{safeEval(act.action,framework)}catch(e){logger.log("exceptions","safeEval execution has thrown an exception",e),utils.sendMixpanelFailure({atlas_error_type:"safeEval execution has thrown an exception",atlas_error_message:e.message,atlas_error_stack:e.stack,atlas_exception_action:act.action,atlas_exception_location:act.location,atlas_exception_moment:name,domain:metrics.domain,website_url:metrics.url})}})},EM.prototype.trigger=function(hook,data,options){return data||(data={}),options=options||{},options.params=data,logger.log("exceptions","triggering exceptions hook",hook),HOOKS.indexOf(hook)===-1&&logger.log("exceptions","WARNING unregistered hook",hook),this._executeExceptions(hook,options),this},EM.prototype.on=function(hook,location,fn,type){if(!(arguments.length<4))return HOOKS.indexOf(hook)===-1&&logger.log("exceptions","WARNING unregistered hook",hook),this.userActions[location]||(this.userActions[location]=[]),this.userActions[location].push({moment:hook,action:fn,type:type}),this},EM.prototype.load=function(rules){var that=this;return remoteExceptionsLoaded||(rules.forEach(function(rule){that.on(rule.moment,rule.location,rule.action,"remote")}),remoteExceptionsLoaded=!0),this},EM.prototype.loadHardcoded=function(rules){var that=this;return Object.keys(rules).forEach(function(hostname){rules[hostname].forEach(function(rule){that.on(rule.moment,hostname,rule.action,"hardcoded")})}),this}},{"../logger":130,"../metrics":135,"./framework":8,"./utils":11,jquery:"jquery",notevil:215,underscore:"underscore","url-parser":233}],10:[function(require,module,exports){function fillInputAeroplan($fragments,val){var username=val.replace(/\s/g,"");9===username.length&&3===$fragments.length&&(PB.contentscript.formManager.fillInput($fragments[0],username.substr(0,3)),PB.contentscript.formManager.fillInput($fragments[1],username.substr(3,3)),PB.contentscript.formManager.fillInput($fragments[2],username.substr(6,3)))}function setRolesAeroplan(params,loginForm,fakeUsernameFieldId){var $fakeUsernameField=$("input#"+fakeUsernameFieldId);$fakeUsernameField.length&&(params.roles=params.roles||{},params.roles.username=[$fakeUsernameField.get(0)])}function interceptUserNameAeroplan(loginForm,fakeUsernameFieldId,fragment){if(loginForm.length){var $fragments=loginForm.find(fragment),$fakeUsernameField=$("input#"+fakeUsernameFieldId);$fakeUsernameField.length||($fakeUsernameField=$('<input type="text" id="'+fakeUsernameFieldId+'" pb-role="username"/>').hide(),loginForm.append($fakeUsernameField)),$fragments.on("keyup",function(e){var username="";$fragments.each(function(){username+=$(this).val()}),$fakeUsernameField.val(username)})}}var $=require("jquery"),logger=require("../logger");module.exports={"^altitude\\.aircanada\\.com$":[{moment:"pb:cs:init",action:function(){logger.log("exceptions","fix for username in 3 fields aircanada"),interceptUserNameAeroplan($("div.loginRow form"),"PB_FakeUsernameAirCanada","input[id^=headerCardNumber]")}},{moment:"pb:cs:formManager:roles",action:function(params){logger.log("exceptions","forcing fakeUsernameField for AirCanada"),setRolesAeroplan(params,$("div.loginRow form"),"PB_FakeUsernameAirCanada")}},{moment:"pb:cs:formManager:fillForm",action:function(params){logger.log("exceptions","forcing fakeUsernameField for AirCanada"),fillInputAeroplan($("input[id^=headerCardNumber]"),params.asset.login)}}],"^sfglobe\\.com$":[{moment:"pb:cs:formManager:findForms",action:function(opts){return logger.log("exceptions","forcing execOnStart to false on SFGlobe"),opts.execOnStart=!1,opts}}],"^login\\.capitalone\\.com$":[{moment:"pb:cs:formManager:selectAsset",action:function(params){var username=params.saved_assets&&params.saved_assets.length&&params.saved_assets[0].login;username&&setTimeout(function(){PB.contentscript.formManager.fillInput(document.querySelector("input#uname"),username)},250)}}],"^(www\\.)?amazon\\.\\w{2,3}(.\\w{2,3})?$":[{moment:"pb:cs:init",action:function(){"one_click_login"===PBCS.assets.auto_login_type&&(logger.log("exceptions","fix for login url"),PBCS.DomHelpers.waitFor("#nav-flyout-ya-signin a.nav-action-button",function(el){var url=$(el).attr("href");url&&(location.href=url)}))}}],"^([\\w]+\\.)?hulu\\.com$":[{moment:"pb:cs:formManager:fillForm",action:function(params){logger.log("exceptions","fix for login form");var $form=$(params.form.el);$form.find(".dummy").hide(),$form.find("#login, #password").show()}},{moment:"pb:cs:loginDetect",action:function(params){$("#payment-info-form").length&&(params.isLoginPage=!1,params.login_detect_reasons="The logged-in menu is in the page with the payment form")}}],"^(\\www\\.)?alce\\/.ca$":[{moment:"pb:cs:formManager:roles",action:function(params){params.roles&&params.roles.submit&&params.roles.submit.forEach(function(el){$(el).removeAttr("disabled")})}}],"^www.v-roomonline.com":[{moment:"pb:cs:intelready",action:function(params){!PBCS.currentLocation.isIframe&&location.href.match("www.v-roomonline.com/login.aspx")&&(PB.contentscript.intelForUrl.settings.contentScript=!1,PB.contentscript.intelForUrl.ignoreNotification=!0)}}],"^([\\w]+\\.)?accounts\\.google\\.com$":[{moment:"pb:cs:formManager:atlasForms",action:function(params){logger.log("exceptions","Remove username field on google if not visible :",params.forms),$("input#Email").hasClass("hidden")&&(params.forms=params.forms.reduce(function(newForm,form){return"login"!==form.formType?newForm.push(form):(form.fields=form.fields.reduce(function(ret,field){return"username"===field.fieldType&&$(field.selector).hasClass("hidden")?ret:(ret.push(field),ret)},[]),newForm.push(form))},[]))}},{moment:"pb:cs:formManager:selectAsset",action:function(params){if(logger.log("exceptions","Fix for login page with username static. asset:",params.saved_assets),params){var $newEl=$("span#reauthEmail"),i=0,saved_asset=[],domainIndex=-1,shortLogin="";if($("input#Email").hasClass("hidden")&&$newEl.length){var selectedAssetByGoogle=$newEl.html(),tmpSaveAssets=[];for(i=0;i<params.saved_assets.length&&(saved_asset=params.saved_assets[i],domainIndex=selectedAssetByGoogle.indexOf("@"),shortLogin=selectedAssetByGoogle.substr(0,domainIndex),saved_asset.login!==selectedAssetByGoogle&&saved_asset.login!==shortLogin||(tmpSaveAssets[0]=params.saved_assets[i],saved_asset.login!==selectedAssetByGoogle));i++);params.saved_assets=tmpSaveAssets,1===params.saved_assets.length&&(params.auto_login=!params.is_tab_ignored&&"1"===params.saved_assets[0].autologin)}}}},{moment:"pb:cs:formManager:getFormData",action:function(params){if("username"===params.inputProps.role){var username=$("span#reauthEmail").html();if(username&&!(username.length<2)){params.inputProps.value=username;return(params.inputProps.value&&params.inputProps.value.indexOf("@"))===-1?(logger.log("exceptions","Fix for google apps login. The @domain.com is appended to username"),void(params.inputProps.value=params.inputProps.value+"@gmail.com")):void 0}}}},{moment:"pb:cs:formManager:getFormData",action:function(params){"username"===params.inputProps.role&&params.inputProps.value&&!~params.inputProps.value.indexOf("@")&&(params.inputProps.value+="@gmail.com")}}],"wwws\\.mint\\.com":[{moment:"pb:cs:intelready",action:function(params){location.href.match("wwws.mint.com/loginJumper.event")&&(PB.contentscript.intelForUrl.settings.contentScript=!1,PB.contentscript.intelForUrl.ignoreNotification=!0)}}],"^(www\\.)?rds\\.ca":[{moment:"pb:cs:intelready",action:function(params){$(".loggedin").is(":visible")&&(PB.contentscript.intelForUrl.settings.detect={login:{ignore:"#loginForm, div"}})}}],"^(www\\.)?flipkart\\.com":[{moment:"pb:cs:intelready",action:function(params){$(".signup-link").length||(PB.contentscript.intelForUrl.settings.detect={login:{ignore:"#login-form"}})}}],"^(www\\.)?kongregate\\.com":[{moment:"pb:cs:intelready",action:function(params){$("#nav_welcome_box").is(":visible")&&(PB.contentscript.intelForUrl.settings.detect={login:{ignore:"#nav_sign_in",force:""}})}}],"^roe\\.prodigy\\.co\\.id":[{moment:"pb:cs:intelready",action:function(params){$("#imlogged").length&&"visible"==$("#imlogged").css("visibility")&&(PB.contentscript.intelForUrl.settings.detect={login:{ignore:".sidebr form"}})}}],"^wartune\\.r2games\\.com":[{moment:"pb:cs:intelready",action:function(params){$("#welcome").length&&(PB.contentscript.intelForUrl.settings.detect={login:{ignore:"#login_form"}})}}],"^(www\\.)?shutterstock\\.com":[{moment:"pb:cs:intelready",action:function(params){$("#inline_login").length||(PB.contentscript.intelForUrl.settings.detect={login:{ignore:"#inline_login_form"}})}}],"^(www\\.)?marriott\\.com":[{moment:"pb:cs:intelready",action:function(params){location.href.match("marriott.com/(directLogin.mi|signIn.mi|ProtectedServlet)")&&(PB.contentscript.intelForUrl.settings.contentScript=!1,PB.contentscript.intelForUrl.ignoreNotification=!0)}}],"^(www\\.)?letitbit\\.net":[{moment:"pb:cs:intelready",action:function(params){$(".account-data").length&&(PB.contentscript.intelForUrl.settings.detect={login:{ignore:"#dialog_auth form"}})}}],"^(forums|store)\\.steampowered\\.com":[{moment:"pb:cs:formManager:selectAsset",action:function(params){
var service=location.hostname.match(/^(forums|store)\.steampowered\.com/)[1];params.saved_assets=params.saved_assets.filter(function(asset){return!asset.domain.indexOf(service)})}}],"^(www\\.)?dropbox\\.com":[{moment:"pb:cs:intelready",action:function(params){location.href.match("dropbox.com/verify_code")&&(PB.contentscript.intelForUrl.settings.contentScript=!1,PB.contentscript.intelForUrl.ignoreNotification=!0)}},{moment:"pb:cs:formManager:submitForm",action:function(params){params.submitDelay=1250}}],"^(www\\.)?twitter\\.com":[{moment:"pb:cs:intelready",action:function(params){location.href.match("twitter.com/account/login_verification")&&(PB.contentscript.intelForUrl.settings.contentScript=!1,PB.contentscript.intelForUrl.ignoreNotification=!0)}}],"^(www\\.)?facebook\\.com":[{moment:"pb:cs:formManager:getFormData",action:function(params){if(params.inputProps&&"username"===params.inputProps.role&&!params.inputProps.value){var info=params.el.querySelector(".fbLoggedOutAccountBlock"),text=info&&info.innerText||"",emails=text.match(/.+\@.+\..+/),email=emails&&emails[0];email&&(params.inputProps.value=email)}}}],"^(www\\.)?instagram\\.com":[{moment:"pb:cs:init",action:function(opts){location.href.match("instagram.com/accounts/login")&&($(".lpDialog").width(450),$(".LoadableIframe").height(330))}}],"^(www\\.)?paypal\\.com":[{moment:"pb:cs:disableCs",action:function(params){$("#mainForm #securityCode").length&&(params.exitCS=!0)}}],"^(www\\.)?bankofamerica\\.com$":[{moment:"pb:cs:intelready",action:function(){logger.log("exceptions","fix for bankofamerica username");var $user=$("input#id");$user.append('<input type="hidden" id="uzer">'),$user.on("change",function(e){$("input#uzer").val(e.target.value)})}},{moment:"pb:cs:formManager:getFormData",action:function(params){params.inputProps&&"username"===params.inputProps.role&&(params.inputProps.value=$("input#uzer").val()||params.inputProps.value)}}],"^((login|nb|www)\\.)?fidelity\\.com$":[{moment:"pb:cs:formManager:atlasForms",action:function(){logger.log("exceptions","creating dummy input on fidelity.com to cache unmasked username");var $fidelityUsername=$("input#userId-input, input#temp_id, input#ssnt");if($fidelityUsername.length){var dummyInput=document.createElement("input");dummyInput.id="pb-dummy-username",dummyInput.style.cssText="display:none;",$($fidelityUsername.parents()[0]).prepend(dummyInput),$fidelityUsername.on("change",function(e){dummyInput.value=this.value})}}},{moment:"pb:cs:formManager:getFormData",action:function(params){if(logger.log("exceptions","override username value when saving asset on fidelity.com"),params.inputProps&&"username"===params.inputProps.role){var dummyUsername=document.querySelector("input#pb-dummy-username");params.inputProps.value=dummyUsername&&dummyUsername.value||params.inputProps.value}}},{moment:"pb:cs:formManager:fillForm",action:function(params){if(params&&params.form&&params.asset&&params.asset.login){var usernameField=params.form&&params.form.fields&&params.form.fields.filter(function(field){return"username"===field.fieldType}),el=usernameField[0]&&usernameField[0].el;setTimeout(function(){logger.log("exceptions","setting attribute with unmasked value to ensure autofill on fidelity.com"),el.setAttribute("data-unmasked",params.asset.login),$("#ssnt","#SSN, #hiddenId").val(params.asset.login),PB.contentscript.formManager.fillInput(el,params.asset.login)},4e3)}}},{moment:"pb:cs:formManager:submitForm",action:function(params){(location.href.indexOf("login.fidelity.com")>-1||location.href.indexOf("nb.fidelity.com")>-1||location.href.indexOf("www.fidelity.com")>-1)&&(logger.log("exceptions","delaying autosubmit for 1sec on fidelity.com"),params.submitDelay=5e3)}}],"^itunesconnect\\.apple\\.com":[{moment:"pb:cs:formManager:selectAsset",action:function(params){params.saved_assets=params.saved_assets.filter(function(asset){return!asset.domain.indexOf("itunesconnect")})}}],"signup\\.live\\.com":[{moment:"pb:cs:formManager:getFormData",action:function(params){var usernameField=$("#MemberName"),nextLabel=$("#MemberName + label"),labelVisible="none"!==nextLabel.css("display");"username"===params.inputProps.role&&labelVisible&&(params.inputProps.value=usernameField.val()+nextLabel.text())}}],"edit\\.yahoo\\.com":[{moment:"pb:cs:intelready",action:function(params){var confirm=document.getElementById("confirm-password");confirm&&confirm.setAttribute("pb-role","password")}},{moment:"pb:cs:disableCs",action:function(params){($("#captchaV5ClassicCaptchaImg").length||$('form[data="sendSMSValidationConfigs"]').length||$("#timer-message").length)&&(params.exitCS=!0)}}],"new\\.aol\\.com":[{moment:"pb:cs:formManager:getFormData",action:function(params){"username"===params.inputProps.role&&params.inputProps.value.indexOf("@aol.com")===-1&&(params.inputProps.value+="@aol.com")}}],"^(www\\.)?firstrepublichb\\.com":[{moment:"pb:cs:intelready",action:function(params){"https://www.firstrepublichb.com/tob/live/usp-core/app/initialLogin"===location.href&&(PB.contentscript.intelForUrl.settings.contentScript=!1,PB.contentscript.intelForUrl.ignoreNotification=!0)}},{moment:"pb:cs:formManager:fillForm",action:function(params){if(params&&params.form){params.asset.login&&location.href.match("firstrepublichb.com/onlineserv/HB/.*cgi")&&setTimeout(function(){PB.contentscript.formManager.fillForm(params.form,params.asset,!0)},250)}}}],"^(www\\.)?my\\.screenname\\.aol\\.com$":[{moment:"pb:cs:formManager:findForms",action:function(opts){document.querySelector("#asq > form")&&(logger.log("exceptions","forcing 2 steps on screenname.aol.com "),opts.filters["two-factor"]={force:"#asq > form"})}}],"^(www\\.)?t-online\\.de$":[{moment:"pb:cs:intelready",action:function(opts){$("iframe#LoginFrame").height(300).width(431),$("#Thead3").css("z-index","9999"),$("object").each(function(){var params=$(this).children("param[name=wmode], param[name=wMode]");params.size()?params.val("transparent"):$(this).prepend('<param name="wMode" value="transparent"/>')})}}],"^(www\\.)?naver\\.com$":[{moment:"pb:cs:init",action:function(opts){$(".login #loginframe").width(440).height(320)}}],"^login\\.yahoo\\.com$":[{moment:"pb:cs:formManager:submitForm",action:function(params){params.submitDelay=1250}}],"accesd\\.desjardins\\.com":[{moment:"pb:cs:intelready",action:function(params){$("[name=LogonForm]").length&&"document.LogonForm.submit()"===$(document.body).attr("onload")&&(PB.contentscript.intelForUrl.settings.contentScript=!1,PB.contentscript.intelForUrl.ignoreNotification=!0)}}],"www\\.engadget\\.com":[{moment:"pb:cs:intelready",action:function(params){$("#user-menu").length&&(PB.contentscript.intelForUrl.settings.detect={login:{ignore:"form#login-form"}})}}],"mockflow\\.com":[{moment:"pb:cs:loginDetect",action:function(params){!!~$("#indexContent").text().indexOf("Account created")&&(params.isLoginPage=!1,params.login_detect_reasons="Ajax submit shows a blocking success message")}}],"wix\\.com":[{moment:"pb:cs:loginDetect",action:function(params){$("div.wm-logged-in").length&&(params.isLoginPage=!1,params.login_detect_reasons="The logged-in menu is in the page.")}}],"mya\\.godaddy\\.com":[{moment:"pb:cs:loginDetect",action:function(params){$("#PageBody").length&&(params.isLoginPage=!1,params.login_detect_reasons="#PageBody class is in the DOM")}}],"hautelook\\.com":[{moment:"pb:cs:loginDetect",action:function(params){$(".secondary-nav__account-menu").length&&(params.isLoginPage=!1,params.login_detect_reasons="Account submenu is in the DOM.")}}]}},{"../logger":130,jquery:"jquery"}],11:[function(require,module,exports){var utils={sendMixpanelFailure:function(params){FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"atlas_remote_exception_failure",mixpanel_params:params})}};module.exports=utils},{}],12:[function(require,module,exports){module.exports={name:"fdetect",repository:"passwordbox/fdetect","private":!0,description:"deterministic form detection module in javascript, used for the short tail.",version:"0.3.1",main:"lib/index.js",json:["component.json"],scripts:["lib/index.js","lib/utils/google-cssPath.js","lib/utils/*.js","lib/finder/*.js","lib/field-finders/*.js","lib/form-classifiers/*.js","lib/element-categorizers/*.js","lib/form-finders/*.js"],dependencies:{"passwordbox/jquery":"1.8.2","jashkenas/underscore":"*","visionmedia/debug":"*","passwordbox/visible":"*","passwordbox/measure":"*"},development:{dependencies:{"chaijs/chai":"*","component/domify":"*"},styles:["test/index.css"],scripts:["test/lib/finder/finder.js","test/lib/utils/concat-regexp.js","test/lib/it-should/index.js","test/lib/utils/simple_statistics.js","test/lib/login/tests.js","test/lib/login/index.js","test/lib/signup/tests.js","test/lib/signup/index.js","test/lib/payment/tests.js","test/lib/payment/index.js","test/lib/two-factor/tests.js","test/lib/two-factor/index.js","test/lib/reset/tests.js","test/lib/reset/index.js","test/lib/performance/tests.js","test/lib/performance/index.js"],templates:["test/lib/**/fixtures/*.html"]}}},{}],13:[function(require,module,exports){module.exports=require("./lib")},{"./lib":72}],14:[function(require,module,exports){function is(type,el){var matches=[];return isLogin(el)&&matches.push("login"),isSignup(el)&&matches.push("signup"),isReset(el)&&matches.push("reset"),1==matches.length&&!!~matches.indexOf(type)}var isLogin=require("./login"),isSignup=require("./signup"),isReset=require("./reset");module.exports=is},{"./login":15,"./reset":16,"./signup":17}],15:[function(require,module,exports){function isLogin(el){return withLoginAttributes(el)}function withLoginAttributes(el){var attrs=["id","action","class","name","title","onsubmit"],regexps=concat([/(sign|log)(.?)[io]n/i,/\bsso\b/i,/user_session$/i]);$(el);return attrs.some(function(attr){var text=$(el).attr(attr);return regexps.some(function(reg){return reg.test(text)})})}var concat=(require("../field-finders/signup-button"),require("../field-finders/login-button"),require("../utils/sort-by-dom").sort,require("../utils/concat-regexp")),$=require("jquery");module.exports=isLogin},{"../field-finders/login-button":42,"../field-finders/signup-button":48,"../utils/concat-regexp":73,"../utils/sort-by-dom":80,jquery:"jquery"}],16:[function(require,module,exports){function isReset(el){return withResetAttributes(el)}function withResetAttributes(el){var attrs=["id","action","class","name","title","onsubmit"],regexps=concat([/(change|reset|edit|update)(.?)(password|form)/i,/edit(passwd|password)/i,/update.*setting(s?)/i,/settings.profile/i]);$(el);return attrs.some(function(attr){var text=$(el).attr(attr);return regexps.some(function(reg){return reg.test(text)})})}var concat=require("../utils/concat-regexp"),$=require("jquery");module.exports=isReset},{"../utils/concat-regexp":73,jquery:"jquery"}],17:[function(require,module,exports){function isSignup(el){return withSignupAttributes(el)||withSignupText(el)}function withSignupAttributes(el){return filterElementByAttributes(el,["id","action","class","name","title","onsubmit"],concat([/sign.?up/i,/enroll/i,/join/i,/reg/i]),concat([/(change|reset|edit|update)(.?)(password|form)/i,/edit(passwd|password)/i,/update.*setting(s?)/i]))}function withSignupText(el){var regexps=[/sign.?up|register/i],$el=$(el),links=$el.find("a").text(),text=$el.text().replace(links,"");return regexps.some(function(reg){return reg.test(text)})}var concat=(require("../field-finders/signup-button"),require("../field-finders/login-button"),require("../utils/sort-by-dom").sort,require("../utils/concat-regexp")),$=require("jquery"),filterElementByAttributes=require("../utils/filter-element-by-attributes");module.exports=isSignup},{"../field-finders/login-button":42,"../field-finders/signup-button":48,"../utils/concat-regexp":73,"../utils/filter-element-by-attributes":74,"../utils/sort-by-dom":80,jquery:"jquery"}],18:[function(require,module,exports){function isTwoFactor(el){return withTwoFactorText(el)||withTwoFactorAttributes(el)}function withTwoFactorAttributes(el){var attrs=["id","action","class","name","title","onsubmit"],regexps=[/(two|second).*factor/i,/(otc|otp|verification)/i];$(el);return attrs.some(function(attr){var text=$(el).attr(attr);return regexps.some(function(reg){return reg.test(text)})})}function withTwoFactorText(el){var text=$(el).text();return[/two.{1}factor\sauthentication/i,/enter\s(the\s)?security\scode/i].some(function(reg){return reg.test(text)})}var $=require("jquery");module.exports=isTwoFactor},{jquery:"jquery"}],19:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text]").accept(/address.*label/i).reject(/email/i).lookup("id","class","name")}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:address_title").map("findByAttributes",findByAttributes)},{"../finder":54}],20:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text]").lookup("id","class","name").accept(/address/i,/^street/i,/shipadd-add/i,/(billing|shipping).*street/i,/ad.*line.*\d/i,/ship_addr.*/i).reject(/email/i,/name/i,/city/i,/state/i,/region/i,/postal/i,/phone/i,/zip/i,/label/i,/careof/i)}function findByLabelText(){return this.select("label").lookup("text","val").accept(/street.*address/i,/address.*line/i,/(billing|shipping).*street/i).reject(/email/i,/name/i,/city/i,/state/i,/region/i,/postal/i,/phone/i,/zip/i,/label/i,/careof/i).map(findInputsForLabels).filter(function(el){return"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:address").map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],21:[function(require,module,exports){function findByLabelText(){return this.select("label").accept(/date.*of.*birth/i).reject(/day/i,/month/i,/year/i).lookup("text").map(findInputsForLabels).filter(function(el){return"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:birthday_date").map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],22:[function(require,module,exports){function findByAttributes(){return this.accept(/birthday.*day/i,/day.*birthday/i).reject(/month/i,/year/i).select("select,input[type=text]").lookup("id","autocomplete","name","data").fullText(!0)}function findByLabelText(){return this.select("label").accept(/day/i).lookup("text").map(findInputsForLabels).filter(function(el){return"text"===el.type}).lookup("id").accept(/birth/i).reject(/month/i,/year/i)}function findByOptionText(){return this.accept(/birth.*day/i).reject(/month/i,/year/i).select("select").lookup("id","class","name").filter(function(el){var options=$(el).find("option").toArray();return options.length>=28&&options.length<=32&&options.every(function(el){return/\d\d?/i.test($(el).val())})})}var finder=require("../finder"),$=require("jquery"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:birthday_day").map("findByAttributes",findByAttributes).map("findByOptionText",findByOptionText).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75,jquery:"jquery"}],23:[function(require,module,exports){function findByLabelText(){return this.select("label").accept(/month/i).lookup("text").map(findInputsForLabels).filter(function(el){return"text"===el.type}).lookup("id").accept(/birth/i)}function findByOptionText(){return this.accept(/date|birth/i).select("select").lookup("id","class","name").filter(function(el){var options=$(el).find("option").toArray();return options.length>=12&&options.length<=14&&options.some(function(el){return["text","val"].some(function(fn){return/birth.*month/i.test($(el)[fn]())})})})}function findByAttributes(){return this.accept(/birth.*month/i,/month.*birth/i).reject(/year/i).select("select,input[type=text]").lookup("id","autocomplete","name","data").fullText(!0)}var finder=require("../finder"),$=require("jquery"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:birthday_month").map("findByAttributes",findByAttributes).map("findByOptionText",findByOptionText).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75,jquery:"jquery"}],24:[function(require,module,exports){function findByOptionText(){return this.accept(/date|birth/i).select("select").lookup("id","class","name").filter(function(el){var options=$(el).find("option").toArray();return options.length>=12&&options.length<=14&&options.some(function(el){return["text","val"].some(function(fn){return/birth.*year/i.test($(el)[fn]())})})})}function findByAttributes(){return this.accept(/birth.*year/i,/year.*birth/i).reject(/month/i).select("select,input[type=text]").lookup("id","autocomplete","name","data").fullText(!0)}function findByLabelText(){return this.select("label").accept(/year/i).lookup("text").map(findInputsForLabels).filter(function(el){return"text"===el.type}).lookup("id").accept(/birth/i)}var finder=require("../finder"),$=require("jquery"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:birthday_year").map("findByAttributes",findByAttributes).map("findByOptionText",findByOptionText).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75,jquery:"jquery"}],25:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text]").lookup("name","id","aria-label").accept(/captcha|turing/i,/keyval/i,/enter\sthe\scharacters\syou\ssee/i)}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:captcha").map("findByAttributes",findByAttributes)},{"../finder":54}],26:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text],input[type=radio],select:not([type=hidden])").accept(/(credit|card|cc)(.*)?(type|brand)/i).lookup("id","class","name")}function findByLabelText(){return this.select("label").accept(/(credit|card|cc)(.*)?(type|brand)/i).lookup(["text","val"]).map(findInputsForLabels).filter(function(el){return"hidden"!==el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:card_type").map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],27:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text],input[type=password],input[type=tel],input:not([type]),input[type=number]").lookup("id","class","name","autocomplete","x-autocompletetype").lookupAttributeNames(!0).accept(/^cc-number$/i,/(credit|card|cc).*(num|no)/i,/data-creditcard/i).reject(/(gift|address|cvv|CID|verification).*(num|no)/i,/accountNumber/i)}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:card_number").map("findByAttributes",findByAttributes)},{"../finder":54}],28:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text]").accept(/card.*label/i).reject(/email/i).lookup("id","class","name")}function findByLabelText(){return this.select("label").accept(/save.*?as/i).lookup("text","val").map(findInputsForLabels).filter(function(el){return"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:card_title").map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],29:[function(require,module,exports){function findByAttributes(){return this.accept(/city/i).select("input[type=text]").lookup("id","class","name")}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:city").map("findByAttributes",findByAttributes)},{"../finder":54}],30:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text]").lookup("id","name").accept(/(comp|company|business).*name/i).reject(/first/i,/last/i)}function findByLabelText(){return this.select("label").accept(/(company|business).*name/i).reject(/first/i,/last/i).lookup("text","val").map(findInputsForLabels).filter(function(el){return"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:company_name").map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],31:[function(require,module,exports){function findByConfirmPassword(){return this.select("input[type=password]").lookup("id","name","placeholder").accept(/again/i,/confirm/i,/check/i,/retype/i,/pass(word)?2/,/verpass/i,/passwordverify/i)}function findByLabelConfirmPassword(){return this.select("label").lookup("text","val").accept(/confirm.*password/i,/re(-)?enter(.)?new password/i).map(findInputsForLabels).filter(function(el){return"password"===el.type||"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:confirm-password").map("findByConfirmPassword",findByConfirmPassword).map("findByLabelConfirmPassword",findByLabelConfirmPassword)},{"../finder":54,"../utils/find-inputs-for-labels":75}],32:[function(require,module,exports){function findByAttributes(){return this.accept(/country/i).reject(/state/i).select("select,input[type=text]").lookup("id","class","name")}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:country").map("findByAttributes",findByAttributes)},{"../finder":54}],33:[function(require,module,exports){function findByTypePassword(){return this.select("input[type=password]").lookup("id","name").accept(/old/i,/mw-input-wpPassword/i,/current/i,/editmy_password/i,/iCurPassword/i,/curpass/i,/xpassword/i).reject(/email/i)}function findByLabelText(){return this.select("label").lookup("text","val").accept(/old.*password/i,/current.*password/i).map(findInputsForLabels).filter(function(el){return"text"===el.type||"password"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:current-password").map("findByTypePassword",findByTypePassword).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],34:[function(require,module,exports){function findByAttributes(){return this.accept(/cvv/i,/cvc/i,/^cid$/i,/security.*code/i,/(billing|shipping|number|card|cc).*(cv|sid|cid|security|verification|(s.*code))/i,/(cv|sid|cid|security|verification|(s.*code)).*(billing|shipping|number|card|cc)/i).reject(/postal/i,/pin.*num/i,/gift/i).select("input[type=text],input[type=password],input[type=tel]").lookup("id","class","name")}function findByLabelText(){return this.select("label").accept(/cvv/i,/security.*code/i).lookup("text","val").map(findInputsForLabels).filter(function(el){return~["text","password"].indexOf(el.type)})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:cvv").map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],35:[function(require,module,exports){function findByType(){return this.select("input[type=email]")}function findByAttributes(){return this.accept(/email/i).select("input[type=text],input[type=textbox],input:not([type])").lookup("id","class","name","value","placeholder")}function findByLabelText(){return this.select("label").lookup("text").accept(/\bemail\b/i).map(findInputsForLabels).filter(function(el){return"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:email").map("findByType",findByType).map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],36:[function(require,module,exports){function findByAttributes(){return this.accept(/\b(expiry|expiration|cc-exp\b)/i).reject(/month|year/i).select("input[type=text]").lookup("id","class","name")}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:expiry_date").map("findByAttributes",findByAttributes)},{"../finder":54}],37:[function(require,module,exports){function findByAttributes(){return this.select("select,input[type=text],input[type=tel]").lookup("id","autocomplete","name").accept(/(exp|card).*month/i,/ccmonth/i,/exp.*date.*month/i)}function findByOptionText(){return this.select("select").lookup("id","class","name").accept(/date/i).filter(function(el){var options=$(el).find("option").toArray();return options.length>=12&&options.length<=14&&options.some(function(el){return["text","val"].some(function(fn){return/month/i.test($(el)[fn]())})})})}var finder=require("../finder"),$=require("jquery");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:expiry_date_month").map("findByAttributes",findByAttributes).map("findByOptionText",findByOptionText)},{"../finder":54,jquery:"jquery"}],38:[function(require,module,exports){function findByAttributes(){return this.select("select,input[type=text],input[type=tel]").lookup("autocomplete","id","name").accept(/^cc-exp-year$/i,/ccyear/i,/(exp|card).*year/i,/exp.*date.*year/i)}function findByOptionText(){var accept=concat([/year/i,/\d{2,4}/i]),reject=concat([/month/i,/\d{2}\/\d{2}\/\d{2,4}/i]);return this.select("select").reject(/gift/i,/month/i).accept(/date/i,/year/i,/yr/i).lookup("id","class","name").filter(function(el){return $(el).find("option").toArray().every(function(el){return["text","val"].some(function(fn){var text=$(el)[fn](),accepted=accept.some(function(re){return re.test(text)}),rejected=reject.some(function(re){return re.test(text)});return accepted&&!rejected})})})}var finder=require("../finder"),concat=require("../utils/concat-regexp"),$=require("jquery");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:expiry_date_year").map("findByAttributes",findByAttributes).map("findByOptionText",findByOptionText)},{"../finder":54,"../utils/concat-regexp":73,jquery:"jquery"}],39:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text]").accept(/first.*name/i,/shipadd-fname/i).reject(/last/i,/full/i,/nick/i).lookup("id","class","name")}function findByLabelText(){return this.select("label").accept(/first.*name/i).lookup("text","val").map(findInputsForLabels).filter(function(el){return"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:first_name").map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],40:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text]").accept(/(customer|holder|card|creditcard|account|full).*name/i,/ccname/i,/name.*card/i,/signup_name/i).reject(/first.*name/i,/last.*name/i,/nick.*name/i).lookup("id","name","placeholder")}function findFirstAndLastName(){return this.select("input[type=text]").lookup("id").accept(/first_and_last_name/i)}function findByLabelText(){return this.select("label").accept(/full.name/i,/and.last/i).reject(/first/i,/last/i).lookup("text","val").map(findInputsForLabels).filter(function(el){return"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:full_name").map("findByAttributes",findByAttributes).map("findFirstAndLastName",findFirstAndLastName).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],41:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text]").accept(/last(.*)?name/i,/shipadd-lname/i).reject(/first/i,/full/i).lookup("id","class","name")}function findByLabelText(){return this.select("label").accept(/last(.*)?name/i).lookup("text","val").map(findInputsForLabels).filter(function(el){return"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:last_name").map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],42:[function(require,module,exports){function firstElementAfterPassword(els){var credentials=domOrder.sort(findPasswords(this.context()).concat(findUsernames(this.context())).concat(findEmails(this.context()))),credential=credentials.pop();return credential?domOrder.after(credential,els).slice(0,1):els}function findByLabel(){return this.select("[type=submit]").lookup("text").accept(/(log|sign).*in/i,/entrer|enter/i).reject(/join/i,/password/i,/create.*account/i,/find.*friends/i,/register/i,/enroll/i,/sign.*up/i,/(remember|fb|google_apps_sign_in_link|facebook|social|password|passwd|pwd|pswd|passwd|reset|forgot|forget|frgt|problem|learn|create|trouble)/i)}function findInputs(){return this.select("[type=submit]","input[type=button]","input[type=image]").lookup("name","id","value","text").reject(/join/i,/create.*account/i,/find.*friends/i,/register/i,/enroll/i,/sign.*up/i,/(remember|fb|google_apps_sign_in_link|facebook|social|password|passwd|pwd|pswd|passwd|reset|forgot|forget|frgt|problem|learn|create|trouble)/i,/get.started/i)}function findLinksAndButtons(){return this.select("button","a","div[role=button]").lookup("id","class","title","text","onclick").reject(/join/i,/register/i,/enroll/i,/create.*account/i,/find.*friends/i,/sign.*up/i,/(remember|fb|google_apps_sign_in_link|facebook|social|password|passwd|pwd|pswd|passwd|reset|forgot|forget|frgt|problem|learn|trouble)/i).accept(/(sign|log).?[io]n/i,/sso/i,/submit/i,/entrer|enter/i)}function findDivsWithonClick(){return this.select("div").lookup("onclick").accept(/submit/i).reject(/enroll|join|register|sign.*up/i,/create.*account/i,/find.*friends/i)}var finder=require("../finder"),findPasswords=require("./password"),findUsernames=require("./username"),findEmails=require("./email"),domOrder=require("../utils/sort-by-dom");module.exports=function(el){return new Finder({context:el}).toArray()}
;var Finder=finder("field:login_button").map("findInputs",findInputs).map("findByLabel",findByLabel).map("findLinksAndButtons",findLinksAndButtons).map("findDivsWithonClick",findDivsWithonClick).finalize("firstElementAfterPassword",firstElementAfterPassword)},{"../finder":54,"../utils/sort-by-dom":80,"./email":35,"./password":44,"./username":52}],43:[function(require,module,exports){function findByTypePassword(){return this.select("input[type=password]").lookup("id","name","ng-model").accept(/new/i,/f_password/i,/pass(word)?1/,/identity\[password\]/i,/regi_password/i).reject(/password2/i,/again/i,/confirm/i,/check/i,/retype/i)}function findByLabelText(){return this.select("label").lookup("text","val").accept(/new(.?)password/i).reject(/confirm/i,/check/i,/re(-)?enter/i,/retype/i,/again/i).map(findInputsForLabels).filter(function(el){return"password"===el.type||"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:new-password").map("findByTypePassword",findByTypePassword).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],44:[function(require,module,exports){function findByType(){return this.select("input[type=password]").lookup("id","name").reject(/code/i,/old(.)?password/i,/password(.)?old/i)}function findByAttributes(){return this.select("input[type=text]").lookup("id","class","name").accept(/password/i).reject(/code/i,/pin/i)}function keepOnlyPasswordTypes(els){var strongerMatches=els.filter(function(el){return"password"===el.type});return els.length>1&&strongerMatches.length&&strongerMatches.length<els.length?strongerMatches:els}function findByLabelText(){return this.select("label").lookup("text","val").accept(/.*password$/i).reject(/old/i).map(findInputsForLabels).filter(function(el){return"text"===el.type})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:password").map("findByType",findByType).map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText).finalize("keepOnlyPasswordTypes",keepOnlyPasswordTypes)},{"../finder":54,"../utils/find-inputs-for-labels":75}],45:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text],input[type=tel],input:not([type])").lookup("id","class","name","placeholder","label").accept(/phone/i,/mobile.*number/i).reject(/annotation/i,/phone.*ext/i)}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:phone").map("findByAttributes",findByAttributes)},{"../finder":54}],46:[function(require,module,exports){function findResetInputs(){return this.select("[type=submit]","input[type=button]").lookup("class","id","value","text").accept(/save/i,/^continue$/i,/change.*password/i,/change!/i,/resetpassword/i,/^submit$/i,/update/i).reject(/(log|sign).*in/i,/(sign|log).?[io]n/i,/sso/i,/(remember|fb|facebook|social|forgot|forget|frgt|problem|learn|trouble)/i,/join/i,/register/i,/enroll/i,/create.*account/i,/sign.*up/i,/cancel/i,/entrer/i,/email/i,/checkpoint/i)}function findResetLinksAndButtons(){return this.select("a","button").lookup("id","class","title","html").accept(/save/i,/^continue$/i,/change password/i,/change!/i,/resetpassword/i,/update/i).reject(/(log|sign).*in/i,/(sign|log).?[io]n/i,/sso/i,/(remember|fb|facebook|social|forgot|forget|frgt|problem|learn|trouble)/i,/join/i,/register/i,/enroll/i,/create.*account/i,/sign.*up/i,/cancel/i,/entrer/i,/email/i,/click here/i)}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:reset_button").map("findResetInputs",findResetInputs).map("findResetLinksAndButtons",findResetLinksAndButtons)},{"../finder":54}],47:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text]").lookup("name","id","placeholder","title").accept(/search/i)}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:search").map("findByAttributes",findByAttributes)},{"../finder":54}],48:[function(require,module,exports){function firstElementAfterPassword(els){var passwords=findPasswords(this.context()),password=domOrder.sort(passwords)[0];return password?domOrder.after(password,els).slice(0,1):els}function findInputs(){return this.select("[type=submit]","input[type=button]","input[type=image]").lookup("name","class","id","value","text").accept(/join/i,/create.*account/i,/register/i,/enroll/i,/sign.*up/i,/get started/i,/submit/i).reject(/(sign|log).?[io]n/i,/sso/i,/(remember|fb|facebook|social|password|passwd|pwd|pswd|passwd|reset|forgot|forget|frgt|problem|learn|trouble)/i)}function findLinksAndButtons(){return this.select("a","button").lookup("id","class","title","html").accept(/join/i,/register/i,/enroll/i,/create.*account/i,/sign.*up/i).reject(/(sign|log).?[io]n/i,/sso/i,/(remember|fb|facebook|social|password|passwd|pwd|pswd|passwd|reset|forgot|forget|frgt|problem|learn|trouble)/i)}function findDivsWithonClick(){return this.select("div").lookup("onclick").accept(/enroll|join|register|sign.*up/i,/create.*account/i)}var finder=require("../finder"),findPasswords=require("./password"),domOrder=require("../utils/sort-by-dom");module.exports=function(el,opts){return new Finder({context:el},opts).toArray()};var Finder=finder("field:signup_button").map("findInputs",findInputs).map("findLinksAndButtons",findLinksAndButtons).map("findDivsWithonClick",findDivsWithonClick).finalize("firstElementAfterPassword",firstElementAfterPassword)},{"../finder":54,"../utils/sort-by-dom":80,"./password":44}],49:[function(require,module,exports){function findByAttributes(){return this.select("select,input[type=text]").lookup("id","class","name").accept(/state|province|region/i)}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:state").map("findByAttributes",findByAttributes)},{"../finder":54}],50:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text],input[type=tel]").lookup("id","class","name").accept(/(code|token|otc|otp)/i,/sms.*pin/i,/(two.*factor)|verification|security.*code/i).reject(/postal/i,/pin.*num/i,/credit|card/i,/cvv|cid/i)}function findByLabelText(){return this.select("label").accept(/authentication.*code/i).lookup("text","val").map(findInputsForLabels).filter(function(el){return~["text","tel"].indexOf(el.type)})}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:two_factor_code").map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText)},{"../finder":54,"../utils/find-inputs-for-labels":75}],51:[function(require,module,exports){function findByAttributes(){return this.select("input[type=submit], button").lookup("name","id","value","text").reject(/join/i,/create.*account/i,/register/i,/enroll/i,/sign.*up/i,/send/i,/sso/i,/cancel/i,/(remember|fb|facebook|social|password|passwd|pwd|pswd|passwd|reset|forgot|forget|frgt|problem|learn|create|trouble)/i)}function firstElementAfterCode(els){var codes=findCodes(this.context());if(!codes||!codes.length)return els;var firstCode=domOrder.sort(codes)[0];return domOrder.after(firstCode,els).slice(0,1)}var finder=require("../finder"),domOrder=(require("../utils/find-inputs-for-labels"),require("../utils/sort-by-dom")),findCodes=require("./two-factor-code");module.exports=function(el,opts){return new Finder({context:el},opts).toArray()};var Finder=finder("field:two_factor_submit").map("findByAttributes",findByAttributes).finalize("firstElementAfterCode",firstElementAfterCode)},{"../finder":54,"../utils/find-inputs-for-labels":75,"../utils/sort-by-dom":80,"./two-factor-code":50}],52:[function(require,module,exports){function findByContainerText(){return this.select("input[type=text]").map(function(el){return el.parentNode}).filter(function(el){var inputs=el.querySelectorAll("input");return!$(el).data("pb-role")&&1==inputs.length}).lookup("text").accept(/(user|login).*(id|name)/i).reject(/remember/i,/recovery/i,/altemail/i,/nick/i,/first/i,/last/i,/full/i,/search/i,/membership/i,/phone/i,/mobile.*number/i,/login\:description/i).map(function(el){return el.querySelector("input")})}function findByAttributes(){return this.select("input[type=text],input:not([type])").lookup("name","id","placeholder","title","value","label","aria-label").fullText(!0).reject(/remember/i,/recovery/i,/altemail/i,/nick/i,/first/i,/last/i,/full/i,/search/i,/membership/i,/phone/i,/mobile.*number/i,/login\:description/i).accept(/login/i,/(member|online|user).*(id|name)/i,/uname/i,/(id|name|user).*session/i,/(cust|customer)id/i,/\bid\b/i,/session_key/i,/accesscard/i,/^(\s+)?id(\s+)?$/i)}function findByLabelText(){return this.select("label").lookup("text").accept(/(user|login).*(id|name)/i).reject(/nick/i,/first/i,/last/i,/full/i,/recovery/i,/search/i,/membership/i,/phone/i,/mobile.*number/i,/remember/i).map(findInputsForLabels).filter(function(el){return"text"===el.type}).lookup("id","class").reject(/recovery/i,/alternate/i)}var finder=require("../finder"),findInputsForLabels=require("../utils/find-inputs-for-labels"),$=require("jquery");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:username").map("findByAttributes",findByAttributes).map("findByLabelText",findByLabelText).map("findByContainerText",findByContainerText)},{"../finder":54,"../utils/find-inputs-for-labels":75,jquery:"jquery"}],53:[function(require,module,exports){function findByAttributes(){return this.select("input[type=text],input[type=tel]").lookup("id","class","name").accept(/(zip|postal).*(code)?/i)}var finder=require("../finder");module.exports=function(el){return new Finder({context:el}).toArray()};var Finder=finder("field:zip").map("findByAttributes",findByAttributes)},{"../finder":54}],54:[function(require,module,exports){function createFinder(name){function Finder(attrs,opts){if(!(this instanceof Finder))return new Finder(attrs);this.attrs=attrs||{},this.fieldType(name);var cache=!0;opts&&void 0!==opts.cache&&(cache=opts.cache),this.cache=cache}if("string"!=typeof name)throw new TypeError("finder name required");Finder.map=function(name,fn){return this.fns.map.push(getFunctionWithName(name,fn)),this},Finder.reduce=function(name,fn){return this.fns.reduce.push(getFunctionWithName(name,fn)),this},Finder.finalize=function(name,fn){return this.fns.finalize.push(getFunctionWithName(name,fn)),this},Finder.fns={map:[],reduce:[],finalize:[]},Finder.fieldType=name,Finder.prototype={},Finder.prototype.finder=Finder;for(var key in proto)Finder.prototype[key]=proto[key];return Finder}function getFunctionWithName(name,fn){return name&&fn?[name,fn]:[name.name||"",name]}var proto=require("./proto");module.exports=createFinder},{"./proto":55}],55:[function(require,module,exports){function wrap(args){return[].slice.call(args).reduce(function(ret,arg){return _.isArray(arg)?ret=ret.concat(arg):ret.push(arg),ret},[])}function value(el,prop){switch(prop){case"data":return el.getAttribute&&el.getAttribute("data");case"label":var label=findLabelForInput(el);if(label)return $(label).text();break;default:var $el=$(el);return"function"==typeof $el[prop]?$el[prop]():$(el).attr(prop)||el[prop]}}function attributeNames(el){for(var arr=[],i=0,attrs=el.attributes,l=attrs.length;i<l;i++)arr.push(attrs.item(i).nodeName);return arr}var $=require("jquery"),_=require("underscore"),cssPath=require("../../../css-path"),identity=function(o){return o},findLabelForInput=require("../utils/find-label-for-input"),concat=require("../utils/concat-regexp"),debug=require("debug")("fdetect:finder"),version=require("../utils/version");exports.fullText=function(b){return arguments.length?(this.attrs.fullText=!!b,this):this.attrs.fullText},exports.debug=function(k,v){if(!arguments.length)return this.attrs.debug;if(require("debug").enabled("fdetect:finder:"+this.fieldType())){if(this._debug=this._debug||{},1==arguments.length&&"cache"==k&&!this.owner&&require("debug").enabled("fdetect:finder:cache"))return this._debug.cache=$(this.context()).find("*").toArray().reduce(function(res,e){var $e=require("jquery")(e),sel=cssPath(e);$e.data(version+":pb-ignore")&&res.ignore.push(sel);var role=$e.data(version+":pb-role");return role&&(res[role]=res[role]||[],res[role].push(sel)),res},{ignore:[]}),this;if(1==arguments.length&&"object"==typeof k)for(var key in k)this.debug(key,k[key]);else v&&(this._debug[k]=this._debug[k]||[],v instanceof Array?this._debug[k]=this._debug[k].concat(v):this._debug[k].push(v));return this.owner&&this.owner.debug(this._debug),this}},exports.accept=function(){return arguments.length?(this.attrs.accept=concat(wrap(arguments)),this):this.attrs.accept},exports.fieldType=function(name){return arguments.length?(this.attrs.fieldType=name,this):this.attrs.fieldType},exports.reject=function(){return arguments.length?(this.attrs.reject=concat(wrap(arguments)),this):this.attrs.reject},exports.lookupAttributeNames=function(b){return arguments.length?(this.attrs.lookupAttributeNames=!!b,this):this.attrs.lookupAttributeNames},exports.lookup=function(){return arguments.length?(this.attrs.lookup=wrap(arguments),this):this.attrs.lookup},exports.select=function(){return arguments.length?(this.attrs.select=wrap(arguments),this):this.attrs.select},exports.context=function(el){return arguments.length?(this.attrs.context=el,this):this.attrs.context},["map","filter","reduce"].forEach(function(name){exports[name]=function(fn){var els=this.run(fn.name||name);els=els[name](fn,[]);var finder=new this.finder;return finder.context(this.context()),finder.owner=this,finder.els=els,finder}}),exports.toArray=function(){var self=this,map=this.finder.fns.map,reduce=this.finder.fns.reduce,finalize=this.finder.fns.finalize;this.debug("cache");var els=this.run("main");return map.length&&(els=map.reduce(function(ret,arr){var name=arr[0],fn=arr[1],finder=new self.finder({context:self.context()},{cache:self.cache});return finder.owner=self,finder=fn.call(finder),finder.els=(finder.els||[]).concat(self.els||[]),finder.run(name).forEach(function(el){~ret.indexOf(el)||ret.push(el)}),ret},els)),reduce.length&&(els=reduce.reduce(function(ret,arr){var name=arr[0],fn=arr[1],tmp=ret.reduce(fn.bind(self),[]);return self.debug(name,tmp),tmp},els)),finalize.length&&(els=finalize.reduce(function(ret,arr){var name=arr[0],fn=arr[1],tmp=fn.call(self,ret);return self.debug(name,tmp),tmp},els)),els.forEach(function(el){$(el).data(version+":pb-role",self.fieldType()),debug("WARNING caching "+self.fieldType()+" with selector "+cssPath(el))}),this.log(),els},exports.log=function(){require("debug").enabled("fdetect:finder:"+this.fieldType())},exports.run=function(name){var self=this,selectors=this.select()||[],res=selectors.reduce(function(arr,sel){return $(sel,self.context()).toArray().forEach(function(el){~arr.indexOf(el)||arr.push(el)}),arr},this.els||[]),cachedElements=[];return this.cache&&(res=res.filter(function(el){var role=$(el).data(version+":pb-role");return role==self.fieldType()&&cachedElements.push(el),!role})),res=_.uniq(res.filter(identity)),res=this._accept(res),res=this._reject(res),res=_.uniq(cachedElements.concat(res)),res.forEach(function(el){self.debug(name,el)}),res},exports._accept=function(els){var regexps=this.accept()||[];if(!regexps.length)return els;var fullText=this.fullText(),attributes=this.lookup()||[],lookupAttributeNames=this.lookupAttributeNames();return els.filter(function(el){if(fullText){var text=attributes.map(function(prop){return value(el,prop)});return lookupAttributeNames&&(text=text.concat(attributeNames(el))),text=text.filter(identity).join(" "),regexps.some(function(re){return re.test(text)})}var foundAttributeMatch=attributes.some(function(prop){var val=value(el,prop);return regexps.some(function(re){return re.test(val)})});return!foundAttributeMatch&&lookupAttributeNames&&(foundAttributeMatch=attributeNames(el).some(function(val){return regexps.some(function(re){return re.test(val)})})),foundAttributeMatch})},exports._reject=function(els){var regexps=this.reject()||[];if(!regexps.length)return els;var fullText=this.fullText(),attributes=this.lookup()||[],lookupAttributeNames=this.lookupAttributeNames();return els.filter(function(el){if(fullText){var text=attributes.map(function(prop){return value(el,prop)});return lookupAttributeNames&&(text=text.concat(attributeNames(el))),text=text.filter(identity).join(" "),regexps.every(function(re){return!re.test(text)})}return attributes.every(function(prop){var val=value(el,prop),res=regexps.every(function(re){return!re.test(val)});return res&&lookupAttributeNames&&(res=attributeNames(el).every(function(val){return regexps.every(function(re){return!re.test(val)})})),res})})}},{"../../../css-path":4,"../utils/concat-regexp":73,"../utils/find-label-for-input":76,"../utils/version":81,debug:148,jquery:"jquery",underscore:"underscore"}],56:[function(require,module,exports){function classify(el){return{title:findAddressTitle(el),first_name:findFirstName(el),last_name:findLastName(el),full_name:findFullName(el),birthday_day:findBirthdayDay(el),birthday_month:findBirthdayMonth(el),birthday_year:findBirthdayYear(el),birthday_date:findBirthdayDate(el),city:findCity(el),country:findCountry(el),state:findState(el),zip:findZip(el),email:findEmail(el),phone:findPhone(el),company_name:findCompanyName(el),address:findAddress(el)}}var findFullName=require("../field-finders/full-name"),findFirstName=require("../field-finders/first-name"),findLastName=require("../field-finders/last-name"),findAddress=require("../field-finders/address"),findAddressTitle=require("../field-finders/address-title"),findCity=require("../field-finders/city"),findCountry=require("../field-finders/country"),findState=require("../field-finders/state"),findZip=require("../field-finders/zip"),findEmail=require("../field-finders/email"),findPhone=require("../field-finders/phone"),findCompanyName=require("../field-finders/company-name"),findBirthdayDay=require("../field-finders/birthday-day"),findBirthdayMonth=require("../field-finders/birthday-month"),findBirthdayYear=require("../field-finders/birthday-year"),findBirthdayDate=require("../field-finders/birthday-date");module.exports=classify},{"../field-finders/address":20,"../field-finders/address-title":19,"../field-finders/birthday-date":21,"../field-finders/birthday-day":22,"../field-finders/birthday-month":23,"../field-finders/birthday-year":24,"../field-finders/city":29,"../field-finders/company-name":30,"../field-finders/country":32,"../field-finders/email":35,"../field-finders/first-name":39,"../field-finders/full-name":40,"../field-finders/last-name":41,"../field-finders/phone":45,"../field-finders/state":49,"../field-finders/zip":53}],57:[function(require,module,exports){function classifyForm(el,type){switch(type){case"payment":return classifyPaymentForm(el);case"address":return classifyAddressForm(el);case"login":return classifyLoginForm(el);case"signup":return classifySignupForm(el);case"reset":return classifyResetForm(el);case"two-factor":return classifyTwoFactorForm(el);default:throw new TypeError("#classifyForm(el, type): type must be one of `login`, `signup`, `reset`, `payment`, `address`, `two-factor`, `reset`.")}}var classifyPaymentForm=require("./payment"),classifyAddressForm=require("./address"),classifyLoginForm=require("./login"),classifySignupForm=require("./signup"),classifyResetForm=require("./reset"),classifyTwoFactorForm=require("./two-factor");module.exports=classifyForm},{"./address":56,"./login":58,"./payment":59,"./reset":60,"./signup":61,"./two-factor":62}],58:[function(require,module,exports){function classify(el){findSearch(el);var passwords=findPassword(el),captchas=findCaptcha(el),emails=findEmail(el),usernames=_.uniq(emails.concat(findUsername(el))),states=findState(el),loginButtons=findLoginButton(el),signupButtons=findSignupButton(el),allButtons=domOrder.sort(loginButtons.concat(signupButtons));if(loginButtons=~loginButtons.indexOf(allButtons[0])?[allButtons[0]]:[],!usernames.length){var inputs=$(el).find("input[type=text],input[type=email]").toArray().filter(function(el){return!$(el).data(version+":pb-role")&&!$(el).data(version+":pb-ignore")});inputs&&inputs.length&&usernames.push(inputs[inputs.length-1])}return{username:usernames,password:passwords,captcha:captchas,submit:loginButtons,state:states}}var findUsername=require("../field-finders/username"),findEmail=require("../field-finders/email"),findPassword=require("../field-finders/password"),findLoginButton=require("../field-finders/login-button"),findSignupButton=require("../field-finders/signup-button"),findCaptcha=require("../field-finders/captcha"),findState=require("../field-finders/state"),findSearch=require("../field-finders/search"),domOrder=require("../utils/sort-by-dom"),version=require("../utils/version"),$=(require("visible"),require("jquery")),_=require("underscore");module.exports=classify},{"../field-finders/captcha":25,"../field-finders/email":35,"../field-finders/login-button":42,"../field-finders/password":44,"../field-finders/search":47,"../field-finders/signup-button":48,"../field-finders/state":49,"../field-finders/username":52,"../utils/sort-by-dom":80,"../utils/version":81,jquery:"jquery",underscore:"underscore",visible:236}],59:[function(require,module,exports){function classify(el,includeAddressFields){var paymentFields={card_number:findCreditCardNumbers(el),cvv:findCVV(el),expiry_date_year:findExpirationYear(el),expiry_date_month:findExpirationMonth(el),expiry_date:findExpirationDate(el),full_name:findFullName(el),first_name:findFirstName(el),last_name:findLastName(el),card_type:findCreditCardType(el),captcha:findCaptcha(el),title:findCardTitle(el)},addressFields=0==includeAddressFields?{}:addressClassifier(el);return _.extend(addressFields,paymentFields)}var findCreditCardNumbers=require("../field-finders/cc-number"),findCreditCardType=require("../field-finders/card-type"),findCVV=require("../field-finders/cvv"),findExpirationYear=require("../field-finders/expiration-year"),findExpirationMonth=require("../field-finders/expiration-month"),findExpirationDate=require("../field-finders/expiration-date"),findFullName=require("../field-finders/full-name"),findFirstName=require("../field-finders/first-name"),findLastName=require("../field-finders/last-name"),findCaptcha=require("../field-finders/captcha"),findCardTitle=require("../field-finders/cc-title"),addressClassifier=require("./address"),_=require("underscore");module.exports=classify},{"../field-finders/captcha":25,"../field-finders/card-type":26,"../field-finders/cc-number":27,"../field-finders/cc-title":28,"../field-finders/cvv":34,"../field-finders/expiration-date":36,"../field-finders/expiration-month":37,"../field-finders/expiration-year":38,"../field-finders/first-name":39,"../field-finders/full-name":40,"../field-finders/last-name":41,"./address":56,underscore:"underscore"}],60:[function(require,module,exports){function classify(el){var c={},confirm_password=findConfirmPassword(el),new_password=findNewPassword(el),resetButton=findResetButton(el);(resetButton.length&&1==resetButton.length||2==resetButton.length)&&(c.submit=resetButton,new_password.length||(new_password=findPassword(el)));var current_password=findCurrentPassword(el);return current_password.length&&(c.current_password=[current_password[0]]),new_password.length&&(c.new_password=[new_password[0]]),confirm_password.length&&(c.confirm_password=[confirm_password[0]]),c}var findPassword=require("../field-finders/password"),findCurrentPassword=require("../field-finders/current-password"),findNewPassword=require("../field-finders/new-password"),findConfirmPassword=require("../field-finders/confirm-password"),findResetButton=require("../field-finders/reset-button");module.exports=classify},{"../field-finders/confirm-password":31,"../field-finders/current-password":33,"../field-finders/new-password":43,"../field-finders/password":44,"../field-finders/reset-button":46}],61:[function(require,module,exports){function classify(el,includeAddressFields){findSearch(el);var password=findPassword(el),captcha=findCaptcha(el),username=findUsername(el),email=findEmail(el),signupButtons=findSignupButton(el,{cache:!1}),loginButtons=findLoginButton(el),allButtons=domOrder.sort(signupButtons.concat(loginButtons));signupButtons=~signupButtons.indexOf(allButtons[0])?[allButtons[0]]:[],username.length||(username=email,email=[]);var signupFields={username:username,email:email,password:password,captcha:captcha,submit:signupButtons},addressFields=0==includeAddressFields?{}:addressClassifier(el);return _.extend(addressFields,signupFields)}var findSearch=require("../field-finders/search"),findUsername=require("../field-finders/username"),findEmail=require("../field-finders/email"),findPassword=require("../field-finders/password"),findCaptcha=require("../field-finders/captcha"),findLoginButton=require("../field-finders/login-button"),findSignupButton=require("../field-finders/signup-button"),addressClassifier=require("./address"),domOrder=(require("debug")("fdetect:form-finders:signup"),require("../utils/sort-by-dom")),_=require("underscore");module.exports=classify},{"../field-finders/captcha":25,"../field-finders/email":35,"../field-finders/login-button":42,"../field-finders/password":44,"../field-finders/search":47,"../field-finders/signup-button":48,"../field-finders/username":52,"../utils/sort-by-dom":80,"./address":56,debug:148,underscore:"underscore"}],62:[function(require,module,exports){function classify(el){return{code:findCode(el),submit:findSubmit(el,{cache:!1})}}var findCode=(require("../field-finders/username"),require("../field-finders/email"),require("../field-finders/password"),require("../field-finders/search"),require("../field-finders/two-factor-code")),findSubmit=require("../field-finders/two-factor-submit");module.exports=classify},{"../field-finders/email":35,"../field-finders/password":44,"../field-finders/search":47,"../field-finders/two-factor-code":50,"../field-finders/two-factor-submit":51,"../field-finders/username":52}],63:[function(require,module,exports){function containerWithAddress(type,ctx){if("address"!==type)return[];ctx=ctx||document.body;var els=findStreetAddressFields(ctx).filter(function(el){return isNotIgnored(el)}),res=els.map(matchParents(type));return _.uniq(res)}function matchParents(type){return function(el){for(var rounds=5,parent=el.parentNode,lastMatch=parent,previousMatches=getFoundFields(addressFields(parent));--rounds&&parent.parentNode;)if(parent=parent.parentNode,!$(parent).data(version+":pb-ignore")){if($(parent).data(version+":pb-role")==="form:"+type)return parent;var fields=addressFields(parent),cc=findCC(parent),pw=findPassword(parent);if(cc.length||pw.length||fields.state.length>1)break;var matches=getFoundFields(fields);if(matches.length>previousMatches.length&&(previousMatches=matches,lastMatch=parent),"FORM"===parent.nodeName)break}return previousMatches.length>3&&lastMatch}}function addressFields(el){return addressClassifier(el)}function getFoundFields(roles){return _.uniq(Object.keys(roles).filter(function(key){return!!roles[key].length}))}var addressClassifier=(require("debug")("fdetect:form-finders:payment:address-container"),require("../form-classifiers/address")),findStreetAddressFields=require("../field-finders/address"),findCC=require("../field-finders/cc-number"),findPassword=require("../field-finders/password"),$=require("jquery"),isNotIgnored=require("../utils/is-not-ignored"),version=(require("../utils/is-not-in-form"),require("../utils/version")),_=require("underscore");exports=module.exports=containerWithAddress,exports.name="containerWithAddress"},{"../field-finders/address":20,"../field-finders/cc-number":27,"../field-finders/password":44,"../form-classifiers/address":56,"../utils/is-not-ignored":77,"../utils/is-not-in-form":78,"../utils/version":81,debug:148,jquery:"jquery",underscore:"underscore"}],64:[function(require,module,exports){function containerWitCreditCard(type,ctx){if("payment"!==type)return[];ctx=ctx||document.body;var els=findCreditCardFields(ctx).filter(function(el){return isNotIgnored(el)});els=els.filter(function(el){return!$(el).parents("form").toArray().filter(function(form){return $(form).data(version+":pb-role")==="form:"+type}).length});var res=els.map(matchParents(type));return _.uniq(res)}function matchParents(type){return function(el){for(var rounds=5,parent=el.parentNode,lastMatch=parent,previousMatches=countFields(paymentFields(parent));--rounds&&parent.parentNode;)if(parent=parent.parentNode,!$(parent).data(version+":pb-ignore")){if($(parent).data(version+":pb-role")==="form:"+type)return parent;var fields=paymentFields(parent);if(fields.card_number.length>1)break;var matches=countFields(fields);if(matches.length>previousMatches.length&&(previousMatches=matches,lastMatch=parent),"FORM"===parent.nodeName)break}return previousMatches.length>3&&lastMatch}}function paymentFields(el){return paymentClassifier(el,!1)}function countFields(roles){return Object.keys(roles).filter(function(key){return!!roles[key].length})}var findCreditCardFields=(require("debug")("fdetect:form-finders:payment:cc-container"),require("../field-finders/cc-number")),paymentClassifier=require("../form-classifiers/payment"),$=require("jquery"),isNotIgnored=require("../utils/is-not-ignored"),version=(require("../utils/is-not-in-form"),require("../utils/version")),_=require("underscore");exports=module.exports=containerWitCreditCard,exports.name="containerWitCreditCard"},{"../field-finders/cc-number":27,"../form-classifiers/payment":59,"../utils/is-not-ignored":77,"../utils/is-not-in-form":78,"../utils/version":81,debug:148,jquery:"jquery",underscore:"underscore"}],65:[function(require,module,exports){function containerWithPassword(type,ctx){if(!~["login","signup"].indexOf(type))return[];ctx=ctx||document.body;var els=findPasswords(ctx).filter(function(el){return isNotIgnored(el)&&isNotInForm(el,"login"==type?"signup":"login")});els=els.filter(function(el){return!$(el).parents("form").toArray().filter(function(form){var hasPbRole=$(form).data(version+":pb-role")==="form:"+type,hasPbLogin=$(form).attr("pb-autologin"),hasPbSignup=$(form).attr("pb-signup");return hasPbRole||hasPbLogin||hasPbSignup}).length});var res=els.map(matchParents(type));return _.uniq(res)}function matchParents(formType){return function(el){return"login"===formType?findLogin(el):"signup"===formType?findSignup(el):void 0}}function findLogin(el){for(var rounds=5,parent=el.parentNode,lastMatch=parent,previousFieldsCount=sum(loginFieldsCount(parent));--rounds&&parent.parentNode;)if(parent=parent.parentNode,!$(parent).data(version+":pb-ignore")){if("form:login"===$(parent).data(version+":pb-role"))return parent;var foundSignupForm="FORM"==parent.nodeName&&isType("signup",parent);if(foundSignupForm)return;var fieldsCount=sum(loginFieldsCount(parent));fieldsCount<sum(signupFieldsCount(parent))||fieldsCount>previousFieldsCount&&(previousFieldsCount=fieldsCount,lastMatch=parent)}var fields=loginFieldsCount(lastMatch);if(isType("login",lastMatch)){if(fields.username<=2&&fields.password<=1)return lastMatch}else if(!isType("signup",lastMatch)){var inputs=lastMatch.querySelectorAll("input");if(1==fields.username&&1==fields.password&&1==fields.submit&&inputs.length<35)return lastMatch}}function findSignup(el){
for(var rounds=5,parent=el.parentNode,lastMatch=parent,previousFieldsCount=sum(signupFieldsCount(parent));--rounds&&parent.parentNode;)if(parent=parent.parentNode,!$(parent).data(version+":pb-ignore")){if("form:signup"===$(parent).data(version+":pb-role"))return parent;var cc=findCC(parent);if(cc.length)break;var fieldsCount=sum(signupFieldsCount(parent));if(fieldsCount>previousFieldsCount&&(previousFieldsCount=fieldsCount,lastMatch=parent),"FORM"===parent.nodeName)break}var fields=signupFieldsCount(lastMatch);if(isType("signup",lastMatch)){if(Object.keys(fields).filter(function(role){return fields[role]}).length>=2&&fields.password>=1)return lastMatch}else if(!isType("login",lastMatch)&&1==fields.username&&2==fields.password)return lastMatch}function signupFieldsCount(el){var roles=signupClassifier(el,!1);return Object.keys(roles).reduce(function(ret,key){return roles[key].length&&(ret[key]=ret[key]||0,ret[key]+=roles[key].length),ret},{})}function loginFieldsCount(el){var roles=loginClassifier(el);return Object.keys(roles).reduce(function(ret,key){return roles[key].length&&(ret[key]=ret[key]||0,ret[key]+=roles[key].length),ret},{})}function sum(count){return Object.keys(count).reduce(function(sum,prop){return sum+count[prop]},0)}var findPasswords=(require("debug")("fdetect:form-finders:password-container"),require("../field-finders/password")),findCC=require("../field-finders/cc-number"),loginClassifier=require("../form-classifiers/login"),signupClassifier=require("../form-classifiers/signup"),isType=require("../element-categorizers"),$=require("jquery"),isNotIgnored=require("../utils/is-not-ignored"),isNotInForm=require("../utils/is-not-in-form"),version=require("../utils/version"),_=require("underscore");exports=module.exports=containerWithPassword,exports.name="containerWithPassword"},{"../element-categorizers":14,"../field-finders/cc-number":27,"../field-finders/password":44,"../form-classifiers/login":58,"../form-classifiers/signup":61,"../utils/is-not-ignored":77,"../utils/is-not-in-form":78,"../utils/version":81,debug:148,jquery:"jquery",underscore:"underscore"}],66:[function(require,module,exports){function emptyForm(type,ctx){if(!~["login"].indexOf(type))return[];ctx=ctx||document;var els=$(ctx).find("form").toArray().filter(function(el){return isEmpty(el)&&isNotIgnored(el)});if(!els.length)return[];var cached=[],parents=els.map(function(el){var parent=el.parentNode;return $(parent).data(version+":pb-role")==="form:"+type&&cached.push(parent),parent}).filter(isNotIgnored).filter(isNotInForm);if(cached.length)return cached;var logins=parents.filter(is("login")).filter(function(el){var roles=classifyLoginForm(el);return 1==roles.username.length&&roles.password.length<=1&&1==roles.submit.length}),others=parents.filter(function(e){return!isType("login",e)&&!isType("signup",e)}).filter(function(el){var roles=classifyLoginForm(el);return 1==roles.username.length&&1==roles.password.length&&1==roles.submit.length});return logins.concat(others)}function is(type){return function(el){return isType(type,el)}}function isEmpty(el){return el&&!el.innerHTML}var classifyLoginForm=(require("debug")("fdetect:form-finders:empty-form"),require("../form-classifiers/login")),isType=require("../element-categorizers"),$=require("jquery"),isNotIgnored=require("../utils/is-not-ignored"),isNotInForm=require("../utils/is-not-in-form"),version=(require("../utils/is-not-in-ignored-element"),require("../utils/version"));exports=module.exports=emptyForm,exports.name="emptyForm"},{"../element-categorizers":14,"../form-classifiers/login":58,"../utils/is-not-ignored":77,"../utils/is-not-in-form":78,"../utils/is-not-in-ignored-element":79,"../utils/version":81,debug:148,jquery:"jquery"}],67:[function(require,module,exports){function formWithTwoFactor(formType,ctx){if("two-factor"!==formType)return[];ctx=ctx||document;var els=$(ctx).find("form").toArray().filter(function(el){return isNotIgnored(el)}),cached=els.reduce(function(cache,el){return $(el).data(version+":pb-role")==="form:"+formType&&cache.push(el),cache},[]);return cached.length?cached:els.filter(function(el){return is2Factor(el)&&has2FactorField(el)&&hasNoUsernameOrPassword(el)})}function has2FactorField(el){return 1==findCodeField(el).length}function hasNoUsernameOrPassword(el){var search=findSearch(el),username=findUsername(el),email=findEmail(el),password=findPassword(el);return!(search.length||username.length||email.length||password.length)}var findCodeField=(require("debug")("fdetect:form-finders:payment:form-with-2fa"),require("../field-finders/two-factor-code")),findUsername=require("../field-finders/username"),findEmail=require("../field-finders/email"),findPassword=require("../field-finders/password"),findSearch=require("../field-finders/search"),is2Factor=require("../element-categorizers/two-factor"),$=require("jquery"),isNotIgnored=require("../utils/is-not-ignored"),version=(require("../utils/is-not-in-form"),require("../utils/is-not-in-ignored-element"),require("../utils/version"));exports=module.exports=formWithTwoFactor,exports.name="formWithTwoFactor"},{"../element-categorizers/two-factor":18,"../field-finders/email":35,"../field-finders/password":44,"../field-finders/search":47,"../field-finders/two-factor-code":50,"../field-finders/username":52,"../utils/is-not-ignored":77,"../utils/is-not-in-form":78,"../utils/is-not-in-ignored-element":79,"../utils/version":81,debug:148,jquery:"jquery"}],68:[function(require,module,exports){function formWithAddressFields(type,ctx){if("address"!==type)return[];ctx=ctx||document.body;var els=$(ctx).find("form").toArray().filter(function(el){return isNotIgnored(el)}),cached=els.reduce(function(cache,el){return $(el).data(version+":pb-role")==="form:"+type&&cache.push(el),cache},[]);return cached.length?cached:(els=els.filter(function(el){return isNotInForm(el)}),els.filter(hasNoPassword).filter(hasNoCC).filter(hasAddressFields(4)))}function hasNoPassword(el){return!findPassword(el).length}function hasNoCC(el){return!findCreditCardNumber(el).length}function hasAddressFields(min){return min=min||1,function(el){var roles=addressClassifier(el);return Object.keys(roles).filter(function(key){return!!roles[key].length}).length>=min}}var addressClassifier=(require("debug")("fdetect:form-finders:form-with-address"),require("../form-classifiers/address")),findCreditCardNumber=require("../field-finders/cc-number"),findPassword=require("../field-finders/password"),$=require("jquery"),isNotIgnored=require("../utils/is-not-ignored"),isNotInForm=require("../utils/is-not-in-form"),version=(require("../utils/is-not-in-ignored-element"),require("../utils/version"));exports=module.exports=formWithAddressFields,exports.name="formWithAddressFields"},{"../field-finders/cc-number":27,"../field-finders/password":44,"../form-classifiers/address":56,"../utils/is-not-ignored":77,"../utils/is-not-in-form":78,"../utils/is-not-in-ignored-element":79,"../utils/version":81,debug:148,jquery:"jquery"}],69:[function(require,module,exports){function formWithCreditCard(formType,ctx){if("payment"!==formType)return[];ctx=ctx||document.body;var els=$(ctx).find("form").toArray().filter(function(el){return isNotIgnored(el)}),cached=els.reduce(function(cache,el){return $(el).data(version+":pb-role")==="form:"+formType&&cache.push(el),cache},[]);return cached.length?cached:(els=els.filter(function(el){return isNotInForm(el)}),els.filter(hasPaymentFields))}function hasPaymentFields(el){var roles=paymentClassifier(el),fields=Object.keys(roles).filter(function(key){return!!roles[key].length});return 1==roles.card_number.length&&fields.length>=2}var paymentClassifier=(require("debug")("fdetect:form-finders:payment:form-with-cc"),require("../form-classifiers/payment")),$=require("jquery"),isNotIgnored=require("../utils/is-not-ignored"),isNotInForm=require("../utils/is-not-in-form"),version=(require("../utils/is-not-in-ignored-element"),require("../utils/version"));exports=module.exports=formWithCreditCard,exports.name="formWithCreditCard"},{"../form-classifiers/payment":59,"../utils/is-not-ignored":77,"../utils/is-not-in-form":78,"../utils/is-not-in-ignored-element":79,"../utils/version":81,debug:148,jquery:"jquery"}],70:[function(require,module,exports){function formWithPassword(type,ctx){if(!~SUPPORTED_TYPES.indexOf(type))return[];ctx=ctx||document.body;var els=ctx.nodeName&&"form"==ctx.nodeName.toLowerCase()?$(ctx):$(ctx).find("form");els=isNotOtherFormType(type,els);var cached=els.reduce(function(cache,el){return $(el).data(version+":pb-role")==="form:"+type&&cache.push(el),cache},[]);if(cached.length)return cached;switch(els=els.filter(function(el){var validator="reset"==type?isResetForm:hasPasswordOrUsername;return isNotIgnored(el)&&validator(el)}),els=els.filter(function(el){return isNotInForm(el)}),type){case"reset":return findResets(els);case"signup":return findSignups(els);default:return findLogins(els)}}function isNotOtherFormType(type,els){var filteredForms=els.toArray();return SUPPORTED_TYPES.forEach(function(supTypes){type!=supTypes&&(filteredForms=filteredForms.filter(isNot(supTypes)))}),filteredForms}function hasThreeVisiblePasswords(el){return 3===$("input[type=password]",el).filter(function(){return visible(this)}).length}function hasPasswordOrUsername(el){return!!(findPasswords(el).length||findEmails(el).length||findUsernames(el).length)}function isResetForm(el){return hasThreeVisiblePasswords(el)||hasNewPasswordOrReset(el)}function hasNewPasswordOrReset(el){return!!findNewPasswords(el).length||!!findResetButton(el).length}function findLogins(els){if(!els.length)return[];var logins=els.filter(is("login")).filter(function(el){var roles=classifyLoginForm(el);return roles.visiblePassword=roles.password.filter(visible),roles.username.length<=2&&roles.visiblePassword.length<=1||1==roles.password.length&&1==roles.submit.length&&0==roles.username.length}),others=els.filter(function(e){return!isType("login",e)&&!isType("signup",e)}).filter(function(el){var roles=classifyLoginForm(el),keys=Object.keys(roles).filter(function(role){return roles[role].length}),inputs=el.querySelectorAll("input");return roles.username.length<=1&&1==roles.password.length&&1==roles.submit.length&&inputs.length<35||1==roles.username.length&&1==roles.password.length&&keys.length<3&&inputs.length<35});return logins.concat(others)}function findSignups(els){if(!els.length)return[];var signups=els.filter(is("signup")).filter(function(el){var roles=classifySignupForm(el);return Object.keys(roles).filter(function(role){return roles[role].length}).length>=2&&roles.password.length>=1}),others=els.filter(function(e){return!isType("login",e)&&!isType("signup",e)}).filter(function(el){var roles=classifySignupForm(el);return roles.username.length>=1&&roles.username.length<=2&&2==roles.password.length});return signups.concat(others)}function findResets(els){var resets=els.filter(is("reset"));return(resets.length?resets:els).filter(function(el){var roles=classifyResetForm(el);return roles&&roles.new_password&&(roles.confirm_password||roles.current_password||resets.length)})}function is(type){return function(el){return isType(type,el)}}function isNot(type){return function(el){return!isType(type,el)}}var findUsernames=(require("debug")("fdetect:form-finders:form-with-password"),require("../field-finders/username")),findEmails=require("../field-finders/email"),findPasswords=require("../field-finders/password"),findNewPasswords=require("../field-finders/new-password"),findResetButton=require("../field-finders/reset-button"),classifyLoginForm=require("../form-classifiers/login"),classifySignupForm=require("../form-classifiers/signup"),classifyResetForm=require("../form-classifiers/reset"),isType=require("../element-categorizers"),visible=require("visible"),$=require("jquery"),isNotIgnored=require("../utils/is-not-ignored"),isNotInForm=require("../utils/is-not-in-form"),version=(require("../utils/is-not-in-ignored-element"),require("../utils/version"));exports=module.exports=formWithPassword,exports.name="formWithPassword";var SUPPORTED_TYPES=["signup","login","reset"]},{"../element-categorizers":14,"../field-finders/email":35,"../field-finders/new-password":43,"../field-finders/password":44,"../field-finders/reset-button":46,"../field-finders/username":52,"../form-classifiers/login":58,"../form-classifiers/reset":60,"../form-classifiers/signup":61,"../utils/is-not-ignored":77,"../utils/is-not-in-form":78,"../utils/is-not-in-ignored-element":79,"../utils/version":81,debug:148,jquery:"jquery",visible:236}],71:[function(require,module,exports){function findForms(el,formType){var res=strategies(formType).reduce(function(ret,strategy,i){var name=strategy.name+" - "+formType;trace.start(name);var els=strategy(formType,el);return trace.end(name),els.forEach(function(el){$(el).data(version+":pb-role","form:"+formType),$(el).data(version+":pb-form-finder",strategy.name),~ret.indexOf(el)||ret.push(el),"payment"!=formType&&$(el).parents().data("pb-ignore",!0)}),ret},[]);return _.uniq(res)}function strategies(formType){switch(formType){case"two-factor":return[formWithTwoFactorStrategy];case"login":return[formWithPasswordStrategy,emptyFormStrategy,containerWithPasswordStrategy];case"signup":return[formWithPasswordStrategy,containerWithPasswordStrategy];case"payment":return[formWithCCStrategy,containerWithCCStrategy];case"address":return[containerWithAddressFieldsStrategy,formWithAddressFieldsStrategy];case"reset":return[formWithPasswordStrategy];default:return[formWithTwoFactorStrategy,containerWithPasswordStrategy,formWithPasswordStrategy,containerWithCCStrategy,formWithCCStrategy,containerWithAddressFieldsStrategy,formWithAddressFieldsStrategy]}}var formWithPasswordStrategy=require("./form-with-password"),emptyFormStrategy=require("./empty-form"),containerWithPasswordStrategy=require("./container-with-password"),formWithCCStrategy=require("./form-with-cc"),containerWithCCStrategy=require("./container-with-cc"),formWithAddressFieldsStrategy=require("./form-with-address-fields"),containerWithAddressFieldsStrategy=require("./container-with-address"),formWithTwoFactorStrategy=require("./form-with-2fa"),_=require("underscore"),$=(require("debug")("fdetect:form-finders"),require("jquery")),version=require("../utils/version"),measure=require("../../../measure"),trace=measure(version);module.exports=findForms},{"../../../measure":132,"../utils/version":81,"./container-with-address":63,"./container-with-cc":64,"./container-with-password":65,"./empty-form":66,"./form-with-2fa":67,"./form-with-address-fields":68,"./form-with-cc":69,"./form-with-password":70,debug:148,jquery:"jquery",underscore:"underscore"}],72:[function(require,module,exports){function getForms(options){options=options||{};var res=[];trace.flush();var elsByFormType=detect(options),performance=trace.measures();trace.flush();for(var formType in elsByFormType){elsByFormType[formType].forEach(function(el){var ret=[],fieldsByFieldType=getFields(el,formType);for(var fieldType in fieldsByFieldType){fieldsByFieldType[fieldType].forEach(function(el){var field={fieldType:fieldType,el:el,selector:cssPath(el)};ret.push(field)})}var formFinderName=$(el).data(version+":pb-form-finder");res.push({el:el,version:exports.version,selector:cssPath(el),formType:formType,formFinder:formFinderName,url:location.href,fields:ret,context:cssPath(options.ctx||document.body),performance:performance})})}return res}function detect(options){trace.start("detect"),options=options||{};var opts={};_.isString(options.detect)&&(opts.detect=options.detect.split(" ")),opts.detect&&opts.detect.length||(opts.detect=options.detect&&options.detect.length?options.detect:FORM_TYPES),opts.ctx=options.ctx||document.body,opts.filters=options.filters||{},FORM_TYPES.forEach(function(formType){opts[formType]=!!~opts.detect.indexOf(formType),opts.filters[formType]=opts.filters[formType]||{}});var res=opts.detect.reduce(function(ret,formType){return!opts[formType]||ret.reset&&ret.reset.length?ret:(ret[formType]=get(formType,{ctx:opts.ctx,filters:opts.filters,isMutation:options.isMutation}),ret)},{});return trace.end("detect"),res}function get(formType,options){var ignoreString=Object.keys(options.filters).map(function(key){return options.filters[key].ignore}).filter(Boolean).join(",");if(options.filters[formType]&&options.filters[formType].force&&options.filters[formType].force.length){var res=$(options.filters[formType].force+":not("+ignoreString+")",options.ctx);if(res&&res.length)return res.toArray()}var ctx=options.isMutation&&options.ctx.parentElement?options.ctx.parentElement:options.ctx,els=$(ignoreString,ctx);return els.data(version+":pb-ignore",!0),els.find("*").data(version+":pb-ignore",!0),_.uniq(findForms(options.ctx,formType)).filter(identity)}var findForms=require("./form-finders"),getFields=require("./form-classifiers"),version=require("./utils/version"),$=require("jquery"),_=require("underscore"),identity=function(_){return _},measure=require("../../measure"),trace=measure(version),cssPath=require("../../css-path"),FORM_TYPES=["reset","two-factor","login","signup","payment","address"];exports=module.exports=detect,exports.roles=getFields,exports.getForms=getForms,exports.version=version},{"../../css-path":4,"../../measure":132,"./form-classifiers":57,"./form-finders":71,"./utils/version":81,jquery:"jquery",underscore:"underscore"}],73:[function(require,module,exports){function concat(regexps){return reduce(groupByModifiers(decompose(regexps)))}function decompose(regexps){return regexps.map(function(re){return"string"==typeof re?{source:re,modifiers:""}:{source:re.source,modifiers:(re.ignoreCase?"i":"")+(re.multiline?"m":"")+(re.global?"g":"")}})}function groupByModifiers(src){return src.reduce(function(res,re){return res[re.modifiers]=res[re.modifiers]||"",res[re.modifiers].length&&(res[re.modifiers]+="|"),res[re.modifiers]+="("+re.source+")",res},{})}function reduce(groups){return Object.keys(groups).reduce(function(res,g){return res.push(new RegExp(groups[g],g)),res},[])}module.exports=concat},{}],74:[function(require,module,exports){function filterElementByAttributes(el,attrs,acceptedRegex,rejectedRegex){if(arguments.length<3||!el||!attrs.length||!acceptedRegex.length)return!1;rejectedRegex=rejectedRegex||[];var $el=$(el),foundMatch=attrs.some(function(attr){var text=$el.attr(attr);return acceptedRegex.some(function(reg){return reg.test(text)})});return foundMatch&&(foundMatch=!attrs.some(function(attr){var text=$el.attr(attr);return rejectedRegex.some(function(reg){return reg.test(text)})})),foundMatch}var $=require("jquery");module.exports=filterElementByAttributes},{jquery:"jquery"}],75:[function(require,module,exports){function findInputForLabel(el){var input,label=$(el),id=label.attr("for");if(id){label.parents().toArray().some(function(e){var selector="input[id='"+id+"'],input[name='"+id+"'],select[id='"+id+"'],select[name='"+id+"']",el=$(e).find(selector)[0];if(el&&"hidden"!=el.type)return input=el,!0})}else input=label.find("input:not([type=hidden])")[0],!input&&el.nextElementSibling&&(input="INPUT"==el.nextElementSibling.nodeName&&el.nextElementSibling);return input}var $=require("jquery");module.exports=findInputForLabel},{jquery:"jquery"}],76:[function(require,module,exports){function findLabelForInput(el){return parentLabel(el)||forLabel(el)||siblingLabel(el)}function parentLabel(el){return $(el).parent("label")[0]}function forLabel(el){var label,id=$(el).attr("id");return id&&(label=document.querySelector("label[for='"+id+"']")),label}function siblingLabel(el){return $(el).prev("label").toArray().filter(function(el){return el&&el.getAttribute&&!el.getAttribute("for")})[0]}var $=require("jquery");module.exports=findLabelForInput},{jquery:"jquery"}],77:[function(require,module,exports){function isNotIgnored(el){return!$(el).data(version+":pb-ignore")}var $=require("jquery"),version=require("./version");module.exports=isNotIgnored},{"./version":81,jquery:"jquery"}],78:[function(require,module,exports){function isNotInForm(el,formTypes){var role=$(el).data(version+":pb-role"),roles="string"==typeof formTypes&&formTypes.split(" ").map(function(r){return"form:"+r});if(role)if(roles){if(~roles.indexOf(role))return!1}else if(~role.indexOf("form:"))return!1;var target=el.parentNode,ret=!0;try{for(;target&&ret;){var tag=$(target).data(version+":pb-role")||"";tag&&(ret=roles?!~roles.indexOf(tag):!~tag.indexOf("form:")),target=target.parentNode}}catch(e){ret=!0}return ret}var $=require("jquery"),version=require("./version");module.exports=isNotInForm},{"./version":81,jquery:"jquery"}],79:[function(require,module,exports){function isNotInIgnoredElement(el){var target=el.parentNode,ret=!0;try{for(;target&&ret;)ret=!~$(target).data(version+":pb-ignore"),target=target.parentNode}catch(e){ret=!0}return ret}var $=require("jquery");module.exports=isNotInIgnoredElement},{jquery:"jquery"}],80:[function(require,module,exports){function comparePosition(a,b){return a.compareDocumentPosition?a.compareDocumentPosition(b):a.contains?(a!=b&&a.contains(b)&&16)+(a!=b&&b.contains(a)&&8)+(a.sourceIndex>=0&&b.sourceIndex>=0?(a.sourceIndex<b.sourceIndex&&4)+(a.sourceIndex>b.sourceIndex&&2):1)+0:0}exports.sort=function(els){return els.sort(function(a,b){return 3-(6&comparePosition(a,b))})},exports.before=function(el,els){return els.filter(function(e){return 3-(6&comparePosition(el,e))>0})},exports.after=function(el,els){return els.filter(function(e){return 3-(6&comparePosition(el,e))<0})}},{}],81:[function(require,module,exports){var meta=require("../../component.json"),src=meta.repository.split("/"),org=src[0],repo=src[1],version=meta.version;module.exports=org+"~"+repo+"@"+version},{"../../component.json":12}],82:[function(require,module,exports){function sendFeedback(opts){opts=opts||{};var $forms=$("form"),$formsWithPassword=$("form:has(input[type=password])"),passwordFields=$("input[type=password]").toArray().map(cssPath),params={feedback_type:opts.type||"feedback",feedback_content:opts.content||"no_content",website_url:metrics.url,domain:metrics.domain,browser_name:metrics.browserName,browser_version:metrics.browserVersion,context:metrics.context,asset_count_for_domain:metrics.assetCountForDomain,is_logged_in:metrics.isUserLoggedIn,page_atlas_api_timeout:metrics.apiTimeout,page_atlas_forms_found_in_page:metrics.atlasForms.length,page_fdetect_forms_found_in_page:metrics.fdetectForms.length,page_atlas_forms_from_background:metrics.backgroundForms.length,page_atlas_forms_from_localstorage:metrics.localStorageForms.length,page_forms_count:$forms.length,page_forms_with_password_count:$formsWithPassword.length,page_password_fields_selectors:passwordFields.join(", ")};exports.framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"exp_feedback_from_users",mixpanel_params:params})}function reportBrokenSite(request,opts){opts=opts||{};var notify=opts.notify||alert;location.href===request.pageUrl&&(sendFeedback({type:"report_broken_site",content:request.content}),notify("Your report has been sent to the True Key apps support/engineering team. They will take a closer look at your issue as soon as possible.\n\nDont worry, youll remain anonymous."))}function reportFeedback(request){location.href===request.pageUrl&&sendFeedback({type:"feedback"})}var $=require("jquery"),framework=require("../framework"),cssPath=require("../css-path"),metrics=require("../metrics");exports.reportBrokenSite=reportBrokenSite,exports.reportFeedback=reportFeedback,exports.framework=framework},{"../css-path":4,"../framework":121,"../metrics":135,jquery:"jquery"}],83:[function(require,module,exports){function triggerClick(el){triggerEvent(el,"mousedown",{detail:0}),triggerEvent(el,"mouseup",{detail:0}),el.click(),(Target.IOS||Target.ANDROID)&&(triggerEvent(el,"touchstart",{detail:0}),triggerEvent(el,"touchend",{detail:0}))}function fillInput(input,value){input.focus(),"password"===input.type&&input.setAttribute("hercules-fillInputInProgress","true"),triggerEvent(input,"focus"),triggerEvent(input,"keydown"),input.value=value,triggerEvent(input,"input",{bubbles:!0}),triggerEvent(input,"change"),triggerEvent(input,"keyup"),triggerEvent(input,"keypress"),triggerEvent(input,"payload"),triggerEvent(input,"blur")}function triggerEvent(el,type,options){var e,bubbles=!1,cancelable=!0;options=options||{},bubbles=_.has(options,"bubbles")?options.bubbles:bubbles,cancelable=_.has(options,"cancelable")?options.cancelable:cancelable,options.bubbles=bubbles,options.cancelable=cancelable,"string"==typeof el&&(options=type,type=el,el=document),e=Target.EDGE?new Event(type,options):createEvent(type,options),el.dispatchEvent?Target.EDGE?el.dispatchEvent(e,!0):el.dispatchEvent(e):el.fireEvent("on"+type,e)}function createEvent(type,options){if(!document.createEvent)return createIeEvent(type,options);switch(type){case"dblclick":case"click":case"mousedown":case"mouseup":return createMouseEvent(type,options);case"keydown":case"keyup":return createKeyboardEvent(type,options);case"change":case"blur":return createHtmlEvent(type,options);default:return createCustomEvent(type,options)}}function createCustomEvent(type,options){options=eventOptions(options);var e=document.createEvent("CustomEvent");try{e.initCustomEvent(type,options.bubbles,options.cancelable)}catch(err){try{e.initEvent(type,options.bubbles,options.cancelable,options.view)}catch(err){e=new Event(type,{bubbles:options.bubles,cancelable:options.cancelable})}}return e}function createIeEvent(type,options){options=eventOptions(type,options);var e=document.createEventObject();return e.altKey=options.alt,e.bubbles=options.bubbles,e.button=options.button,e.cancelable=options.cancelable,e.clientX=options.clientX,e.clientY=options.clientY,e.ctrlKey=options.ctrl,e.detail=options.detail,e.metaKey=options.meta,e.screenX=options.screenX,e.screenY=options.screenY,e.shiftKey=options.shift,e.keyCode=options.key,e.charCode=options.key,e.view=options.view,e}function eventOptions(type,options){var defaults={alt:!1,bubbles:!0,button:0,cancelable:!0,clientX:0,clientY:0,ctrl:!1,detail:1,key:0,meta:!1,relatedTarget:null,screenX:0,screenY:0,shift:!1,view:window},opts={};options=options||{};for(var prop in defaults)opts[prop]=options[prop]||defaults[prop];return"dblclick"===type&&(opts.detail=2),opts}function createMouseEvent(type,options){options=eventOptions(type,options);var e=document.createEvent("MouseEvent");try{e.initMouseEvent(type,options.bubbles,options.cancelable,options.view,options.detail,options.screenX,options.screenY,options.clientX,options.clientY,options.ctrl,options.alt,options.shift,options.meta,options.button,options.relatedTarget)}catch(err){try{e.initEvent(type,options.bubbles,options.cancelable,options.view)}catch(err){e=new Event(type,{bubbles:options.bubbles,cancelable:options.cancelable})}}return e}function createKeyboardEvent(type,options){options=eventOptions(type,options);var e=document.createEvent("KeyboardEvent");try{(e.initKeyboardEvent||e.initKeyEvent).call(e,type,options.bubbles,options.cancelable,options.view,options.ctrl,options.alt,options.shift,options.meta,options.key,options.key),e.keyCode!==options.key&&(Object.defineProperty(e,"keyCode",{get:function(){return options.key}}),Object.defineProperty(e,"charCode",{get:function(){return options.key}}),Object.defineProperty(e,"which",{get:function(){return options.key}}))}catch(err){try{e.initEvent(e,type,options.bubbles,options.cancelable,options.view)}catch(err){e=new Event(type,{bubbles:options.bubbles,cancelable:options.cancelable})}}return e}function createHtmlEvent(type,options){options=eventOptions(type,options);var e=document.createEvent("HTMLEvents");try{(e.initEvent||e.initHtmlEvent).call(e,type,options.bubbles,options.cancelable,options.view)}catch(err){e=new Event(type,{bubbles:options.bubbles,cancelable:options.cancelable})}return e}var Target=require("../target"),_=require("underscore");exports.fillInput=fillInput,exports.triggerClick=triggerClick,exports.triggerEvent=triggerEvent},{"../target":142,underscore:"underscore"}],84:[function(require,module,exports){function validFieldFound(field,cache,isCaptcha){var isValid=!1;return field.el&&!cache?isValid=!0:field.el&&cache&&!field.el.fieldFound?isValid=!0:isCaptcha&&(isValid=!0),isValid}var $=require("jquery"),isUrlAlreadyReported=require("./helpers").isUrlAlreadyReported,metrics=require("../metrics"),logger=require("../logger");module.exports=function(form,cache,suppressLogs){var allFieldsFound=form.fields.every(function(field){if(!field.fieldType||"string"!=typeof field.fieldType)return!1;var isCaptcha="captcha"===field.fieldType,$el=$(field.selector);if($el.size()>1){isUrlAlreadyReported("form_field_selector_"+field.selector,metrics.url)||FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"atlas_forms_have_issues",mixpanel_params:{atlas_form_issue_type:"form_field_selector",form_selector:form.selector,field_selector:field.selector,field_type:field.fieldType,field_match_count:$el.size(),website_url:metrics.url,domain:metrics.domain}}),field.el=$(form.selector).find(field.selector).get(0),suppressLogs||logger.warn("form-manager","field selector matches multiple elements "+form.formType+'="'+form.selector+'", field '+field.fieldType+'="'+field.selector)}else field.el=$el.get(0);isCaptcha||field.el?field.el&&field.el.fieldFound&&(suppressLogs||logger.warn("form-manager","rejecting "+form.formType+'="'+form.selector+'", field '+field.fieldType+'="'+field.selector+'" element already in a form')):suppressLogs||logger.info("form-manager","rejecting "+form.formType+'="'+form.selector+'", field '+field.fieldType+'="'+field.selector+'" not in the page');var result=validFieldFound(field,cache,isCaptcha);return result||$(form.selector).attr("yield-handling","true"),result});return cache&&allFieldsFound&&form.fields.forEach(function(field){"captcha"!==field.fieldType&&(field.el.fieldFound=!0)}),allFieldsFound}},{"../logger":130,"../metrics":135,"./helpers":86,jquery:"jquery"}],85:[function(require,module,exports){function isPageAttrEnglish(){var string=$("html, body").attr("lang")||"";return/^en/i.test(string)}var $=require("jquery"),logger=require("../logger"),reprocessLoginDetectHints=require("./reprocess-login-detect-hints");module.exports=function(){var intervalCount=0,_this=this,opts={intervalTime:3e3,maxIntervalCount:4,disable:!1};if(PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:handleAjaxSubmit",opts),opts.disable)return logger.info("form-manager","#handleAjax has been disabled by remote exception."),"disabled";logger.info("form-manager","#handleAjax settings: intervalTime "+opts.intervalTime+"; maxIntervalCount "+opts.maxIntervalCount),this.checkInterval&&clearInterval(this.checkInterval),this.checkInterval=setInterval(function(){var detect,hints;if(logger.log("form-manager","#handleAjax interval: "+intervalCount),intervalCount>opts.maxIntervalCount)clearInterval(_this.checkInterval),PB.contentscript.reinit(),_this.checkInterval=void 0;else{hints=reprocessLoginDetectHints(),detect=new PB.LoginDetect(document.body,document.URL,hints);var loginResult={isLoginPage:detect.isLoginPage(),hasLoginValidationError:detect.hasLoginValidationError()};PB.contentscript.exceptionsManager.trigger("pb:cs:loginDetect",loginResult),logger.debug("form-manager","#handleAjax detect.isLoginPage(): "+loginResult.isLoginPage),logger.debug("form-manager","#handleAjax detect.hasLoginValidationError(): "+loginResult.hasLoginValidationError),loginResult.login_detect_reasons&&logger.info("form-manager","#handleAjax exception login_detect_reasons: "+loginResult.login_detect_reasons),!loginResult.isLoginPage||isPageAttrEnglish()&&loginResult.hasLoginValidationError?(clearInterval(_this.checkInterval),PB.contentscript.reinit(),_this.checkInterval=void 0):intervalCount++}},opts.intervalTime)}},{"../logger":130,"./reprocess-login-detect-hints":92,jquery:"jquery"}],86:[function(require,module,exports){function addRolesToDom(roles){
roles.forEach(function(role){role.el&&$(role.el).attr("pb-role",role.fieldType)})}function getFieldsByType(fields,types){return fields&&types?(_.isArray(types)||(types=[types]),fields.filter(function(field){return~types.indexOf(field.fieldType)})):[]}function isUrlAlreadyReported(type,url){var records=persistenceUtils.getItem("tk_reported_urls");try{records=JSON.parse(records)}catch(e){logger.log("form-manager","error parsing is url already reported data",e)}return records||(records={}),records[type]?!!_.find(records[type],function(record){return record.url===url})||(records[type].push({url:url}),persistenceUtils.setItem("tk_reported_urls",JSON.stringify(records)),!1):(records[type]=[{url:url}],persistenceUtils.setItem("tk_reported_urls",JSON.stringify(records)),!1)}function hasCaptcha(ctx,opts){ctx=ctx||document;var $captcha=$("[id*=captcha],[class*=captcha],[src*=captcha],[src*=mollom],[alt*=captcha]",ctx);return opts=opts||{},_.defaults(opts,{visibilityCheck:!0}),opts.visibilityCheck&&($captcha=$captcha.filter(function(){return isVisible(this)})),$captcha=$captcha.filter(function(){return!$(this).is("div")||!DomHelpers.isEmpty(this)}),!!$captcha.length}function formHasVisibleCaptcha(form){var captchaField=getFieldsByType(form.fields,"captcha"),hasVisibleCaptcha=!1,$captcha=[];return captchaField.length&&($captcha=$(captchaField[0].selector)),$captcha.length?(logger.log("form-manager","form has an Atlas-defined captcha field present on the page, checking it's visibility"),$captcha=$captcha.filter(function(){return isVisible(this)}),hasVisibleCaptcha=!!$captcha.length):(logger.log("form-manager","form has no captcha field defined, or no defined fields present, checking for potential captcha fields"),hasVisibleCaptcha=hasCaptcha(form.el)),hasVisibleCaptcha}var $=require("jquery"),_=require("underscore"),logger=require("../logger"),isVisible=require("visible"),DomHelpers=require("../dom-helpers"),persistenceUtils=require("../persistence/utils.js");module.exports={addRolesToDom:addRolesToDom,getFieldsByType:getFieldsByType,isUrlAlreadyReported:isUrlAlreadyReported,hasCaptcha:hasCaptcha,formHasVisibleCaptcha:formHasVisibleCaptcha}},{"../dom-helpers":5,"../logger":130,"../persistence/utils.js":140,jquery:"jquery",underscore:"underscore",visible:236}],87:[function(require,module,exports){function addIconsToForm(form,opts){logger.log("icons","Adding icons to form.",form),opts=opts||{},opts.hasOwnProperty("visible")||(opts.visible=!0),opts.technique=opts.technique||form.technique,$(form.el).attr("autocomplete","off");var curriedAddIconToField=function(field){return addIconToField(field,form.formType,opts)};form.fields.forEach(curriedAddIconToField)}function addIconToField(field,formType,opts){var enabledFieldType=~ENABLED_FIELD_TYPES.indexOf(field.fieldType),$el=$(field.el),tkIconType="main";if(InputWatcher.isInputWatched($el))return logger.log("icons","Exiting. Not adding icon for this field. Input is being watched.",field),!1;if(!enabledFieldType)return"submit"!==field.fieldType&&logger.log("icons","Not adding icon for this field.",field.fieldType,"should not contain an icon. Selector:",field.selector),!1;logger.log("icons","Adding icons to field.",field),opts=opts||{},opts.hasOwnProperty("visible")||(opts.visible=!0),opts.debug&&opts.technique&&!~opts.technique.indexOf("atlas")&&(tkIconType="black");var defaultIcon=tkIcons[tkIconType]["default"]||tkIcons.main["default"],$icon=$("<passwordboxicon />"),zIndex=$el.css("z-index"),compareTo="auto"===zIndex?0:zIndex;"login"===formType&&removeExistingIcon($el,field.fieldType),$el.parent().append($icon);var zIndexes=$el.siblings().map(function(){return+$(this).css("z-index")});_.each(zIndexes,function(value){!isNaN(value)&&value+1>compareTo&&(zIndex=value+1)}),$icon.css({display:"none",position:"absolute",background:"url("+defaultIcon+") center right no-repeat",width:30,height:$el.outerHeight(),zIndex:zIndex,visibility:opts.visible?"visible":"hidden"}).attr("pb-icon",field.fieldType).attr("icon-type",tkIconType),opts.visible&&$icon.fadeIn(800),InputWatcher.watchInput($el);var onMove=function(){updatePosition($el,$icon)};$(Target.IE?window.self:window).on("resize",onMove),$el.on("pbOnMove",onMove),$el.on("pbOnShow",function(){$icon.show()}),$el.on("pbOnHide",function(){$icon.hide()}),onMove()}function defineIconClick($icon,callback){var iconType=$icon.attr("icon-type")||"main",iconDefault=tkIcons[iconType]["default"],iconHover=iconDefault;tkIcons[iconType].hover&&(iconHover=tkIcons[iconType].hover),$icon.css({cursor:"pointer"}).hover(function(){$icon.css("background-image","url("+iconHover+")")},function(){$icon.css("background-image","url("+iconDefault+")")}),$icon.off("click"),$icon.on("click",function(e){e.preventDefault(),e.stopPropagation(),callback(e)})}function removeIconClick($icon){try{$icon instanceof $&&($icon.css("cursor","default"),$icon.unbind("mouseenter mouseleave"),$icon.off("click"))}catch(e){logger.error("icons","Could not unbind Icon functionality.",e)}}function updatePosition($el,$icon){var position=$el.position(),offsetParent=$el.offsetParent();isNaN(position.left)&&(position.left=0),isNaN(position.top)&&(position.top=0),offsetParent.is("body")&&(offsetParent.css("margin-left")===offsetParent.css("margin-right")&&"auto"===offsetParent.css("margin-left")||(position.left-=parseInt(offsetParent.css("margin-left"))-parseInt(offsetParent.css("margin-right"))));var marginTop=parseInt($el.css("margin-top"));_.isNaN(marginTop)&&(marginTop=0),isNaN(position.left)&&(position.left=0),$icon.css({top:position.top+marginTop,left:position.left+$el.outerWidth()-30,height:$el.outerHeight()})}function removeExistingIcon($el,fieldType){var $existingIcon=$el.siblings("passwordboxicon[pb-icon="+fieldType+"]");$existingIcon.length&&$existingIcon.remove()}var InputWatcher=require("../../input-watcher"),$=require("jquery"),_=require("underscore"),Target=require("../../target"),logger=require("../../logger");exports.addIconsToForm=addIconsToForm,exports.addIconToField=addIconToField,exports.defineIconClick=defineIconClick,exports.removeIconClick=removeIconClick;var ENABLED_FIELD_TYPES=["username","password","card_number","current_password","new_password","confirm_password"],tkIcons=require(Target.LEGACY?"./pb-icons.json":"./tk-icons.json")},{"../../input-watcher":124,"../../logger":130,"../../target":142,"./pb-icons.json":88,"./tk-icons.json":89,jquery:"jquery",underscore:"underscore"}],88:[function(require,module,exports){module.exports={main:{"default":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAQCAYAAAAI0W+oAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowOTNGRTI3REQyOTQxMUUxOTY3NDk1OEY5Nzc4MDgyRCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowOTNGRTI3RUQyOTQxMUUxOTY3NDk1OEY5Nzc4MDgyRCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjA5M0ZFMjdCRDI5NDExRTE5Njc0OTU4Rjk3NzgwODJEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjA5M0ZFMjdDRDI5NDExRTE5Njc0OTU4Rjk3NzgwODJEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+vG1KUAAABBpJREFUeNqElF1oHFUUx/93ZnZm9iOb3c2XyaaJqW0Sq2Jiq1YJNlDqBxSqQmtAfRAfpKJSQR8UpIhglYoRwYeKor5JqEIV1FBroi3SxESLaa3VtKY2H2V3s5vsZmd2Pu69nh2fs7lwmZnLnfO/53f/57B3v+i/Sw8ZIV2rg6aGmaIYiqqYUFiIqYrOAJUJyWVEbxchrU5I6QuASUgpJLjwuS9oBw3X2zfw+nmsM7RUzLhTUwUc/xJCoSjCRj3qws2IhdugqjqJKxSX4YbEZhihVrjeGrjP4XEXrmvTtwXbseG4rBpvfaFCcc0KG9FIb/ogwuE4LUksFy/hujWLRKwTiqLRmg9dycPQFHh+BYIHudC7R9OFT0/X4zZqDK1UtqSCKHZ0v4xoTP1/leCc+u0w8sVJ1Ec7KSMenJzJchBYSoCTmM89elanT2JEssZQXJdJx62e0MHkhU/x2TcPw/Eq2NbxBByHo+IUkVu5jOXVK7CcPCQdomRlULazhM5CobhEInxjoUqF7scRxD+ChdwFjE6dQHEtj6jZhELpX6xZFdzc/jS600NkiwQyhb/Q0TRIWHsoSw/be56iK4zAdouiJjqrIqSueUHQB3a8hntveRYauW5k7HHYto2Bu49gU1tPsLmzZRdOnH6OTGKib8tjWMz9gabkFoxNv0d4DdTMyLaFtGwR8FaVEBriNyISjmGllEM6tScQmZj5BKOTr1bNh1s3P4rRicNwfRttTdvwwy/DWC1dJ8TOBugcKe2KRCreieNjb2LPIQUzl0/iyfu/RLpxAB5h/W7yDZz5/X3K+ipaG/rxz8IU5hbPBgHmFn+FVSnDsmujUxwykeNyCOGRw9pBTsVC9gri0UaYeoqyUOgODeQKZYS0SIBYV1uQbu4PAtze/QgWM3+TUcq1M/LIcRVyl0J1uXfXMzh9TGLf4PO4unQOX58ZhqYDB3YPY+89b1ERN2F8+iMMbn8hsPT41MfYedsQulp3IrM8V1NICylh6ZHQByMvobfrDjrpVnBZwfFTRzH95zg+//YIhh56BX09DxKyaczM/oj9u9/G9xPH8NVP71BdcaorY0N7s/0vbj0oJVMyK/NUPxZM0yRcEol4KpgrpWu4r+8AbtrUi7PnR+iPEBWuRrU1TyhNFFbn0VzXAS0c844e+vnDdTOCnRwXzGptCHc1yKifgMJ1pkpCycjePiJmG05OjODcbAwtjR2wrLXqxVMJhME9QybM3mWH84xtiWs10TEev8igXmRCo6oXkKpXRy0nKVSe9DSe4qpIxox00tRNdWXFzlMfzSqyOStEJKfKaF6qzHeMTNDQawpV+1jQvEBFQkiYQAlMLUnJlxhEPTW+JDWqBs/zNXhaFr6ehTQLkIZkTCfMfoCasZo6+E+AAQCmTgzZSvGiZwAAAABJRU5ErkJggg==",hover:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAQCAYAAAAI0W+oAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyMzBDREM2Q0QyOTUxMUUxOTY3NDk1OEY5Nzc4MDgyRCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyMzBDREM2REQyOTUxMUUxOTY3NDk1OEY5Nzc4MDgyRCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjA5M0ZFMjdGRDI5NDExRTE5Njc0OTU4Rjk3NzgwODJEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjA5M0ZFMjgwRDI5NDExRTE5Njc0OTU4Rjk3NzgwODJEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+eoBaUQAABCJJREFUeNqElGtoHFUYht8zMzuX3c02zdVcmjS9ZJNoaWILVgk2UGoVClWhNaD+EH8URaWC/lDQUgSrVIwICgUl+k9CFaqghrYm2ipNmjTBNGo1rakmad1cdrObndm5nHP8dvzddeAws4ed7z3fM+/7sXc/7zqmR4y4rpVBUy1FUQxNVUymsIiiKroCqIqQXET1xiCilQVSBh7AOKT0JXgQ8MBXmQiE8PIHuo99iNtcWkXceF1TBdzgKiKRGCxjHcqsGsSteqiqTuKkxRjuKN8EI1IHz1+j8hw+9+B5Dv224bgOXI8V691eKJ1d+8cyYrVtDc/AshK0JbGcvYpb9gzK481QFI32AujKCgxNgR8UIDj1IgJ69ml5COju+XwRJS4tl7e5ghh2tr6MWFz9b1cA5yaOYiU7inWx5pBU8eRM5sPCUgKcxALu0724AhITvJSQ4nlMuF7xhC5Gpz/Bp18/DNcvoKPpCbguR8HNYilzDcur12G7K5B0iJydQt5ZJHQ20tmbJML/X6hQENJ1BfGPYn5pGoNjp5FdW0HMrEY69xfW7ALaG59Ga0MvVFaOVPp3NFX3ENYkdeljR/Ip+oRROF62pJBmF4TQNT8sum/na7jvzmehKSYGhh6H4zjovuc4NtQnwz831+7G6fPPkUlMdG55DAtLv6B6/RYMjb9HeA1RsiPHEcJ2RMhbVSKoTGxE1Iojk1tCQ8XeUGRkqh+Do68WzYe7Nj2KwZGj8AIH9dUd+O5SH1ZztwixW1qo4ErhFCQqEs04NfQm9h5RMHXtDJ584As0VHXDp/e/HX0DF35+n7q+gbrKLvw5P4bZhYthgdmFy7ALedhOaXSK64HMwCGETw5rBDkV84vXkYhVwdQrqAuFTGFgKZ1HRIuGiHW1Fg01XWGB7a2PYCH1BxklH5QU8j0pCuQuhXK5f/dhnD8pcaDnedy4OYmvLvRB04FDe/qw/963KMTVGB7/CD07XggtPTz2MXZt60VL3S6klmdLotMiiiV9Evpg4CW0tdxNJ90KLgs4de4Exn8bxmffHEfvQ6+gM/kgIRvH1Mz3OLjnbZwdOYkvf3iHclWcRkbR3iWF2MEXt3pSskgqM0f5sWGaJuGSKE9UhCuT+xv3dx7C5g1tuHhlgN6IUHA1ytYcoTSRXp1DTVkTNCueO3Hkp8RtO4Kz/rBgdnel1bJNxoIkFJ5gqiSUjOwdIGrW48zIACZn4qitaoJtrxU/PEXAAvcNXm62TbmcX3JscbYkOsYT/QxqPxMapV5Aqv5GGjlJofJ2X+MdXBXtcaOhw9RNI5NxrtAcnVBkzWUhohOqjE1LlTmukaJOJUoKFedYOLxAISEkTGAWTJ2Vkv/IIDbT4GujQbXd94MofG0MgT4Jaf4KaXDGdMIchKgZK6mDfwUYAKr8DqKXqYU3AAAAAElFTkSuQmCC"},black:{"default":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAQCAYAAAAI0W+oAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0JJREFUeNqMVE0so2EQflqtsqpIUESkNLItNnv1s0LCTSQSB5xwsXFyd9hk4yxue3FoiBAHB8KBbDjtxTa1ye6mIQ71bzUEVaW/O89Ej1qTTN7ve9935pl5ZuY1TExMfM3NzbXm5eVBVqPZbDaJGnJycowmk8loMBiMSZGSkpJ4fn5+PJFIRGUvkUqlYrLN/5h8x0XCw8PD3/CKmMT4ixji5uYGBCsoKEBxcTGKiooggDAajRBHqK+v171IJAJxjlgshufnZzw9PanyW+R1oFAo9E/A7B0dHQpCOTs7w8XFBcrLyyGZQSLH7e0tJGpEo1H9T4OlVc6CyCCmx8fHhFCG3t5ezYjCDJaWlhAIBFBWVqb/jFqoVKf8JxiB05ogcgYxynkyfXlrawtTU1NKQ3t7uzoNh8M4Pz/H5eUlJHsFYXZ3d3cKfn19rdllBRJnrCQsFguOjo6wvb2tTmw2G66urrQmnZ2daGlpgVCM09NTNDY2oqqqSgPp7u7WWpKZbEBJZhAMBjE0NISFhQU1nJ6eVpDBwUEFampqUqesEc+ZcWtrK6qrq3F8fMz9ZFagl2JqDex2uzYF6aHz2tpabG5uYn5+HuxOOmcwBHQ4HFhZWdGOlWAzAwmAArHD5ubmlCKv14vJyUm4XC6lZ3FxEWtra0plXV0d9vf34ff71cHBwQFpYy3f1gysZWlpqXYT68CZsVqtOkeU+/t7rSPBCgsL4XQ6db+trQ0nJyekOf6mjEhLf3+/ZjMwMIDDw0MsLy/rHI2Pj2NkZETBNzY20NfXp4Gtr6+jq6tLM5fOzEidSWYoRaCZmRm43W7U1NQoXazD7u4uPB4PRkdH0dzcrJT5fD6MjY1hdXVVZ42ADIbMZAIy9PT0RGU1kxLORXpo+QxR2Y2MmlTt7OyoU2bP+xx0nnOopYFCs7OztlczEvksGXySyx9kGN+L2uiIDtlZ8pjqIJO2yspKPDw86BCzxfm4VlRU/Babn3L3e0bqxMAjq4fO2Qhi5CCg7LmFjgbZcwtYgzSARUD+SFB70hQ+CXBPbP9Ks0TIBF+MjEC8QCUQVSQga0D2fsjqFHXJ90cBeCdnXnH8S9QvmmBHvthklf8CDADF4BuEaCwqKgAAAABJRU5ErkJggg=="},experimental:{"default":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAQCAYAAAABOs/SAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0tJREFUeNrEVUtIVFEY/s69M47jNJpDWpllISkmRUEmRRERiCBBRLkoeqxaRIu0omgTtWhRkBBFLSp60KJlGaVELyqzIkxLsYdFPged7DUzztxz7zn954yJTFGMm87wcR73zP3+739dJqXE/xiu8w3l9YwBkkk1oMxghgQd6bU6YVKw0jwGIRlsB7D1bICPwnIYqlc8XpMSsQH6GQY87gwmmQ0hRogYMAnQMxELhy4K2EIZRSYRmUQCQpvIUlfMbSBnUiHWLr+kDxxhoWvgBp6/OQbTlBDkDpNgCwaukKTUJljWBIgdIrbtxKYv9Ax+73QUzViHD/23MfStRatXgv5Gygk1NTX/JKurqxtbG7ZNsXMSFj95dRINT/fodbo7B+qZCT8CmYtIfZ4mZCwAT1qBJp2atRJpxlQin0ByKbUjsYjezC/cCJfpIXdzDITakeWdi6plpyj+fkgp8OLdAbrlxeKig2jqOIIlxbW43LgOnI+5+gJhaxLHRcK2ZGLDoSzldqKkimdVonDGKgQ/v8b3cAhlJTvhNr1433cTcT6Movzt+Dh4F5FYEOXFu/G+9w4i0ch44h2EjnHv7xg9+20YnNzpjLr62oN9qH90ANMCpZg3ez1yJhfjbU8j7r88jPbuM8jMmIN4XKKzu55c70FX7yNNyvnY+6KEDaPz+PXvxA6p/ZVcw9+D6Pz4AOGREJEWUWk5sHhcx5OTa2wnRokE5E5eoO8X5q/WpJGowB9UJqtPKicOKRLFiC1VZxG3wshIz0bnp3voHWwj91cg+LUVc6dXk2Fd8KUXYGZuOZ6+voSy0k1UaqfJmCD+ENd/lBMZG47+QPOrqwhk5SPTl4ueYBuaXl6B3xfA5qoyVCw+pJPrVvNelBZUo2+wFQ9bLlIiZsPnmYJBEUw5q9n+E0uvU4Ngqm1SA9NQ+lWDUmeBrDwsLKnE52+t+DTQBo9rCr7+GEY4YoPHHSjDVVs9WtOUWsuMcP7GxdhMl2FmuA3GDGJU5Cpqag596Sd15+Dzpul4RqMhHVNNSozU2ywHsj9lxeM3tcfLPTFprSD+MpfBZpvMCKRR+nq8DP50N2KWtKIxe8jiot0R8ubxXc8+/Ppvql859r8+iz8FGABgR4wFnZ402AAAAABJRU5ErkJggg==",hover:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAQCAYAAAABOs/SAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA05JREFUeNrEVUtIVFEY/s69M44z02gNaWnWFJKiUhRoUhQRQQS2CCmDoseqRbQoK4o2UYsWBS2i16KgBy1aRtGD6EVmVkRqKvawGNMcbDQf87zn3nP67xkTmSKZNp3h4zzumfv93/+6TEqJ/zHYpbtLJGOAZDI17ENNHYHWtJdgUmgVhQxCMpgWYKpZAx+DYTHUrXjOMiF2aKCfpsHl9DDJTCZEnIgBnUCPmK4RsbDoooApbKPo/UQmkYKAzccyVuzgJpA3pRjrl19VB5Yw0NV3G6/fn4SuSwjSrhNMwcBtpCk1CYbxD8QWEZtmatMbfgWfuwAls2rx+dsDfB9+q9Tbgv5GygmBQGBSsmAwOL7WTJNiZ6UsfvHuDO693K/W2c482M90+ODPWUzqCxUhY364sgKKdEbuSmRpM4g88+Ry2GrjiajaLCjeDIfuIndz9IXbkeuej5plZyn+PsoygTcfD9MtNypLjqCx4ziWlNbj2v1acD7u6suE7WkcVwg70ok1i7KUm6mSKp2zFsWzViE00IaRSBhVZbvh1N341HsHST6IkqKd+NL/CNFECNWl+/Cp5yGisehE4l2Ejgnv7xg7+21onNxpjbn65tODuNVwGDP9FSifuwF5U0vx4et9PGk+hvbuC8jxzEMyKdHZfYtc70JXT4Mi5Xz8fTHCxrF54vp3YovU/kquwZEQOr88RSQeJtISCCojgydVPDm5xrQSlEhA/tSF6n5x0WpFGo0J/EFluvq0cuKQIlWM2FZzEUkjAk/2NHQGH6Onv5XcvwahoRbML6gjw7rgzQ5gdn41XrZdRVXFFiq182RMCH+I6yTlRMZGYqNoencD/twi5Hjz8TXUisbm6/B5/dhaU4U1lUdVct1tOoCKQB16+1vw7O0VSsRp8Lqmo1+EMm+Zh04vFdQgmN0jqYEp2PrtBmWf+XMLsahsLQaGWxDsa4XLMR1Do4OIRE3wpAXbcLutntjbmFnLjHLe5GCs3KHpPqfGqHsyRW5HzZ7DP76RukvwurNUPGOxsIqpIpV2LxdxC/JjxoonbupPVXsS0tikMbbOobEFOtMKsnTd43Iz5st2ImHIeCxhdhtcPLOEPHdqz6vmX//N9CvH/tdn8acAAwBDf43zdSmDdAAAAABJRU5ErkJggg=="}}},{}],89:[function(require,module,exports){module.exports={main:{"default":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAQCAYAAAAI0W+oAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzU4NUJBRkU1QkVFMTFFNDkyRkVDMDk0Nzk5RDFBMDQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzU4NUJBRkQ1QkVFMTFFNDkyRkVDMDk0Nzk5RDFBMDQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjA5M0ZFMjdERDI5NDExRTE5Njc0OTU4Rjk3NzgwODJEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjA5M0ZFMjdFRDI5NDExRTE5Njc0OTU4Rjk3NzgwODJEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+MHuEgAAAAWtJREFUeNq8VCFMxEAQ3DZ1RRdfSUBTcg6JwdfjeQsaJCXYDxZ03/+7BtD/BsMLDAFdXebu9r7bpnxLSZhkvr9719vu7uxRVVXUiUlxDUbCjo2vA/qMPvr0M17AI2En7BsFX3xxBIZi7Qk8FvYh+9z+sJHx4EBEMXiHlw+MlalP/M7E+ox9xHvu+Z1B8HT9PM+r+0B0CU5x6DP7FAcu2NYlPAOv4HtzPfpdIFcSIs2Sgy7Bd/DEHO7WMlVKMfRii+rOwVTYqfGNVF2wkbJUW6ZyPCNTwho5Z6j3n7I4HC76Egq4/l0bS5b0XMi75P05B7a46S9dsGXt0WQwKXbwfAVT7tEotFWnG637sDJfbUv0Be6Ba/jm7NsHb50ghojBb1wxdjZWXBo3pB/ggkvnyrbmmYvHDGxomuqC2Ox2zazYeYk3N0emHoTUB6HuUaaWrbWkceXY/7U4eFjHZEQdgRatSzb5kxj+A98CDADG3MBsPyzvawAAAABJRU5ErkJggg==",hover:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAQCAYAAAAI0W+oAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTc5Mjk4REY1QkVFMTFFNDkyRkVDMDk0Nzk5RDFBMDQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTc5Mjk4REU1QkVFMTFFNDkyRkVDMDk0Nzk5RDFBMDQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjA5M0ZFMjdERDI5NDExRTE5Njc0OTU4Rjk3NzgwODJEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjA5M0ZFMjdFRDI5NDExRTE5Njc0OTU4Rjk3NzgwODJEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+21Iy/AAAAWtJREFUeNq8VEFOhEAQbAgP4Ak8gTsm6gvAxLvx6klfIH7AYV/gejdxfYG7Bw+edC/ejCZ+gB9gz0wNNAQXHBMrqV26e5hmuquHmqahUVw8PTITYafGNwK9xxRD+hkPzELYBXxeCMUXJ8xYxFbME2Hn8Ln1ce/EsxMRpcwXfvnAWCr75N+FiC/gI6z5wDuzEOj6BUHQ9YHoXj/xpiv4jpH4DrYuoWIese/V9eh3iVxJiDRrJF0z35hnZnMXU1ktxTCJHaq7YZbCLo3PU3VRK2WpNpVV/J+YEnaocEK9/hzicDicOlCE+o8trCHppZB3jfUVEltcT5cu2hG7MiewPXtmXqJHXhiqTm+q+7AxX21L9MXcY27Zt4Rvn3nqBDFHDGHvirGzsUFp3JC+M2/bntjYFjOX+gxsbJrqktjTJWZW7Lyk7c2hslJIfRa6HqlsPYgVvSvHPnfiwLD6nGiIHCWTl2z+JzH8B74FGABl7MD684BFAgAAAABJRU5ErkJggg=="},black:{"default":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAQCAMAAAA/D5+aAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAD9QTFRFQEBA7+/vz8/Pj4+PICAgn5+fUFBQ39/fv7+/f39/r6+vcHBwEBAQYGBgq6urMDAwxsbGqqqqgICArKys////gZeJlwAAABV0Uk5T//////////////////////////8AK9l96gAAAJFJREFUeNpskEcWxCAMQ12oqVN0/7OOyMtiIPjBwgjJHwRXSQZM0NXdugPVH1JW7hM46dTcSUsoQLxW2ZY+0AIPjqNdsnGWZpXPW7RFPzD2Sox9xBARh/C+CpzN6EoNI03fZcFfHcMtaXL4d43wpL1kG79BzJhX/52UClsNQKDFymNWXAEmzjASnWVOOKufAAMAFjYaiCFpQEIAAAAASUVORK5CYII="},experimental:{"default":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAQCAYAAADj5tSrAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAdJJREFUeNqkVEsvQ1EQ/m5vi+vVR0IqkZCKRghiIZEQQRcsWHdp4RfYqESsRILfgESsGksbFsWCpDtBiHiFRCLxqnq0tNpr5tym2iB6byeZzPnOzDnfecyMhJHVLgBLpC7okwvSYXV+cPu/QDPpAmzVLihWfRTRsAtP13y4uv9CTaTu3whm+h2ALGmArMCZoq3J6famvxxbVx/wuBQxZsvYqGSRjHXb4HYWivHaWQQORRZjtoxZ2M9xhknmdsLwNhbD21oGfKpYOXgBSmTNEuZ59nOcHjFnoYSKqY0QUUtwOiyY7bVj/zaGlsoC+DZD8B+8AklV93OlSTpqFd4b0biK3et3jLaXY3j1HoglgQKTIPStP6CtugiKRRJcwRsDz5UpMnvU1KnJyibD//59k+BlNINawmzwGYtDFZjefsJEl008F8/zLfPKLq6HyT47vM2luAvFEX5P4DxlGfM8+9P1YyiFO63wH0Xg36NsMkucBwD9kbCEeZ79HKdHJOpdKqqafjgGGkoQp90DpxF46othodOvHb9lB90cgnqXZPjje2oKEbjQ/okt43wq/oSa3Q/H+PojtHfS6kfg7AYJsTbH7BqhbrpMWqvzgJdibQ7yJcAAe2uoYeV+Pj8AAAAASUVORK5CYII=",hover:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAQCAYAAADj5tSrAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAe5JREFUeNqklM9LVFEUxz/vzQxq5ohkRD4JnWIoiBbSpghCmFBBWoarWrh3axK0EMKC/oQioo24tMUICREFbkKiBGUQGaXpB46YWszY9OZ1zn01OpT43syBy7nfc8695577PfdaDD+/AjyVkSCcrMi45T0afHNYYFTGYxrjCaIN4VL82k1Q3NbDnT4s1JaR/F+C+9dPQcTygWiDq45n1gSq3j7I8Wplh1QybuaqFdcqVUlGUw5nnWYzTy9t0XYkauaqFauoX+PCiCXEexw9XrmWu9ccMvkik2/z6iXWHKP0owQeDF1sJ9neyPiLHLhi+L6OEG8FIX5PZOH4zEepz8KRzSYGHN5/KnCho4mxdI7J+Q0oe6Gvq5Lk0pm47G1RKJWZz+4wcvkEN6eysOtCQ4QHfZ2MTq/S09VCU8yWXB5z79api/iIev6eWnTErpn3vUrmlrf3pbZ4+PorT250c+/lZ+70nmRsJmfsWmVd3WWI7+9kqOcYXzaKfCu4LOd9rVjt6q+8n5pauLeDqQ+bfmdFbVy9rp9lXwtWu/o1rvYW3icD59souWVmF7dInWslJqSkFzargwK28IF0Xk20MJvxeVKtuJ4Xn5HP7h/H7ek1/8H9eT8GV3+QmLUBu2tYftNnortCHjBr1gaQ3wIMACe+r9e4xFGaAAAAAElFTkSuQmCC"}}},{}],90:[function(require,module,exports){function addEventListeners(){emitter.on("form-manager:request-bind-hash-change",me._onRequestBindHashChange)}function _onRequestBindHashChange(){window.onhashchange=function(){logger.log("form-manager","#onhashchange","handleAjaxSubmit via hash change"),handleAjaxSubmit()}}function getSelectedAsset(response){var saved_assets,selection;try{saved_assets=response.faAssets||[]}catch(exception){logger.log("form-manager","error parsing assets",{exception:exception,faAssets:response.faAssets})}return selection={saved_assets:saved_assets,auto_login:response.auto_login,is_tab_ignored:response.is_tab_ignored,auto_login_type:response.auto_login_type},PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:selectAsset",selection),selection}function refactorForm(form){var isFormJSObj=!!form.attrs;return{hostname:form.hostname,domain:form.domain,formType:isFormJSObj?form.formType():form.formType,selector:isFormJSObj?form.selector():form.selector,url:form.url||location.href,form_detection_technique:form.technique,fields:form.fields.map(function(field){return{fieldType:isFormJSObj?field.fieldType():field.fieldType,selector:isFormJSObj?field.selector():field.selector}})}}function submitForm(form,options){var captcha;if(options=options||{},options.form=form,"fdetect"===form.technique&&triggerExceptionsForCurrentPage(form.fields,form.el),captcha=getFieldsByType(form.fields,"captcha").shift()){var captchaEl=captcha.el;if(captchaEl||(captchaEl=captcha.el=$(captcha.selector).get(0)),captchaEl&&isVisible(captchaEl))return logger.info("form-manager","submit canceled because of captchas in the form"),void captchaEl.focus()}var submits=getFieldsByType(form.fields,"submit"),params={submitDelay:250};if(PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:submitForm",params),submits.length){logger.info("form-manager","clicking on submit button with delay=",params.submitDelay),PBCS.frameFactory.create({id:"banner-connecting"});var submit=submits[0];submit.el||(submit.el=$(submit.selector).get(0)),setTimeout(function(){Events.triggerClick(submit.el)},params.submitDelay)}else{var method=$(form.el).attr("method");method&&"post"===method.toLowerCase()&&(logger.info("form-manager","triggering form submit event with delay=",params.submitDelay),PBCS.frameFactory.create({id:"banner-connecting"}),setTimeout(function(){$(form.el).submit()},params.submitDelay))}}function fillForm(form,asset,disableExceptions){disableExceptions||PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:fillForm",{asset:asset,form:form});var selectedAsset={id:asset.faAssetId,username:asset.login,website_url:asset.url};PB.contentscript.bgdata.lastAccountSelected=selectedAsset,FA.Framework.sendMessage({faTrigger:"setLastAccountSelected",asset:selectedAsset}),getFieldsByType(form.fields,"username").forEach(function(username){logger.info("form-manager",'filling username="'+username.selector+'"'),username.el||(username.el=$(username.selector).get(0)),Events.fillInput(username.el,asset.login)}),getFieldsByType(form.fields,"password").forEach(function(password){logger.info("form-manager",'filling password="'+password.selector+'"'),password.el||(password.el=$(password.selector).get(0)),Events.fillInput(password.el,asset.password)});var captchas=getFieldsByType(form.fields,"captcha");captchas.length&&(captchas[0].el||(captchas[0].el=$(captchas[0].selector).get(0)),captchas[0].el&&captchas[0].el.focus()),sendFillFormEvent(form)}function triggerExceptionsForCurrentPage(fields,el){var exceptions={},exceptionsForType=[];PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:roles",{roles:exceptions,el:el});for(var fieldType in exceptions){for(var i=fields.length-1;i>=0;i--)fields[i].fieldType===fieldType&&fields.splice(i,1);exceptionsForType=exceptions[fieldType],exceptionsForType.forEach(function(exception){fields.push({el:exception,selector:PBCS.cssPath(exception),fieldType:fieldType})})}}function processLoginForm(form){if(form&&form.el){var el=form.el;PB.contentscript.intelForUrl;logger.log("form-manager","processing login form",form),$(el).attr("pb-autologin",!0),"fdetect"===form.technique&&triggerExceptionsForCurrentPage(form.fields,el),~form.technique.indexOf("atlas")&&form.partial&&(PBCS.multistep=form.partial);var roles=form.fields;addRolesToDom(roles),addIconsToForm(form,{visible:!!PB.contentscript.is_signed_up,debug:config.icons}),interceptSubmit(el,"login",roles,form);var focusedEl=_.findWhere(form.fields,{fieldType:"password"});focusedEl||(focusedEl=_.findWhere(form.fields,{fieldType:"username"})),focusedEl&&focusedEl.selector&&PB.contentscript.checkAndDisplayLoggedOutInpage(focusedEl.selector),emitter.emit("form-manager:request-bind-hash-change")}}function interceptSubmit(el,type,roles,form){function getFormData(){var triggerParams,inputsData=[],rolesForFieldType=[];return["username","password"].forEach(function(inputType){if(rolesForFieldType=roles.filter(function(role){return role.fieldType===inputType}),rolesForFieldType.length)rolesForFieldType.forEach(function(role){var value,$el=$(role.selector);if($el.length){"login"===type&&"username"===inputType&&"www.accountonline.com"===location.hostname&&$("#USERNAME").length&&($el=$("#USERNAME")),value=$el.prop("value"),"username"===inputType&&(value=value.trim());var inputProps={name:$el.prop("name"),value:value,type:$el.prop("type"),role:inputType};triggerParams={inputProps:inputProps,el:el},PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:getFormData",triggerParams),inputsData.push(inputProps)}});else{var inputProps={value:null,role:inputType};triggerParams={inputProps:inputProps,el:el},PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:getFormData",triggerParams),inputProps.value&&inputsData.push(inputProps)}}),"signup"===type&&inputsData.push({name:"pbIsSignupForm",value:"true",type:"hidden"}),inputsData}function sendDataToBackground(meta){var formInputs=getFormData();meta=meta||{},form.formType=form.formType||type,logger.log("form-manager",form.formType," form. sending user data to background",form);var assetUrl=metrics.url;!Target.FIREFOX&&~assetUrl.indexOf("www.amazon.")&&~assetUrl.match(/ap\/(signin|register)/)&&(assetUrl=PB.utils.standardizeProtocol(PB.utils.getUrlHostname(assetUrl)));var params={url:assetUrl};if(PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:sendDataToBackground",params),assetUrl!=params.url&&(logger.log("form-manager","the URL has been changed by a remote exception from",assetUrl,"to",params.url),assetUrl=params.url),formInputs.length){var triggerData=_.extend(meta,{faForm:formInputs,faTrigger:"tAssetDetection",domain:metrics.domain,url:assetUrl,form:PB.contentscript.formManager.stripElementsFromForm(form),is_signed_up:PB.contentscript.is_signed_up,allowAutosave:PB.contentscript.intelForUrl.settings.autologin});FA.Framework.sendMessage(triggerData);var loginType=PBCS.assets.auto_login_type?PBCS.assets.auto_login_type:"manual_"+form.formType,data={tabId:metrics.tabId,url:metrics.url,login_type:loginType,asset_count_for_domain:metrics.assetCountForDomain,domain:metrics.domain,browser_name:metrics.browserName,browser_version:metrics.browserVersion,context:metrics.context,form:refactorForm(form),form_type:form.formType,form_partial_type:form.partial,form_trigger_selector:form.trigger,form_selector:form&&form.selector,form_detection_technique:form&&form.technique,pb_cs_version:metrics.csVersion,page_request_time_in_ms:metrics.pageRequestTime,page_time_before_submit_form_in_sec:((new Date).getTime()-window.performance.timing.domLoading)/1e3,page_atlas_api_timeout:metrics.apiTimeout,page_atlas_forms_found_in_page:metrics.atlasForms.length,page_atlas_forms_count_at_atlas_process:metrics.atlasFormsCountAtAtlasProcess,page_atlas_forms_count_at_fdetect_process:metrics.atlasFormsCountAtFdetectProcess,page_fdetect_forms_found_in_page:metrics.fdetectForms.length,page_atlas_forms_from_background:metrics.backgroundForms.length,page_atlas_forms_from_localstorage:metrics.localStorageForms.length,is_browser_local_storage_available:PB.contentscript.isLocalStorageAvailable,is_last_chance:!1,experiments:["desktop_remove_fdetect_login_forms:"+(PB.contentscript&&PB.contentscript.removeFdetectExperiment)]};FA.Framework.sendMessage({faTrigger:"recordSubmit",data:data}),~loginType.indexOf("manual")&&(PB.contentscript.bgdata.lastAccountSelected=!1,FA.Framework.sendMessage({faTrigger:"setLastAccountSelected",asset:!1})),handleAjaxSubmit()}}var inputs,$inputs,submit,sendData=_.debounce(sendDataToBackground,3e3,!0),$el=$(el);inputs=getFieldsByType(roles,["username","password"]).map(function(field){return field.el}),submit=getFieldsByType(roles,"submit")[0],$inputs=$(inputs),$inputs.on("keydown",function(e){return 13===(e.keyCode?e.keyCode:e.which)&&(PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:userSubmitedForm"),sendData()),!0});var params={submitButtonEventToListenFor:"click"};PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:handleSubmitClick",params),submit&&submit.selector&&(logger.info("form-manager",'listening for a "',params.submitButtonEventToListenFor,'" event on the submit button'),$(submit.selector).on(params.submitButtonEventToListenFor,function(){PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:userSubmitedForm"),sendData()}),(Target.IOS||Target.ANDROID)&&(logger.info("form-manager",'listening for a "touchend" event on the submit button.'),$(submit.selector).on("touchend",function(){PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:userSubmitedForm"),sendData()}))),$el.on("submit",function(e){if(getFormData().length){var metaData={};PB.contentscript.is_signed_up||(metaData.token=Math.floor(1e9*Math.random()),metaData.domain=PB.utils.getUrlBaseDomain(location.href)),PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:userSubmitedForm"),sendData(metaData)}}),$inputs.one("keypress",function(){submit&&submit.el||(window.onbeforeunload=function(){sendData()})})}function isPassGenEnabled(nbOfPasswordFields,formTechnique){var domainsValidated,BI_disabled=PB.contentscript.intelForUrl.settings.autologin===!1,domainIsWhitelisted=~formTechnique.indexOf("atlas")||"last-chance"===formTechnique
;return domainIsWhitelisted||(domainsValidated=["facebook.com","google.com","live.com","yahoo.com","paypal.com","linkedin.com","amazon.com","ebay.co.uk","ebay.fr","ebay.ca","ebay.com","twitter.com","salesforce.com","dropbox.com","reddit.com","netflix.com","evernote.com","pinterest.com","imgur.com","etsy.com","adobe.com","walmart.com","conduit.com","quickbooks.intuit.com","forbes.com","amazonaws.com","wikipedia.org","tumblr.com","weather.com","wordpress.com","yelp.com","zillow.com","pandora.com","vimeo.com"],domainIsWhitelisted=domainsValidated.indexOf(PB.utils.getUrlBaseDomain(location.hostname))>=0),(!PB.contentscript.bgdata||!PB.contentscript.bgdata.isOffline)&&domainIsWhitelisted&&!BI_disabled&&PB.contentscript.logged_in&&nbOfPasswordFields&&!("IE"===browser.name&&8===parseInt(browser.version))}function processSignupForm(form,el){if(form&&form.el){el=form.el;var $el,roles=form.fields,passwordFields=[];if(logger.log("form-manager","processing signup form",form),$(el).attr("pb-signup",!0),"fdetect"===form.technique&&triggerExceptionsForCurrentPage(form.fields,el),roles=form.fields,addRolesToDom(roles),addIconsToForm(form,{visible:!!PB.contentscript.is_signed_up,debug:config.icons}),emitter.emit("form-manager:request-bind-hash-change"),"https://twitter.com/"!==location.href&&interceptSubmit(el,"signup",roles,form),passwordFields=roles.filter(function(role){return"password"===role.fieldType}).map(function(role){return role.el}),isPassGenEnabled(passwordFields.length,form.technique)){$el=$(el),passwordFields=$(passwordFields);var showPassGen=function(){var settings=PB.contentscript.passgenSettings;PBCS.frameFactory.create({id:"tooltip-passwordGenerator",attachTo:passwordFields.first(),options:{disableLetters:settings["passgen.letters"]===!1,disableSymbols:settings["passgen.symbols"]===!1,disableDigits:settings["passgen.digits"]===!1,disableCapitals:settings["passgen.capitals"]===!1,nbCharacters:settings["passgen.stringLength"]}}).on("passwordGenerated",function(payload){passwordFields.each(function(){Events.fillInput(this,payload.password)}),sendFillFormEvent(form)})};PB.contentscript.passgenSettings["passgen.enabled"]!==!1&&passwordFields.first().one("focus",function(e){showPassGen()});defineIconClick($el.find("passwordboxicon[pb-icon=password]").first(),function(e){showPassGen()})}}}function clearForm(){$("[pb-autologin] passwordboxicon[pb-icon=username]").off("click"),$("[pb-role=username],[pb-role=password]").val($(this).attr("placeholder"))}function fdetectOptions(opts){function createOrAppendSelector(detect,formType,selector){detect[formType]=detect[formType]||{},detect[formType].ignore=detect[formType].ignore?detect[formType].ignore+", "+selector:selector}opts=opts||{};var settings=PB.contentscript.intelForUrl.settings;return settings.detect||(settings.detect={}),opts.forms.length&&(settings.detect=_.reduce(opts.forms,function(detect,form){return createOrAppendSelector(detect,form.formType,form.selector),detect},settings.detect)),opts.filters=opts.filters||settings.detect||{},opts.detect||(opts.detect=detectOptions(opts.loginForms&&!!opts.loginForms.length,opts.signupForms&&!!opts.signupForms.length)),opts.ctx=opts.ctx||document.body,opts.execOnStart="undefined"==typeof opts.execOnStart||opts.execOnStart,PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:findForms",opts),opts}function detectOptions(isLoginFoundByAtlas,isSignupFoundByAtlas){var pb=PBCS.currentLocation.isPasswordbox||PBCS.currentLocation.isPsswrdbx,settings=PB.contentscript.intelForUrl.settings,checkout=settings.checkout,defaultFormTypes=["two-factor"];isLoginFoundByAtlas||defaultFormTypes.push("login"),isSignupFoundByAtlas||defaultFormTypes.push("signup");var detect=[];return pb||detect.push("reset"),pb||(detect=detect.concat(defaultFormTypes)),!Target.IE&&checkout&&detect.concat("payment"),detect}function getSimplifiedForm(form,discardEl){var simplifiedForm=form,isLegacy=!!form.attrs;return isLegacy&&(simplifiedForm={},simplifiedForm.formType=form.formType(),simplifiedForm.technique=form.technique,simplifiedForm.hostname=form.hostname,simplifiedForm.foundFormsWithMeta=form.foundFormsWithMeta,simplifiedForm.metaTypeTechnique=form.metaTypeTechnique,simplifiedForm.selector=form.selector(),simplifiedForm.el=form.el(),simplifiedForm.isMutation=form.attrs.isMutation,simplifiedForm.performance=form.attrs.performance.reduce(function(acc,perf){return acc+=parseInt(perf.duration,10)},0)),discardEl&&delete simplifiedForm.el,simplifiedForm.fields=form.fields.map(function(field){var newField={};return discardEl||(newField.el=isLegacy?field.el():field.el),newField.selector=isLegacy?field.selector():field.selector,newField.fieldType=isLegacy?field.fieldType():field.fieldType,newField}),simplifiedForm}function stripElementsFromForm(form){var newForm=_.omit(form,["el","fields"]);return newForm.fields=[],form.fields.forEach(function(field){newForm.fields.push(_.omit(field,"el"))}),newForm}function isFormCompletelyVisible(form){var fields=form.fields.filter(function(field){return"captcha"!==field.fieldType});return form.isVisible=isVisible(form.el)&&fields.every(function(field){return isVisible(field.el)}),form.isVisible}function _filterVisibleForms(forms,formType){return!!forms&&("string"==typeof formType&&(forms=_.filter(forms,function(form){return form.formType===formType})),!!_.find(forms,function(form){return PB.contentscript.isVisible(form.el)}))}function hasVisibleLoginForms(){return _filterVisibleForms(me.forms,"login")}function fillAndSubmitForm(form,options){if(logger.log("form-manager","starting filling and submitting of the form",form,"with options",options),form.faFilled&&form.faSubmitted)return void logger.info("form-manager","fillAndSubmitForm: form has been previously filled and submitted. exiting fillAndSubmitForm");var selectedAsset=options.selectedAsset,autoLogin=options.autoLogin,isTabIgnored=(options.loginType,options.isTabIgnored);isFormCompletelyVisible(form),form.faFilled&&!PB.contentscript.multi_account_selected||(PB.contentscript.formManager.fillForm(form,selectedAsset),form.faFilled=!0),form.el=form.el||$(form.selector).get(0);var $form=$(form.el),singled_out="true"===$form.attr("pb-autologin")||"www.passwordbox.com"===location.host;if(autoLogin){var customAutologin=selectedAsset.autologin;"1"!==customAutologin||isTabIgnored?"0"===customAutologin?(logger.info("form-manager","autologin disabled: user turned off the instant login for this asset"),autoLogin=!1):isTabIgnored&&(logger.info("form-manager","autologin disabled: decision made by the background. tab is ignored"),autoLogin=!1):autoLogin=!0}else logger.info("form-manager","autologin disabled: decision made by the background (ex: tab is ignored, or instant login is disabled)");var overridesForThisDomain=PB.contentscript.intelForUrl.settings;overridesForThisDomain.autologin===!1&&(logger.info("form-manager","autologin disabled: server-side setting disabled autologin"),autoLogin=!1),overridesForThisDomain.autoSubmitForm===!1&&(logger.info("form-manager","autologin disabled: server-side setting disabled auto submit"),autoLogin=!1),location.href.indexOf("twitter.com/intent/tweet")>-1&&"update-form"===$form.attr("id")&&(logger.info("form-manager","autologin disabled: special rule for twitter's tweet intent"),autoLogin=!1);var params={ignoreVisibility:!1};PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:autoLoginVisibilityCheck",params),!autoLogin||params.ignoreVisibility||form.isVisible||(logger.info("form-manager","autologin disabled: the form is not visible"),autoLogin=!1,form.trigger&&addListenerToFormTrigger(form,function(){form.faFilled=!1,fillAndSubmitForm(form,options)})),PB.contentscript.multi_account_selected&&(logger.info("form-manager","autologin enabled: multi-account selector used, we want to auto-submit"),autoLogin=!0,PBCS.multistep||(PB.contentscript.multi_account_selected=!1)),PBCS.multistep&&PB.contentscript.bgdata&&PB.contentscript.bgdata.multistep&&PBCS.multistep===PB.contentscript.bgdata.multistep&&(logger.info("form-manager","autologin disabled: already filled/submitted this form"),autoLogin=!1);var formAction=$form.closest("form").attr("action");if(formAction){var whitelist=["huffingtonpost.ca"],anchor=document.createElement("a");anchor.href=formAction;var pageDomain=UrlParser.parse(location.href).domain,anchorDomain=UrlParser.parse(anchor.href).domain;anchorDomain&&anchorDomain!==pageDomain&&!~whitelist.indexOf(pageDomain)&&(logger.info("form-manager","autologin disabled: the form points to a different domain"),autoLogin=!1)}autoLogin&&formHasVisibleCaptcha(form)&&(logger.info("form-manager","autologin disabled: captcha found in the form"),autoLogin=!1),form.faSubmitted&&(logger.info("form-manager","autologin disabled: form has been previously submitted"),autoLogin=!1),form.blockSubmit&&(logger.info("form-manager","autologin disabled: form has been blocked from submission"),autoLogin=!1),selectedAsset.login||(autoLogin=!1),autoLogin&&singled_out&&(PBCS.multistep&&"username"===PBCS.multistep||FA.Framework.sendMessage({faTrigger:"tIgnoreTab"}),PBCS.assets.auto_login_type||(PBCS.assets.auto_login_type="seamless_login"),PB.contentscript.formManager.submitForm(form,{asset_count_for_domain:metrics.assetCountForDomain,asset_title:selectedAsset.name}),form.faSubmitted=!0)}function foundLoginForm(form){var atlasForm=getSimplifiedForm(form);processLoginForm(atlasForm),PB.contentscript.initFillForms(PBCS.assets,[atlasForm])}function foundSignupForm(form){processSignupForm(getSimplifiedForm(form))}function foundResetForm(form,el){processResetForm(getSimplifiedForm(form),el)}function addMetaTrackingData(form,metaForUrl){return form.technique="fdetect",form.foundFormsWithMeta=metaForUrl&&metaForUrl.forms&&metaForUrl.forms.map(function(atlasForm){return atlasForm.selector}).join(","),form.metaTypeTechnique=metaForUrl&&metaForUrl.technique,form.url=location.href,form.domain=PB.contentscript.urlParser.parse(location.href).domain,form.hostname=location.hostname,form}function usefDetect(opts,fn){var finder,login,options=fdetectOptions(opts),disableObserveMutation=Target.IE;logger.info("form-manager","starting fdetect with disableObserveMutation =",disableObserveMutation,"and with options,",options),finder=new PB.contentscript.Form.find(options),finder.on("login",function(form,el){logger.info("form-manager","fdetect found "+form.formType()+'="'+form.selector()+'"'),login=el,!disableObserveMutation&&login&&finder.pause(),form=addMetaTrackingData(form,options),foundLoginForm(form)}),finder.on("reset",function(form,el){logger.info("form-manager","fdetect found "+form.formType()+'="'+form.selector()+'"'),disableObserveMutation||finder.pause(),form=addMetaTrackingData(form,options),foundResetForm(form,el)}),fn&&finder.once("forms",function(forms){forms=forms.filter(function(form){return"signup"!==form.attrs.formType}),logger.info("form-manager","finished fdetect processing, found "+(forms&&forms.length)+" forms in the page"),forms=forms.map(function(form){return form=getSimplifiedForm(form),form=addMetaTrackingData(form,options)}),PB.contentscript.formManager.forms=PB.contentscript.formManager.forms.concat(forms),metrics.fdetectForms=forms,fn()}),disableObserveMutation?finder.exec():finder.start()}function addListenerToFormTrigger(form,cb){if(!form.listenerAdded){form.listenerAdded=!0,logger.log("form-manager","adding listener on trigger",form),_isAtlasObserving=!0;var delegate=function(criteria,listener){return function(e){var el=e.target;do if(el.tagName&&criteria(el))return e.delegateTarget=el,void listener.apply(this,arguments);while(el=el.parentNode)}},filter=function(el){return $(el).is(form.trigger)},handler=function(e){logger.log("form-manager","form trigger click",form);var meta={forms:[form],technique:"atlas-trigger"};setTimeout(function(){cb(meta)},2e3)};document.body.addEventListener("click",delegate(filter,handler),!0)}}function findFormForThisPage(meta){var el,forms=[],els=[];meta.forms.forEach(function(form){try{el=$(form.selector).get(0)}catch(err){return void logger.log("form-manager","invalid selector",form)}if(el){var found=_.find(els,function(elExists){return elExists.el===el});found?(els.push({selector:found.selector,el:found.el,duplicate:!0}),els.push({selector:form.selector,el:el,duplicate:!0})):els.push({selector:form.selector,el:el}),form.el=el,form.selector=form.selector,forms.push(form)}});var duplicateSelectorEls=_.filter(els,function(el){return el.duplicate});if(duplicateSelectorEls.length){if(!isUrlAlreadyReported("form_selector",metrics.url)){var selectorsString=_.reduce(duplicateSelectorEls,function(string,nextEl,index){return nextEl.selector+(index>0?", "+string:string)},"");FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"atlas_forms_have_issues",mixpanel_params:{atlas_form_issue_type:"form_selector",duplicate_selectors:selectorsString,website_url:metrics.url,domain:metrics.domain}})}}return forms}function processAtlasForms(meta){var forms;if(meta.isWaitFor||logger.info("form-manager","found "+meta.forms.length+" forms in atlas using "+meta.technique),metrics.atlasFormsCountAtAtlasProcess=meta.forms.length,forms=findFormForThisPage(meta),forms.length){var intel=PB.contentscript.intelForUrl&&PB.contentscript.intelForUrl.settings;intel&&intel.detect&&!meta.isWaitFor&&(forms=forms.filter(function(form){var ignore=intel.detect[form.formType]&&intel.detect[form.formType].ignore;return!$(form.selector).is(ignore)})),forms=forms.filter(function(form){if(!$(form.el).find("input").length)return!1;var result=findFieldsForThisPage(form,!0);return meta.waitForCB&&meta.waitForCB(result),result}),PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:atlasForms",{forms:forms}),logger.info("form-manager","atlas forms in the page",forms),forms.forEach(function(form){"login"===form.formType?foundLoginForm(form):"signup"===form.formType?foundSignupForm(form):"reset"===form.formType&&foundResetForm(form)}),forms.forEach(function(form){var currForm=getSimplifiedForm(form,!1);_.findWhere(PB.contentscript.formManager.forms,{formType:currForm.formType,selector:currForm.selector})||PB.contentscript.formManager.forms.push(currForm)}),metrics.atlasForms=forms}else logger.info("form-manager","did not find any forms using atlas");return meta.isWaitFor||watcher.observeMissingForms(meta.forms,function(form,waitForCB){processAtlasForms({forms:[form],isWaitFor:!0,waitForCB:waitForCB})}),forms}function processForms(opts,fn){var forms,foundMeta=opts.forms&&opts.forms.length,exceptionOpts={fdetect:config.fdetect};if(logger.log("form-manager","processing forms..."),PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:processForms",exceptionOpts),"function"==typeof opts&&(fn=opts,opts.ctx=document.body),foundMeta){logger.log("form-manager","atlas forms received",opts.forms),opts.forms=removeInvalidSelectors(opts.forms),opts.forms.forEach(function(form){form.technique=form.technique||opts.technique}),forms=processAtlasForms(opts),opts.loginForms=forms.filter(function(form){return"login"===form.formType}),opts.signupForms=forms.filter(function(form){return"signup"===form.formType}),opts.resetForms=forms.filter(function(form){return"reset"===form.formType});if(opts.loginForms.some(function(form){return form.partial})||opts.loginForms.length&&opts.signupForms.length||opts.resetForms.length)return fn&&fn()}if(PB.contentscript.herculesExperimentEnabled&&(opts.disableFdetect=!0),opts.disableFdetect||!exceptionOpts.fdetect)return logger.log("form-manager","fdetect is disabled"),fn&&fn();metrics.atlasFormsCountAtFdetectProcess=opts.forms.length,$.isReady?usefDetect(opts,fn):$(function(){usefDetect(opts,fn)})}function removeInvalidSelectors(forms){return forms.filter(function(form){return DomHelpers.isValidSelector(form.selector)?form.fields.every(function(field){var isFieldValid=DomHelpers.isValidSelector(field.selector);return isFieldValid||logger.info("form-manager","Ignoring Atlas Form with invalid field selector",form," invalid field selector : ",field.selector),isFieldValid}):(logger.info("form-manager","Ignoring Atlas Form with invalid form selector",form),!1)})}var me,$=require("jquery"),_=require("underscore"),addIconsToForm=require("./icons").addIconsToForm,defineIconClick=require("./icons").defineIconClick,handleAjaxSubmit=require("./handle-ajax-submit"),reprocessLoginDetectHints=require("./reprocess-login-detect-hints"),findFieldsForThisPage=require("./find-fields"),watcher=require("./watcher"),UrlParser=require("url-parser"),Events=require("./events"),processResetForm=require("./process-reset-form").process,addRolesToDom=require("./helpers").addRolesToDom,getFieldsByType=require("./helpers").getFieldsByType,hasCaptcha=require("./helpers").hasCaptcha,formHasVisibleCaptcha=require("./helpers").formHasVisibleCaptcha,isUrlAlreadyReported=require("./helpers").isUrlAlreadyReported,sendFillFormEvent=require("./send-fill-form-event"),Target=require("../target"),config=require("../config"),logger=require("../logger"),UAParser=require("ua-parser-js"),browser=UAParser(window.navigator.userAgent).browser,isVisible=require("visible"),DomHelpers=require("../dom-helpers"),metrics=require("../metrics"),emitter=require("../event-emitter"),_isAtlasObserving=!1;module.exports=me={processForms:processForms,fillForm:fillForm,submitForm:submitForm,getSelectedAsset:getSelectedAsset,clearForm:clearForm,fillInput:Events.fillInput,sendFillFormEvent:sendFillFormEvent,getSimplifiedForm:getSimplifiedForm,fillAndSubmitForm:fillAndSubmitForm,stripElementsFromForm:stripElementsFromForm,forms:[],addListenerToFormTrigger:addListenerToFormTrigger,hasCaptcha:hasCaptcha,reprocessLoginDetectHints:reprocessLoginDetectHints,handleAjaxSubmit:handleAjaxSubmit,addEventListeners:addEventListeners,_onRequestBindHashChange:_onRequestBindHashChange,hasVisibleLoginForms:hasVisibleLoginForms},addEventListeners()},{"../config":3,"../dom-helpers":5,"../event-emitter":7,"../logger":130,"../metrics":135,"../target":142,"./events":83,"./find-fields":84,"./handle-ajax-submit":85,"./helpers":86,"./icons":87,"./process-reset-form":91,"./reprocess-login-detect-hints":92,"./send-fill-form-event":93,"./watcher":94,jquery:"jquery","ua-parser-js":227,underscore:"underscore","url-parser":233,visible:236}],91:[function(require,module,exports){function process(atlasForm,formEl){var formEl,$formEl;return me.form=atlasForm,formEl=formEl||atlasForm.el,$formEl=$(formEl),!$formEl.attr("pb-signup")&&!$formEl.attr("pb-autologin")&&(logger.log("form-manager","processing reset form",atlasForm),$formEl.attr("pb-reset",!0),me._processRoles(),addRolesToDom(atlasForm.fields),me.assets=_.filter(PBCS.assets.faAssets,function(asset){return asset.owner}),me.assets.length?(me._injectIcons($formEl),emitter.emit("form-manager:request-bind-hash-change"),void me._bindHandlersToInputs($formEl)):(logger.log("form-manager","Exiting processing reset form. No valid asset for this website."),!1))}function _processRoles(){me.fields.submit=getFieldsByType(me.form.fields,"submit"),me.fields.$submit=$(me.fields.submit.length&&me.fields.submit[0].el),me.fields.currentPassword=getFieldsByType(me.form.fields,"current_password"),me.fields.$currentPassword=$(me.fields.currentPassword.length&&me.fields.currentPassword[0].el),me.fields.confirmPassword=getFieldsByType(me.form.fields,"confirm_password"),me.fields.newPassword=getFieldsByType(me.form.fields,"new_password"),me.fields.$newPassword=$(me.fields.newPassword.length&&me.fields.newPassword[0].el),me.fields.$confirmPassword=$(me.fields.confirmPassword.length&&me.fields.confirmPassword[0].el)}function _injectIcons($formEl){var newPasswordFieldIcon,frameAssets;PB.contentscript.passgenSettings["passgen.enabled"];addIconsToForm(me.form,{visible:!!PB.contentscript.is_signed_up,debug:config.icons}),newPasswordFieldIcon=$formEl.find("passwordboxicon[pb-icon=new_password]").first(),1===me.assets.length?(logger.log("form-manager","processing reset form with exactly one asset.",me.form),me.assetToUse=me.assets[0],defineIconClick(newPasswordFieldIcon,me._showPassGen),PB.contentscript.passgenSettings["passgen.enabled"]!==!1&&me.fields.$newPassword.one("focus",me._showPassGen),me._fillResetAndReport(me.assetToUse,me.form)):me.assets.length>1&&(logger.log("form-manager","processing reset form with more than one user asset.",me.form),currentPasswordFieldIcon=$formEl.find("passwordboxicon[pb-icon=current_password]").first(),frameAssets=me.assets.map(function(asset){return{id:asset.faAssetId,username:asset.login,title:asset.name}}),currentPasswordFieldIcon.length?(defineIconClick(newPasswordFieldIcon,_.bind(me._showPassGen,me,frameAssets,me.form)),defineIconClick(currentPasswordFieldIcon,_.bind(me._showMultiAccount,me,frameAssets,me.form,!1)),me._showMultiAccount(frameAssets,me.form,!1),PB.contentscript.passgenSettings["passgen.enabled"]!==!1&&me.fields.$newPassword.one("focus",me._showPassGen)):(defineIconClick(newPasswordFieldIcon,_.bind(me._showMultiAccount,me,frameAssets,me.form,!0)),me._showMultiAccount(frameAssets,me.form,!0)))}function _bindHandlersToInputs($formEl){var $inputs=me.fields.$currentPassword.add(me.fields.$newPassword).add(me.fields.$confirmPassword);$inputs.on("keydown",me._keydownHandler),me.fields.$submit.on("click",me._submitClickHandler),$formEl.on("submit",me._submitHandler),$inputs.one("input",me._inputHandler)}function _submitClickHandler(){me._sendData()}function _keydownHandler(e){return 13===(e.keyCode?e.keyCode:e.which)&&(PB.contentscript.exceptionsManager.trigger("pb:cs:formManager:userSubmitedForm"),me._sendData(me.assetToUse)),!0}function _submitHandler(){var metaData={};PB.contentscript.is_signed_up||(metaData.token=Math.floor(1e9*Math.random()),metaData.domain=PB.utils.getUrlBaseDomain(location.href)),me._sendData(me.assetToUse,metaData)}function _inputHandler(){me.fields.submit.length||(window.onbeforeunload=me._sendData)}function _handleResetSelectedAsset(form,selectedAsset){me.assetToUse=_.find(me.assets,function(asset){return asset.faAssetId===selectedAsset.id}),me._fillResetAndReport(me.assetToUse,me.form)}function _handleResetSelectedAssetAndShowPassGen(form,selectedAsset){me._handleResetSelectedAsset(form,selectedAsset),PB.contentscript.passgenSettings["passgen.enabled"]!==!1&&me._showPassGen()}function _showMultiAccount(frameAssets,form,showPassGen){var inpageType,attachTo=me.fields.$currentPassword.length?me.fields.$currentPassword:me.fields.$newPassword;inpageType=me.fields.currentPassword.length?"fillPassword":"updatePassword",PBCS.frameFactory.create({id:"tooltip-accountSelector",attachTo:attachTo,options:{inpageType:inpageType,assets:frameAssets,form:PB.contentscript.formManager.stripElementsFromForm(form),onSelectedAsset:showPassGen?me._handleResetSelectedAssetAndShowPassGen:me._handleResetSelectedAsset}})}function _fillResetAndReport(asset,form){me.fields.currentPassword.length?me.fields.newPassword.length?asset&&(logger.log("form-manager","processResetForm(fillResetAndReport): Old password and new password me.fields found, filling old and focusing on new."),me._injectPassword(asset.password),sendFillFormEvent(form)):logger.log("form-manager","processResetForm(fillResetAndReport): No new password field, this should not happen, every reset form should have a new password field."):logger.log("form-manager","processResetForm(fillResetAndReport): No current(old) password field, will not inject current password or report."),me.fields.$newPassword.length&&me.fields.$newPassword.focus()}function _injectPassword(password){Events.fillInput(me.fields.currentPassword[0].el,password),me.fields.$currentPassword.one("focus",_passwordFocusHandler(password))}function _passwordFocusHandler(password){return function(e){$(e.target).val().length||Events.fillInput(e.target,password)}}function _sendDataToBackground(meta){var formInputs;if(!me.assetToUse)return void logger.log("form-manager","processResetForm: canceling background reporting, no asset.");meta=meta||{},formInputs=[{name:"username",value:me.assetToUse.login,type:"text",role:"username"},{name:"newpassword",value:me.fields.$newPassword.val(),type:"password",role:"password"}],logger.log("form-manager","reset form. sending user data to background",formInputs),FA.Framework.sendMessage(_.extend(meta,{faForm:formInputs,faTrigger:"tAssetDetection",form:PB.contentscript.formManager.stripElementsFromForm(me.form),domain:PB.contentscript.urlParser.parse(location.href).domain,url:location.href,is_signed_up:!0,allowAutosave:!0,formType:"reset"})),PBCS.frameFactory.create({id:"banner-update",options:{siteName:location.hostname,formType:"reset"}})}function _showPassGen(){var settings=PB.contentscript.passgenSettings;PBCS.frameFactory.create({id:"tooltip-passwordGenerator",attachTo:me.fields.$newPassword,options:{disableLetters:settings["passgen.letters"]===!1,disableSymbols:settings["passgen.symbols"]===!1,disableDigits:settings["passgen.digits"]===!1,disableCapitals:settings["passgen.capitals"]===!1,nbCharacters:settings["passgen.stringLength"]}}).on("passwordGenerated",function(payload){me.fields.newPassword.length&&Events.fillInput(me.fields.newPassword[0].el,payload.password),me.fields.confirmPassword.length&&Events.fillInput(me.fields.confirmPassword[0].el,payload.password)})}var $=require("jquery"),_=require("underscore"),addIconsToForm=require("./icons").addIconsToForm,addRolesToDom=require("./helpers").addRolesToDom,config=require("../config"),defineIconClick=require("./icons").defineIconClick,emitter=require("../event-emitter"),Events=require("./events"),getFieldsByType=require("./helpers").getFieldsByType,logger=require("../logger"),sendFillFormEvent=require("./send-fill-form-event"),me={process:process,_processRoles:_processRoles,_injectIcons:_injectIcons,_bindHandlersToInputs:_bindHandlersToInputs,_submitClickHandler:_submitClickHandler,_keydownHandler:_keydownHandler,_submitHandler:_submitHandler,_inputHandler:_inputHandler,_handleResetSelectedAsset:_handleResetSelectedAsset,_handleResetSelectedAssetAndShowPassGen:_handleResetSelectedAssetAndShowPassGen,_showMultiAccount:_showMultiAccount,_fillResetAndReport:_fillResetAndReport,_injectPassword:_injectPassword,_passwordFocusHandler:_passwordFocusHandler,_sendDataToBackground:_sendDataToBackground,_showPassGen:_showPassGen,_sendData:_.debounce(_sendDataToBackground,1500,!0),assets:[],assetToUse:void 0,fields:{newPassword:"",$newPassword:"",confirmPassword:"",$confirmPassword:"",currentPassword:"",$currentPassword:"",submit:""},form:void 0};module=module.exports=me},{"../config":3,"../event-emitter":7,"../logger":130,"./events":83,"./helpers":86,"./icons":87,"./send-fill-form-event":93,jquery:"jquery",underscore:"underscore"}],92:[function(require,module,exports){function currentFormsInPage(){var forms=[];return(PB.contentscript.atlasMetaForUrl&&PB.contentscript.atlasMetaForUrl.forms&&PB.contentscript.atlasMetaForUrl.forms.data||[]).forEach(function(form){var el;try{el=$(form.selector).get(0)}catch(err){return void logger.warn("form-manager","invalid atlas form selector: "+(form&&form.selector))}el&&isVisible(el)&&findFieldsForThisPage(form,!1)&&forms.push(form)}),forms}var $=require("jquery"),isVisible=require("visible"),findFieldsForThisPage=require("./find-fields"),logger=require("../logger");module.exports=function(){var forms=currentFormsInPage(),hints={hasLoginForm:!1,hasSignupForm:!1,hasTwoFactorForm:!1};return forms.forEach(function(form){"login"===form.formType?hints.hasLoginForm=!0:"signup"===form.formType?hints.hasSignupForm=!0:"two-factor"===form.formType&&(hints.hasTwoFactorForm=!0)}),hints}},{"../logger":130,"./find-fields":84,jquery:"jquery",visible:236}],93:[function(require,module,exports){function reduceFormForMixpanel(form){var formData={};return form.attrs?(formData.formType=form.formType(),formData.selector=form.selector()):(formData.formType=form.formType,formData.selector=form.selector),formData.url=location.href.substring(0,254-JSON.stringify(formData).length),formData}function reduceFormForPISession(form){return{formId:form.formId,formType:form.formType,isVisible:form.isVisible,selector:form.selector,element:hercules.domHelpers.buildElementModel({element:form.selector}),technique:form.technique,fields:_.map(form.fields,function(el){return{fieldType:el.fieldType,selector:el.selector,element:hercules.domHelpers.buildElementModel({element:el.selector})}})}}var hasCaptcha=require("./helpers").hasCaptcha,metrics=require("../metrics"),hercules=(require("url-parser"),require("hercules")),_=require("underscore");module.exports=function(form){var url=PB.contentscript.urlParser.parse(location.href);if(!PBCS.DomHelpers.matchesIPv4(window.location.hostname)&&!url.port){var formData=reduceFormForMixpanel(form),timeNow=(new Date).getTime(),mixpanelParams={website_url:metrics.url,domain:metrics.domain,pb_cs_version:metrics.csVersion,browser_name:metrics.browserName,browser_version:metrics.browserVersion,context:metrics.context,asset_count_for_domain:metrics.assetCountForDomain,form_type:formData.formType,form:JSON.stringify(formData),form_is_in_iframe:PBCS.currentLocation.isIframe,form_detection_technique:form.technique,form_is_visible:form.isVisible,atlas_failed_forms_found:form.foundFormsWithMeta||"none",atlas_failed_technique_used:form.metaTypeTechnique,form_is_found_with_mutation:form.isMutation,fdetect_time_to_execute:form.performance,form_partial_type:form.partial,form_selector:form.selector,form_with_captcha:hasCaptcha(form.el),is_cs_reinit:metrics.reinit,page_request_time_in_ms:metrics.pageRequestTime,perf_timing_since_dom_loading:timeNow-window.performance.timing.domLoading,perf_timing_since_dom_interactive:timeNow-window.performance.timing.domInteractive,perf_timing_since_contentscript_init:timeNow-window.TK_CS_INIT_MOMENT};FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"fillForm",mixpanel_params:mixpanelParams}),setTimeout(function(){hercules.piSession.emitPISessionOperation("form_automatically_filled",{authFlowMarker:!0,extendSession:!0,form:reduceFormForPISession(form)})},0)}}},{"../metrics":135,"./helpers":86,hercules:163,underscore:"underscore","url-parser":233}],94:[function(require,module,exports){function observeMissingForms(forms,callback){forms.forEach(function(form){var $element=DomHelpers.getjQueryElement(form.selector);if(0===$element.length)waitForSelectorToAppear(form.selector,form,callback),logger.log("form-manager:watcher","Waiting for form to appear with selector :",form.selector);else if(1===$element.length){var hasInputs=$element.find("input");hasInputs.length&&findFieldsForThisPage(form,!1,!0)?waitForElementToDisappear($element[0],form,callback):waitForSelectorToAppear(form.selector,form,callback)}else $element.length>1&&$(form.selector).attr("yield-handling","true")})}function waitForSelectorToAppear(selector,form,callback){DomHelpers.waitFor(selector,function(){if(!DomHelpers.getjQueryElement(form.selector).find("input").length||!findFieldsForThisPage(form,!1,!0))return void setTimeout(function(){waitForSelectorToAppear(form.selector,form,callback)},500);logger.log("form-manager:watcher","Found form with selector :",selector),~form.technique.indexOf("-wait-for")||(form.technique=form.technique+"-wait-for"),callback(form,atlasProcessCallback)});var atlasProcessCallback=function(){waitForElementToDisappear(DomHelpers.getElement(form.selector),form,callback)}}function waitForElementToDisappear(element,form,callback){logger.log("form-manager:watcher","Waiting for form element to disappear",element,form.selector),DomHelpers.waitForElementToDissapear(element,!1,function(){form.faFilled&&(form.faFilled=!1),_.each(form.fields,function(field){field.el&&(field.el.fieldFound=!1)}),logger.log("form-manager:watcher","Form element has disappeared :",element,form.selector),logger.log("form-manager:watcher","Waiting for form to appear with selector :",form.selector),waitForSelectorToAppear(form.selector,form,callback)})}
var logger=require("../logger"),DomHelpers=require("../dom-helpers"),_=require("underscore"),$=require("jquery"),findFieldsForThisPage=require("./find-fields");exports.observeMissingForms=observeMissingForms,exports.waitForSelectorToAppear=waitForSelectorToAppear,exports.waitForElementToDisappear=waitForElementToDisappear},{"../dom-helpers":5,"../logger":130,"./find-fields":84,jquery:"jquery",underscore:"underscore"}],95:[function(require,module,exports){var Form=require("./lib/form"),finder=require("./lib/finder");exports=module.exports=Form,exports.Finder=finder,Form.find=function(opts){return new finder(opts)}},{"./lib/finder":101,"./lib/form":103}],96:[function(require,module,exports){function Asset(data){this.attrs={},this.set(data)}function splitName(fullName){var result={};result.full=fullName,result.first="",result.last="";var sName=fullName.split(" ");if(1==sName.length)result.first=sName[0];else if(2==sName.length)result.first=sName[0],result.last=sName[1];else if(sName.length>2){result.first=sName[0]+" "+sName[1];for(var i=2;i<sName.length;i++)result.last+=sName[i],i!==sName.length-1&&(result.last+=" ")}return result}module.exports=Asset,Asset.prototype.set=function(data){for(var key in data)"function"==typeof this[key]&&this[key](data[key])},Asset.attr=function(name){return this.attrs=this.attrs||[],this.attrs.push(name),this.prototype[name]=function(val){return arguments.length?(this.attrs[name]=val,this):this.attrs[name]},this},Asset.attr("first_name").attr("last_name").attr("full_name").attr("username").attr("password").attr("email").attr("address").attr("city").attr("country").attr("state").attr("zip").attr("phone").attr("cellular").attr("card_number").attr("cvv").attr("card_type").attr("expiry_date_month").attr("expiry_date_year").attr("expiry_date"),Asset.prototype.each=Asset.prototype.forEach=function(fn){for(var i=0,l=Asset.attrs.length;i<l;i++){var attr=Asset.attrs[i],val=this[attr]();val&&fn(attr,val)}},Asset.prototype.full_name=function(val){if(this.attrs=this.attrs||{},!arguments.length)return this.attrs.full_name;var names=splitName(val);return this.attrs.full_name=names.full,this.first_name(names.first),this.last_name(names.last),this},Asset.prototype.expiry_date=function(){return this.expiry_date_month()+"/"+this.expiry_date_year()}},{}],97:[function(require,module,exports){function Field(attrs){if(!(this instanceof Field))return new Field(attrs);attrs=attrs||{},this.attrs={};for(var key in attrs)attrs.hasOwnProperty(key)&&("function"==typeof this[key]?this[key](attrs[key]):this.attrs[key]=attrs[key])}var Accessible=require("../utils/accessible"),trigger=require("../utils/trigger-event"),visible=(require("debug")("form:field"),require("visible"));module.exports=Field;var mixins={input:require("./input"),select:require("./select")};Accessible(Field),Field.attr("fieldType").attr("selector").attr("scores"),Field.prototype.el=Field.prototype.element=function(val){if(!arguments.length){if(this.attrs.el)return this.attrs.el;var ctx=this.form.el(),el=ctx&&ctx.querySelector(this.selector());return this.attrs.el=el,el}this.attrs.el=val;var nodeName=val&&val.nodeName&&val.nodeName.toLowerCase(),mixin=mixins[nodeName];return mixin&&mixin(this),this},Field.prototype.selector=function(val){return arguments.length?(this.attrs.selector=val,this):this.attrs.selector},Field.prototype.fieldType=function(type){return arguments.length?(this.attrs.fieldType=type,this):this.attrs.fieldType},Field.prototype.fill=function(val){var el=this.el();return el?(el.focus&&el.focus(),trigger(el,"focus"),el.value=val,trigger(el,"change"),trigger(el,"keyup"),el.blur&&el.blur(),trigger(el,"blur"),this):this},Field.prototype.clear=function(){return this.fill("")},Field.prototype.click=function(){var el=this.el();return el.click(),trigger(el,"click"),this},Field.prototype.toJSON=function(shallow){var json={};if(shallow)json.fieldType=this.attrs.fieldType,json.selector=this.attrs.selector;else for(var key in this.attrs)if(this.attrs.hasOwnProperty(key))if("function"==typeof this[key]){var val=this[key]();~["string","number"].indexOf(typeof val)&&(json[key]=val)}else{var val=this.attrs[key];~["string","number"].indexOf(typeof val)&&(json[key]=val)}return!shallow&&this.el()&&(json.visible=visible(this.el())),json}},{"../utils/accessible":106,"../utils/trigger-event":111,"./input":98,"./select":99,debug:148,visible:236}],98:[function(require,module,exports){function Input(obj){if(obj)return mixin(obj)}function mixin(obj){return obj.fill=Input.prototype.fill,obj}var trigger=require("../utils/trigger-event");module.exports=Input,Input.prototype.fill=function(val){var input=this.el();return input?(input.focus&&input.focus(),trigger(input,"focus"),input.value=val,trigger(input,"input",{bubbles:!0}),trigger(input,"keyup"),trigger(input,"change"),input.blur&&input.blur(),trigger(input,"blur"),this):this}},{"../utils/trigger-event":111}],99:[function(require,module,exports){function Select(obj){if(obj)return mixin(obj)}function mixin(obj){return obj.fill=Select.prototype.fill,obj}var trigger=require("../utils/trigger-event"),states=require("./states");module.exports=Select,Select.prototype.fill=function(val){var select=this.el();if(!select)return this;select.focus&&select.focus(),trigger(select,"focus");var options=select.querySelectorAll("option"),regex=new RegExp(val,"i");"state"==this.fieldType()&&2==options[options.length-1].innerText.length&&(regex=new RegExp(states[val]));for(var i=0,l=options.length;i<l;i++){var option=options[i];regex.test(option.innerText)||regex.test(option.value)?option.selected=!0:option.selected=!1}return trigger(select,"change"),select.blur&&select.blur(),trigger(select,"blur"),this}},{"../utils/trigger-event":111,"./states":100}],100:[function(require,module,exports){module.exports={Alabama:"AL",Alaska:"AK","American Samoa":"AS",Arizona:"AZ",Arkansas:"AR",California:"CA",Colorado:"CO",Connecticut:"CT",Delaware:"DE","District Of Columbia":"DC","Federated States Of Micronesia":"FM",Florida:"FL",Georgia:"GA",Guam:"GU",Hawaii:"HI",Idaho:"ID",Illinois:"IL",Indiana:"IN",Iowa:"IA",Kansas:"KS",Kentucky:"KY",Louisiana:"LA",Maine:"ME","Marshall Islands":"MH",Maryland:"MD",Massachusetts:"MA",Michigan:"MI",Minnesota:"MN",Mississippi:"MS",Missouri:"MO",Montana:"MT",Nebraska:"NE",Nevada:"NV","New Hampshire":"NH","New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND","Northern Mariana Islands":"MP",Ohio:"OH",Oklahoma:"OK",Oregon:"OR",Palau:"PW",Pennsylvania:"PA","Puerto Rico":"PR","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD",Tennessee:"TN",Texas:"TX",Utah:"UT",Vermont:"VT","Virgin Islands":"VI",Virginia:"VA",Washington:"WA","West Virginia":"WV",Wisconsin:"WI",Wyoming:"WY"}},{}],101:[function(require,module,exports){function FormFinder(opts){opts=opts||{},this.ctx(document),this.execOnStart(!0),this.set(opts),this.watched=[],this.found=[],this.running=!1}function hasInput(el){if(el){if("INPUT"==el.nodeName&&"password"==el.type)return!0;var inputs=el.querySelectorAll&&el.querySelectorAll("input[type=password]");return!(!inputs||!inputs.length)}}function within(el,parent){for(var node=el;node=node.parentNode;)if(node==parent)return!0;return!1}var setImmediate,debug=require("debug")("form:finder"),fdetect=require("../../../fdetect"),Accessible=require("../utils/accessible"),Emitter=require("component-emitter"),Loop=require("../utils/loop"),Observer=require("../utils/mutation-observer"),Form=(require("visible"),require("../form")),$=require("jquery");module.exports=FormFinder,Emitter(FormFinder),Emitter(FormFinder.prototype),Accessible(FormFinder).attr("ctx").attr("filters").attr("detect").attr("execOnStart"),FormFinder.prototype.set=function(opts){opts=opts||{};for(var prop in opts)"function"==typeof this[prop]&&"undefined"!=typeof opts[prop]&&this[prop](opts[prop]);return this},FormFinder.prototype.exec=function(opts){var self=this;return opts=opts||{},this.set(opts),opts={ctx:this.ctx(),filters:this.filters(),detect:this.detect(),isMutation:opts.isMutation},setImmediate||(setImmediate=require("../utils/set-immediate")),setImmediate(function(){var forms=fdetect.getForms(opts).map(function(form){return form=Form(form),form.attrs.isMutation=opts.isMutation||!1,form});self.emit("forms",forms,opts),forms.forEach(function(form){~self.found.indexOf(form.el())||(self.found.push(form.el()),self.emit(form.formType(),form,form.el()),self.emit("form",form,form.el(),form.formType()))})}),this},FormFinder.prototype.start=function(){var self=this;return this.running=!0,this.loop=this.loop||new Loop,this.observe(),this.execOnStart()&&this.exec(),this.loop.on("render",function(){self.onrender.apply(self,arguments)}),this.loop.start(),this.emit("start"),debug("start"),this},FormFinder.prototype.observe=function(){if(["function","object"].indexOf(typeof Observer)==-1)return this;var self=this;return this.observer=this.observer||new Observer(function(){self.onchanges.apply(self,arguments)}),this.observer.observe(this.ctx(),{childList:!0,subtree:!0}),this},FormFinder.prototype.onchanges=function(changes){for(var i=0,len=changes.length;i<len;i++)if(changes[i].addedNodes.length)for(var nodes=[].slice.call(changes[i].addedNodes).reduce(function(ret,el){return~ret.indexOf(el)?ret:ret.some(function(parent){return $.contains(parent,el)})?ret:(ret.push(el),ret)},[]),j=0,l=nodes.length;j<l;j++){var target=nodes[j],containsInput=hasInput(target),alreadyWatched=~this.watched.indexOf(target),alreadyIncluded=this.watched.some(function(el){return within(target,el)});!containsInput||alreadyWatched||alreadyIncluded||this.watched.push(target)}},FormFinder.prototype.disconnect=function(){return this.observer&&this.observer.disconnect(),this},FormFinder.prototype.pause=FormFinder.prototype.stop=function(){return this.running=!1,this.disconnect(),this.loop.pause(),this.loop.off("render"),this.emit("pause"),debug("pause"),this},FormFinder.prototype.onrender=function(){var watched=this.watched.slice();for(this.watched=[];watched.length;){var el=watched.pop();this.exec({ctx:el,isMutation:!0})}return this}},{"../../../fdetect":13,"../form":103,"../utils/accessible":106,"../utils/loop":107,"../utils/mutation-observer":108,"../utils/set-immediate":110,"component-emitter":146,debug:148,jquery:"jquery",visible:236}],102:[function(require,module,exports){function Address(obj){if(obj)return mixin(obj)}function mixin(obj){return obj.fill=Address.prototype.fill,obj}var Asset=require("../asset");module.exports=Address,Address.prototype.fill=function(data){if(!this.el())return this;var self=this,asset=new Asset(data);return asset.forEach(function(role,val){if("address"==role){var field=self.getFields(role).shift();field&&field.fill(asset.address())}else if("phone"==role){var field=self.getFields(role).shift();field&&field.fill(asset.phone()||asset.cellular())}else if("cellular"==role){var fields=self.getFields("phone");asset.phone?fields.length>=2&&(field=fields&&fields[1]):field=fields&&fields.shift(),field&&field.fill(asset.cellular()||asset.phone())}else self.getFields(role).forEach(function(field){field.fill(val)})}),this}},{"../asset":96}],103:[function(require,module,exports){function Form(attrs){if(!(this instanceof Form))return new Form(attrs);attrs=attrs||{},this.attrs={},this.fields=[];for(var key in attrs)"fields"!=key&&attrs.hasOwnProperty(key)&&("function"==typeof this[key]?this[key](attrs[key]):this.attrs[key]=attrs[key]);this.classifyFields(attrs.fields)}var Accessible=require("../utils/accessible"),Emitter=require("component-emitter"),fdetect=require("../../../fdetect"),visible=require("visible"),Field=require("../field"),Asset=require("../asset"),mixins={address:require("./address"),login:require("./login"),payment:require("./payment")};module.exports=Form,Emitter(Form.prototype),Accessible(Form),Form.prototype.__iterate__=function(){var self=this;return{length:function(){return self.length()},get:function(i){return self.fields[i]}}},Form.attr("visible").attr("el").attr("selector").attr("context").attr("formType").attr("formFinder"),Form.prototype.length=function(){return this.fields.length},Emitter(Form.prototoype),Form.prototype.el=Form.prototype.element=function(el){if(!arguments.length){if(this.attrs.el)return this.attrs.el;var el=document.querySelector(this.selector());return this.attrs.el=el,el}return this.attrs.el=el,this},Form.prototype.selector=function(val){return arguments.length?(this.attrs.selector=val,this):this.attrs.selector},Form.prototype.formType=function(val){if(!arguments.length)return this.attrs.formType;this.attrs.formType=val;var mixin=mixins[val];return mixin&&mixin(this),this},Form.prototype.fill=function(data){if(!this.el())return this;var self=this;return new Asset(data).forEach(function(role,val){self.getFields(role).forEach(function(field){field.fill(val)})}),this},Form.prototype.classifyFields=function(fields){var self=this;if(fields)this.emit("classifyFields",fields,this.el()),this.fields=this.fields||[],fields.forEach(function(field){self.push(Field(field))});else{var roles=fdetect.roles(this.el(),this.formType());this.emit("classifyFields",roles,this.el()),this.fields=this.fields||[];for(var role in roles)if(roles.hasOwnProperty(role))for(var i=0,l=roles[role].length;i<l;i++)this.push(Field({fieldType:role,el:roles[role][i]}))}return this},Form.prototype.push=function(field){return field?(field.form=this,this.fields.push(field),this):this},Form.prototype.getFields=function(role){return this.fields.filter(function(field){return!role||role==field.fieldType()})},Form.prototype.submit=function(){var captcha=this.getFields("captcha").at(0),submit=this.getFields("submit").at(0);return captcha?(captcha.focus(),this):(submit&&submit.click(),this)},Form.prototype.clear=function(){return this.fields.map(function(field){return field.clear()}),this},Form.prototype.visible=function(){return"undefined"==typeof this.attrs.visible&&this.el()?visible(this.el()):this.attrs.visible},Form.prototype.toJSON=function(shallow){var self=this,json={};if(shallow)["url","context","selector","formType","version"].forEach(function(attr){json[attr]=self.attrs[attr]});else for(var key in this.attrs)if("fields"!=key&&this.attrs.hasOwnProperty(key))if("function"==typeof this[key]){var val=this[key]();~["string","number"].indexOf(typeof val)&&(json[key]=val)}else{var val=this.attrs[key];~["string","number"].indexOf(typeof val)&&(json[key]=val)}return shallow||(json.performance=this.attrs.performance||[]),!shallow&&this.el()&&(json.visible=this.visible()),json.fields=self.fields.map(function(field){return field.toJSON(shallow)}),json}},{"../../../fdetect":13,"../asset":96,"../field":97,"../utils/accessible":106,"./address":102,"./login":104,"./payment":105,"component-emitter":146,visible:236}],104:[function(require,module,exports){function Login(obj){if(obj)return mixin(obj)}function mixin(obj){return obj}module.exports=Login},{}],105:[function(require,module,exports){function Payment(obj){if(obj)return mixin(obj)}function mixin(obj){return obj}module.exports=Payment},{}],106:[function(require,module,exports){function Accessible(ctor){if(ctor)return mixin(ctor)}function mixin(ctor){ctor.attrs=ctor.attrs||{};for(var key in Accessible)ctor[key]=Accessible[key];return ctor}module.exports=Accessible,Accessible.attr=function(name,options){return this.attrs[name]=options||{},this.prototype[name]=function(val){if(this.dirty=this.dirty||{},this.attrs=this.attrs||{},!arguments.length)return this.attrs[name];var prev=this.attrs[name];return this.dirty[name]=val,this.attrs[name]=val,this.constructor&&"function"==typeof this.constructor.emit&&(this.constructor.emit("change",this,name,val,prev),this.constructor.emit("change "+name,this,val,prev)),"function"==typeof this.emit&&(this.emit("change",name,val,prev),this.emit("change "+name,val,prev)),this},this.prototype.toJSON=function(){return this.attrs||{}},this}},{}],107:[function(require,module,exports){function Loop(fps){this.now=0,this.before=0,this.deltaTime=0,this.maxDeltaTime=0,this.timeStep=0,this.startTime=0,this.timeElapsed=0,this.accumulator=0,this.ticking=!1,this.frame=0,this._fps=0,this.fps(fps||60)}var raf=require("./raf"),Emitter=require("component-emitter");module.exports=Loop,Emitter(Loop.prototype),Loop.prototype.start=function(){return this.startTime=this.now=this.before=Date.now(),this.emit("start"),this.ticking=!0,this.tick(),this},Loop.prototype.pause=function(){return this.ticking=!1,this.emit("pause"),this},Loop.prototype.fps=function(fps){return fps?(this._fps=fps,this.timeStep=1e3/this._fps|0,this.maxDeltaTime=5*this.timeStep,this):this._fps},Loop.prototype.tick=function(){function tick(){if(self.ticking){if(raf(tick),self.now=Date.now(),self.timeElapsed=self.now-self.startTime,self.deltaTime=self.now-self.before,self.before=self.now,self.deltaTime>self.maxDeltaTime)return void self.emit("discard",self.deltaTime/self.timeStep,self.deltaTime);for(self.accumulator+=self.deltaTime;self.accumulator>=self.timeStep;)self.accumulator-=self.timeStep,self.emit("update",self.timeStep,1,++self.frame,self.timeElapsed);alpha=self.accumulator/self.timeStep,self.emit("render",self.deltaTime,alpha,self.frame,self.timeElapsed)}}var alpha,self=this;return raf(tick),this}},{"./raf":109,"component-emitter":146}],108:[function(require,module,exports){module.exports=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},{}],109:[function(require,module,exports){function fallback(fn){var curr=(new Date).getTime(),ms=Math.max(0,16-(curr-prev)),req=setTimeout(function(){fn()},ms);return prev=curr,req}exports=module.exports=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||fallback;var prev=(new Date).getTime(),cancel=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.clearTimeout;exports.cancel=function(id){cancel.call(window,id)}},{}],110:[function(require,module,exports){(function(process){!function(root,undefined){"use strict";function addFromSetImmediateArguments(args){return tasksByHandle[nextHandle]=partiallyApplied.apply(void 0,args),nextHandle++}function partiallyApplied(handler){var args=[].slice.call(arguments,1);return function(){"function"==typeof handler?handler.apply(void 0,args):new Function(""+handler)()}}function runIfPresent(handle){if(currentlyRunningATask)setTimeout(function(){partiallyApplied(runIfPresent,handle)},0);else{var task=tasksByHandle[handle];if(task){currentlyRunningATask=!0;try{task()}finally{clearImmediate(handle),currentlyRunningATask=!1}}}}function clearImmediate(handle){delete tasksByHandle[handle]}function installNextTickImplementation(){setImmediate=function(){var handle=addFromSetImmediateArguments(arguments);return process.nextTick(partiallyApplied(runIfPresent,handle)),handle}}function canUsePostMessage(){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1)return!1;if(global.postMessage&&!global.importScripts){var postMessageIsAsynchronous=!0,testCallback=function(event){"canUsePostMessage"===event.data&&(postMessageIsAsynchronous=!1,event.stopImmediatePropagation()),global.removeEventListener("message",testCallback,!1)};return global.addEventListener("message",testCallback,!1),global.postMessage("canUsePostMessage","*"),postMessageIsAsynchronous}}function installPostMessageImplementation(){var messagePrefix="setImmediate$"+Math.random()+"$",onGlobalMessage=function(event){event.source!==global&&event.origin!==global.location.origin||"string"!=typeof event.data||0!==event.data.indexOf(messagePrefix)||(event.stopImmediatePropagation(),runIfPresent(+event.data.slice(messagePrefix.length)))};global.addEventListener?global.addEventListener("message",onGlobalMessage,!1):global.attachEvent("onmessage",onGlobalMessage),setImmediate=function(){var handle=addFromSetImmediateArguments(arguments);return global.postMessage(messagePrefix+handle,"*"),handle}}function installMessageChannelImplementation(){var channel=new MessageChannel;channel.port1.onmessage=function(event){runIfPresent(event.data)},setImmediate=function(){var handle=addFromSetImmediateArguments(arguments);return channel.port2.postMessage(handle),handle}}function installReadyStateChangeImplementation(){var html=doc.documentElement;setImmediate=function(){var handle=addFromSetImmediateArguments(arguments),script=doc.createElement("script");return script.onreadystatechange=function(){runIfPresent(handle),script.onreadystatechange=null,html.removeChild(script),script=null},html.appendChild(script),handle}}function installSetTimeoutImplementation(){setImmediate=function(){var handle=addFromSetImmediateArguments(arguments);return setTimeout(function(){partiallyApplied(runIfPresent,handle)},0),handle}}var global=root&&root.self&&root.self.window?root.self:root;if(global.setImmediate)return void(module.exports=global.setImmediate);var setImmediate,nextHandle=1,tasksByHandle={},currentlyRunningATask=!1,doc=global.document;"[object process]"==={}.toString.call(global.process)?installNextTickImplementation():canUsePostMessage()?installPostMessageImplementation():global.MessageChannel?installMessageChannelImplementation():doc&&"onreadystatechange"in doc.createElement("script")?installReadyStateChangeImplementation():installSetTimeoutImplementation(),exports=module.exports=setImmediate,exports.clearImmediate=clearImmediate}("undefined"==typeof window?this:window)}).call(this,require("_process"))},{_process:218}],111:[function(require,module,exports){function trigger(el,name,options){var event,type;options=options||{};for(var attr in defaults)options.hasOwnProperty(attr)||(options[attr]=defaults[attr]);if(document.createEvent)type=eventTypes[name]||"CustomEvent",event=document.createEvent(type),initializers[type](el,name,event,options),el.dispatchEvent(event);else{event=document.createEventObject();for(var key in options)event[key]=options[key];el.fireEvent("on"+name,event)}}module.exports=trigger;var eventTypes={load:"HTMLEvents",unload:"HTMLEvents",abort:"HTMLEvents",error:"HTMLEvents",select:"HTMLEvents",change:"HTMLEvents",submit:"HTMLEvents",reset:"HTMLEvents",focus:"HTMLEvents",blur:"HTMLEvents",resize:"HTMLEvents",scroll:"HTMLEvents",input:"HTMLEvents",keyup:"KeyboardEvent",keydown:"KeyboardEvent",click:"MouseEvents",dblclick:"MouseEvents",mousedown:"MouseEvents",mouseup:"MouseEvents",mouseover:"MouseEvents",mousemove:"MouseEvents",mouseout:"MouseEvents",contextmenu:"MouseEvents"},defaults={clientX:0,clientY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0,view:document.defaultView,key:"",location:0,modifiers:"",repeat:0,locale:""},initializers={HTMLEvents:function(el,name,event,o){return event.initEvent(name,o.bubbles,o.cancelable)},KeyboardEvent:function(el,name,event,o){var charCode,modifiers,key="key"in o?o.key:"",location="location"in o?o.location:0;return event.initKeyboardEvent?(!1 in o?(modifiers=[],o.ctrlKey&&modifiers.push("Ctrl"),o.altKey&&modifiers.push("Alt"),o.ctrlKey&&o.altKey&&modifiers.push("AltGraph"),o.shiftKey&&modifiers.push("Shift"),o.metaKey&&modifiers.push("Meta"),modifiers=modifiers.join(" ")):modifiers=o.modifiers,event.initKeyboardEvent(name,o.bubbles,o.cancelable,o.view,key,location,modifiers,o.repeat,o.locale)):(charCode="charCode"in o?o.charCode:key.charCodeAt(0)||0,event.initKeyEvent(name,o.bubbles,o.cancelable,o.view,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,charCode,key))},MouseEvents:function(el,name,event,o){var clicks,button,screenX="screenX"in o?o.screenX:o.clientX,screenY="screenY"in o?o.screenY:o.clientY;return clicks="detail"in o?o.detail:"dblclick"===name?2:1,"contextmenu"===name&&(button=button=o.button||2),event.initMouseEvent(name,o.bubbles,o.cancelable,o.view,clicks,screenX,screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,button,el)},CustomEvent:function(el,name,event,o){return event.initCustomEvent(name,o.bubbles,o.cancelable,o.detail)}}},{}],112:[function(require,module,exports){function Banner(config){Frame.apply(this,arguments),this.$el.css({display:"inline-block",position:"fixed",width:"100%",height:"43px",top:0,left:0})}var DomHelpers=require("../dom-helpers"),Frame=(require("jquery"),require("./frame")),inherit=require("component-inherit");module.exports=Banner;inherit(Banner,Frame),Banner.prototype.show=function(callback){this.$el.css({"margin-top":"-43px"}),DomHelpers.addImportantStyleAttribute(this.$el,"visibility","visible"),DomHelpers.addImportantStyleAttribute(this.$el,"z-index","2147483647"),this.$el.show(),this.$el.animate({marginTop:0},{duration:300,complete:function(){callback&&callback()}})},Banner.prototype.resize=function(width,height){return Frame.prototype.resize.call(this,void 0,height)},Banner.prototype.hide=function(callback){var _this=this;this.$el.animate({marginTop:-this.$el.height()},{duration:300,complete:function(){_this.$el.hide(),callback&&callback()}})}},{"../dom-helpers":5,"./frame":116,"component-inherit":147,jquery:"jquery"}],113:[function(require,module,exports){function Custom(config){Frame.apply(this,arguments)}var DomHelpers=require("../dom-helpers"),Frame=require("./frame"),inherit=require("component-inherit");module.exports=Custom,inherit(Custom,Frame),Custom.prototype.prepareEl=function(){this.$el.css({position:"fixed",bottom:"-500px",right:"0px"})},Custom.prototype.show=function(callback){DomHelpers.addImportantStyleAttribute(this.$el,"visibility","visible"),DomHelpers.addImportantStyleAttribute(this.$el,"z-index","2147483647"),this.$el.animate({bottom:0},{duration:300,complete:function(){callback&&callback()}}),callback&&callback()},Custom.prototype.hide=function(callback){var _this=this;this.$el.animate({bottom:-this.$el.outerHeight(!0)},{duration:300,complete:function(){_this.$el.hide(),callback&&callback()}})}},{"../dom-helpers":5,"./frame":116,"component-inherit":147}],114:[function(require,module,exports){function appendStyles(){var fetchStyles;if(Target.CHROME){var req={type:"link-request",content:{method:"fetchContentScriptStyles",params:{}}};fetchStyles=new Promise(function(resolve,reject){chrome.extension.sendMessage(req,function(data){data&&data.success?resolve(data.content):reject()})})}else fetchStyles=new Promise(function(resolve,reject){FA.Framework.sendMessage({faTrigger:"fetchContentScriptStyles"},function(data){"string"==typeof data?resolve(data):reject()})});return fetchStyles.then(function(data){var styleNode=document.createElement("style");styleNode.type="text/css";var styleText=document.createTextNode(data);styleNode.appendChild(styleText),document.getElementsByTagName("head")[0].appendChild(styleNode)})}function onDocumentLoaded(){var frameId=location.hash.substr(1),options={};try{options=JSON.parse(window.name)}catch(e){options={}}var frames=require("frames");frames.setLocale(options.language),view=new(frames.getView(frameId))(options),view.on("frameMessage",sendMessage),$("body").html(view.$el),view.render()}function sendMessage(message,data,view){var blob=JSON.stringify({type:"pb-frame-to-parent",message:message,frameID:view.options.uuid,payload:data||{}});Target.IE?window.self.parent.postMessage(blob,"*"):window.parent.postMessage(blob,"*")}var view,$=require("jquery"),Target=require("../target"),Promise=require("bluebird");module.exports=function(){if("/pages/tk-inpages-frame.html"!==location.pathname&&"/framefactory/tk-inpages-frame.html"!==location.pathname&&"/data/pages/tk-inpages-frame.html"!==location.pathname)return!1;Target.IE?appendStyles().then(function(){onDocumentLoaded()}):$(document).ready(function(){appendStyles().then(onDocumentLoaded)})};var onMessage=function(evt){var parsedMessage;try{parsedMessage=JSON.parse(evt.data)}catch(e){return}if("pb-parent-to-frame"!==parsedMessage.type)return!1;var payload=parsedMessage.payload;view.onMessage(parsedMessage.message,payload)};"undefined"!=typeof PB&&Target.IE?window.self.addEventListener("message",onMessage,!1,!0):window.addEventListener("message",onMessage,!1,!0)},{"../target":142,bluebird:145,frames:"frames",jquery:"jquery"}],115:[function(require,module,exports){function FrameFactory(){this.children=[]}var Frame=require("./frame"),Tooltip=require("./tooltip"),Banner=require("./banner"),Overlay=require("./overlay"),Custom=require("./custom"),_=require("underscore"),Target=require("../target"),pbUtils=require("../pb-utils"),metrics=require("../metrics");module.exports=FrameFactory,FrameFactory.prototype.create=function(params){if(Target.IOS)return!1;if(Target.IE&&document&&9===document.documentMode)return PB.contentscript.IEMonitoringExperimentEnabled&&FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"ie_legacy_document_mode_encountered",mixpanel_params:{origin_script:"legacy",context:"browser_desktop",website_url:metrics.url,domain:metrics.domain,document_mode:document.documentMode}}),!1;var frame,_this=this,type=params.id.split("-")[0],config=_.extend(params,{id:params.id,type:type,options:params.options||{},attachTo:params.attachTo||"[pb-autologin] [pb-role=password]"});config.options.originScript=params.options.originScript||"legacy",config.options.formIsInIframe=params.options.formIsInIframe||pbUtils.areWeInAnIframe();var existing=this.getByFrameID(config.id);switch(existing&&"tooltip-creditcardSelector"!==config.id&&existing.destroy(),type){case"tooltip":frame=new Tooltip(config);break;case"banner":frame=new Banner(config);break;case"overlay":frame=new Overlay(config);break;case"custom":frame=new Custom(config);break;default:frame=new Frame(config)}return config.options.focus&&frame.$el[0].contentWindow.focus(),this.children.push(frame),frame.once("destroy",function(){_this.children=_.without(_this.children,frame)}),frame},FrameFactory.prototype.getByFrameID=function(id){return _.find(this.children,function(frame,index,list){return frame.config.id===id})},FrameFactory.prototype.destroyAll=function(){_.each(this.children,function(frame,index,list){frame.destroy()})}},{"../metrics":135,"../pb-utils":136,"../target":142,"./banner":112,"./custom":113,"./frame":116,"./overlay":118,"./tooltip":120,underscore:"underscore"}],116:[function(require,module,exports){function Frame(config){this.config=config||{options:{}},this.config.options.uuid=uuid(),"undefined"!=typeof PB&&(this.config.options.language=PB.contentscript.bgdata.language),Target.CHROME?this.url="chrome-extension://"+chrome.runtime.id+"/pages/tk-inpages-frame.html":Target.EDGE?this.url="ms-browser-extension://"+browser.runtime.id+"/pages/tk-inpages-frame.html":Target.FIREFOX?this.url=browser.extension.getURL("pages/tk-inpages-frame.html"):this.url="https://a0.tkassets.com/framefactory/tk-inpages-frame.html",this.url+="#"+config.id,this.$el=$('<iframe class="PBTooltipFrame" style="width:100%; z-index: -2147483647; visibility:hidden;" scrolling="no" frameborder="0" src="'+this.url+'" />'),this.$el.attr({name:JSON.stringify(this.config.options),"data-inpageID":config.id}),this.prepareEl&&this.prepareEl(),this.render(),Target.IE?window.self.addEventListener("message",_.bind(this.onMessage,this),!1,!0):window.addEventListener("message",_.bind(this.onMessage,this),!1,!0)}var Emitter=require("component-emitter"),uuid=require("node-uuid"),$=require("jquery"),_=require("underscore"),Target=require("../target"),metrics=require("../metrics"),DomHelpers=require("../dom-helpers");module.exports=Frame,Frame.prototype.onMessage=function(evt){var parsedMessage;if(!Target.IE){var origin="https://a0.tkassets.com";if(Target.CHROME?origin="chrome-extension://"+chrome.runtime.id:Target.EDGE?origin="ms-browser-extension://"+browser.runtime.id:Target.FIREFOX&&(origin=browser.runtime.getURL("")),!origin.startsWith(evt.origin)||this.$el.get(0).contentWindow!==evt.source)return!1}try{parsedMessage=JSON.parse(evt.data)}catch(e){return}if("pb-frame-to-parent"!==parsedMessage.type)return!1;var payload=parsedMessage.payload;if(parsedMessage.frameID!==this.config.options.uuid)return!1;switch(parsedMessage.message){case"contentReady":
this.onContentReady();break;case"resize":this.resize(payload.width,payload.height);break;case"destroy":this.destroy();break;case"cancelSave":FA.Framework.sendMessage({faTrigger:"cancelAutoSave"});break;case"blockLastChance":FA.Framework.sendMessage({faTrigger:"blockLastChance",url:metrics.url});break;case"removeTemp":FA.Framework.sendMessage({faTrigger:"tRemoveTemp",cid:payload.tempCid});break;case"validateTemp":FA.Framework.sendMessage({faTrigger:"tValidateTemp",cid:payload.tempCid,doAction:payload.doAction||"update",context:payload.context,formDetectionTechnique:payload.formDetectionTechnique,browserName:metrics.browserName,browserVersion:metrics.browserVersion});break;case"neverSave":FA.Framework.sendMessage({faTrigger:"neverSave"});break;case"disableBoxFullNag":FA.Framework.sendMessage({faTrigger:"tDisableBoxFullNag"});break;case"copyToClipboard":FA.Framework.sendMessage({faTrigger:"copyToClipboard",string:payload.string});break;case"unsupportedNotificationSeen":FA.Framework.sendMessage({faTrigger:"tSupportNotificationSeen",id:payload.siteID});break;case"disable-unregistered":FA.Framework.sendMessage({faTrigger:"tAddToIgnoredNeverSignedUp",url:location.hostname});break;case"disableLoginPrompt":FA.Framework.sendMessage({faTrigger:"tDisableLoginPromptInpage"});break;case"passwordGenerated":FA.Framework.sendMessage({faTrigger:"tCreateGeneratedPassword",attributes:{domain:location.hostname,date:(new Date).toString(),password:payload.password}});break;case"cardSelected":this.emit("cardSelected",payload);break;case"track":_.extend(payload,{context:metrics.context,browser_name:metrics.browserName,browser_version:metrics.browserVersion,website_url:metrics.url,domain:metrics.domain});var eventName=payload.name;delete payload.name,FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:eventName,mixpanel_params:payload});break;case"accountSelected":var options=this.config.options,selectedAsset=_.find(options.assets,function(asset){return asset.id===payload.assetID});"function"==typeof options.onSelectedAsset&&options.onSelectedAsset(options.form,selectedAsset);break;case"deleteAsset":FA.Framework.sendMessage({faTrigger:"tDeleteAssetFromCS",assetID:payload.assetID,websiteUrl:payload.websiteUrl,browserName:metrics.browserName,browserVersion:metrics.browserVersion}),_.each(PB.contentscript.saved_assets,function(asset,index,list){asset.faAssetId===payload.assetID&&list.splice(index,1)});if(PBCS.frameFactory.getByFrameID("tooltip-accountSelector")){var assets=_.map(PB.contentscript.saved_assets,function(asset){return{id:asset.faAssetId,username:asset.login,title:asset.name}});assets.length&&PBCS.frameFactory.create({id:"tooltip-accountSelector",options:{assets:assets}})}}this.emit(parsedMessage.message,payload)},Emitter(Frame.prototype),Frame.prototype.onContentReady=function(options){this.isContentReady=!0,this.show(),this.emit("contentReady")},Frame.prototype.getFrameContext=function(){return this.config.id.replace(this.config.type+"-","")},Frame.prototype.resize=function(width,height){var viewport;viewport=$(Target.IE?window.self:window),width&&(width==viewport.outerWidth()?width="100%":width+="px",DomHelpers.addImportantStyleAttribute(this.$el,"width",width)),height&&(height==viewport.outerHeight()?height="100%":height+="px",DomHelpers.addImportantStyleAttribute(this.$el,"height",height)),this.$attachTo&&this.$attachTo.trigger("pbOnMove"),this.$el.trigger("pbOnResize")},Frame.prototype.destroy=function(){var _this=this;this.hide(function(){_this.$attachTo&&_this.$attachTo.focus(),_this.emit("destroy"),_this.$el.remove(),_this.off()})},Frame.prototype.render=function(){function doRender(){var target=that.config.prependTo||"body";that.$el.appendTo(target),DomHelpers.addImportantStyleAttribute(that.$el,"width","100%")}var that=this;$.isReady?doRender():$(function(){doRender()})},Frame.prototype.show=function(){DomHelpers.addImportantStyleAttribute(this.$el,"visibility","visible"),DomHelpers.addImportantStyleAttribute(this.$el,"z-index","2147483647"),this.$el.show()},Frame.prototype.hide=function(callback){this.$el.hide(),callback()},Frame.prototype.sendMessage=function(message,payload){var blob=JSON.stringify({type:"pb-parent-to-frame",message:message,payload:payload||{}}),that=this;$(function(){that.$el.get(0).contentWindow.postMessage(blob,"*")})}},{"../dom-helpers":5,"../metrics":135,"../target":142,"component-emitter":146,jquery:"jquery","node-uuid":214,underscore:"underscore"}],117:[function(require,module,exports){"undefined"==typeof PBCS&&(PBCS={});var FrameFactory=require("./frame-factory"),loadContent=require("./frame-content");PBCS.frameFactory=new FrameFactory,module.exports={loadContent:loadContent}},{"./frame-content":114,"./frame-factory":115}],118:[function(require,module,exports){function Overlay(config){Frame.apply(this,arguments),this.$el.css({position:"fixed",width:"100%",height:"100%",top:0,left:0,opacity:0})}var Frame=require("./frame"),inherit=require("component-inherit"),DomHelpers=require("../dom-helpers");module.exports=Overlay,inherit(Overlay,Frame),Overlay.prototype.show=function(callback){DomHelpers.addImportantStyleAttribute(this.$el,"visibility","visible"),DomHelpers.addImportantStyleAttribute(this.$el,"z-index","2147483647"),this.$el.animate({opacity:1},{duration:400,complete:function(){callback&&callback()}}),callback&&callback()},Overlay.prototype.hide=function(callback){var _this=this;this.$el.animate({opacity:0},{duration:400,complete:function(){_this.$el.hide(),callback&&callback()}})}},{"../dom-helpers":5,"./frame":116,"component-inherit":147}],119:[function(require,module,exports){function FrameFactoryShim(){}function Frame(config){}module.exports=FrameFactoryShim,FrameFactoryShim.prototype.loadContent=function(){},FrameFactoryShim.prototype.create=function(params){switch(params=params||{},params.id){case"tooltip-accountSelector":FA.Framework.sendMessage({faTrigger:"tooltip-accountSelector",options:{forms:params.options.form,faCallback:"accountSelected"}})}return new Frame},FrameFactoryShim.prototype.getByFrameID=function(id){return new Frame},FrameFactoryShim.prototype.destroyAll=function(){},Frame.prototype.onMessage=function(evt){},Frame.prototype.on=function(event,params,callback){},Frame.prototype.onContentReady=function(options){},Frame.prototype.getFrameContext=function(){},Frame.prototype.resize=function(width,height){},Frame.prototype.destroy=function(){},Frame.prototype.render=function(){},Frame.prototype.show=function(callback){},Frame.prototype.hide=function(callback){},Frame.prototype.sendMessage=function(message,payload){}},{}],120:[function(require,module,exports){function Tooltip(config){switch(Frame.apply(this,arguments),this.attachTo=config.attachTo,this.attachmentPoint=config.attachmentPoint,this.isToolbar=config.isToolbar,config.id){case"tooltip-passwordGenerator":this.destroyOnBodyClick=!0;break;case"tooltip-accountSelector":this.destroyOnBodyClick=!0;break;case"tooltip-catchAll":this.ignoreAnchorElementVisibility=!0}"body"!==this.attachTo?DomHelpers.addImportantStyleAttribute(this.$el,"position","absolute"):DomHelpers.addImportantStyleAttribute(this.$el,"position","fixed")}var $=require("jquery"),_=require("underscore"),Frame=require("./frame"),inherit=require("component-inherit"),isVisible=require("visible"),DomHelpers=require("../dom-helpers");module.exports=Tooltip;inherit(Tooltip,Frame),Tooltip.prototype.onContentReady=function(){var visibleElements,attachTo=this.attachTo;return this.$attachTo=$(attachTo),0!==this.$attachTo.length&&(visibleElements=this.$attachTo.toArray().filter(PB.contentscript.isVisible),visibleElements.length&&(this.$attachTo=$(visibleElements)),this.isToolbar?this.positionToolbarTooltip():(this.positionTooltip(),this.$attachTo.on("pbOnMove",_.bind(this.positionTooltip,this))),this.ignoreAnchorElementVisibility||isVisible(this.$attachTo.get(0))?this.show():this.$attachTo.one("pbOnShow",_.bind(this.show,this)),this.isContentReady=!0,!0)},Tooltip.prototype.positionTooltip=function(){var targetX,targetY,$body=$("body"),elWidth=this.$el.outerWidth(),marginLeft=parseInt($body.css("margin-left"));_.isNaN(marginLeft)&&(marginLeft=0),this.attachmentPoint?(DomHelpers.addImportantStyleAttribute(this.$el,"position","absolute"),targetX=Math.round(this.attachmentPoint.left-elWidth+this.attachmentPoint.width+marginLeft)+28,targetY=Math.round(this.attachmentPoint.top+this.attachmentPoint.height)):(targetX=Math.round(this.$attachTo.offset().left-elWidth+this.$attachTo.outerWidth()+marginLeft)+28,targetY=this.$attachTo.offset().top+this.$attachTo.outerHeight());var bodyMargin=parseInt($body.css("margin-left"));_.isNaN(bodyMargin)&&(bodyMargin=0),bodyMargin>0&&(targetX=targetX-bodyMargin+0),targetX<0&&(targetX=0),DomHelpers.addImportantStyleAttribute(this.$el,"top",targetY+"px"),DomHelpers.addImportantStyleAttribute(this.$el,"left",targetX+"px")},Tooltip.prototype.positionToolbarTooltip=function(){DomHelpers.addImportantStyleAttribute(this.$el,"top",0),DomHelpers.addImportantStyleAttribute(this.$el,"right","6px")},Tooltip.prototype.show=function(){Frame.prototype.show.apply(this,arguments),this.destroyOnBodyClick&&$("body").one("mousedown",_.bind(this.destroy,this))},Tooltip.prototype.destroy=function(){Frame.prototype.destroy.apply(this,arguments),$("body").off("click",_.bind(this.destroy,this))}},{"../dom-helpers":5,"./frame":116,"component-inherit":147,jquery:"jquery",underscore:"underscore",visible:236}],121:[function(require,module,exports){var Target=require("../target"),_=require("underscore"),metrics=require("../metrics"),doSendMessage=function(msg,callback){if("function"==typeof window.initializeComm&&"undefined"==typeof window.comm)try{window.comm=window.initializeComm()}catch(e){console.log("Cannot init comm "+e.message)}if("undefined"!=typeof window.comm){var sender={id:"msie@passwordbox.com",url:window.location.toString(),tab:{id:passwordBoxObj.tabId,active:passwordBoxObj.isActiveTab,url:window.location.toString(),title:window.document.title}};window.comm.sendRequest(msg,"bg-cs-request",sender).then(function(data){callback(data)})}else if(chrome&&chrome.runtime&&"function"==typeof chrome.runtime.sendMessage){var payload={type:"bg-cs-request",content:msg};Target.LEGACY&&(payload=msg),chrome.runtime.sendMessage(payload,function(response){return response?callback(Target.LEGACY?response:response.content):callback()})}else"undefined"!=typeof self&&self.postMessage(msg)};module.exports={sendMessage:function(msg,callback){"mixpanel_track"===msg.faTrigger&&_.extend(msg.mixpanel_params,{browser_name:metrics.browserName,browser_version:metrics.browserVersion}),doSendMessage(msg,function(response){if("function"==typeof callback)callback.call(this,response);else if(response&&response.faCallback){var pbcs_valid=["secondBackgroundResponse","firstBackgroundResponse","secondBackgroundQuery"],pb_contentscript_valid=["tLaunchUrl","tLoginDone","tLogoutDone","gotSessionDataDisplayedTab","viralAssetsReceived","welcomeSuggestionsReceived","accountSelected"];pbcs_valid.indexOf(response.faCallback)!==-1?PBCS[response.faCallback].call(PBCS,response):pb_contentscript_valid.indexOf(response.faCallback)!==-1&&PB.contentscript[response.faCallback].call(PB.contentscript,response)}})},openDashboard:function(params){if(!Target.LEGACY)if("undefined"!=typeof window.comm)window.comm.openDashboard(params);else if(chrome&&chrome.runtime&&"function"==typeof chrome.runtime.sendMessage){var payload={type:"link-request",content:{method:"allow_set_foreground"}};chrome.runtime.sendMessage(payload,function(){payload={type:"std-request",content:{method:"open",params:params||{}}},chrome.runtime.sendMessage(payload,function(){})})}},closeCurrentTab:function(params){if(!Target.LEGACY)if(Target.IE)window.open("about:blank","_self").close();else if(chrome&&chrome.runtime&&"function"==typeof chrome.runtime.sendMessage){var payload={type:"link-request",content:{method:"closeCurrentTab"}};chrome.runtime.sendMessage(payload,function(){})}}}},{"../metrics":135,"../target":142,underscore:"underscore"}],122:[function(require,module,exports){window.TK_CS_INIT_MOMENT=Date.now(),require("prototype-extender"),window.$=require("jquery"),window.underscore=window._=require("underscore"),"undefined"==typeof FA&&(window.FA={}),"undefined"==typeof PB&&(window.PB={});var config=require("./config"),logger=require("./logger"),Target=require("./target");if("undefined"!=typeof window.IS_TK_INJECTED)"development"===config.environment&&console.log("IS_TK_INJECTED is already defined, exiting the CS!",location.href);else{"development"===config.environment&&console.log("IS_TK_INJECTED is undefined, setting to TRUE, continue loading CS.",location.href),window.IS_TK_INJECTED=!0,logger.enable(config.logger.enable),logger.disable(config.logger.disable),logger.level(config.logger.level),config.processLocalStorage(function(){config.processQuery(),logger.level(config.logger.level),logger.enable(config.logger.enable),logger.disable(config.logger.disable),logger.log("init","URL: "+location.href),logger.log("init","TARGET: "+Target.Name),logger.log("init","LEGACY: "+Target.LEGACY)}),window.$(function(){logger.log("DOCUMENT READY",Date.now()-window.TK_CS_INIT_MOMENT)}),PB.utils=require("./pb-utils");var persistenceUtils=require("./persistence/utils.js");FA.Framework=require("./framework");require("./listeners").start(),PB.version=require("../package.json").version,PB.InputWatcher=require("./input-watcher"),window.PBCS=require("./pbcs"),PB.contentscript=require("./pbcs/contentscript"),PB.contentscript.Form=require("./form.js"),PB.contentscript.isVisible=require("visible"),PB.contentscript.measure=require("./measure"),PB.contentscript.urlParser=require("url-parser"),PB.contentscript.isLocalStorageAvailable=persistenceUtils.isLocalStorageAvailable(),PB.LoginDetect=require("./login-linter"),PBCS.DomHelpers=require("./dom-helpers"),PB.contentscript.exceptionsManager=require("./exceptions/manager")(),PBCS.cssPath=require("./css-path"),PB.contentscript.formManager=require("./form-manager");var UserActivity=require("./user-activity");PB.user_activity=new UserActivity;var frameFactory;if(Target.IOS||Target.ANDROID){var FrameFactory=require("./frames-container/shim");PBCS.frameFactory=new FrameFactory}else frameFactory=require("./frames-container"),frameFactory.loadContent();var ExceptionManager=require("./exceptions/manager"),rules=require("./exceptions/rules");PB.contentscript.exceptionsManager=new ExceptionManager,PB.contentscript.exceptionsManager.loadHardcoded(rules),window.DomMessenger=require("./dom-messenger");var isDefaultExecWanted=require("./preload-command-handler").exec();(void 0===isDefaultExecWanted||isDefaultExecWanted)&&require("./init");var metrics=require("./metrics"),hercules=require("hercules"),loggerOverride=config.logger&&"*"===config.logger.enable,urlParser=require("url-parser");hercules.init({environment:config.environment,loggerOverride:loggerOverride,browser:metrics.browserName,browserVersion:metrics.browserVersion,contentscriptInitMoment:window.TK_CS_INIT_MOMENT,context:metrics.context,cssPath:PBCS.cssPath,domain:urlParser.parse(location.href).domain,frameFactory:PBCS.frameFactory,CBMS:PBCS.CBMS,externalIgnoreAttribute:"pb-role",externalOverrideIgnoreAttribute:"yield-handling"})}},{"../package.json":237,"./config":3,"./css-path":4,"./dom-helpers":5,"./dom-messenger":6,"./exceptions/manager":9,"./exceptions/rules":10,"./form-manager":90,"./form.js":95,"./frames-container":117,"./frames-container/shim":119,"./framework":121,"./init":123,"./input-watcher":124,"./listeners":129,"./logger":130,"./login-linter":131,"./measure":132,"./metrics":135,"./pb-utils":136,"./pbcs":138,"./pbcs/contentscript":137,"./persistence/utils.js":140,"./preload-command-handler":141,"./target":142,"./user-activity":144,hercules:163,jquery:"jquery","prototype-extender":"prototype-extender",underscore:"underscore","url-parser":233,visible:236}],123:[function(require,module,exports){function init(){if(!Target.IOS&&!Target.ANDROID){var CBMS="undefined"!=typeof PB_addListener?require("true-key-common-modules").ExternalConnectionCs.MSIE:require("true-key-common-modules").ExternalConnectionCs.Chrome;PBCS.CBMS=new CBMS,interceptor.intercept(function(message){PBCS.CBMS.request("isLoggedIn").then(function(loggedIn){PBCS.CBMS.request("track2",{mixpanel_event:"visitor_redirected",mixpanel_params:{context:"browser_desktop",is_logged_in:loggedIn,website_url:window.location.href,app_redirect_value:message.action,redirect_type:"application",browser_name:metrics.browserName,browser_version:metrics.browserVersion}}).then(function(){"installed-standalone"===message.externalEvent?PBCS.CBMS.request("connectToStandalone").then(function(){FA.Framework.openDashboard(message),window.setTimeout(FA.Framework.closeCurrentTab,1500)}):("rp"===message.action||message.action,FA.Framework.openDashboard(message),window.setTimeout(FA.Framework.closeCurrentTab,1500))})})})}if(body=$("body"),PBCS.init(),PBCS.currentLocation.isIframe){var $win=$(Target.IE?window.self:window);Target.IE||Target.EDGE?$win.one("resize",function(){PBCS.init()}):$win.on("resize",function(){PBCS.init()})}}var $=require("jquery"),Target=require("./target"),interceptor=require("./url-interceptor"),metrics=require("./metrics");Target.CHROME&&"pinterest.com"!==metrics.domain?init():$(function(){init()})},{"./metrics":135,"./target":142,"./url-interceptor":143,jquery:"jquery","true-key-common-modules":"true-key-common-modules"}],124:[function(require,module,exports){var _=require("underscore");module.exports=new function(){var _public={},isVisible=require("visible");_public.watchList=[],_public.watchInput=function(input){if(_.find(_public.watchList,function(inputData){return inputData.input==input}))return!1;var inputData=(input.offset(),getInputData(input));return _public.watchList.push(inputData),input},_public.removeInputFromWatchList=function(input){var foundMatch=!1;return _public.watchList=_public.watchList.filter(function(el){return el.input[0]!==input[0]&&el.input[0]!==input||(foundMatch=!0,!1)}),foundMatch},_public.isInputWatched=function(input){return!!_.find(_public.watchList,function(inputData){return inputData.input[0]===input[0]})};var getInputData=function(input){var offset=input.offset();return{input:input,top:offset.top,left:offset.left,visible:isVisible(input[0])}},verifyInputs=function(){_.each(_public.watchList,function(inputData,index,list){var input=inputData.input,offset=input.offset(),visible=isVisible(input&&input.get(0)),hasChanged=!1;inputData.top==offset.top&&inputData.left==offset.left||(input.trigger("pbOnMove"),hasChanged=!0),inputData.visible!=visible&&(visible?input.trigger("pbOnShow"):input.trigger("pbOnHide"),hasChanged=!0),hasChanged&&_.extend(list[index],{top:offset.top,left:offset.left,visible:visible})})},fnListener=function(){_.each(_public.watchList,function(inputData,index,list){inputData.input.trigger("pbOnMove")})};return window.self.addEventListener?window.self.addEventListener("resize",fnListener):window.addEventListener("resize",fnListener),setInterval(function(){verifyInputs()},1e3),_public}},{underscore:"underscore",visible:236}],125:[function(require,module,exports){function saveTempForm(form){var lastChanceForms=persistence.getLocalStorageItem("tk_last_chance_forms","temp_forms",metrics.domain);_.find(lastChanceForms,function(f){return f.selector===form.selector})||persistence.appendRecordForDomain("tk_last_chance_forms","temp_forms",form,metrics.domain)}function validateSubmitSelector(form){return""!==_.find(form.fields,function(field){return"submit"===field.fieldType}).selector}function handleSaveFormLocalStorage(form,formType){var formattedForm=formatFormForMixpanel(form);validateSubmitSelector(form)?(reporter.reportValidationResults(formType,formattedForm,"localstorage_form_save_success"),saveTempForm(_.pick(form,"formType","selector","fields","technique","blockSubmit")),logger.info("last-chance","saving form to localStorage",form)):(reporter.reportValidationResults(formType,formattedForm,"localstorage_form_save_failure"),logger.info("last-chance","no submit selector, not saving form to localStorage",form))}function formatFormForMixpanel(form){var formatted={form_selector:form.selector,form_type:form.formType,form_all_possible_username_selectors:!1,form_username_selector:!1};return _.each(form.fields,function(field){"password"===field.fieldType?formatted.form_password_selectors?formatted.form_password_selectors=formatted.form_password_selectors+", "+field.selector:formatted.form_password_selectors=field.selector:"username"===field.fieldType?(formatted.form_username_selector=field.selector,formatted.form_all_possible_username_selectors?formatted.form_all_possible_username_selectors=formatted.form_all_possible_username_selectors+", "+field.selector:formatted.form_all_possible_username_selectors=field.selector):formatted["form_"+field.fieldType+"_selector"]=field.selector}),formatted}function getInputFormatted(inputElement,role){return{name:$(inputElement).prop("name"),value:$(inputElement).prop("value"),type:$(inputElement).prop("type"),role:role}}function getInputMeta(formType,formMeta){var inputsData=[];return"signup"===formType?inputsData.push({name:"pbIsSignupForm",value:"true",type:"hidden"}):"login"===formType&&formMeta.usernameElement&&(formMeta.usernames=[formMeta.usernameElement]),formMeta.passwordInputElements.forEach(function(input){inputsData.push(getInputFormatted(input,"password"))}),formMeta.usernames&&formMeta.usernames.forEach(function(input){var formatted=getInputFormatted(input,"username");""!==formatted.value&&inputsData.push(formatted)}),inputsData}function formatFormForBackground(formType,formMeta){var fields=[];return"login"===formType?(fields=[{selector:cssPath(formMeta.passwordInputElements[0]),fieldType:"password"},{selector:cssPath(formMeta.submitElement),fieldType:"submit"}],formMeta.usernameElement&&fields.push({selector:cssPath(formMeta.usernameElement),fieldType:"username"})):"signup"===formType&&(formMeta.usernames.forEach(function(username){var usernameValue=username.value;""!==usernameValue&&fields.push({selector:cssPath(username),fieldType:"username",value:usernameValue})}),formMeta.passwordInputElements.forEach(function(password){fields.push({selector:cssPath(password),fieldType:"password"})}),fields.push({selector:cssPath(formMeta.submitElement),fieldType:"submit"})),{url:metrics.url,formType:formType,selector:cssPath(formMeta.formElement),technique:"last-chance",fields:fields}}var reporter=require("./reporter.js"),cssPath=require("../css-path"),metrics=require("../metrics"),Persistence=require("../persistence"),persistence=new Persistence,$=require("jquery"),_=require("underscore"),logger=require("../logger"),isVisible=require("visible");module.exports={trackAsset:function(formType,formMeta){var form=formatFormForBackground(formType,formMeta),faForm=getInputMeta(formType,formMeta),data={faForm:faForm,faTrigger:"tAssetDetection",domain:metrics.domain,url:metrics.url,form:form,is_signed_up:PB&&PB.contentscript&&PB.contentscript.is_signed_up,allowAutosave:PB&&PB.contentscript&&PB.contentscript.intelForUrl.settings.autologin};FA.Framework.sendMessage(data)},recordSubmit:function(formType,formMeta,assetCount,unsureFlag,isManual,removeFdetectExperiment){var form=formatFormForBackground(formType,formMeta);unsureFlag&&(form.blockSubmit=!0);var loginType="last_chance_"+formType;("signup"===formType||isManual)&&(loginType="manual_"+loginType,PB.contentscript.bgdata.lastAccountSelected=!1,FA.Framework.sendMessage({faTrigger:"setLastAccountSelected",asset:!1}));var data={tabId:metrics.tabId,url:metrics.url,browser_name:metrics.browserName,browser_version:metrics.browserVersion,context:metrics.context,login_type:loginType,asset_count_for_domain:assetCount,domain:metrics.domain,form:form,form_partial_type:void 0,form_trigger_selector:void 0,form_selector:form.selector,form_detection_technique:"last-chance",form_type:form.formType,pb_cs_version:metrics.csVersion,page_request_time_in_ms:metrics.pageRequestTime,page_time_before_submit_form_in_sec:((new Date).getTime()-window.performance.timing.domLoading)/1e3,page_atlas_api_timeout:metrics.apiTimeout,page_atlas_forms_found_in_page:metrics.atlasForms.length,page_fdetect_forms_found_in_page:metrics.fdetectForms.length,page_atlas_forms_from_background:metrics.backgroundForms.length,page_atlas_forms_from_localstorage:metrics.localStorageForms.length,page_atlas_forms_count_at_atlas_process:metrics.atlasFormsCountAtAtlasProcess,page_atlas_forms_count_at_fdetect_process:metrics.atlasFormsCountAtFdetectProcess,is_browser_local_storage_available:PB.contentscript.isLocalStorageAvailable,is_last_chance:!0,experiments:["desktop_remove_fdetect_login_forms:"+removeFdetectExperiment]};FA.Framework.sendMessage({faTrigger:"recordSubmit",data:data})},validateFromResponse:function(response,flow,formType,form){if("login"===formType&&"failure"===flow)reporter.reportValidationResults(formType,formatFormForMixpanel(form),"login_failure"),logger.info("last-chance","login failure",form);else if("login"===formType&&"manual_failure"===flow)reporter.reportValidationResults(formType,formatFormForMixpanel(form),"manual_login_failure"),PBCS.frameFactory.create({id:"banner-asksave",options:{siteName:response.faDomainToValidate,tempCid:response.faIdToValidate}}),logger.info("last-chance","login failure, removing temp asset",form);else if("login"===formType&&"update"===flow)reporter.reportValidationResults(formType,formatFormForMixpanel(form),"login_update"),PBCS.frameFactory.create({id:"banner-update",options:{siteName:response.faDomainToValidate,tempCid:response.faIdToValidate,formType:"login",formTechnique:response.tempAssetFormTechnique}}),logger.info("last-chance","update asset, showing in-page",form);else if("saveLocalStorageLogin"===flow)handleSaveFormLocalStorage(form,formType);else if("save"===flow&&"login"===formType)FA.Framework.sendMessage({faTrigger:"tValidateTemp",cid:response.faIdToValidate,doAction:"save",formDetectionTechnique:response.tempAssetFormTechnique,context:"browser_desktop",browserName:metrics.browserName,browserVersion:metrics.browserVersion}),PBCS.frameFactory.create({id:"banner-autosave",options:{siteName:response.faDomainToValidate,formType:"login",formTechnique:response.tempAssetFormTechnique}}),handleSaveFormLocalStorage(form,formType);else if("signup"===formType&&("save"===flow||"failure"===flow)){var passwordInputToCheck=_.find(form.fields,function(field){return"password"===field.fieldType}),$password=$(form.selector).find(passwordInputToCheck.selector);if($password.length&&isVisible($password[0]))reporter.reportValidationResults(formType,formatFormForMixpanel(form),"signup_cancel_form_still_on_page"),logger.info("last-chance","Form selector and password selector still exist in page, not saving last-chance signup asset."),FA.Framework.sendMessage({faTrigger:"tRemoveTemp",cid:response.faIdToValidate});else{logger.info("last-chance","last page had last-chance signup, showing signup autosave inpage");var potentialUsernames=_.filter(form.fields,function(field){return"username"===field.fieldType});potentialUsernames=_.pluck(potentialUsernames,"value");var frame=PBCS.frameFactory.create({id:"banner-lastChanceChooseUsername",options:{usernames:potentialUsernames,domain:metrics.domain}});reporter.reportValidationResults(formType,formatFormForMixpanel(form),"signup_start"),frame.on("saveLastChanceSignup",function(res){logger.info("last-chance","User has chosen a username to save."),FA.Framework.sendMessage({faTrigger:"tValidateTemp",cid:response.faIdToValidate,doAction:"save",username:res.username,formDetectionTechnique:response.tempAssetFormTechnique,context:"browser_desktop",browserName:metrics.browserName,browserVersion:metrics.browserVersion}),PBCS.frameFactory.create({id:"banner-autosave",options:{siteName:response.faDomainToValidate,formType:"signup",formTechnique:response.tempAssetFormTechnique}});var formForStorage=form,userChosenUsername=_.find(formForStorage.fields,function(field){return field.value===res.username});delete userChosenUsername.value;var notUsernames=_.filter(formForStorage.fields,function(field){return"username"!==field.fieldType});formForStorage.fields=notUsernames,formForStorage.fields.push(userChosenUsername),handleSaveFormLocalStorage(formForStorage,formType)}),frame.on("removeAsset",function(){reporter.ValidationResults(formType,formatFormForMixpanel(form),"signup_cancel"),logger.info("pbcs","User have chosen to cancel last-chance signup save."),FA.Framework.sendMessage({faTrigger:"tRemoveTemp",cid:response.faIdToValidate})})}}}}},{"../css-path":4,"../logger":130,"../metrics":135,"../persistence":139,"./reporter.js":127,jquery:"jquery",underscore:"underscore",visible:236}],126:[function(require,module,exports){function LastChance(){}function start(){if(wasLoggedOut)return processLogin(wasLoggedOut.loginFormMeta);utils.findAndReportUnprocessedPaswords(DOMContext,foundFormCount);var unprocessedPasswordInputs=utils.getUnprocessedPasswordInputElements(DOMContext);if(unprocessedPasswordInputs.length){reporter.reportUnprocessedPasswords(unprocessedPasswordInputs);var sharedParents=utils.determineInputElementsParents(unprocessedPasswordInputs);if(!sharedParents||!Object.keys(sharedParents).length)return void logger.info("last-chance","Exiting. No detected form parents for the unprocessed inputs.",unprocessedPasswordInputs);logger.info("last-chance","found shared parent(s) for unprocessed inputs",sharedParents),sharedParents[1]?(unprocessedPasswordInputs=sharedParents[1][0].inputElements[0],processOneInput(unprocessedPasswordInputs,sharedParents[1][0].el)):sharedParents[2]?(unprocessedPasswordInputs=sharedParents[2][0].inputElements,handleMultipleInputs(unprocessedPasswordInputs,sharedParents[2][0].el)):sharedParents[3]&&(unprocessedPasswordInputs=sharedParents[3][0].inputElements,handleMultipleInputs(unprocessedPasswordInputs,sharedParents[3][0].el))}else logger.info("last-chance","Exiting. No unprocessed inputs.")}function processOneInput(passwordInputElement,formElement){$(passwordInputElement).attr("pb-role","password"),foundFormCount.total=1;var formMeta=utils.predictFormMeta(formElement,[passwordInputElement]);formMeta.allPotentialUsernameElements.length<=1?processLogin(formMeta):!disableSignupResetLastChance&&formMeta.allPotentialUsernameElements.length>1&&askSignup(formMeta)}function handleMultipleInputs(passwordInputElements,formElement){if(!disableSignupResetLastChance){var formMeta=utils.predictFormMeta(formElement,passwordInputElements);formMeta.allPotentialUsernameElements.length?(askSignup(formMeta),$(passwordInputElements).attr("pb-role","password"),foundFormCount.total=1):processReset(formMeta)}}function processLogin(loginFormMeta,unsureFlag){logger.info("last-chance","processing login form",loginFormMeta.passwordInputElements[0],loginFormMeta.formElement),reporter.reportStartFlow("login",loginFormMeta);var $icon=utils.injectLoginIcons(assets,loginFormMeta,wasLoggedOut);if(!isLoggedIn&&checkAndDisplayLoggedOutInpage(loginFormMeta.passwordInputElements[0],$icon))return wasLoggedOut={loginFormMeta:loginFormMeta,$icon:$icon},void logger.info("last-chance","exiting and showing logged out in page, user is not logged in.");isLoggedIn||logger.info("last-chance","exiting, user not logged in."),utils.listenToUserNameInputs(loginFormMeta.formElement,usernameInputsEngaged),utils.listenToSubmitElements(loginFormMeta.formElement,submitElementsEngaged),utils.interceptSubmit(loginFormMeta,function(){var isManual=!1;usernameInputsEngaged.length&&loginFormMeta.usernameElement&&usernameInputsEngaged[0]!==loginFormMeta.usernameElement&&(loginFormMeta.usernameElement=usernameInputsEngaged[0]),!loginFormMeta.usernameElement&&usernameInputsEngaged[0]&&(loginFormMeta.usernameElement=usernameInputsEngaged[0]),
autoFilled&&(loginFormMeta.usernameElement&&autoFilled.username&&loginFormMeta.usernameElement.value!=autoFilled.username&&(isManual=!0),loginFormMeta.passwordInputElements[0]&&autoFilled.password&&loginFormMeta.passwordInputElements[0].value!=autoFilled.password&&(isManual=!0)),utils.setValidSubmitElement(loginFormMeta,submitElementsEngaged);var saveAssetStatus=(!loginFormMeta.usernameElement||loginFormMeta.usernameElement&&loginFormMeta.usernameElement.value)&&!!loginFormMeta.passwordInputElements[0].value;if(reporter.reportFormSubmit("login",loginFormMeta,saveAssetStatus),!saveAssetStatus)return void logger.info("last-chance","login form submitted but the form was not filled or missing username element",loginFormMeta);loginFormMeta.usernames=_.filter(loginFormMeta.usernames,function(username){return""!==username.value}),logger.info("last-chance","login form submitted, messaging background.",loginFormMeta),bgHandler.trackAsset("login",loginFormMeta),bgHandler.recordSubmit("login",loginFormMeta,assets.length,unsureFlag,isManual,removeFdetectExperiment),handleAjaxSubmit()}),autoFilled=utils.handleAutomaticLoginFormInteraction(loginFormMeta,assets,autoLoginType,isTabIgnored)}function processSignup(signupFormMeta){logger.info("last-chance","processing signup form",signupFormMeta),reporter.reportStartFlow("signup",signupFormMeta),signupFormMeta.usernames=[],signupFormMeta.usernameElement&&signupFormMeta.usernames.push(signupFormMeta.usernameElement),utils.injectSignupIcons(signupFormMeta.passwordInputElements,signupFormMeta.formElement),utils.listenToUserNameInputs(signupFormMeta.formElement,usernameInputsEngaged),utils.listenToSubmitElements(signupFormMeta.formElement,submitElementsEngaged),utils.interceptSubmit(signupFormMeta,function(){utils.determineSignupUsername(signupFormMeta,usernameInputsEngaged);var passwordsFilled=_.every(signupFormMeta.passwordInputElements,function(el){return""!==el.value});utils.setValidSubmitElement(signupFormMeta,submitElementsEngaged);var saveAssetStatus=signupFormMeta.usernames.length&&passwordsFilled;if(reporter.reportFormSubmit("signup",signupFormMeta,saveAssetStatus),!saveAssetStatus)return void logger.info("last-chance","signup form submitted but the form was not filled or missing username element",signupFormMeta);logger.info("last-chance","signup form submitted, messaging background.",signupFormMeta),bgHandler.trackAsset("signup",signupFormMeta),bgHandler.recordSubmit("signup",signupFormMeta,assets.length,void 0,void 0,removeFdetectExperiment),handleAjaxSubmit()})}function processReset(resetFormMeta){reporter.reportStartFlow("reset",resetFormMeta)}function askSignup(formMeta){if($(formMeta.passwordInputElements).attr("pb-role","password"),!isLoggedIn)return void logger.info("last-chance","exiting, user not logged in");var frame=PBCS.frameFactory.create({id:"banner-lastChanceFormTypeQuestion"});frame.on("selectedSignup",function(){processSignup(formMeta)}),frame.on("selectedLogin",function(){processLogin(formMeta,!0)})}var _=require("underscore"),$=require("jquery"),utils=require("./utils.js"),reporter=require("./reporter.js"),bgHandler=require("./bg-handler.js"),logger=require("../logger"),handleAjaxSubmit=require("../form-manager").handleAjaxSubmit,checkAndDisplayLoggedOutInpage=require("../pbcs/contentscript").checkAndDisplayLoggedOutInpage;module.exports=new LastChance;var DOMContext,assets,isLoggedIn,usernameInputsEngaged,submitElementsEngaged,disableSignupResetLastChance,autoLoginType,autoFilled,isTabIgnored,wasLoggedOut,removeFdetectExperiment,foundFormCount;LastChance.prototype.initialize=function(options){return options&&void 0!==options.isCSReInit&&void 0!==options.disableFromRemoteException&&void 0!==options.target&&void 0!==options.assets&&void 0!==options.isLoggedIn&&void 0!==options.removeFdetectExperiment&&void 0!==options.autoLoginType&&void 0!==options.isTabIgnored&&void 0!==options.disableSignupResetLastChance?options.isCSReInit||options.disableFromRemoteException||options.target.IOS||options.target.ANDROID?(logger.info("last-chance","Exiting. One of the options determined not to continue.",options),!1):(logger.info("last-chance","Starting ...",options),DOMContext=options.DOMContext||document.body,assets=options.assets,isLoggedIn=options.isLoggedIn,removeFdetectExperiment=options.removeFdetectExperiment,disableSignupResetLastChance=options.disableSignupResetLastChance,autoLoginType=options.autoLoginType,isTabIgnored=options.isTabIgnored,usernameInputsEngaged=[],submitElementsEngaged=[],foundFormCount={total:0},start(),!0):(logger.info("last-chance","Exiting. One of the required options was not passed.",options),!1)}},{"../form-manager":90,"../logger":130,"../pbcs/contentscript":137,"./bg-handler.js":125,"./reporter.js":127,"./utils.js":128,jquery:"jquery",underscore:"underscore"}],127:[function(require,module,exports){function getFormSelectors(formMeta){return{form_selector:cssPath(formMeta.formElement),form_username_selector:cssPath(formMeta.usernameElement),form_submit_selector:cssPath(formMeta.submitElement),form_password_selectors:formMeta.passwordInputElements.map(cssPath),form_all_possible_username_selectors:formMeta.allPotentialUsernameElements.map(cssPath)}}function getBaseMixpanelParams(){return{website_url:metrics.url,domain:metrics.domain,browser_name:metrics.browserName,browser_version:metrics.browserVersion,context:metrics.context}}var cssPath=require("../css-path"),metrics=require("../metrics"),$=require("jquery");module.exports={reportUnprocessedPasswords:function(unprocessedPasswordInputs){var params=getBaseMixpanelParams();$.extend(params,{page_atlas_forms_found_in_page:metrics.atlasForms.length,page_fdetect_forms_found_in_page:metrics.fdetectForms.length,page_atlas_api_timeout:metrics.apiTimeout,page_atlas_forms_from_background:metrics.backgroundForms.length,page_atlas_forms_from_localstorage:metrics.localStorageForms.length,page_request_time_in_ms:metrics.pageRequestTime,unprocessed_password_inputs:unprocessedPasswordInputs.map(cssPath).toString()}),FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"unprocessed_password_found",mixpanel_params:params})},reportUnprocessedPasswordsAfterProcess:function(unprocessedPasswordInputs,foundFormCount){var params=getBaseMixpanelParams();$.extend(params,{page_atlas_forms_found_in_page:metrics.atlasForms.length,page_fdetect_forms_found_in_page:metrics.fdetectForms.length,page_atlas_api_timeout:metrics.apiTimeout,page_atlas_forms_from_background:metrics.backgroundForms.length,page_atlas_forms_from_localstorage:metrics.localStorageForms.length,page_request_time_in_ms:metrics.pageRequestTime,asset_count_for_domain:metrics.assetCountForDomain,unprocessed_password_inputs:unprocessedPasswordInputs.map(cssPath).toString(),page_last_chance_forms_found_in_page:foundFormCount.total}),FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"encountered_password_element_flow_detection_failure",mixpanel_params:params})},reportStartFlow:function(formType,formMeta){var params=getBaseMixpanelParams(),formSelectors=getFormSelectors(formMeta);$.extend(params,formSelectors),params.form_type=formType,FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"last_chance_flow_started",mixpanel_params:params})},reportFormSubmit:function(formType,formMeta,saveAssetStatus){var params=getBaseMixpanelParams(),formSelectors=getFormSelectors(formMeta);$.extend(params,formSelectors),params.form_type=formType,params.save_asset_status=saveAssetStatus,FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"submitted_last_chance_form",mixpanel_params:params})},reportValidationResults:function(formType,extraParams,result){var params=getBaseMixpanelParams();$.extend(params,extraParams),params.last_chance_validation_result=result,FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"last_chance_form_validation_occurred",mixpanel_params:params})}}},{"../css-path":4,"../metrics":135,jquery:"jquery"}],128:[function(require,module,exports){function showSelectForPotentialForm(savedAssets,usernameInput,passwordInput){if(savedAssets.length){var assets=savedAssets.map(function(asset){return{id:asset.faAssetId,username:asset.login,title:asset.name}});PBCS.frameFactory.create({id:"tooltip-accountSelector",attachTo:$(passwordInput),options:{assets:assets,form:{username:usernameInput,password:passwordInput},onSelectedAsset:responseFromAccountSelectedPotentialForm}})}}function responseFromAccountSelectedPotentialForm(form,selectedAsset){var asset={id:selectedAsset.id,username:selectedAsset.username};PB.contentscript.bgdata.lastAccountSelected=asset,FA.Framework.sendMessage({faTrigger:"setLastAccountSelected",asset:asset}),form.username&&Events.fillInput(form.username,selectedAsset.username),form.password&&Events.fillInput(form.password,selectedAsset.password)}function determineMostViableUsernamesFromInputs(usernameInputs,maxReturnInputs){var usernames=[];if(usernameInputs.length){usernames=usernameInputs,usernames=_.uniq(usernames,function(item){return item.value});var canadianPostalRegex=new RegExp("[ABCEGHJKLMNPRSTVXY][0-9][ABCEGHJKLMNPRSTVWXYZ] ?[0-9][ABCEGHJKLMNPRSTVWXYZ][0-9]"),americanPostalRegex=new RegExp("^d{5}(-d{4})?$"),notGreedyDateRegex=new RegExp("^((0?[13578]|10|12)(-|/)(([1-9])|(0[1-9])|([12])([0-9]?)|(3[01]?))(-|/)((19)([2-9])(d{1})|(20)([01])(d{1})|([8901])(d{1}))|(0?[2469]|11)(-|/)(([1-9])|(0[1-9])|([12])([0-9]?)|(3[0]?))(-|/)((19)([2-9])(d{1})|(20)([01])(d{1})|([8901])(d{1})))$");usernames=_.filter(usernames,function(username){return!canadianPostalRegex.test(username.value.toUpperCase())&&!americanPostalRegex.test(username.value)&&!notGreedyDateRegex.test(username.value)});var weights={email:3,text:2,tel:1};usernames=_.sortBy(usernames,function(item){return weights[item.type]}),usernames.length>maxReturnInputs&&(usernames=usernames.slice(0,maxReturnInputs))}return usernames}function getFormFilledElements(formElement){return $(formElement).find(confidentUsernameSelectorString).toArray().filter(function(input){return""!==input.value&&input.placeholder!==input.value})}function findParentWithCount(el1,el2,max){for(var el1Parents=$(el1).parents(),el2Parents=$(el2).parents(),i=0;i<max;i++)if(el1Parents.index(el2Parents[i])!==-1)return{count:i+1,match:el2Parents[i]}}var $=require("jquery"),_=require("underscore"),isVisible=require("visible"),logger=require("../logger"),Events=require("../form-manager/events"),addIconToField=require("../form-manager/icons").addIconToField,defineIconClick=require("../form-manager/icons").defineIconClick,InputWatcher=require("../input-watcher"),reporter=require("./reporter.js"),confidentUsernameSelectorArray=['input[type="text"]','input[type="email"]','input[type="tel"]',"input:not([type])"],confidentUsernameSelectorString=confidentUsernameSelectorArray.join(", "),confidentSubmitSelectorArray=['input[type="submit"]','button[type="submit"]','input[type="button"]'],unsureSubmitSelectorArray=["button:not([type])",'a[href="#"]'],passwordSelectorString='input[type="password"]:not([maxlength="2"]):not([maxlength="3"]):not([maxlength="4"])';module.exports={getUnprocessedPasswordInputElements:function(DOMContext){return!!DOMContext&&$('input[type="password"]:not([pb-role]):not([maxlength="2"]):not([maxlength="3"]):not([maxlength="4"])',DOMContext).toArray().filter(function(input){return isVisible(input)})},findAndReportUnprocessedPaswords:function(DOMContext,foundFormCount){var _this=this,unprocessedPasswordInputsReported=[];setInterval(function(){var unprocessedPasswordInputs=_this.getUnprocessedPasswordInputElements(DOMContext);if(unprocessedPasswordInputs.length){var newUnprocessed=_.filter(unprocessedPasswordInputs,function(newUnprocessedEl){return!_.contains(unprocessedPasswordInputsReported,newUnprocessedEl)});newUnprocessed.length&&(reporter.reportUnprocessedPasswordsAfterProcess(newUnprocessed,foundFormCount),unprocessedPasswordInputsReported=unprocessedPasswordInputsReported.concat(newUnprocessed))}},1500)},predictFormMeta:function(formElement,passwordElements){if(!formElement)return!1;var usernames=this._getElementsByPriority(formElement,confidentUsernameSelectorArray),submits=this._getElementsByPriority(formElement,confidentSubmitSelectorArray,unsureSubmitSelectorArray,"bottom");if(submits.length>1&&usernames.length){var validSubmits=[],validUsernames=[];submits.forEach(function(submitEl){var parent=findParentWithCount(submitEl,passwordElements[0],4);parent&&(validSubmits.push(submitEl),usernames.forEach(function(usernameEl){$(parent.match).find(usernameEl).length&&validUsernames.push(usernameEl)}))}),1===validSubmits.length&&(submits=validSubmits,usernames=validUsernames)}var formMeta={usernameElement:usernames[0],submitElement:submits[0],formElement:formElement,allPotentialSubmitElements:submits,allPotentialUsernameElements:usernames,passwordInputElements:passwordElements};return logger.info("last-chance","predicted form meta",formMeta),formMeta},interceptSubmit:function(formMeta,callback){var cbDebounced=_.debounce(callback,3e3,!0);$(formMeta.formElement).find(confidentUsernameSelectorString+", "+passwordSelectorString).on("keydown",function(e){return 13===(e.keyCode?e.keyCode:e.which)&&cbDebounced(),!0});var formCheckInterval=setInterval(function(){$(formMeta.formElement).length&&isVisible(formMeta.formElement)||(clearInterval(formCheckInterval),cbDebounced())},1e3);$(formMeta.submitElement).on("click",function(){cbDebounced()}),$(formMeta.formElement).on("submit",function(){cbDebounced()}),$(formMeta.formElement).find(confidentUsernameSelectorString+", "+passwordSelectorString).toArray().forEach(function(el){$(el).one("keypress",function(){window.onbeforeunload=function(){cbDebounced()}})})},injectLoginIcons:function(assets,loginFormMeta,wasLoggedOut){wasLoggedOut&&(wasLoggedOut.$icon.remove(),InputWatcher.removeInputFromWatchList(wasLoggedOut.loginFormMeta.passwordInputElements[0])),addIconToField({fieldType:"password",el:loginFormMeta.passwordInputElements[0]},"login",{visible:!!(PB&&PB.contentscript&&PB.contentscript.is_signed_up)}),loginFormMeta.usernameElement&&addIconToField({fieldType:"username",el:loginFormMeta.usernameElement},"login",{visible:!!(PB&&PB.contentscript&&PB.contentscript.is_signed_up)});var $icon=$("passwordboxicon[pb-icon=password]",$(loginFormMeta.passwordInputElements[0]).parent());return assets.length&&(defineIconClick($icon,function(e){e.stopPropagation(),showSelectForPotentialForm(assets,loginFormMeta.usernameElement,loginFormMeta.passwordInputElements[0])}),assets.length>1&&showSelectForPotentialForm(assets,loginFormMeta.usernameElement,loginFormMeta.passwordInputElements[0])),$icon},injectSignupIcons:function(passwordInputs,formElement){addIconToField({fieldType:"password",el:passwordInputs[0]},"signup"),2===passwordInputs.length&&addIconToField({fieldType:"password",el:passwordInputs[1]},"signup"),defineIconClick($(formElement).find("passwordboxicon[pb-icon=password]").first(),function(e){showPassGen()}),$(passwordInputs[0]).one("focus",function(e){showPassGen()});var showPassGen=function(){var settings=PB.contentscript.passgenSettings;PBCS.frameFactory.create({id:"tooltip-passwordGenerator",attachTo:passwordInputs[0],options:{disableLetters:settings["passgen.letters"]===!1,disableSymbols:settings["passgen.symbols"]===!1,disableDigits:settings["passgen.digits"]===!1,disableCapitals:settings["passgen.capitals"]===!1,nbCharacters:settings["passgen.stringLength"]}}).on("passwordGenerated",function(payload){passwordInputs.forEach(function(input){Events.fillInput(input,payload.password)})})}},determineSignupUsername:function(signupFormMeta,userNameInputsEngaged){signupFormMeta.usernames=signupFormMeta.usernames.concat(determineMostViableUsernamesFromInputs(userNameInputsEngaged,5)),signupFormMeta.usernames=signupFormMeta.usernames.concat(determineMostViableUsernamesFromInputs(getFormFilledElements(signupFormMeta.formElement),5)),signupFormMeta.usernames=determineMostViableUsernamesFromInputs(signupFormMeta.usernames,5)},listenToUserNameInputs:function(formElement,usernameInputsEngaged){$(formElement).find(confidentUsernameSelectorString).on("blur",function(){var elBlur=this;_.find(usernameInputsEngaged,function(el){return el===elBlur})||usernameInputsEngaged.push(elBlur)})},listenToSubmitElements:function(formElement,submitElementsEngaged){$(formElement).find('input[type="submit"], input[type="button"], button, a, img, span').on("mousedown",function(){var elMouseDown=this;_.find(submitElementsEngaged,function(el){return el===elMouseDown})||submitElementsEngaged.push(elMouseDown)})},setValidSubmitElement:function(formMeta,submitElementsEngaged){submitElementsEngaged.length?formMeta.submitElement=_.last(submitElementsEngaged):formMeta.submitElement=void 0},handleAutomaticLoginFormInteraction:function(loginFormMeta,assets,autoLoginType,isTabIgnored){if(assets.length&&1===assets.length&&("one_click_login"===autoLoginType||"seamless_login"===autoLoginType)){var filled={};return loginFormMeta.usernameElement&&(Events.fillInput(loginFormMeta.usernameElement,assets[0].login),filled.username=assets[0].login),loginFormMeta.passwordInputElements[0]&&(Events.fillInput(loginFormMeta.passwordInputElements[0],assets[0].password),filled.password=assets[0].password),!isTabIgnored&&"one_click_login"===autoLoginType&&loginFormMeta.submitElement&&(Events.triggerClick(loginFormMeta.submitElement),FA.Framework.sendMessage({faTrigger:"tIgnoreTab"})),filled.username||filled.password?FA.Framework.sendMessage({faTrigger:"setLastAccountSelected",asset:{id:assets[0].faAssetId,username:assets[0].login}}):filled=!1,filled}},determineInputElementsParents:function(unprocessedInputs){if(unprocessedInputs.length){var sharedParents=[];return _.each(unprocessedInputs,function(el){var elFormParents=$(el).parents("form:not([pb-autologin],[pb-signup],[pb-reset])");if(elFormParents.length){var exists=!1;_.each(sharedParents,function(parent){parent.el===elFormParents[0]&&(parent.inputElements.push(el),exists=!0)}),exists||sharedParents.push({el:elFormParents[0],inputElements:[el]})}}),sharedParents=sharedParents.filter(function(sharedParent){return isVisible(sharedParent.el)}),sharedParents=_.groupBy(sharedParents,function(parent){return parent.inputElements.length})}},_getElementsByPriority:function(formElement,confidentSelectorArrayOrdered,unsureSelectorArrayOrdered,positionalPriority){function getOrderedResultsFromSelectorArray(selectorArray,position){var results=[];if(selectorArray.forEach(function(selector){var elements=$(formElement).find(selector).toArray();results=results.concat(elements)}),position){var selectorsString=selectorArray.join(", ");results=results.sort(function(element){return $(formElement).find(selectorsString).index(element)}),"bottom"===position&&(results=results.reverse())}return results}var confidentResults=getOrderedResultsFromSelectorArray(confidentSelectorArrayOrdered),unsureResults=[];return unsureSelectorArrayOrdered&&(unsureResults=getOrderedResultsFromSelectorArray(unsureSelectorArrayOrdered,positionalPriority)),confidentResults.concat(unsureResults)}}},{"../form-manager/events":83,"../form-manager/icons":87,"../input-watcher":124,"../logger":130,"./reporter.js":127,jquery:"jquery",underscore:"underscore",visible:236}],129:[function(require,module,exports){var feedback=require("./feedback"),logger=require("./logger");exports.start=function(){var handle_request=function(request){(request.faCallback||request.faTrigger)&&("secondBackgroundResponse"===request.faCallback?PBCS.secondBackgroundResponse(request):"tLaunchUrl"===request.faCallback?PB.contentscript.tLaunchUrl(request):"firstBackgroundResponse"===request.faCallback?PBCS.firstBackgroundResponse(request):"tLoginDone"===request.faTrigger?PB.contentscript.tLoginDone(request):"tLogoutDone"===request.faTrigger?PB.contentscript.tLogoutDone(request):"gotSessionDataDisplayedTab"===request.faCallback?PB.contentscript.gotSessionDataDisplayedTab(request):"processForms"===request.faCallback?(logger.warn("listeners","handle_request processForms() called without params"),PB.contentscript.formManager.processForms()):"reportBrokenSite"===request.faTrigger?feedback.reportBrokenSite(request):"feedback"===request.faTrigger&&feedback.reportFeedback(request))};if(window.browser&&window.browser.runtime&&(window.chrome=window.browser),"function"==typeof window.initializeComm&&"undefined"==typeof window.comm)try{window.comm=window.initializeComm()}catch(e){console.log("Cannot init comm "+e.message)}"undefined"!=typeof window.comm?window.comm.on("tab-request",function(request){var tab_id=request.tab_id;("broadcast"===tab_id||"object"==typeof passwordBoxObj&&passwordBoxObj.tabId===tab_id)&&handle_request(request.request)}):chrome&&chrome.runtime&&"function"==typeof chrome.runtime.sendMessage&&chrome.runtime.onMessage.addListener(function(request,sender,sendResponse){handle_request(request)})}},{"./feedback":82,"./logger":130}],130:[function(require,module,exports){function Logger(opts){this.reset(opts),this._createLogLevelMethods()}var Target=require("../target"),_=require("underscore"),config=require("../config"),Levels={DEBUG:0,LOG:1,INFO:2,WARN:3,ERROR:4,LevelToString:function(level){switch(level){case this.DEBUG:return"DEBUG";case this.INFO:return"INFO";case this.WARN:return"WARN";case this.ERROR:return"ERROR";default:return"LOG"}},LevelFromString:function(levelStr){return this[levelStr.toUpperCase()]},ToArray:function(){return["DEBUG","LOG","INFO","WARN","ERROR"]}};Logger.prototype.isEnabled=function(namespace,level){return this.isNamespaceEnabled(namespace)&&this.isLevelEnabled(level)},Logger.prototype.isNamespaceEnabled=function(namespace){var enabled=~this._enabled.indexOf("*");enabled=enabled||~this._enabled.indexOf(namespace);var disabled=~this._disabled.indexOf(namespace);return enabled&&!disabled},Logger.prototype.isLevelEnabled=function(level){return this._level<=level},Logger.prototype.level=function(level){level&&(this._level=_.isNumber(level)?level:Levels.LevelFromString(level))},Logger.prototype.enable=function(csv){csv&&csv.length&&(this._enabled=csv.split(","),this._enabled=this._enabled.map(function(e){return e.trim()}))},Logger.prototype.disable=function(csv){csv&&csv.length&&(this._disabled=csv.split(","),this._disabled=this._disabled.map(function(e){return e.trim()}))},Logger.prototype.reset=function(opts){opts=opts||{},this._level=opts.level||Levels.LOG,this._enabled=opts.enabled||[],this._disabled=opts.disabled||[],this.css=opts.css||"color: teal",this.separator=opts.separator||"::"},Logger.prototype._createLogLevelMethods=function(){var self=this;Levels.ToArray().forEach(function(level){self[level.toLowerCase()]=function(namespace){self.isEnabled(namespace,Levels[level])&&self._output(self._format(arguments,Levels[level]),level.toLowerCase())}})},Logger.prototype._output=function(args,method){function doLog(){_.isFunction(out[method])?out[method].apply(out,args):"function"!=typeof out.log.apply?Function.prototype.apply.call(out.log,out.log,args):out.log.apply(out,args)}var out=Target.IE?window.self.console:console;args=this._addTimeDelta(args),"development"===config.environment||Target.FIREFOX?doLog():setTimeout(function(){doLog()},0)},Logger.prototype._addTimeDelta=function(args){var delta=Date.now()-window.TK_CS_INIT_MOMENT;return args.push("after "+delta+" ms"),args.slice()},Logger.prototype._format=function(params,level,opts){var args=Array.prototype.slice.call(params);return opts=opts||{},opts.color||Target.CHROME?(args[0]="%c"+args[0],args.splice(1,0,this.css)):args.splice(1,0,this.separator),args[0]=Levels.LevelToString(level)+" "+args[0],args},exports=module.exports=new Logger,exports.Logger=Logger,exports.Levels=Levels},{"../config":3,"../target":142,underscore:"underscore"}],131:[function(require,module,exports){function LoginLinter(html,url,hints){this.html=html,this.url=url,this.hints=hints||{},this.reasons=[],this.flags={hasLoginOrSignupForm:!1,hasTwoFactorForm:!1,hasLoginLink:!1,hasLogoutLinkOrInput:!1,hasLogoutLinkOrInputAndLoginOrSignupForm:!1,hasLoginAttribute:!1,hasLogoutAttribute:!1,hasLoginUrl:!1,hasLoginValidationError:!1}}var $=require("jquery"),logger=require("../logger");exports=module.exports=LoginLinter,exports.isVisible=require("visible"),LoginLinter.prototype.isLoginPage=function(){return this.score()>2},LoginLinter.prototype.score=function(){return this._score||(this._score=0,(this.hasLoginForm()||this.hasSignupForm())&&(this.addReason("has a login or signup form +2","hasLoginOrSignupForm"),this._score+=2),this.hasTwoFactorForm()&&(this.addReason("has a two factor form -2","hasTwoFactorForm"),this._score-=2),this.hasLoginLink()&&(this.addReason("has a login link +1","hasLoginLink"),this._score+=1),this.hasLogoutLink()||this.hasLogoutInput()?(this.addReason("has a logout link or input -2","hasLogoutLinkOrInput"),this._score-=2):(this.addReason("does not have a logout link or input +1"),this._score+=1),(this.hasLogoutLink()||this.hasLogoutInput())&&(this.hasLoginForm()||this.hasSignupForm())&&(this.addReason("has a logout link and login/signup form +1","hasLogoutLinkOrInputAndLoginOrSignupForm"),this._score+=2),(this.hasNonHiddenLogoutLink()||this.hasNonHiddenLogoutInput())&&(this.addReason("has a non hidden logout link or input -3","hasNonHiddenLogoutLinkOrInput"),this._score-=3),(this.hasNonHiddenLogoutLink()||this.hasNonHiddenLogoutInput())&&(this.hasLoginForm()||this.hasSignupForm())&&(this.addReason("has both logout and login/signup, but logout is not hidden -5","hasLoginAndNonHiddenLogout"),this._score-=5),this.hasLoginAttribute()&&(this.addReason("has a login attribute +1","hasLoginAttribute"),this._score+=1),this.hasLogoutAttribute()&&(this.addReason("has a logout attribute -1","hasLogoutAttribute"),this._score-=1),this.hasNonHiddenLogoutAttribute()&&(this.addReason("has non hidden logout attribute -2","hasNonHiddenLogoutAttribute"),this._score-=2),this.hasLoginUrl()&&(this.addReason("has a login url +1","hasLoginUrl"),this._score+=1),this.hasLoginValidationError()&&(this.addReason("has a validation error +1","hasLoginValidationError"),this._score+=1)),this._score},LoginLinter.prototype.addReason=function(reason,flag){logger.log("login-linter","adding reason",reason),this.reasons.push(reason),flag&&(this.flags[flag]=!0)},LoginLinter.prototype.hasLoginForm=function(){return Boolean(this.hints.hasLoginForm)},LoginLinter.prototype.hasTwoFactorForm=function(){return Boolean(this.hints.hasTwoFactorForm)},LoginLinter.prototype.hasSignupForm=function(){return Boolean(this.hints.hasSignupForm)},LoginLinter.prototype.hasLoginLink=function(){return $("a,btn",this.html).toArray().some(function(el){return $(el).text().match(/(sign|log)(.?)(in|on)/i)})},LoginLinter.prototype.hasLogoutLink=function(){var re=/(sign|log)(.?)(out|off)/i;return $("a,btn",this.html).toArray().some(function(el){return $(el).text().match(re)||$(el).find("img").attr("alt")&&$(el).find("img").attr("alt").match(re)})},LoginLinter.prototype.hasNonHiddenLogoutLink=function(){var re=/(sign|log)(.?)(out|off)/i;return $("a,btn",this.html).toArray().some(function(el){var imageAltText=$(el).find("img").attr("alt");return($(el).text().match(re)||re.test(imageAltText))&&exports.isVisible(el)})},LoginLinter.prototype.hasLogoutInput=function(){return $("input",this.html).toArray().some(function(el){return $(el).val().match(/(sign|log)(.?)(out|off)/i)})},LoginLinter.prototype.hasNonHiddenLogoutInput=function(){return $("input",this.html).toArray().some(function(el){return!(!$(el).val().match(/(sign|log)(.?)(out|off)/i)||!exports.isVisible(el))})},LoginLinter.prototype.hasLoginAttribute=function(){return $("[class*=login],[id*=login],[class*=signin],[id*=signin],[class*=Login],[id*=Login],[class*=Signin],[id*=Signin]",this.html).toArray().some(function(el){return el.innerHTML.length})},LoginLinter.prototype.hasLogoutAttribute=function(){return $("[class*=logout],[id*=logout],[class*=signout],[id*=signout],[class*=Logout],[id*=Logout],[class*=Signout],[id*=Signout]",this.html).toArray().some(function(el){return el.innerHTML.length})},LoginLinter.prototype.hasNonHiddenLogoutAttribute=function(){return $("[class*=logout],[id*=logout],[class*=signout],[id*=signout],[class*=Logout],[id*=Logout],[class*=Signout],[id*=Signout]",this.html).toArray().some(function(el){return!(!el.innerHTML.length||!exports.isVisible(el))})},LoginLinter.prototype.hasLoginUrl=function(){return this.url&&Boolean(this.url.match(/(sign|log)(.?)(in|on)/i))},LoginLinter.prototype.hasLoginValidationError=function(){if(!this.loginFailedRegExp){var id="(id|name|username|nick|screen name|handle|e-?mail( address)?|password|user id|login|account)",rules=["enter (a|an|your)?\\s?valid\\s?"+id,id+" (you entered )?(is|were|was|are)?\\s?(locked|incorrect|invalid|missing|unknown|do not match)",id+" was entered incorrectly","(incorrect|invalid|unknown|wrong|not a valid) (avatar )?"+id,"enter a (value for|valid|correct) "+id,id+"(is|has been) (temporarily )?(disabled|blocked|de-activated)","(sign|signing|log|loging)(s|-)?(in|on)? failed","unable to (sign|signing|log|loging)(s|-)?(in|on)?",id+" (doesn't|does not) exist","(does not|doesn't) match (an account|our records)","the "+id+" or password (you) entered is not correct"];rules=rules.map(function(rule){return"("+rule+")"}),this.loginFailedRegExp=new RegExp(rules.join("|"),"gi")}var ctx=$("div, span, p, section, h1, h2, h3, h4, li, article, nav, main, form",this.html),text=ctx.text(),matches=text.match(this.loginFailedRegExp);if(!matches)return!1;logger.log("login-linter","#hasLoginValidationError # of matches (visible & invisible) "+matches.length);var isThereAVisibleMatch=matches.some(function(textMatch){return $(":contains("+textMatch+"):visible",ctx).not("script").filter(function(){return $(this).find("*").length<2}).filter(function(){return exports.isVisible(this)}).length});return logger.log("login-linter","#hasLoginValidationError isThereAVisibleMatch "+isThereAVisibleMatch),isThereAVisibleMatch}},{"../logger":130,jquery:"jquery",visible:236}],132:[function(require,module,exports){module.exports=require("./lib/trace")},{"./lib/trace":134}],133:[function(require,module,exports){var perf=window&&window.performance;module.exports=function(){return perf&&"function"==typeof perf.now&&perf.timing&&perf.timing.navigationStart?perf.now()+perf.timing.navigationStart:(new Date).getTime()}},{}],134:[function(require,module,exports){function Trace(id){return traces[id]?traces[id]:this instanceof Trace?(this.id=id,traces[id]=this,void(this._events=[])):new Trace(id)}var now=require("./now"),_=require("underscore");exports=module.exports=Trace;var traces={};exports.flush=function(){var flushed=_.keys(traces).map(function(id){return traces[id].flush()});return traces={},flushed},Trace.prototype.flush=function(){var flushed=this._events;return this._events=[],flushed},Trace.prototype.measures=function(name){return this._events.filter(function(event){var hasDuration="undefined"!=typeof event.duration,isname=!name||event.name===name;return hasDuration&&isname})},Trace.prototype.measuresToCSV=function(){},Trace.prototype.cycles=function(name){function clone(obj){return JSON.parse(JSON.stringify(obj))}return clone(this._events).filter(function(e){return delete e.duration,e.start&&e.end&&delete e.end,!name||e.name===name})},Trace.prototype.cyclesToCSV=function(){},Trace.prototype.start=function(name,date){var start=date&&date.getTime()||now();return this._events.push({id:this.id,name:name,start:start}),this},Trace.prototype.end=function(name,date){var start,end=date&&date.getTime()||now(),self=this;return this._events.push({id:this.id,name:name,end:end}),this._events.some(function(event){if(event.id===self.id&&event.name===name&&event.start&&!event.end)return start=event,!0}),start&&(start.end=end,start.duration=end-start.start),this}},{"./now":133,underscore:"underscore"}],135:[function(require,module,exports){
var DomHelpers=require("../dom-helpers"),UrlParser=require("url-parser"),Target=require("../target"),url=location.href,domain=UrlParser.parse(url).domain;if(window.self!==window.top){domain===UrlParser.parse(document.referrer).domain&&(url=document.referrer)}var metrics={url:DomHelpers.removeQueryString(url),domain:domain,pageRequestTime:DomHelpers.getPageRequestTime(),reinit:!1,csVersion:"",assetCountForDomain:0,tabId:-1,apiTimeout:!1,isUserLoggedIn:!1,atlasForms:[],fdetectForms:[],backgroundForms:[],localStorageForms:[],browserName:Target.Name,browserVersion:Target.BrowserVersion,context:Target.Context};module.exports=metrics},{"../dom-helpers":5,"../target":142,"url-parser":233}],136:[function(require,module,exports){var _=require("underscore"),Target=require("./target");Date.now||(Date.now=function(){return(new Date).valueOf()});var global=function(){return this}();module.exports={SPECIAL_TLDS:["co.uk","com.au","com.br","co.nz","gov.uk","co.il","gov.hk","org.uk","com.uk","ia.us","co.us","net.au","co.za","com.eg","com.mx","com.uk","gc.ca","qc.ca","co.jp"],getUrlHostname:function(url){if(url||(url=""),Target.FIREFOX){var result=url.match(/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/);return result.length>0?result[0].split("/")[0].split("#")[0].split("?")[0]:null}0!==url.indexOf("http")&&(url="http://"+url);var a=document.createElement("a");return a.href=url,a.hostname},addProtocol:function(url){return url&&0!==url.indexOf("http://")&&0!==url.indexOf("https://")&&(url="http://"+url),url},standardizeProtocol:function(url){if(!url)return!1;var url=PB.utils.removeProtocol(url);return PB.utils.addProtocol(url)},removeSubdomain:function(url){if(!url)return url;var split=this.splitDomain(url);return"string"==typeof split?split:split.length?split.length<2?split.toString():[_.last(split[0].split("."),1),split[1]].join("."):split.toString()},splitDomain:function(url){if(!url)return url;if(url.match(/^[\.0-9]*$/))return url;var dotsInTLD=1;_.find(this.SPECIAL_TLDS,function(tld){if(url.indexOf(tld,url.length-tld.length)!==-1)return!0})&&(dotsInTLD=2);for(var c=0,i=0;i<url.length&&("."!==url.charAt(url.length-i)||++c!==dotsInTLD);i++);if(0===c)return url;var tld=url.slice(-i+1);return[url.slice(0,url.length-i),tld]},getUrlBaseDomain:function(url){var no_proto=PB.utils.removeProtocol(url),hostname=PB.utils.getUrlHostname(no_proto);return hostname.match(/^\d+\.\d+\.\d+\.\d+$/)?hostname:PB.utils.removeSubdomain(hostname)},removeProtocol:function(url){return"string"==typeof url?url.replace("http://","").replace("https://",""):""},setNamespace:function(name,definition,context){function value(v){return"function"==typeof v?v():v}var namespace=name.split(".");context||(global.PB||(global.PB={}),context=PB,"PB"!==namespace[0]&&"pb"!==namespace[0]||namespace.shift()),namespace.reduce(function(mod,name){return mod[name]||(mod[name]={}),name===namespace[namespace.length-1]&&(mod[name]=value(definition)),mod[name]},context)},areWeInAnIframe:function(){return Target.FIREFOX?window.location!==window.parent.location:top!==self}}},{"./target":142,underscore:"underscore"}],137:[function(require,module,exports){var $=require("jquery"),_=require("underscore"),Target=require("../target"),logger=require("../logger"),config=require("../config"),Icons=require("../form-manager/icons"),metrics=require("../metrics"),lastChanceBGhandler=require("../last-chance/bg-handler"),addFirstSiteEnabled=!Target.EDGE;module.exports={checkAndDisplayLoggedOutInpage:function(elementToAttach,$iconEl){if(PB.contentscript.bgdata&&PB.contentscript.bgdata.isOffline||PB.contentscript.logged_in||!PB.contentscript.is_signed_up)return!1;if("desktop_remove_dontaskagain_link_login_prompt"!==PB.contentscript.loggedOutInpageExperiment&&PB.contentscript.bgdata&&PB.contentscript.bgdata.loginPromptInpageDisabled)return FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"pi_bad_experience",mixpanel_params:{pi_experience_type:"login_prompt_blocked_never_shown_again"}}),logger.info("checkAndDisplayLoggedOutInpage","User selected never show again, not showing loginPrompt."),!1;var $el=$iconEl||$("[pb-autologin] passwordboxicon[pb-icon=password]"),showMPFill=function(){var frame=PBCS.frameFactory.create({id:"tooltip-loginPrompt",attachTo:elementToAttach||"[pb-autologin] [pb-role=password]",options:{experiment:PB.contentscript.loggedOutInpageExperiment}});frame.off("loginSucceeded"),frame.on("loginSucceeded",function(){Icons.removeIconClick($el)})};return Icons.defineIconClick($el,function(e){showMPFill()}),showMPFill(),!0},tLaunchUrl:function(response){window.top.location.href=response.url},detectLogout:function(){$("body").on("click","a,button,input",function(e){/(sign|log)(.?)(out|off)/i.test(e.target.outerHTML)&&FA.Framework.sendMessage({faTrigger:"tIgnoreTab"})})},setUserSettings:function(key,value){FA.Framework.sendMessage({faTrigger:"tSetUserSettings",sendResponse:!0,args:{key:key,value:value}})},viralAssetsReceived:function(response){var assets=response.credentials,aol=_.filter(assets,function(asset){return"aol.com"===asset.url}),hotmail=_.filter(assets,function(asset){return"live.com"===asset.url||"hotmail.com"===asset.url||"outlook.com"===asset.url}),yahoo=_.filter(assets,function(asset){return"yahoo.com"===asset.url||"rocketmail.com"===asset.url||"ymail.com"===asset.url});aol.length>0&&($("#aol-email").val(aol[0].login),$("#aol-password").val(aol[0].password),$(".logo.aol").trigger("click")),hotmail.length>0&&($("#hotmail-email").val(hotmail[0].login),$("#hotmail-password").val(hotmail[0].password),$(".logo.hotmail").trigger("click")),yahoo.length>0&&($("#yahoo-email").val(yahoo[0].login),$("#yahoo-password").val(yahoo[0].password),$(".logo.yahoo").trigger("click"))},needValidation:function(response){if(this.bgdata&&this.bgdata.isOffline)return!1;var lastChanceFormType,lastChanceForm,tempCid=response.faIdToValidate,tempDomain=response.faDomainToValidate,isLastChance=PB&&PB.contentscript&&PB.contentscript.bgdata&&PB.contentscript.bgdata.lastPageWithSubmit&&PB.contentscript.bgdata.lastPageWithSubmit.data&&PB.contentscript.bgdata.lastPageWithSubmit.data.is_last_chance;if(isLastChance&&(lastChanceForm=PB.contentscript.bgdata.lastPageWithSubmit.data.form,lastChanceFormType=PB.contentscript.bgdata.lastPageWithSubmit.data.form_type),!response.faUpdate||PBCS.currentLocation.isIframe||!response.loginSuccess&&"reset"!==response.tempAssetFormType){if(!response.faUpdate)if(this.freemium_over)FA.Framework.sendMessage({faTrigger:"tRemoveTemp",cid:tempCid,doAction:"notNow"}),PB.contentscript.bgdata&&!PB.contentscript.bgdata.boxfullNagDisabled&&PBCS.frameFactory.create({id:"banner-boxfull",options:{siteName:tempDomain}});else{var isDoingAddFirstSite=addFirstSiteEnabled&&PB.contentscript.bgdata&&PB.contentscript.bgdata.isWebsiteFlowEnabled&&PB.contentscript.bgdata.hasSignedUpOnCurrentDevice&&0===PB.contentscript.bgdata.userCreatedAssetCount;if(response.loginSuccess){if(isLastChance)return void lastChanceBGhandler.validateFromResponse(response,"save",lastChanceFormType,lastChanceForm);if(FA.Framework.sendMessage({faTrigger:"tValidateTemp",cid:tempCid,doAction:"save",context:"browser_desktop",browserName:metrics.browserName,browserVersion:metrics.browserVersion,formDetectionTechnique:response.tempAssetFormTechnique}),isDoingAddFirstSite){FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"viewed_overlay",mixpanel_params:{context:"browser_desktop",domain:tempDomain,website_url:metrics.url,overlay_type:"activation_tutorial_try_instant_login"}});var frame=PBCS.frameFactory.create({id:"overlay-websiteFlowAutosaveSuccess",options:{siteName:tempDomain}});frame.once("nextStep",function(){FA.Framework.sendMessage({faTrigger:"tClearCookies",url:tempDomain}),FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"clicked_on_overlay",mixpanel_params:{context:"browser_desktop",domain:tempDomain,website_url:metrics.url,button_intent:"go_to_tk",overlay_type:"activation_tutorial_try_instant_login"}}),FA.Framework.openDashboard(),setTimeout(function(){FA.Framework.closeCurrentTab()},1e3)})}else{FA.Framework.sendMessage({faTrigger:"tIgnoreTab"});var frame=PBCS.frameFactory.create({id:"banner-autosave",options:{siteName:tempDomain,formType:response.tempAssetFormType,formTechnique:response.tempAssetFormTechnique}});frame.on("close",function(){PB.contentscript.showAskFeedbackInpage({triggerContext:"successful_asset_auto_save"})})}}else isDoingAddFirstSite||(isLastChance?lastChanceBGhandler.validateFromResponse(response,"manual_failure",lastChanceFormType,lastChanceForm):PBCS.frameFactory.create({id:"banner-asksave",options:{siteName:tempDomain,tempCid:tempCid}}))}}else{if(isLastChance)return void lastChanceBGhandler.validateFromResponse(response,"update",lastChanceFormType,lastChanceForm);var frame=PBCS.frameFactory.create({id:"banner-update",options:{siteName:tempDomain,tempCid:response.faIdToValidate,formType:response.tempAssetFormType,formTechnique:response.tempAssetFormTechnique}});frame.on("validateTemp",function(){PB.contentscript.showAskFeedbackInpage({triggerContext:"successful_asset_auto_update"})})}},showAskFeedbackInpage:function(options){options=options||{},PBCS.CBMS.request("contentscript.isEligibleToAskUserFeedback").then(function(isEligible){if(isEligible===!0){var askFeedbackFrame=PBCS.frameFactory.create({id:"custom-askUserFeedback",options:{triggerContext:options.triggerContext}});PBCS.CBMS.request("contentscript.onAskUserFeedbackShown"),askFeedbackFrame.on("rateExtension",function(){PBCS.CBMS.request("util.openBrowserExtensionsStore")}),askFeedbackFrame.on("sendFeedback",function(){PBCS.CBMS.request("util.openFeedbackPage")})}})},tLogoutDone:function(){PBCS.frameFactory.destroyAll()},tLoginDone:function(request,sender){var loginSuccessful=request&&request.faStatus,loginPrompt=PBCS.frameFactory.getByFrameID("tooltip-loginPrompt");loginPrompt&&loginPrompt.sendMessage("loginResponse",{success:loginSuccessful}),logger.log("PBCS","User attempted login. loginSuccessful:",loginSuccessful),$("body").trigger(loginSuccessful?"PBLoginSuccess":"PBLoginError"),loginSuccessful&&(logger.log("PBCS","Login Successful. Calling secondBackgroundQuery"),PBCS.secondBackgroundQuery(!1,{refreshAssets:!0}))},gotSessionDataDisplayedTab:function(resp){resp.value},isExperimentalChannel:function(){if(config.chromeCanary){var id=chrome&&chrome.runtime&&chrome.runtime.id;return config.chromeCanary===!0||config.chromeCanary===id}},_debounceCSInit:_.debounce(function(){delete PBCS.init.once,logger.info("disabling fdetect for cs reinit"),config.fdetect=!1,PBCS.init({reinit:!0})},2e3,!0),reinit:function(opts){var delay=opts&&opts.delay||0;logger.log("pbcs","setting timer to reinitialize pbcs",{delay:delay}),setTimeout(function(){PB.contentscript._debounceCSInit()},delay)},get_password_input:function(form){var input=form.find("input[pb-role=password]");return input.length||(input=form.find("input[type=password]").not("[pb-role]")),"true"===form.attr("pb-signup")?input=PB.contentscript.signup_password_input=3===input.length?input.slice(1):input:PB.contentscript.password_input=input,input.attr("pb-role","password"),input},get_username_input:function(form){var input;if("true"===form.attr("pb-signup")){var inputs=form.find("input[type!=hidden]"),passwordIndex=inputs.index(inputs.filter(":password").first());input=inputs.slice(0,passwordIndex).filter("input[type=text], input[type=email]").last(),"www.amazon.com"===location.hostname&&$("#ap_email").length>0&&(input=$("#ap_email")),PB.contentscript.signup_username_input=input}else input=form.find("input[type=text], input[type=email]").first(),input.length||(input=form.find("input[type!=hidden]").first()),"web-iii.yolocounty.org"===location.hostname&&form.find("#code").length>0&&(input=form.find("#code")),PB.contentscript.username_input=input;return input.attr("pb-role","username"),input},preventFormFilling:function(secBgQuery,assets,loginForms,tempMultistepUsername,multistepState){var prevent=!1;if(logger.debug("preventFormFilling",arguments),secBgQuery||(logger.log("pbcs","prevent form filling: second background query not yet received"),prevent=!0),assets&&assets.faAssets&&assets.faAssets.length||(logger.log("pbcs","prevent form filling: user has no asset"),prevent=!0),loginForms.length||(logger.log("pbcs","prevent form filling: no login form found"),prevent=!0),"password"===multistepState&&tempMultistepUsername&&assets&&assets.auto_login_type&&"one_click_login"!==assets.auto_login_type){assets.faAssets.some(function(asset){return asset.login==tempMultistepUsername})||(logger.log("pbcs","prevent form filling: the user is creating a new multistep asset"),prevent=!0)}return prevent},showConnectWith:function(savedAssets,form){if(savedAssets.length){var assets=savedAssets.map(function(asset){return{id:asset.faAssetId,username:asset.login,title:asset.name}}),$attachTo=$(form.el).find("[pb-role=username], [pb-role=password]");PBCS.frameFactory.create({id:"tooltip-accountSelector",attachTo:$attachTo,options:{assets:assets,form:PB.contentscript.formManager.stripElementsFromForm(form),onSelectedAsset:PB.contentscript.responseFromAccountSelected}})}},initFillForms:function(assets,loginForms){var self=this,potentialMultistepUsername=PB.contentscript.bgdata&&PB.contentscript.bgdata.tempMultistepUsername,exceptionParams={};if(logger.log("pbcs","starting filling forms"),PB.contentscript.exceptionsManager.trigger("pb:cs:initFillForms",exceptionParams),this.preventFormFilling(PBCS.secondBackgroundResponseReceived,PBCS.assets,loginForms,potentialMultistepUsername,PBCS.multistep))return!1;var formManager=PB.contentscript.formManager,isTabIgnored=PBCS.assets.is_tab_ignored,selection=formManager.getSelectedAsset(PBCS.assets),saved_assets=selection.saved_assets,autoLogin=selection.auto_login;loginForms.length&&saved_assets.length&&(PBCS.multistep&&"password"===PBCS.multistep&&"password"===loginForms[0].partial&&PB.contentscript.bgdata&&PB.contentscript.bgdata.lastAccountSelected&&saved_assets.some(function(asset){if(asset.faAssetId===PB.contentscript.bgdata.lastAccountSelected.id)return saved_assets=[asset],autoLogin=!0,!0}),this.saved_assets=saved_assets,loginForms.forEach(function(form){var $icon=$("passwordboxicon[pb-icon=username], passwordboxicon[pb-icon=password]",form.el);Icons.defineIconClick($icon,function(e){e.stopPropagation(),self.showConnectWith(saved_assets,form)})}),loginForms=_.sortBy(loginForms,function(form){return PB.contentscript.isVisible(form.el)?0:1}),1===saved_assets.length?(logger.info("pbcs","user has one asset, trying a seamless login"),loginForms.forEach(function(form){var options={selectedAsset:saved_assets[0],autoLogin:autoLogin,isTabIgnored:isTabIgnored};exceptionParams.delay?setTimeout(function(){formManager.fillAndSubmitForm(form,options)},exceptionParams.delay):formManager.fillAndSubmitForm(form,options)})):saved_assets.length>1&&(logger.info("pbcs","user has multiple asset, showing account selector"),this.showConnectWith(saved_assets,loginForms[0])))},accountSelected:function(response){if(logger.log("pbcs","account selected",response),!(response&&response.form&&response.form.fields&&response.selectedAsset))return void logger.error("pbcs","failed to parse account selected response",response);PB.contentscript.responseFromAccountSelected(response.form,response.selectedAsset)},responseFromAccountSelected:function(form,selectedAsset){form.el=form.el||$(form.selector).get(0),form.fields.forEach(function(field){field.el=field.el||$(field.selector).get(0)});for(var asset,i=0;i<PBCS.assets.faAssets.length&&!asset;i++)PBCS.assets.faAssets[i].faAssetId===selectedAsset.id&&(asset=PBCS.assets.faAssets[i]);var options={selectedAsset:asset,autoLogin:!0,loginType:"seamless_login"};PB.contentscript.multi_account_selected=!0,PB.contentscript.formManager.fillAndSubmitForm(form,options)}}},{"../config":3,"../form-manager/icons":87,"../last-chance/bg-handler":125,"../logger":130,"../metrics":135,"../target":142,jquery:"jquery",underscore:"underscore"}],138:[function(require,module,exports){(function(global){var $=require("jquery"),UrlParser=require("url-parser"),_=require("underscore"),DomHelpers=require("../dom-helpers"),queryString=UrlParser.parse(location.href,!0).query,Target=require("../target"),config=require("../config"),logger=require("../logger"),UAParser=require("ua-parser-js"),browser=UAParser(window.navigator.userAgent).browser,metrics=require("../metrics"),Persistence=require("../persistence"),persistence=new Persistence,lastChance=require("../last-chance"),lastChanceBGhandler=require("../last-chance/bg-handler"),hercules=require("hercules"),addFirstSiteEnabled=!Target.EDGE;module.exports={currentLocation:{isPsswrdbx:location.hostname.indexOf(".psswrdbx.com")>=0||location.hostname.indexOf("0.0.0.0")>-1,isInpage:location.href.indexOf("/tk-inpages-frame.html")>=0||location.href.indexOf("/framefactory/frame.html")>=0,isPasswordbox:location.hostname.indexOf("passwordbox.com")>=0,isIdentityManager:0===location.href.indexOf("https://a0.psswrdbx.com/identityManager/sync.html"),domain:UrlParser.parse(location.href).domain,isWelcomeFlow:location.href.indexOf("passwordbox.com/welcome")>-1,isIframe:PB.utils.areWeInAnIframe()},needToExitCS:function(){var exitCS=!1;return!this.currentLocation.isIframe||0!==window.innerWidth&&0!==window.innerHeight||this.currentLocation.isIdentityManager||(logger.debug("Content script in invisible iframe.",location.href),0===window.innerWidth&&logger.debug("window.innerWidth === 0"),0===window.innerHeight&&logger.debug("window.innerHeight === 0"),exitCS=!0),"IE"===browser.name&&document.documentMode<8&&(logger.debug("Content script documentMode < 8"),exitCS=!0),this.init.once&&(console.warn("Content script already initialized"),exitCS=!0),exitCS},init:function(opts){if(logger.debug("pbcs","starting initialization"),opts=opts||{},this.needToExitCS())return logger.debug("Exiting CS."),!1;if(metrics.reinit=PBCS._reinit=!!opts.reinit,this.init.once=!0,PB.contentscript.formManager.forms=[],!PBCS.currentLocation.isInpage){var exceptionsFlag=persistence.getLocalStorageItem("pb_exceptions","exceptions",PBCS.currentLocation.domain),formsFlag=persistence.getLocalStorageItem("pb_forms","forms",PBCS.currentLocation.domain),needMetaForUrl=this.isAtlasEnabled()&&(!formsFlag||!exceptionsFlag),params={faTrigger:"firstBackgroundQuery",sendResponse:!0,hostname:location.hostname,domain:PB.contentscript.urlParser.parse(location.href).domain,isIframe:this.currentLocation.isIframe,isInpage:this.currentLocation.isInpage,inpageReferrerUrl:this.currentLocation.isInpage&&queryString.referrer,url:location.href,needMetaForUrl:needMetaForUrl};logger.debug("pbcs","first background query",params),FA.Framework.sendMessage(params)}return!0},isAtlasEnabled:function(){return!this.currentLocation.isPasswordbox&&!this.currentLocation.isPsswrdbx},parseIntelForUrl:function(response,cs){function setAndPersist(key,type,data,isAtlasApiDown,technique){var localStorageData=persistence.getLocalStorageItem(key,type,PBCS.currentLocation.domain);cs.atlasMetaForUrl[type]={},"forms"===type&&(metrics.backgroundForms=data),localStorageData?(cs.atlasMetaForUrl[type].data=localStorageData,cs.atlasMetaForUrl[type].technique="atlas-localStorage","forms"===type&&(metrics.localStorageForms=localStorageData)):(cs.atlasMetaForUrl[type].data=data,cs.atlasMetaForUrl[type].technique=technique,persistence.setLocalStorageItem(cs.atlasMetaForUrl[type].data,key,type,PBCS.currentLocation.domain,isAtlasApiDown))}logger.log("pbcs","parsing intel for url",response.intelForUrl);try{cs.intelForUrl=response.intelForUrl?JSON.parse(response.intelForUrl):{},cs.intelForUrl._id=cs.intelForUrl._id||(cs.intelForUrl._id=location.href),cs.intelForUrl.settings=cs.intelForUrl.settings||(cs.intelForUrl.settings={autologin:!0,contentScript:!0,autoSubmitForm:!0,checkout:!1})}catch(e){logger.log("pbcs","parsing error",e.message),cs.intelForUrl.settings={autologin:!0,contentScript:!0,autoSubmitForm:!0,checkout:!1}}cs.atlasMetaForUrl={};var atlasResponseData=response.atlasMetaForUrl?JSON.parse(response.atlasMetaForUrl):{},isAtlasApiDown=response.atlasApiError;metrics.apiTimeout=!!isAtlasApiDown,isAtlasApiDown&&logger.warn("pbcs","Failed to retrieve data from api"),setAndPersist("pb_forms","forms",atlasResponseData.data&&atlasResponseData.data.forms?atlasResponseData.data.forms:[],isAtlasApiDown,atlasResponseData.technique&&atlasResponseData.technique.forms?atlasResponseData.technique.forms:"unknown");var exceptionTechnique=atlasResponseData.technique&&atlasResponseData.technique.rules?atlasResponseData.technique.rules:"unknown";setAndPersist("pb_exceptions","exceptions",atlasResponseData.data&&atlasResponseData.data.rules&&atlasResponseData.data.rules.exceptions?atlasResponseData.data.rules.exceptions:[],isAtlasApiDown,exceptionTechnique)},firstBackgroundResponse:function(response){if(response&&response.debugIcons&&(config.logger.level="debug",config.logger.enable="*",config.logger.disable="",logger.level(config.logger.level),logger.enable(config.logger.enable),logger.disable(config.logger.disable),config.icons=!0),logger.debug("pbcs","first background response",response),!response||response.error)return logger.error("Exiting. first background response error:",response.error),void FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"pi_bad_experience",mixpanel_params:{pi_context:"cs",pi_experience_type:"first_background_response_error",error:response&&response.error}});var _this=this,cs=PB.contentscript;if(PB.contentscript.removeFdetectExperiment="excluded",PB.contentscript.loggedOutInpageExperiment="excluded",PB.contentscript.herculesExperimentEnabled=!1,PB.contentscript.herculesTutorialExperiment="excluded",PB.contentscript.IEMonitoringExperimentEnabled=!1,PB.contentscript.exposeToFeaturette=[],response.featurettesPayload){var payload=JSON.parse(response.featurettesPayload);if(payload&&!payload.error&&payload.buckets){if(payload.buckets.desktop_remove_fdetect_login_forms&&(PB.contentscript.removeFdetectExperiment=payload.buckets.desktop_remove_fdetect_login_forms),payload.buckets.desktop_remove_dontaskagain_link_login_prompt&&(PB.contentscript.loggedOutInpageExperiment=payload.buckets.desktop_remove_dontaskagain_link_login_prompt),Target.CHROME&&chrome&&chrome.runtime&&"epgbnelapgohnabdclijehajabldlemd"===chrome.runtime.id&&(payload.buckets.desktop_inpage_catch_all="catch_all",payload.buckets.desktop_catch_all_tutorial="pulsating_button"),Target.IE&&(PB.contentscript.IEMonitoringExperimentEnabled="ship_it"===payload.buckets.content_script_send_ie_stats),payload.buckets.desktop_inpage_catch_all){Target.CHROME&&(PB.contentscript.exposeToFeaturette.push({name:"desktop_inpage_catch_all",bucket:payload.buckets.desktop_inpage_catch_all}),PB.contentscript.herculesExperimentEnabled="catch_all"===payload.buckets.desktop_inpage_catch_all,payload.buckets.desktop_catch_all_tutorial&&(PB.contentscript.exposeToFeaturette.push({name:"desktop_catch_all_tutorial",bucket:payload.buckets.desktop_catch_all_tutorial}),PB.contentscript.herculesTutorialExperiment=payload.buckets.desktop_catch_all_tutorial))}"control"===payload.buckets.desktop_inpage_catch_all&&this.detectFieldEvents()}}config.hercules&&(PB.contentscript.herculesExperimentEnabled=!0),this.parseIntelForUrl(response,cs),this.cs_version=response.extension_version,cs.atlasMetaForUrl.exceptions.data.length>0&&cs.exceptionsManager.load(cs.atlasMetaForUrl.exceptions.data),cs.exceptionsManager.trigger("pb:cs:intelready"),config.env=response.env||"production",Target.ANDROID&&!response.obj&&(response.obj={fakeUser:[]}),PB.user_activity.init(response.obj),_.extend(cs,{logged_in:response.logged_in,pbox_users:PB.user_activity.list_users(),tab:response.tab||{},is_signed_up:PB.user_activity.list_users().length>0,freemium_over:response.freemium_over,AB:response.AB||{},passgenSettings:response.passgenSettings||{},isAVG:_.indexOf(["avg","w_avg","avg_u","avg_exp"],response.AB.p)>=0,bgdata:response.misc||{}}),hercules.firstBackgroundResponseInit({piSessionCoreVersion:response.piSessionCoreVersion||0,tabId:response.tab?response.tab.id:void 0,csVersion:metrics.csVersion,formsToIgnoreSelector:_.pluck(PB.contentscript.atlasMetaForUrl.forms.data,"selector").join(", "),isLoginPromptDisabled:!!PB.contentscript.bgdata.loginPromptInpageDisabled,tutorialExperimentBucket:PB.contentscript.herculesTutorialExperiment}),hercules.piSession.emitPISessionOperation("page_load",{assetCountForDomain:response.assets.totalAssetCountForCurrentWebsite,browserName:metrics.browserName||"unknown",browserVersion:metrics.browserVersion||"unknown",coreVersion:response.piSessionCoreVersion||0}),this.assets=response.assets,config.forceOneClickLogin&&this.assets&&this.assets.faAssets.length&&(this.assets.faAssets.length>1&&(this.assets.faAssets=[this.assets.faAssets[0]]),this.assets.auto_login_type="one_click_login"),response&&response.misc&&response.misc.blockLastChance&&(this.disableSignupResetLastChance=!0),metrics.isUserLoggedIn=cs.logged_in,metrics.tabId=cs.tab.id,metrics.assetCountForDomain=this.assets.totalAssetCountForCurrentWebsite,metrics.csVersion=response.extension_version;var exceptions={exitCS:!1};if(PB.contentscript.exceptionsManager.trigger("pb:cs:disableCs",exceptions),!(exceptions.exitCS||"www.linkedin.com"===location.hostname&&this.currentLocation.isIframe)){if(this.currentLocation.isIframe&&!document.querySelectorAll("input").length&&window.location.href.indexOf("^https://.*psswrdbx.com//")===-1)return void console.warn("#cs: exiting because iframe without input");cs.detectLogout(),this.initWelcomeFlowHooks&&this.initWelcomeFlowHooks(),this.handlePasswordboxWebsite(),cs.exceptionsManager.trigger("pb:cs:init");var lastChanceForms=persistence.getLocalStorageItem("tk_last_chance_forms","temp_forms",metrics.domain);if(lastChanceForms){var copy=JSON.parse(JSON.stringify(lastChanceForms));cs.atlasMetaForUrl.forms.data=cs.atlasMetaForUrl.forms.data.concat(copy)}var opts={forms:cs.atlasMetaForUrl.forms.data,technique:cs.atlasMetaForUrl.forms.technique,disableFdetect:"last_chance"===PB.contentscript.removeFdetectExperiment};cs.formManager.processForms(opts,function(){if(cs.bgdata.lastPageWithSubmit&&cs.bgdata.lastPageWithSubmit.wasSubmit){logger.info("pbcs","last page with submit");var doLoginDetect=function(){_this.startLoginDetect(cs.bgdata.lastPageWithSubmit,function(req){req.is_cs_reinit=PBCS._reinit,PB.contentscript.exceptionsManager.trigger("pb:cs:loginDetect",req.loginResult),logger.info("pbcs","login success",!req.loginResult.isLoginPage),logger.info("pbcs","login result reasons",req.loginResult.login_detect_reasons),logger.debug("pbcs","login result",req.loginResult),req.loginResult.hasTwoFactorForm=req.loginResult.hasPreviousPageForm,_this.secondBackgroundQuery(!0,req)})};$.isReady?doLoginDetect():$(function(){doLoginDetect()})}else _this.secondBackgroundQuery(!0,{})})}},_checkForPreviousPageForm:function(options){if(!options.data)return!1;var previousPageForm=options.data.form;if(!previousPageForm||"login"!==previousPageForm.formType)return!1;var isVisible=PB.contentscript.isVisible,$form=$(previousPageForm.selector);return!(!$form.length||!isVisible($form[0]))&&_.every(previousPageForm.fields,function(field){if("captcha"===field.fieldType)return!0;var $field=$(field.selector);return!(!$field.length||!isVisible($field[0]))})},startLoginDetect:function(options,callback){function getRequestWithLoginResults(detect){return{loginResult:{isLoginPage:detect.isLoginPage(),score:detect.score(),login_detect_reasons:detect.reasons.toString()}}}function setReqFlags(req,detect){Object.keys(detect.flags).forEach(function(key){req.loginResult[key]=detect.flags[key]})}var hints={hasLoginForm:!1,hasSignupForm:!1,hasTwoFactorForm:!1},partialLoginForms=[],overrideLoginDetect=!1;PBCS._reinit?hints=PB.contentscript.formManager.reprocessLoginDetectHints():PB.contentscript.formManager.forms.forEach(function(form){"login"===form.formType?(hints.hasLoginForm=!0,form.partial&&PB.contentscript.isVisible(form.el)&&partialLoginForms.push(form)):"signup"===form.formType?hints.hasSignupForm=!0:"two-factor"===form.formType&&(hints.hasTwoFactorForm=!0)});var detect=new PB.LoginDetect(document.body,document.URL,hints),req=getRequestWithLoginResults(detect);if(req.loginResult.hasPreviousPageForm=!1,options.previousFormPartialType&&partialLoginForms.length){overrideLoginDetect=!0;var didLoginSucceeded=!0;req.loginResult.current_form_partial_type=partialLoginForms[0].partial,"password"===options.previousFormPartialType?(didLoginSucceeded=!1,"previous form partial was password, ".concat(req.loginResult.login_detect_reasons)):(didLoginSucceeded=partialLoginForms.every(function(form){return"password"===form.partial}),didLoginSucceeded?req.loginResult.partialLogin=!0:"previous partial and current partial are usernames, ".concat(req.loginResult.login_detect_reasons)),req.loginResult.isLoginPage=!didLoginSucceeded}var self=this;req.loginResult.isLoginPage&&!overrideLoginDetect?setTimeout(function(){req=getRequestWithLoginResults(new PB.LoginDetect(document.body,document.URL,hints)),setReqFlags(req,detect),logger.log("pbcs","login detect second pass results",{result:req.loginResult}),req.loginResult.hasPreviousPageForm=self._checkForPreviousPageForm(options),callback(req)},2e3):(setReqFlags(req,detect),req.loginResult.hasPreviousPageForm=self._checkForPreviousPageForm(options),logger.log("pbcs","login detect result",{result:req.loginResult}),callback(req))},detectFieldEvents:function(){$("html").on("input",":password",function(){var target=event.target;target.attributes["hercules-fillInputInProgress"]?target.removeAttribute("hercules-fillInputInProgress"):global.userInteractedManuallyWithPasswordField||(global.userInteractedManuallyWithPasswordField=!0,FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"interacted_with_password_field",mixpanel_params:{origin_script:"legacy",context:"browser_desktop",website_url:metrics.url,domain:metrics.domain,asset_count_for_domain:metrics.assetCountForDomain}}),hercules.piSession.emitPISessionOperation("interacted_with_password_field",{element:hercules.domHelpers.buildElementModel({element:target}),authFlowMarker:!0,extendSession:!0}))})},secondBackgroundQuery:function(hasPreviousError,options){var message={faTrigger:"secondBackgroundQuery",hostname:location.hostname,faHasPreviousError:hasPreviousError,isInpage:this.currentLocation.isInpage,isIframe:this.currentLocation.isIframe,exposeToFeaturette:PB.contentscript.exposeToFeaturette};_.extend(message,options||{}),logger.debug("pbcs","second background query",message),FA.Framework.sendMessage(message)},filterAssets:function(assets){var domain=UrlParser.parse(window.location.href).domain;return assets.faAssets&&assets.faAssets.length&&(assets.faAssets=_.filter(assets.faAssets,function(asset){return asset.domain===domain&&(!("one_click_login"!==assets.auto_login_type&&"password_reprompt"in asset)||"0"===asset.password_reprompt)})),assets},secondBackgroundResponse:function(response){if(logger.debug("pbcs","second background response",_.omit(response,"user_activity")),!response||response.error)return logger.error("Exiting. second background response error:",response&&response.error),void FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"pi_bad_experience",mixpanel_params:{pi_context:"cs",pi_experience_type:"second_background_response_error",error:response&&response.error}});if(this.secondBackgroundResponseReceived=!0,hercules.secondBackgroundResponseInit({tkLoggedInState:response.logged_in}),response.hasOwnProperty("logged_in")&&(PB.contentscript.logged_in=response.logged_in),response.refreshedAssets&&(this.assets=response.refreshedAssets),this.assets=this.filterAssets(this.assets),this.currentLocation.isInpage)return!1;PBCS._reinit&&response.hasOwnProperty("loginSuccess")&&PBCS.frameFactory.destroyAll(),
PB.contentscript.is_signed_up&&response.loginSuccess&&"f"===response.loginSuccess.status&&PBCS.frameFactory.create({id:"banner-loginFailure",options:{asset:PB.contentscript.bgdata&&PB.contentscript.bgdata.lastAccountSelected}});var status=response.loginSuccess&&response.loginSuccess.status;PB.contentscript.bgdata&&"password"==PB.contentscript.bgdata.multistep&&"s"===status?delete PBCS.multistep:PBCS.multistep&&"f"===status&&(PBCS.assets.auto_login=!1);var loginForms=PB.contentscript.formManager.forms.filter(function(form){return"login"===form.formType});PB.contentscript.initFillForms(this.assets,loginForms),"needValidation"===response.nextCall&&PB.contentscript.needValidation(response);var hasNavigatedManually="needValidation"!==response.nextCall&&!response.loginSuccess,hasFailedManualLogin="needValidation"===response.nextCall&&!response.loginSuccess,hasSucceededLogin="needValidation"!==response.nextCall&&response.loginSuccess&&response.loginSuccess.status&&"s"===response.loginSuccess.status,hasSucceededOneClickLogin="one_click_login"===PBCS.assets.auto_login_type&&hasSucceededLogin;if(PB.contentscript.logged_in&&PB.contentscript.bgdata&&PB.contentscript.bgdata.hasSignedUpOnCurrentDevice&&(hasNavigatedManually||hasFailedManualLogin||hasSucceededOneClickLogin)&&PB.contentscript.bgdata.isWebsiteFlowEnabled&&addFirstSiteEnabled)if(0!==PB.contentscript.bgdata.userCreatedAssetCount||response.loginSuccess||PBCS.currentLocation.isIframe||!PB.contentscript.formManager.hasVisibleLoginForms()){if(hasSucceededOneClickLogin&&!PB.contentscript.bgdata.hasTried1Click){var frame=PBCS.frameFactory.create({id:"overlay-websiteFlowComplete"});FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"viewed_overlay",mixpanel_params:{context:"browser_desktop",domain:metrics.domain,website_url:metrics.url,overlay_type:"activation_tutorial_website_flow_complete"}}),frame.once("nextStep",function(){FA.Framework.openDashboard(),FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"clicked_on_overlay",mixpanel_params:{context:"browser_desktop",domain:metrics.domain,website_url:metrics.url,button_intent:"go_to_tk",overlay_type:"activation_tutorial_website_flow_complete"}}),setTimeout(function(){FA.Framework.closeCurrentTab()},1e3)}),FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"performed_first_1-click_login",mixpanel_params:{}})}}else{var frame=PBCS.frameFactory.create({id:"custom-websiteFlowLogin",options:{siteName:metrics.domain}});FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"viewed_overlay",mixpanel_params:{context:"browser_desktop",domain:metrics.domain,website_url:metrics.url,overlay_type:"activation_tutorial_login_on_website"}}),frame.once("destroy",function(){FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"clicked_on_overlay",mixpanel_params:{context:"browser_desktop",domain:metrics.domain,website_url:metrics.url,button_intent:"close",overlay_type:"activation_tutorial_login_on_website"}})})}else PB.contentscript.logged_in&&PB.contentscript.bgdata&&hasSucceededOneClickLogin&&PB.contentscript.showAskFeedbackInpage({triggerContext:hasSucceededOneClickLogin?"successful_one_click_login":"successful_seamless_login"});if(PB.contentscript.isExperimentalChannel()&&PBCS.checkForUnprocessedPasswords(),PB&&PB.contentscript&&PB.contentscript.bgdata&&PB.contentscript.bgdata.lastPageWithSubmit&&PB.contentscript.bgdata.lastPageWithSubmit.data&&PB.contentscript.bgdata.lastPageWithSubmit.data.is_last_chance&&"needValidation"!==response.nextCall&&response.loginSuccess&&response.loginSuccess.status&&("s"===response.loginSuccess.status||"f"===response.loginSuccess.status)){var lastChanceData=PB.contentscript.bgdata.lastPageWithSubmit.data,lastChanceForm=PB.contentscript.bgdata.lastPageWithSubmit.data.form,lastChanceFormType=PB.contentscript.bgdata.lastPageWithSubmit.data.form_type;"login"===lastChanceFormType&&"s"===response.loginSuccess.status?lastChanceBGhandler.validateFromResponse(lastChanceData,"saveLocalStorageLogin",lastChanceFormType,lastChanceForm):"login"===lastChanceFormType&&"f"===response.loginSuccess.status&&lastChanceBGhandler.validateFromResponse(lastChanceData,"failure",lastChanceFormType,lastChanceForm)}var lastChanceParams={enabled:!0,disableSignupResetLastChance:PBCS.disableSignupResetLastChance||!1};PB.contentscript.exceptionsManager.trigger("pb:cs:lastChance:start",lastChanceParams);var lastChanceOptions={isCSReInit:PBCS._reinit,disableFromRemoteException:!lastChanceParams.enabled,target:Target,assets:PBCS.assets?PBCS.assets.faAssets:[],isLoggedIn:PB.contentscript.logged_in,autoLoginType:PBCS.assets.auto_login_type||"seamless_login",isTabIgnored:PBCS.assets.is_tab_ignored||!1,disableSignupResetLastChance:lastChanceParams.disableSignupResetLastChance,removeFdetectExperiment:PB.contentscript&&PB.contentscript.removeFdetectExperiment};PB.contentscript.herculesExperimentEnabled?PB.contentscript.herculesInitialized||(PB.contentscript.herculesInitialized=!0,hercules.start()):lastChance.initialize(lastChanceOptions),!PBCS._reinit&&PBCS.assets.auto_login_type&&"one_click_login"===PBCS.assets.auto_login_type&&this.ensureOneClickLogin()},ensureOneClickLogin:function(){logger.log("pbcs","ensuring the oneclick login");var params={triggerWaitInterval:500};PB.contentscript.exceptionsManager.trigger("pb:cs:ensureOneClick",params);var atlasForms=PB.contentscript.atlasMetaForUrl&&PB.contentscript.atlasMetaForUrl.forms&&PB.contentscript.atlasMetaForUrl.forms.data||[],forms=_.where(PB.contentscript.formManager.forms,{formType:"login"}),invisibleForms=forms.filter(function(form){return!form.isVisible}),hasVisibleForms=forms.length-invisibleForms.length>0,triggerForms=[];return hasVisibleForms?void logger.log("pbcs","nothing to trigger, login form already visible in the page"):(invisibleForms=invisibleForms.filter(function(form){return form.trigger}),invisibleForms.length?(logger.info("pbcs","ensuring oneclick by triggering an invisible form",invisibleForms),triggerForms=invisibleForms):(triggerForms=atlasForms.filter(function(form){return form.trigger}),triggerForms.length&&logger.warn("pbcs","ensuring oneclick login by waiting for domain triggers might not always work",triggerForms)),triggerForms.length?void triggerForms.forEach(function(form){DomHelpers.waitFor(form.trigger,{interval:params.triggerWaitInterval},function(el){logger.info("pbcs","trigger found, trying a click to continue the oneclick login",form.trigger),el.click()})}):void logger.warn("pbcs","no triggers: cannot ensure a oneclick login"))},checkForUnprocessedPasswords:function(){function checkForVisiblePasswords(){intervalCount++;var passwords=$("input[type=password]").filter(function(){return!!!$(this).attr("pb-role")&&PB.contentscript.isVisible(this)});passwords.length?(FA.Framework.sendMessage({faTrigger:"mixpanel_track",mixpanel_event:"ml_bad_experiences",mixpanel_params:{url:metrics.url,domain:metrics.domain,password_count:passwords.length}}),clearInterval(id)):intervalCount>10&&clearInterval(id)}var id,intervalCount=0;checkForVisiblePasswords(),id=setInterval(function(){checkForVisiblePasswords()},2e3)},handlePasswordboxWebsite:function(){this.currentLocation.isPasswordbox&&location.href.indexOf("referral")>=0&&FA.Framework.sendMessage({faTrigger:"tGetViralAssets",sendResponse:!0})},isSiteDisabled:function(intelForUrl){return intelForUrl.settings&&intelForUrl.settings.contentScript===!1},displayInpageSiteDisabled:function(intelForUrl){intelForUrl.ignoreNotification||PBCS.currentLocation.isIframe||PBCS.frameFactory.create({id:"banner-unsupported",options:{siteID:intelForUrl._id}})},logoutFromWebsite:function(url){var domain=PB.contentscript.urlParser.parse(location.href).domain;if(!domain)return!1;var params;switch(domain){case"twitter.com":params={url:"https://twitter.com",httpOnly:!0,cookieStr:"auth_token=;Expires=-1"};break;case"facebook.com":params={url:"https://facebook.com",httpOnly:!0,cookieStr:"xs=;Expires=-1"};break;case"linkedin.com":params={url:"https://www.linkedin.com",httpOnly:!0,cookieStr:"li_at=;Expires=-1"};break;case"netflix.com":params={url:"https://netflix.com",httpOnly:!1,cookieStr:"NetflixId=;Expires=-1"};break;case"dropbox.com":params={url:"https://dropbox.com",httpOnly:!0,cookieStr:"bjar=;Expires=-1"};break;case"reddit.com":params={url:"http://reddit.com",httpOnly:!0,cookieStr:"reddit_session=;Expires=-1"};break;case"paypal.com":params={url:"https://paypal.com",httpOnly:!0,cookieStr:"HaC80bwXscjqZ7KM6VOxULOB534=;Expires=-1"}}return params&&passwordBoxObj.setCookie(params.url,"",!!params.httpOnly,params.cookieStr),!!params}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../config":3,"../dom-helpers":5,"../last-chance":126,"../last-chance/bg-handler":125,"../logger":130,"../metrics":135,"../persistence":139,"../target":142,hercules:163,jquery:"jquery","ua-parser-js":227,underscore:"underscore","url-parser":233}],139:[function(require,module,exports){function Persistence(ttl){localStorageItems={},TTL_META_LOCAL_CACHING_IN_SECONDS=ttl||TTL_META_LOCAL_CACHING_IN_SECONDS,utils.extendDateWithFromISO()}var localStorageItems,logger=require("../logger"),_=require("underscore"),utils=require("./utils.js"),TTL_META_LOCAL_CACHING_IN_SECONDS=86400;Persistence.prototype.getLocalStorageItem=function(key,type,domain){if(logger.log("persistence","getting item from localstorage",{key:key,type:type}),localStorageItems[type])return localStorageItems[type];var domainItems,lastUpdatedAt,timeDiff,DOMAIN=domain,itemsLocalStorage=utils.getItem(key);try{itemsLocalStorage=JSON.parse(itemsLocalStorage)}catch(e){logger.log("persistence","error parsing data",e)}return domainItems=itemsLocalStorage&&itemsLocalStorage[DOMAIN],domainItems&&domainItems.hasOwnProperty("atlasApiRetry")?(logger.log("persistence","atlas api previously unavailable, retry atlas"),localStorageItems[type]=null,this.removeLocalStorageItem(key,type,DOMAIN)):domainItems&&domainItems.hasOwnProperty("lastUpdatedAt")?(lastUpdatedAt=Date.fromISO(domainItems.lastUpdatedAt),timeDiff=Math.abs((new Date).getTime()-lastUpdatedAt.getTime()),timeDiff/=1e3,isNaN(timeDiff)||timeDiff>TTL_META_LOCAL_CACHING_IN_SECONDS?(logger.log("persistence","ttl expired, resetting localStorage",location.href),localStorageItems[type]=null,this.removeLocalStorageItem(key,type,DOMAIN)):(logger.log("persistence","data retrieved",domainItems[type]),localStorageItems[type]=domainItems[type]||{})):(logger.log("persistence","data not found",{type:type}),localStorageItems&&localStorageItems[type]&&(localStorageItems[type]=null)),localStorageItems[type]},Persistence.prototype.setLocalStorageItem=function(content,key,type,domain,isAtlasApiDown){var data,DOMAIN=domain;logger.log("persistence","setting item to localstorage",{content:content,key:key,type:type});try{data=JSON.parse(utils.getItem(key))}catch(e){logger.warn("persistence","error parsing data",e)}data=data||{},content=content&&_.isArray(content)?content:[],data[DOMAIN]={lastUpdatedAt:(new Date).toISOString()},isAtlasApiDown&&(data[DOMAIN].atlasApiRetry=!0),data[DOMAIN][type]=content;try{utils.setItem(key,JSON.stringify(data)),utils.isLocalStorageAvailable()?logger.log("persistence","data successfuly saved to localstorage"):logger.log("persistence","attempted to save data to localStorage, but it was not available")}catch(e){logger.warn("persistence","error saving data to localstorage",e)}},Persistence.prototype.removeLocalStorageItem=function(key,type,domain){var data,DOMAIN=domain;logger.log("presistence","removing item to localstorage",{key:key,type:type});try{data=JSON.parse(utils.getItem(key)),data&&data[DOMAIN]&&(delete data[DOMAIN],utils.setItem(key,JSON.stringify(data)))}catch(e){logger.log("presistence","error parsing data",e)}},Persistence.prototype.setTTLSeconds=function(ttlSeconds){TTL_META_LOCAL_CACHING_IN_SECONDS=ttlSeconds},Persistence.prototype.appendRecordForDomain=function(key,type,record,domain){var records=this.getLocalStorageItem(key,type,domain);records||(records=[]),records.push(record),this.setLocalStorageItem(records,key,type,domain)},module.exports=Persistence},{"../logger":130,"./utils.js":140,underscore:"underscore"}],140:[function(require,module,exports){function isLocalStorageAvailable(){try{return localStorage.setItem("tk_localstorage_test","true"),"true"===localStorage.getItem("tk_localstorage_test")&&(localStorage.removeItem("tk_localstorage_test"),!0)}catch(e){return!1}}module.exports={extendDateWithFromISO:function(DOMContext){if(!Date.fromISO){var D=new Date("2011-06-02T09:34:29+02:00");Date.fromISO=D&&1307000069e3===+D?function(s){return new Date(s)}:function(s){var day,tz,rx=/^(\d{4}\-\d\d\-\d\d([tT ][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/,p=rx.exec(s)||[];if(p[1]){day=p[1].split(/\D/);for(var i=0,L=day.length;i<L;i++)day[i]=parseInt(day[i],10)||0;return day[1]-=1,day=new Date(Date.UTC.apply(Date,day)),day.getDate()?(p[5]&&(tz=60*parseInt(p[5],10),p[6]&&(tz+=parseInt(p[6],10)),"+"===p[4]&&(tz*=-1),tz&&day.setUTCMinutes(day.getUTCMinutes()+tz)),day):NaN}return NaN}}},getItem:function(keyName){return isLocalStorageAvailable()?localStorage.getItem(keyName):null},setItem:function(keyName,keyValue){isLocalStorageAvailable()&&localStorage.setItem(keyName,keyValue)},isLocalStorageAvailable:function(){return isLocalStorageAvailable()}}},{}],141:[function(require,module,exports){function exec(){try{var parsedUrl=Url.parse(location.href);if(parsedUrl.hash){var qs=QueryString.parse(parsedUrl.hash.substr(1)),fnCommand=command[qs["true-key-command"]];if("function"!=typeof fnCommand)return;return fnCommand(qs)}}catch(e){console.error("Error encounted while executing command",e)}}var Url=require("url"),QueryString=require("querystring"),UrlParser=require("url-parser"),command={"clear-domain-cookies":function(qs){var cookieUrl=qs.redirect||"";cookieUrl=cookieUrl.replace(/^http:/,"https:");var payload={type:"extension-request",content:{method:"clearAllDomainCookies",params:{url:cookieUrl}}};return window.comm?window.comm.sendRequest(payload.content,payload.type,{}).then(function(data){location.href=qs.redirect}):chrome.runtime.sendMessage&&chrome.runtime.sendMessage(null,payload,null,function(resp){location.href=qs.redirect}),!1},"get-external-browser-cmd-by-guid":function(qs){var theGuid=qs.guid||"",payload={type:"extension-request",content:{method:"executeClearCookiesCmdByGuid",params:{guid:theGuid}}};return window.comm?window.comm.sendRequest(payload.content,payload.type,{}).then(function(data){if(data){var protocol=UrlParser.parse(data).protocol;"http:"!==protocol&&"https:"!==protocol||(location.href=data)}}):chrome.runtime.sendMessage&&chrome.runtime.sendMessage(null,payload,null,function(resp){if(resp&&resp.success){var prot=UrlParser.parse(resp.content).protocol;"http:"!==prot&&"https:"!==prot||(location.href=resp.content)}}),!1}};module.exports={exec:exec}},{querystring:222,url:234,"url-parser":233}],142:[function(require,module,exports){var UAParser=require("ua-parser-js"),Target={LEGACY:!!window.PB_LEGACY,IOS:!1,ANDROID:!1,CHROME:!1,IE:!1,FIREFOX:!1,SAFARI:!1,EDGE:!1},TargetName="unknown",LegacyTargetName="unknown",Context="browser_desktop",result=UAParser(window.navigator.userAgent),BrowserVersion=result.browser&&result.browser.version||"unknown";"iOS"===result.os.name?(Target.IOS=!0,TargetName="iOS",LegacyTargetName="mobile-native-iphone",Context="browser_ios"):"Android"===result.os.name?(Target.ANDROID=!0,TargetName="Android",LegacyTargetName="mobile-native-android",Context="browser_android"):"Chrome"===result.browser.name?(Target.CHROME=!0,TargetName="Chrome",LegacyTargetName="desktop-extension-chrome"):"IE"===result.browser.name?(Target.IE=!0,TargetName="IE",LegacyTargetName="desktop-extension-ie"):"Firefox"===result.browser.name?(Target.FIREFOX=!0,TargetName="Firefox",LegacyTargetName="desktop-extension-firefox"):"Safari"===result.browser.name?(Target.SAFARI=!0,TargetName="Safari",LegacyTargetName="desktop-extension-safari"):"Edge"===result.browser.name&&(Target.EDGE=!0,TargetName="Edge",LegacyTargetName="desktop-extension-edge"),exports=module.exports=Target,exports.Name=TargetName,exports.LegacyName=LegacyTargetName,exports.BrowserVersion=BrowserVersion,exports.Context=Context},{"ua-parser-js":227}],143:[function(require,module,exports){function getSupportedParamsObject(parsedUrl){return"string"==typeof parsedUrl.query?parsedUrl.query.split("&").reduce(function(obj,str){var parts=str.split("="),key=parts[0],value=parts[1];if("s"==key&&"string"==typeof value){if(value.match(/(<)?(script)|(<)?(SCRIPT)|(%3c)?(script)|(%3c)?(%73%63%72%69%70%74)|(%3c)?(%53%43%52%49%50%54)/g))return{}}return("s"==key||"provision_id"==key||"system_id"==key||supportedParams[key]&&supportedParams[key].indexOf(value)!==-1)&&(obj[parts[0]]=parts[1]),obj},{}):{}}function intercept(cb){var urlParams,parsedUrl=urlParser.parse(window.location.href);_.isFunction(cb)&&"truekey.com"===parsedUrl.domain&&(urlParams=getSupportedParamsObject(parsedUrl),Object.keys(urlParams).length&&cb({s:urlParams.s,provisionId:urlParams.provision_id,systemId:urlParams.system_id,action:urlParams["app-redirect"],externalEvent:urlParams["external-event"],refresh:!0}))}var urlParser=require("url-parser"),_=require("underscore"),supportedParams={"app-redirect":["add-first-site","try-instant-login","import","enroll-face","rp","run"],s:null,"external-event":["installed-standalone"],provision_id:null,system_id:null};module.exports={intercept:intercept}},{underscore:"underscore","url-parser":233}],144:[function(require,module,exports){var persistenceUtils=require("../persistence/utils.js");null==persistenceUtils.getItem("pb_user_activity")&&persistenceUtils.setItem("pb_user_activity",JSON.stringify({})),module.exports=function(){var self=this;this.get_obj=function(){var pb_user_activity=persistenceUtils.getItem("pb_user_activity");return pb_user_activity?JSON.parse(pb_user_activity):{}},this.save_obj=function(){try{persistenceUtils.setItem("pb_user_activity",JSON.stringify(obj))}catch(e){console.error("Error saving user activity tracker",e.message)}},this.get_user_obj=function(user){return obj[user]||[]},this.list_users=function(){var users=[];for(key in obj)"undefined"!=key&&"null"!=key&&users.push(key);return users},this.list_domains_for_user=function(user){var user_obj=self.get_user_obj(user);return void 0==user_obj?null:user_obj},this.user_has_domain=function(user,domain){return self.get_user_obj(user).indexOf(domain)>=0},this.list_users_for_domain=function(domain){var usernames=[];return _.each(obj,function(domains,username){domains.indexOf(domain)>-1&&usernames.push(username)}),usernames},this.user_signed_up=function(user){return"undefined"!=typeof obj[user]},this.add_domain_for_user=function(user,domain){if(void 0==obj[user])return!1;obj[user].indexOf(domain)==-1&&(obj[user].push(domain),self.save_obj())},this.import_user_assets=function(user){obj[user]=[],FA.Background.assets.each(function(asset){var domain=asset.get("domain");obj[user].indexOf(domain)<0&&obj[user].push(domain)}),self.save_obj()},this.update_user=function(user){void 0!=user&&void 0==obj[user]&&(obj[user]=[],self.save_obj())},this.init=function(new_obj){obj=new_obj||{}};var obj=this.obj=this.get_obj()}},{"../persistence/utils.js":140}],145:[function(require,module,exports){(function(process,global){!function(e){if("object"==typeof exports&&void 0!==module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:void 0!==global?f=global:"undefined"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof _dereq_&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof _dereq_&&_dereq_,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function any(promises){var ret=new SomePromiseArray(promises),promise=ret.promise();return ret.setHowMany(1),ret.setUnwrap(),ret.init(),promise}var SomePromiseArray=Promise._SomePromiseArray;Promise.any=function(promises){return any(promises)},Promise.prototype.any=function(){return any(this)}}},{}],2:[function(_dereq_,module,exports){"use strict";function Async(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new Queue(16),this._normalQueue=new Queue(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var self=this;this.drainQueues=function(){self._drainQueues()},this._schedule=schedule}function AsyncInvokeLater(fn,receiver,arg){this._lateQueue.push(fn,receiver,arg),this._queueTick()}function AsyncInvoke(fn,receiver,arg){this._normalQueue.push(fn,receiver,arg),this._queueTick()}function AsyncSettlePromises(promise){this._normalQueue._pushOne(promise),this._queueTick()}var firstLineError;try{throw new Error}catch(e){firstLineError=e}var schedule=_dereq_("./schedule"),Queue=_dereq_("./queue"),util=_dereq_("./util");Async.prototype.setScheduler=function(fn){var prev=this._schedule;return this._schedule=fn,this._customScheduler=!0,prev},Async.prototype.hasCustomScheduler=function(){return this._customScheduler},Async.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},Async.prototype.disableTrampolineIfNecessary=function(){util.hasDevTools&&(this._trampolineEnabled=!1)},Async.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},Async.prototype.fatalError=function(e,isNode){isNode?(process.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),process.exit(2)):this.throwLater(e)},Async.prototype.throwLater=function(fn,arg){if(1===arguments.length&&(arg=fn,fn=function(){throw arg}),"undefined"!=typeof setTimeout)setTimeout(function(){fn(arg)},0);else try{this._schedule(function(){fn(arg)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},util.hasDevTools?(Async.prototype.invokeLater=function(fn,receiver,arg){this._trampolineEnabled?AsyncInvokeLater.call(this,fn,receiver,arg):this._schedule(function(){setTimeout(function(){fn.call(receiver,arg)},100)})},Async.prototype.invoke=function(fn,receiver,arg){this._trampolineEnabled?AsyncInvoke.call(this,fn,receiver,arg):this._schedule(function(){fn.call(receiver,arg)})},Async.prototype.settlePromises=function(promise){this._trampolineEnabled?AsyncSettlePromises.call(this,promise):this._schedule(function(){promise._settlePromises()})}):(Async.prototype.invokeLater=AsyncInvokeLater,Async.prototype.invoke=AsyncInvoke,Async.prototype.settlePromises=AsyncSettlePromises),Async.prototype.invokeFirst=function(fn,receiver,arg){this._normalQueue.unshift(fn,receiver,arg),this._queueTick()},Async.prototype._drainQueue=function(queue){for(;queue.length()>0;){var fn=queue.shift();if("function"==typeof fn){var receiver=queue.shift(),arg=queue.shift();fn.call(receiver,arg)}else fn._settlePromises()}},Async.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},Async.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},Async.prototype._reset=function(){this._isTickUsed=!1},module.exports=Async,module.exports.firstLineError=firstLineError},{"./queue":26,"./schedule":29,"./util":36}],3:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,debug){var calledBind=!1,rejectThis=function(_,e){this._reject(e)},targetRejected=function(e,context){context.promiseRejectionQueued=!0,context.bindingPromise._then(rejectThis,rejectThis,null,this,e)},bindingResolved=function(thisArg,context){0===(50397184&this._bitField)&&this._resolveCallback(context.target)},bindingRejected=function(e,context){context.promiseRejectionQueued||this._reject(e)};Promise.prototype.bind=function(thisArg){calledBind||(calledBind=!0,Promise.prototype._propagateFrom=debug.propagateFromFunction(),Promise.prototype._boundValue=debug.boundValueFunction());var maybePromise=tryConvertToPromise(thisArg),ret=new Promise(INTERNAL);ret._propagateFrom(this,1);var target=this._target();if(ret._setBoundTo(maybePromise),maybePromise instanceof Promise){var context={promiseRejectionQueued:!1,promise:ret,target:target,bindingPromise:maybePromise};target._then(INTERNAL,targetRejected,void 0,ret,context),maybePromise._then(bindingResolved,bindingRejected,void 0,ret,context),ret._setOnCancel(maybePromise)}else ret._resolveCallback(target);return ret},Promise.prototype._setBoundTo=function(obj){void 0!==obj?(this._bitField=2097152|this._bitField,this._boundTo=obj):this._bitField=this._bitField&-2097153},Promise.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},Promise.bind=function(thisArg,value){return Promise.resolve(value).bind(thisArg)}}},{}],4:[function(_dereq_,module,exports){"use strict";function noConflict(){try{Promise===bluebird&&(Promise=old)}catch(e){}return bluebird}var old;"undefined"!=typeof Promise&&(old=Promise);var bluebird=_dereq_("./promise")();bluebird.noConflict=noConflict,module.exports=bluebird},{"./promise":22}],5:[function(_dereq_,module,exports){"use strict";var cr=Object.create;if(cr){var callerCache=cr(null),getterCache=cr(null);callerCache[" size"]=getterCache[" size"]=0}module.exports=function(Promise){function ensureMethod(obj,methodName){var fn;if(null!=obj&&(fn=obj[methodName]),"function"!=typeof fn){var message="Object "+util.classString(obj)+" has no method '"+util.toString(methodName)+"'";throw new Promise.TypeError(message)}return fn}function caller(obj){return ensureMethod(obj,this.pop()).apply(obj,this)}function namedGetter(obj){return obj[this]}function indexedGetter(obj){var index=+this;return index<0&&(index=Math.max(0,index+obj.length)),obj[index]}var getGetter,util=_dereq_("./util"),canEvaluate=util.canEvaluate;util.isIdentifier;Promise.prototype.call=function(methodName){var args=[].slice.call(arguments,1);return args.push(methodName),this._then(caller,void 0,void 0,args,void 0)},Promise.prototype.get=function(propertyName){var getter,isIndex="number"==typeof propertyName;if(isIndex)getter=indexedGetter;else if(canEvaluate){var maybeGetter=getGetter(propertyName);getter=null!==maybeGetter?maybeGetter:namedGetter}else getter=namedGetter;return this._then(getter,void 0,void 0,propertyName,void 0)}}},{"./util":36}],6:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,debug){var util=_dereq_("./util"),tryCatch=util.tryCatch,errorObj=util.errorObj,async=Promise._async;Promise.prototype["break"]=Promise.prototype.cancel=function(){if(!debug.cancellation())return this._warn("cancellation is disabled");for(var promise=this,child=promise;promise.isCancellable();){if(!promise._cancelBy(child)){child._isFollowing()?child._followee().cancel():child._cancelBranched();break}var parent=promise._cancellationParent;if(null==parent||!parent.isCancellable()){promise._isFollowing()?promise._followee().cancel():promise._cancelBranched();break}promise._isFollowing()&&promise._followee().cancel(),child=promise,promise=parent}},Promise.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},Promise.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},Promise.prototype._cancelBy=function(canceller){return canceller===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},Promise.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},Promise.prototype._cancel=function(){this.isCancellable()&&(this._setCancelled(),async.invoke(this._cancelPromises,this,void 0))},Promise.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},Promise.prototype._unsetOnCancel=function(){this._onCancelField=void 0},Promise.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},Promise.prototype._doInvokeOnCancel=function(onCancelCallback,internalOnly){if(util.isArray(onCancelCallback))for(var i=0;i<onCancelCallback.length;++i)this._doInvokeOnCancel(onCancelCallback[i],internalOnly);else if(void 0!==onCancelCallback)if("function"==typeof onCancelCallback){if(!internalOnly){var e=tryCatch(onCancelCallback).call(this._boundValue());e===errorObj&&(this._attachExtraTrace(e.e),async.throwLater(e.e))}}else onCancelCallback._resultCancelled(this)},Promise.prototype._invokeOnCancel=function(){var onCancelCallback=this._onCancel();this._unsetOnCancel(),async.invoke(this._doInvokeOnCancel,this,onCancelCallback)},Promise.prototype._invokeInternalOnCancel=function(){this.isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},Promise.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(_dereq_,module,exports){"use strict";module.exports=function(NEXT_FILTER){function catchFilter(instances,cb,promise){return function(e){var boundTo=promise._boundValue();predicateLoop:for(var i=0;i<instances.length;++i){var item=instances[i];if(item===Error||null!=item&&item.prototype instanceof Error){if(e instanceof item)return tryCatch(cb).call(boundTo,e)}else if("function"==typeof item){var matchesPredicate=tryCatch(item).call(boundTo,e);if(matchesPredicate===errorObj)return matchesPredicate;if(matchesPredicate)return tryCatch(cb).call(boundTo,e)}else if(util.isObject(e)){for(var keys=getKeys(item),j=0;j<keys.length;++j){var key=keys[j];if(item[key]!=e[key])continue predicateLoop}return tryCatch(cb).call(boundTo,e)}}return NEXT_FILTER}}var util=_dereq_("./util"),getKeys=_dereq_("./es5").keys,tryCatch=util.tryCatch,errorObj=util.errorObj;return catchFilter}},{"./es5":13,"./util":36}],8:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function Context(){this._trace=new Context.CapturedTrace(peekContext())}function createContext(){if(longStackTraces)return new Context}function peekContext(){var lastIndex=contextStack.length-1;if(lastIndex>=0)return contextStack[lastIndex]}var longStackTraces=!1,contextStack=[];return Promise.prototype._promiseCreated=function(){},Promise.prototype._pushContext=function(){},Promise.prototype._popContext=function(){return null},Promise._peekContext=Promise.prototype._peekContext=function(){},Context.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,contextStack.push(this._trace))},Context.prototype._popContext=function(){if(void 0!==this._trace){var trace=contextStack.pop(),ret=trace._promiseCreated;return trace._promiseCreated=null,ret}return null},Context.CapturedTrace=null,Context.create=createContext,Context.deactivateLongStackTraces=function(){},Context.activateLongStackTraces=function(){var Promise_pushContext=Promise.prototype._pushContext,Promise_popContext=Promise.prototype._popContext,Promise_PeekContext=Promise._peekContext,Promise_peekContext=Promise.prototype._peekContext,Promise_promiseCreated=Promise.prototype._promiseCreated;Context.deactivateLongStackTraces=function(){Promise.prototype._pushContext=Promise_pushContext,Promise.prototype._popContext=Promise_popContext,Promise._peekContext=Promise_PeekContext,Promise.prototype._peekContext=Promise_peekContext,Promise.prototype._promiseCreated=Promise_promiseCreated,longStackTraces=!1},longStackTraces=!0,Promise.prototype._pushContext=Context.prototype._pushContext,Promise.prototype._popContext=Context.prototype._popContext,Promise._peekContext=Promise.prototype._peekContext=peekContext,
Promise.prototype._promiseCreated=function(){var ctx=this._peekContext();ctx&&null==ctx._promiseCreated&&(ctx._promiseCreated=this)}},Context}},{}],9:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,Context){function generatePromiseLifecycleEventObject(name,promise){return{promise:promise}}function defaultFireEvent(){return!1}function cancellationExecute(executor,resolve,reject){var promise=this;try{executor(resolve,reject,function(onCancel){if("function"!=typeof onCancel)throw new TypeError("onCancel must be a function, got: "+util.toString(onCancel));promise._attachCancellationCallback(onCancel)})}catch(e){return e}}function cancellationAttachCancellationCallback(onCancel){if(!this.isCancellable())return this;var previousOnCancel=this._onCancel();void 0!==previousOnCancel?util.isArray(previousOnCancel)?previousOnCancel.push(onCancel):this._setOnCancel([previousOnCancel,onCancel]):this._setOnCancel(onCancel)}function cancellationOnCancel(){return this._onCancelField}function cancellationSetOnCancel(onCancel){this._onCancelField=onCancel}function cancellationClearCancellationData(){this._cancellationParent=void 0,this._onCancelField=void 0}function cancellationPropagateFrom(parent,flags){if(0!==(1&flags)){this._cancellationParent=parent;var branchesRemainingToCancel=parent._branchesRemainingToCancel;void 0===branchesRemainingToCancel&&(branchesRemainingToCancel=0),parent._branchesRemainingToCancel=branchesRemainingToCancel+1}0!==(2&flags)&&parent._isBound()&&this._setBoundTo(parent._boundTo)}function bindingPropagateFrom(parent,flags){0!==(2&flags)&&parent._isBound()&&this._setBoundTo(parent._boundTo)}function boundValueFunction(){var ret=this._boundTo;return void 0!==ret&&ret instanceof Promise?ret.isFulfilled()?ret.value():void 0:ret}function longStackTracesCaptureStackTrace(){this._trace=new CapturedTrace(this._peekContext())}function longStackTracesAttachExtraTrace(error,ignoreSelf){if(canAttachTrace(error)){var trace=this._trace;if(void 0!==trace&&ignoreSelf&&(trace=trace._parent),void 0!==trace)trace.attachExtraTrace(error);else if(!error.__stackCleaned__){var parsed=parseStackAndMessage(error);util.notEnumerableProp(error,"stack",parsed.message+"\n"+parsed.stack.join("\n")),util.notEnumerableProp(error,"__stackCleaned__",!0)}}}function checkForgottenReturns(returnValue,promiseCreated,name,promise,parent){if(void 0===returnValue&&null!==promiseCreated&&wForgottenReturn){if(void 0!==parent&&parent._returnedNonUndefined())return;if(0===(65535&promise._bitField))return;name&&(name+=" ");var msg="a promise was created in a "+name+"handler but was not returned from it";promise._warn(msg,!0,promiseCreated)}}function deprecated(name,replacement){var message=name+" is deprecated and will be removed in a future version.";return replacement&&(message+=" Use "+replacement+" instead."),warn(message)}function warn(message,shouldUseOwnTrace,promise){if(config.warnings){var ctx,warning=new Warning(message);if(shouldUseOwnTrace)promise._attachExtraTrace(warning);else if(config.longStackTraces&&(ctx=Promise._peekContext()))ctx.attachExtraTrace(warning);else{var parsed=parseStackAndMessage(warning);warning.stack=parsed.message+"\n"+parsed.stack.join("\n")}activeFireEvent("warning",warning)||formatAndLogError(warning,"",!0)}}function reconstructStack(message,stacks){for(var i=0;i<stacks.length-1;++i)stacks[i].push("From previous event:"),stacks[i]=stacks[i].join("\n");return i<stacks.length&&(stacks[i]=stacks[i].join("\n")),message+"\n"+stacks.join("\n")}function removeDuplicateOrEmptyJumps(stacks){for(var i=0;i<stacks.length;++i)(0===stacks[i].length||i+1<stacks.length&&stacks[i][0]===stacks[i+1][0])&&(stacks.splice(i,1),i--)}function removeCommonRoots(stacks){for(var current=stacks[0],i=1;i<stacks.length;++i){for(var prev=stacks[i],currentLastIndex=current.length-1,currentLastLine=current[currentLastIndex],commonRootMeetPoint=-1,j=prev.length-1;j>=0;--j)if(prev[j]===currentLastLine){commonRootMeetPoint=j;break}for(var j=commonRootMeetPoint;j>=0;--j){var line=prev[j];if(current[currentLastIndex]!==line)break;current.pop(),currentLastIndex--}current=prev}}function cleanStack(stack){for(var ret=[],i=0;i<stack.length;++i){var line=stack[i],isTraceLine="    (No stack trace)"===line||stackFramePattern.test(line),isInternalFrame=isTraceLine&&shouldIgnore(line);isTraceLine&&!isInternalFrame&&(indentStackFrames&&" "!==line.charAt(0)&&(line="    "+line),ret.push(line))}return ret}function stackFramesAsArray(error){for(var stack=error.stack.replace(/\s+$/g,"").split("\n"),i=0;i<stack.length;++i){var line=stack[i];if("    (No stack trace)"===line||stackFramePattern.test(line))break}return i>0&&(stack=stack.slice(i)),stack}function parseStackAndMessage(error){var stack=error.stack,message=error.toString();return stack="string"==typeof stack&&stack.length>0?stackFramesAsArray(error):["    (No stack trace)"],{message:message,stack:cleanStack(stack)}}function formatAndLogError(error,title,isSoft){if("undefined"!=typeof console){var message;if(util.isObject(error)){message=title+formatStack(error.stack,error)}else message=title+String(error);"function"==typeof printWarning?printWarning(message,isSoft):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(message)}}function fireRejectionEvent(name,localHandler,reason,promise){var localEventFired=!1;try{"function"==typeof localHandler&&(localEventFired=!0,"rejectionHandled"===name?localHandler(promise):localHandler(reason,promise))}catch(e){async.throwLater(e)}"unhandledRejection"===name?activeFireEvent(name,reason,promise)||localEventFired||formatAndLogError(reason,"Unhandled rejection "):activeFireEvent(name,promise)}function formatNonError(obj){var str;if("function"==typeof obj)str="[function "+(obj.name||"anonymous")+"]";else{str=obj&&"function"==typeof obj.toString?obj.toString():util.toString(obj);if(/\[object [a-zA-Z0-9$_]+\]/.test(str))try{str=JSON.stringify(obj)}catch(e){}0===str.length&&(str="(empty array)")}return"(<"+snip(str)+">, no stack trace)"}function snip(str){return str.length<41?str:str.substr(0,38)+"..."}function longStackTracesIsSupported(){return"function"==typeof captureStackTrace}function parseLineInfo(line){var matches=line.match(/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/);if(matches)return{fileName:matches[1],line:parseInt(matches[2],10)}}function setBounds(firstLineError,lastLineError){if(longStackTracesIsSupported()){for(var firstFileName,lastFileName,firstStackLines=firstLineError.stack.split("\n"),lastStackLines=lastLineError.stack.split("\n"),firstIndex=-1,lastIndex=-1,i=0;i<firstStackLines.length;++i){var result=parseLineInfo(firstStackLines[i]);if(result){firstFileName=result.fileName,firstIndex=result.line;break}}for(var i=0;i<lastStackLines.length;++i){var result=parseLineInfo(lastStackLines[i]);if(result){lastFileName=result.fileName,lastIndex=result.line;break}}firstIndex<0||lastIndex<0||!firstFileName||!lastFileName||firstFileName!==lastFileName||firstIndex>=lastIndex||(shouldIgnore=function(line){if(bluebirdFramePattern.test(line))return!0;var info=parseLineInfo(line);return!!(info&&info.fileName===firstFileName&&firstIndex<=info.line&&info.line<=lastIndex)})}}function CapturedTrace(parent){this._parent=parent,this._promisesCreated=0;var length=this._length=1+(void 0===parent?0:parent._length);captureStackTrace(this,CapturedTrace),length>32&&this.uncycle()}var unhandledRejectionHandled,possiblyUnhandledRejection,printWarning,getDomain=Promise._getDomain,async=Promise._async,Warning=_dereq_("./errors").Warning,util=_dereq_("./util"),canAttachTrace=util.canAttachTrace,bluebirdFramePattern=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,stackFramePattern=null,formatStack=null,indentStackFrames=!1,debugging=!(0==util.env("BLUEBIRD_DEBUG")),warnings=!(0==util.env("BLUEBIRD_WARNINGS")||!debugging&&!util.env("BLUEBIRD_WARNINGS")),longStackTraces=!(0==util.env("BLUEBIRD_LONG_STACK_TRACES")||!debugging&&!util.env("BLUEBIRD_LONG_STACK_TRACES")),wForgottenReturn=0!=util.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(warnings||!!util.env("BLUEBIRD_W_FORGOTTEN_RETURN"));Promise.prototype.suppressUnhandledRejections=function(){var target=this._target();target._bitField=target._bitField&-1048577|524288},Promise.prototype._ensurePossibleRejectionHandled=function(){0===(524288&this._bitField)&&(this._setRejectionIsUnhandled(),async.invokeLater(this._notifyUnhandledRejection,this,void 0))},Promise.prototype._notifyUnhandledRejectionIsHandled=function(){fireRejectionEvent("rejectionHandled",unhandledRejectionHandled,void 0,this)},Promise.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},Promise.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._settledValue();this._setUnhandledRejectionIsNotified(),fireRejectionEvent("unhandledRejection",possiblyUnhandledRejection,reason,this)}},Promise.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},Promise.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},Promise.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},Promise.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},Promise.prototype._warn=function(message,shouldUseOwnTrace,promise){return warn(message,shouldUseOwnTrace,promise||this)},Promise.onPossiblyUnhandledRejection=function(fn){var domain=getDomain();possiblyUnhandledRejection="function"==typeof fn?null===domain?fn:domain.bind(fn):void 0},Promise.onUnhandledRejectionHandled=function(fn){var domain=getDomain();unhandledRejectionHandled="function"==typeof fn?null===domain?fn:domain.bind(fn):void 0};var disableLongStackTraces=function(){};Promise.longStackTraces=function(){if(async.haveItemsQueued()&&!config.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!config.longStackTraces&&longStackTracesIsSupported()){var Promise_captureStackTrace=Promise.prototype._captureStackTrace,Promise_attachExtraTrace=Promise.prototype._attachExtraTrace;config.longStackTraces=!0,disableLongStackTraces=function(){if(async.haveItemsQueued()&&!config.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");Promise.prototype._captureStackTrace=Promise_captureStackTrace,Promise.prototype._attachExtraTrace=Promise_attachExtraTrace,Context.deactivateLongStackTraces(),async.enableTrampoline(),config.longStackTraces=!1},Promise.prototype._captureStackTrace=longStackTracesCaptureStackTrace,Promise.prototype._attachExtraTrace=longStackTracesAttachExtraTrace,Context.activateLongStackTraces(),async.disableTrampolineIfNecessary()}},Promise.hasLongStackTraces=function(){return config.longStackTraces&&longStackTracesIsSupported()};var fireDomEvent=function(){try{var event=document.createEvent("CustomEvent");return event.initCustomEvent("testingtheevent",!1,!0,{}),util.global.dispatchEvent(event),function(name,event){var domEvent=document.createEvent("CustomEvent");return domEvent.initCustomEvent(name.toLowerCase(),!1,!0,event),!util.global.dispatchEvent(domEvent)}}catch(e){}return function(){return!1}}(),fireGlobalEvent=function(){return util.isNode?function(){return process.emit.apply(process,arguments)}:util.global?function(name){var methodName="on"+name.toLowerCase(),method=util.global[methodName];return!!method&&(method.apply(util.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),eventToObjectGenerator={promiseCreated:generatePromiseLifecycleEventObject,promiseFulfilled:generatePromiseLifecycleEventObject,promiseRejected:generatePromiseLifecycleEventObject,promiseResolved:generatePromiseLifecycleEventObject,promiseCancelled:generatePromiseLifecycleEventObject,promiseChained:function(name,promise,child){return{promise:promise,child:child}},warning:function(name,warning){return{warning:warning}},unhandledRejection:function(name,reason,promise){return{reason:reason,promise:promise}},rejectionHandled:generatePromiseLifecycleEventObject},activeFireEvent=function(name){var globalEventFired=!1;try{globalEventFired=fireGlobalEvent.apply(null,arguments)}catch(e){async.throwLater(e),globalEventFired=!0}var domEventFired=!1;try{domEventFired=fireDomEvent(name,eventToObjectGenerator[name].apply(null,arguments))}catch(e){async.throwLater(e),domEventFired=!0}return domEventFired||globalEventFired};Promise.config=function(opts){if(opts=Object(opts),"longStackTraces"in opts&&(opts.longStackTraces?Promise.longStackTraces():!opts.longStackTraces&&Promise.hasLongStackTraces()&&disableLongStackTraces()),"warnings"in opts){var warningsOption=opts.warnings;config.warnings=!!warningsOption,wForgottenReturn=config.warnings,util.isObject(warningsOption)&&"wForgottenReturn"in warningsOption&&(wForgottenReturn=!!warningsOption.wForgottenReturn)}if("cancellation"in opts&&opts.cancellation&&!config.cancellation){if(async.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");Promise.prototype._clearCancellationData=cancellationClearCancellationData,Promise.prototype._propagateFrom=cancellationPropagateFrom,Promise.prototype._onCancel=cancellationOnCancel,Promise.prototype._setOnCancel=cancellationSetOnCancel,Promise.prototype._attachCancellationCallback=cancellationAttachCancellationCallback,Promise.prototype._execute=cancellationExecute,propagateFromFunction=cancellationPropagateFrom,config.cancellation=!0}"monitoring"in opts&&(opts.monitoring&&!config.monitoring?(config.monitoring=!0,Promise.prototype._fireEvent=activeFireEvent):!opts.monitoring&&config.monitoring&&(config.monitoring=!1,Promise.prototype._fireEvent=defaultFireEvent))},Promise.prototype._fireEvent=defaultFireEvent,Promise.prototype._execute=function(executor,resolve,reject){try{executor(resolve,reject)}catch(e){return e}},Promise.prototype._onCancel=function(){},Promise.prototype._setOnCancel=function(handler){},Promise.prototype._attachCancellationCallback=function(onCancel){},Promise.prototype._captureStackTrace=function(){},Promise.prototype._attachExtraTrace=function(){},Promise.prototype._clearCancellationData=function(){},Promise.prototype._propagateFrom=function(parent,flags){};var propagateFromFunction=bindingPropagateFrom,shouldIgnore=function(){return!1};util.inherits(CapturedTrace,Error),Context.CapturedTrace=CapturedTrace,CapturedTrace.prototype.uncycle=function(){var length=this._length;if(!(length<2)){for(var nodes=[],stackToIndex={},i=0,node=this;void 0!==node;++i)nodes.push(node),node=node._parent;length=this._length=i;for(var i=length-1;i>=0;--i){var stack=nodes[i].stack;void 0===stackToIndex[stack]&&(stackToIndex[stack]=i)}for(var i=0;i<length;++i){var currentStack=nodes[i].stack,index=stackToIndex[currentStack];if(void 0!==index&&index!==i){index>0&&(nodes[index-1]._parent=void 0,nodes[index-1]._length=1),nodes[i]._parent=void 0,nodes[i]._length=1;var cycleEdgeNode=i>0?nodes[i-1]:this;index<length-1?(cycleEdgeNode._parent=nodes[index+1],cycleEdgeNode._parent.uncycle(),cycleEdgeNode._length=cycleEdgeNode._parent._length+1):(cycleEdgeNode._parent=void 0,cycleEdgeNode._length=1);for(var currentChildLength=cycleEdgeNode._length+1,j=i-2;j>=0;--j)nodes[j]._length=currentChildLength,currentChildLength++;return}}}},CapturedTrace.prototype.attachExtraTrace=function(error){if(!error.__stackCleaned__){this.uncycle();for(var parsed=parseStackAndMessage(error),message=parsed.message,stacks=[parsed.stack],trace=this;void 0!==trace;)stacks.push(cleanStack(trace.stack.split("\n"))),trace=trace._parent;removeCommonRoots(stacks),removeDuplicateOrEmptyJumps(stacks),util.notEnumerableProp(error,"stack",reconstructStack(message,stacks)),util.notEnumerableProp(error,"__stackCleaned__",!0)}};var captureStackTrace=function(){var v8stackFormatter=function(stack,error){return"string"==typeof stack?stack:void 0!==error.name&&void 0!==error.message?error.toString():formatNonError(error)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,stackFramePattern=/^\s*at\s*/,formatStack=v8stackFormatter;var captureStackTrace=Error.captureStackTrace;return shouldIgnore=function(line){return bluebirdFramePattern.test(line)},function(receiver,ignoreUntil){Error.stackTraceLimit+=6,captureStackTrace(receiver,ignoreUntil),Error.stackTraceLimit-=6}}var err=new Error;if("string"==typeof err.stack&&err.stack.split("\n")[0].indexOf("stackDetection@")>=0)return stackFramePattern=/@/,formatStack=v8stackFormatter,indentStackFrames=!0,function(o){o.stack=(new Error).stack};var hasStackAfterThrow;try{throw new Error}catch(e){hasStackAfterThrow="stack"in e}return"stack"in err||!hasStackAfterThrow||"number"!=typeof Error.stackTraceLimit?(formatStack=function(stack,error){return"string"==typeof stack?stack:"object"!=typeof error&&"function"!=typeof error||void 0===error.name||void 0===error.message?formatNonError(error):error.toString()},null):(stackFramePattern=/^\s*at\s*/,formatStack=v8stackFormatter,function(o){Error.stackTraceLimit+=6;try{throw new Error}catch(e){o.stack=e.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(printWarning=function(message){console.warn(message)},util.isNode&&process.stderr.isTTY?printWarning=function(message,isSoft){var color=isSoft?"[33m":"[31m";console.warn(color+message+"[0m\n")}:util.isNode||"string"!=typeof(new Error).stack||(printWarning=function(message,isSoft){console.warn("%c"+message,isSoft?"color: darkorange":"color: red")}));var config={warnings:warnings,longStackTraces:!1,cancellation:!1,monitoring:!1};return longStackTraces&&Promise.longStackTraces(),{longStackTraces:function(){return config.longStackTraces},warnings:function(){return config.warnings},cancellation:function(){return config.cancellation},monitoring:function(){return config.monitoring},propagateFromFunction:function(){return propagateFromFunction},boundValueFunction:function(){return boundValueFunction},checkForgottenReturns:checkForgottenReturns,setBounds:setBounds,warn:warn,deprecated:deprecated,CapturedTrace:CapturedTrace,fireDomEvent:fireDomEvent,fireGlobalEvent:fireGlobalEvent}}},{"./errors":12,"./util":36}],10:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function returner(){return this.value}function thrower(){throw this.reason}Promise.prototype["return"]=Promise.prototype.thenReturn=function(value){return value instanceof Promise&&value.suppressUnhandledRejections(),this._then(returner,void 0,void 0,{value:value},void 0)},Promise.prototype["throw"]=Promise.prototype.thenThrow=function(reason){return this._then(thrower,void 0,void 0,{reason:reason},void 0)},Promise.prototype.catchThrow=function(reason){if(arguments.length<=1)return this._then(void 0,thrower,void 0,{reason:reason},void 0);var _reason=arguments[1],handler=function(){throw _reason};return this.caught(reason,handler)},Promise.prototype.catchReturn=function(value){if(arguments.length<=1)return value instanceof Promise&&value.suppressUnhandledRejections(),this._then(void 0,returner,void 0,{value:value},void 0);var _value=arguments[1];_value instanceof Promise&&_value.suppressUnhandledRejections();var handler=function(){return _value};return this.caught(value,handler)}}},{}],11:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function promiseAllThis(){return PromiseAll(this)}function PromiseMapSeries(promises,fn){return PromiseReduce(promises,fn,INTERNAL,INTERNAL)}var PromiseReduce=Promise.reduce,PromiseAll=Promise.all;Promise.prototype.each=function(fn){return this.mapSeries(fn)._then(promiseAllThis,void 0,void 0,this,void 0)},Promise.prototype.mapSeries=function(fn){return PromiseReduce(this,fn,INTERNAL,INTERNAL)},Promise.each=function(promises,fn){return PromiseMapSeries(promises,fn)._then(promiseAllThis,void 0,void 0,promises,void 0)},Promise.mapSeries=PromiseMapSeries}},{}],12:[function(_dereq_,module,exports){"use strict";function subError(nameProperty,defaultMessage){function SubError(message){if(!(this instanceof SubError))return new SubError(message);notEnumerableProp(this,"message","string"==typeof message?message:defaultMessage),notEnumerableProp(this,"name",nameProperty),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return inherits(SubError,Error),SubError}function OperationalError(message){if(!(this instanceof OperationalError))return new OperationalError(message);notEnumerableProp(this,"name","OperationalError"),notEnumerableProp(this,"message",message),this.cause=message,this.isOperational=!0,message instanceof Error?(notEnumerableProp(this,"message",message.message),notEnumerableProp(this,"stack",message.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var _TypeError,_RangeError,es5=_dereq_("./es5"),Objectfreeze=es5.freeze,util=_dereq_("./util"),inherits=util.inherits,notEnumerableProp=util.notEnumerableProp,Warning=subError("Warning","warning"),CancellationError=subError("CancellationError","cancellation error"),TimeoutError=subError("TimeoutError","timeout error"),AggregateError=subError("AggregateError","aggregate error");try{_TypeError=TypeError,_RangeError=RangeError}catch(e){_TypeError=subError("TypeError","type error"),_RangeError=subError("RangeError","range error")}for(var methods="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),i=0;i<methods.length;++i)"function"==typeof Array.prototype[methods[i]]&&(AggregateError.prototype[methods[i]]=Array.prototype[methods[i]]);es5.defineProperty(AggregateError.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),AggregateError.prototype.isOperational=!0;var level=0;AggregateError.prototype.toString=function(){var indent=Array(4*level+1).join(" "),ret="\n"+indent+"AggregateError of:\n";level++,indent=Array(4*level+1).join(" ");for(var i=0;i<this.length;++i){for(var str=this[i]===this?"[Circular AggregateError]":this[i]+"",lines=str.split("\n"),j=0;j<lines.length;++j)lines[j]=indent+lines[j];str=lines.join("\n"),ret+=str+"\n"}return level--,ret},inherits(OperationalError,Error);var errorTypes=Error.__BluebirdErrorTypes__;errorTypes||(errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,OperationalError:OperationalError,RejectionError:OperationalError,AggregateError:AggregateError}),es5.defineProperty(Error,"__BluebirdErrorTypes__",{value:errorTypes,writable:!1,enumerable:!1,configurable:!1})),module.exports={Error:Error,TypeError:_TypeError,RangeError:_RangeError,CancellationError:errorTypes.CancellationError,OperationalError:errorTypes.OperationalError,TimeoutError:errorTypes.TimeoutError,AggregateError:errorTypes.AggregateError,Warning:Warning}},{"./es5":13,"./util":36}],13:[function(_dereq_,module,exports){var isES5=function(){"use strict";return void 0===this}();if(isES5)module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5,propertyIsWritable:function(obj,prop){var descriptor=Object.getOwnPropertyDescriptor(obj,prop);return!(descriptor&&!descriptor.writable&&!descriptor.set)}};else{var has={}.hasOwnProperty,str={}.toString,proto={}.constructor.prototype,ObjectKeys=function(o){var ret=[];for(var key in o)has.call(o,key)&&ret.push(key);return ret},ObjectGetDescriptor=function(o,key){return{value:o[key]}},ObjectDefineProperty=function(o,key,desc){return o[key]=desc.value,o},ObjectFreeze=function(obj){return obj},ObjectGetPrototypeOf=function(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}},ArrayIsArray=function(obj){try{return"[object Array]"===str.call(obj)}catch(e){return!1}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,names:ObjectKeys,defineProperty:ObjectDefineProperty,getDescriptor:ObjectGetDescriptor,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5,propertyIsWritable:function(){return!0}}}},{}],14:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseMap=Promise.map;Promise.prototype.filter=function(fn,options){return PromiseMap(this,fn,options,INTERNAL)},Promise.filter=function(promises,fn,options){return PromiseMap(promises,fn,options,INTERNAL)}}},{}],15:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,tryConvertToPromise){function PassThroughHandlerContext(promise,type,handler){this.promise=promise,this.type=type,this.handler=handler,this.called=!1,this.cancelPromise=null}function FinallyHandlerCancelReaction(finallyHandler){this.finallyHandler=finallyHandler}function checkCancel(ctx,reason){return null!=ctx.cancelPromise&&(arguments.length>1?ctx.cancelPromise._reject(reason):ctx.cancelPromise._cancel(),ctx.cancelPromise=null,!0)}function succeed(){return finallyHandler.call(this,this.promise._target()._settledValue())}function fail(reason){if(!checkCancel(this,reason))return errorObj.e=reason,errorObj}function finallyHandler(reasonOrValue){var promise=this.promise,handler=this.handler;if(!this.called){this.called=!0;var ret=this.isFinallyHandler()?handler.call(promise._boundValue()):handler.call(promise._boundValue(),reasonOrValue);if(void 0!==ret){promise._setReturnedNonUndefined();var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise){if(null!=this.cancelPromise){if(maybePromise.isCancelled()){var reason=new CancellationError("late cancellation observer");return promise._attachExtraTrace(reason),errorObj.e=reason,errorObj}maybePromise.isPending()&&maybePromise._attachCancellationCallback(new FinallyHandlerCancelReaction(this))}return maybePromise._then(succeed,fail,void 0,this,void 0)}}}return promise.isRejected()?(checkCancel(this),errorObj.e=reasonOrValue,errorObj):(checkCancel(this),reasonOrValue)}var util=_dereq_("./util"),CancellationError=Promise.CancellationError,errorObj=util.errorObj;return PassThroughHandlerContext.prototype.isFinallyHandler=function(){return 0===this.type},FinallyHandlerCancelReaction.prototype._resultCancelled=function(){checkCancel(this.finallyHandler)},Promise.prototype._passThrough=function(handler,type,success,fail){return"function"!=typeof handler?this.then():this._then(success,fail,void 0,new PassThroughHandlerContext(this,type,handler),void 0)},Promise.prototype.lastly=Promise.prototype["finally"]=function(handler){return this._passThrough(handler,0,finallyHandler,finallyHandler)},Promise.prototype.tap=function(handler){return this._passThrough(handler,1,finallyHandler)},PassThroughHandlerContext}},{"./util":36}],16:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,INTERNAL,tryConvertToPromise,Proxyable,debug){function promiseFromYieldHandler(value,yieldHandlers,traceParent){for(var i=0;i<yieldHandlers.length;++i){traceParent._pushContext();var result=tryCatch(yieldHandlers[i])(value);if(traceParent._popContext(),result===errorObj){traceParent._pushContext();var ret=Promise.reject(errorObj.e);return traceParent._popContext(),ret}var maybePromise=tryConvertToPromise(result,traceParent);if(maybePromise instanceof Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver,yieldHandler,stack){if(debug.cancellation()){var internal=new Promise(INTERNAL),_finallyPromise=this._finallyPromise=new Promise(INTERNAL);this._promise=internal.lastly(function(){return _finallyPromise}),internal._captureStackTrace(),internal._setOnCancel(this)}else{(this._promise=new Promise(INTERNAL))._captureStackTrace()}this._stack=stack,this._generatorFunction=generatorFunction,this._receiver=receiver,this._generator=void 0,this._yieldHandlers="function"==typeof yieldHandler?[yieldHandler].concat(yieldHandlers):yieldHandlers,this._yieldedPromise=null,this._cancellationPhase=!1}var errors=_dereq_("./errors"),TypeError=errors.TypeError,util=_dereq_("./util"),errorObj=util.errorObj,tryCatch=util.tryCatch,yieldHandlers=[];util.inherits(PromiseSpawn,Proxyable),PromiseSpawn.prototype._isResolved=function(){return null===this._promise},PromiseSpawn.prototype._cleanup=function(){this._promise=this._generator=null,debug.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},PromiseSpawn.prototype._promiseCancelled=function(){if(!this._isResolved()){var result,implementsReturn="undefined"!=typeof this._generator["return"];if(implementsReturn)this._promise._pushContext(),result=tryCatch(this._generator["return"]).call(this._generator,void 0),this._promise._popContext();else{var reason=new Promise.CancellationError("generator .return() sentinel");Promise.coroutine.returnSentinel=reason,this._promise._attachExtraTrace(reason),this._promise._pushContext(),result=tryCatch(this._generator["throw"]).call(this._generator,reason),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(result)}},PromiseSpawn.prototype._promiseFulfilled=function(value){this._yieldedPromise=null,this._promise._pushContext();var result=tryCatch(this._generator.next).call(this._generator,value);this._promise._popContext(),this._continue(result)},PromiseSpawn.prototype._promiseRejected=function(reason){this._yieldedPromise=null,this._promise._attachExtraTrace(reason),this._promise._pushContext();var result=tryCatch(this._generator["throw"]).call(this._generator,reason);this._promise._popContext(),this._continue(result)},PromiseSpawn.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof Promise){var promise=this._yieldedPromise;this._yieldedPromise=null,promise.cancel()}},PromiseSpawn.prototype.promise=function(){return this._promise},PromiseSpawn.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},PromiseSpawn.prototype._continue=function(result){var promise=this._promise;if(result===errorObj)return this._cleanup(),this._cancellationPhase?promise.cancel():promise._rejectCallback(result.e,!1);var value=result.value;if(result.done===!0)return this._cleanup(),this._cancellationPhase?promise.cancel():promise._resolveCallback(value);var maybePromise=tryConvertToPromise(value,this._promise);if(!(maybePromise instanceof Promise)&&(maybePromise=promiseFromYieldHandler(maybePromise,this._yieldHandlers,this._promise),null===maybePromise))return void this._promiseRejected(new TypeError("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",value)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));maybePromise=maybePromise._target();var bitField=maybePromise._bitField;0===(50397184&bitField)?(this._yieldedPromise=maybePromise,maybePromise._proxy(this,null)):0!==(33554432&bitField)?this._promiseFulfilled(maybePromise._value()):0!==(16777216&bitField)?this._promiseRejected(maybePromise._reason()):this._promiseCancelled()},Promise.coroutine=function(generatorFunction,options){if("function"!=typeof generatorFunction)throw new TypeError("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var yieldHandler=Object(options).yieldHandler,PromiseSpawn$=PromiseSpawn,stack=(new Error).stack;return function(){
var generator=generatorFunction.apply(this,arguments),spawn=new PromiseSpawn$(void 0,void 0,yieldHandler,stack),ret=spawn.promise();return spawn._generator=generator,spawn._promiseFulfilled(void 0),ret}},Promise.coroutine.addYieldHandler=function(fn){if("function"!=typeof fn)throw new TypeError("expecting a function but got "+util.classString(fn));yieldHandlers.push(fn)},Promise.spawn=function(generatorFunction){if(debug.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof generatorFunction)return apiRejection("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var spawn=new PromiseSpawn(generatorFunction,this),ret=spawn.promise();return spawn._run(Promise.spawn),ret}}},{"./errors":12,"./util":36}],17:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,INTERNAL){var util=_dereq_("./util");util.canEvaluate,util.tryCatch,util.errorObj;Promise.join=function(){var fn,last=arguments.length-1;if(last>0&&"function"==typeof arguments[last]){fn=arguments[last];var ret}var args=[].slice.call(arguments);fn&&args.pop();var ret=new PromiseArray(args).promise();return void 0!==fn?ret.spread(fn):ret}}},{"./util":36}],18:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug){function MappingPromiseArray(promises,fn,limit,_filter){this.constructor$(promises),this._promise._captureStackTrace();var domain=getDomain();this._callback=null===domain?fn:domain.bind(fn),this._preservedValues=_filter===INTERNAL?new Array(this.length()):null,this._limit=limit,this._inFlight=0,this._queue=limit>=1?[]:EMPTY_ARRAY,this._init$(void 0,-2)}function map(promises,fn,options,_filter){if("function"!=typeof fn)return apiRejection("expecting a function but got "+util.classString(fn));var limit=0;if(void 0!==options){if("object"!=typeof options||null===options)return Promise.reject(new TypeError("options argument must be an object but it is "+util.classString(options)));if("number"!=typeof options.concurrency)return Promise.reject(new TypeError("'concurrency' must be a number but it is "+util.classString(options.concurrency)));limit=options.concurrency}return limit="number"==typeof limit&&isFinite(limit)&&limit>=1?limit:0,new MappingPromiseArray(promises,fn,limit,_filter).promise()}var getDomain=Promise._getDomain,util=_dereq_("./util"),tryCatch=util.tryCatch,errorObj=util.errorObj,EMPTY_ARRAY=[];util.inherits(MappingPromiseArray,PromiseArray),MappingPromiseArray.prototype._init=function(){},MappingPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values,length=this.length(),preservedValues=this._preservedValues,limit=this._limit;if(index<0){if(index=index*-1-1,values[index]=value,limit>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(limit>=1&&this._inFlight>=limit)return values[index]=value,this._queue.push(index),!1;null!==preservedValues&&(preservedValues[index]=value);var promise=this._promise,callback=this._callback,receiver=promise._boundValue();promise._pushContext();var ret=tryCatch(callback).call(receiver,value,index,length),promiseCreated=promise._popContext();if(debug.checkForgottenReturns(ret,promiseCreated,null!==preservedValues?"Promise.filter":"Promise.map",promise),ret===errorObj)return this._reject(ret.e),!0;var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();var bitField=maybePromise._bitField;if(0===(50397184&bitField))return limit>=1&&this._inFlight++,values[index]=maybePromise,maybePromise._proxy(this,(index+1)*-1),!1;if(0===(33554432&bitField))return 0!==(16777216&bitField)?(this._reject(maybePromise._reason()),!0):(this._cancel(),!0);ret=maybePromise._value()}values[index]=ret}return++this._totalResolved>=length&&(null!==preservedValues?this._filter(values,preservedValues):this._resolve(values),!0)},MappingPromiseArray.prototype._drainQueue=function(){for(var queue=this._queue,limit=this._limit,values=this._values;queue.length>0&&this._inFlight<limit;){if(this._isResolved())return;var index=queue.pop();this._promiseFulfilled(values[index],index)}},MappingPromiseArray.prototype._filter=function(booleans,values){for(var len=values.length,ret=new Array(len),j=0,i=0;i<len;++i)booleans[i]&&(ret[j++]=values[i]);ret.length=j,this._resolve(ret)},MappingPromiseArray.prototype.preservedValues=function(){return this._preservedValues},Promise.prototype.map=function(fn,options){return map(this,fn,options,null)},Promise.map=function(promises,fn,options,_filter){return map(promises,fn,options,_filter)}}},{"./util":36}],19:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection,debug){var util=_dereq_("./util"),tryCatch=util.tryCatch;Promise.method=function(fn){if("function"!=typeof fn)throw new Promise.TypeError("expecting a function but got "+util.classString(fn));return function(){var ret=new Promise(INTERNAL);ret._captureStackTrace(),ret._pushContext();var value=tryCatch(fn).apply(this,arguments),promiseCreated=ret._popContext();return debug.checkForgottenReturns(value,promiseCreated,"Promise.method",ret),ret._resolveFromSyncValue(value),ret}},Promise.attempt=Promise["try"]=function(fn){if("function"!=typeof fn)return apiRejection("expecting a function but got "+util.classString(fn));var ret=new Promise(INTERNAL);ret._captureStackTrace(),ret._pushContext();var value;if(arguments.length>1){debug.deprecated("calling Promise.try with more than 1 argument");var arg=arguments[1],ctx=arguments[2];value=util.isArray(arg)?tryCatch(fn).apply(ctx,arg):tryCatch(fn).call(ctx,arg)}else value=tryCatch(fn)();var promiseCreated=ret._popContext();return debug.checkForgottenReturns(value,promiseCreated,"Promise.try",ret),ret._resolveFromSyncValue(value),ret},Promise.prototype._resolveFromSyncValue=function(value){value===util.errorObj?this._rejectCallback(value.e,!1):this._resolveCallback(value,!0)}}},{"./util":36}],20:[function(_dereq_,module,exports){"use strict";function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}function wrapAsOperationalError(obj){var ret;if(isUntypedError(obj)){ret=new OperationalError(obj),ret.name=obj.name,ret.message=obj.message,ret.stack=obj.stack;for(var keys=es5.keys(obj),i=0;i<keys.length;++i){var key=keys[i];rErrorKey.test(key)||(ret[key]=obj[key])}return ret}return util.markAsOriginatingFromRejection(obj),obj}function nodebackForPromise(promise,multiArgs){return function(err,value){if(null!==promise){if(err){var wrapped=wrapAsOperationalError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped),promise._reject(wrapped)}else if(multiArgs){var args=[].slice.call(arguments,1);promise._fulfill(args)}else promise._fulfill(value);promise=null}}}var util=_dereq_("./util"),maybeWrapAsError=util.maybeWrapAsError,errors=_dereq_("./errors"),OperationalError=errors.OperationalError,es5=_dereq_("./es5"),rErrorKey=/^(?:name|message|stack|cause)$/;module.exports=nodebackForPromise},{"./errors":12,"./es5":13,"./util":36}],21:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function spreadAdapter(val,nodeback){var promise=this;if(!util.isArray(val))return successAdapter.call(promise,val,nodeback);var ret=tryCatch(nodeback).apply(promise._boundValue(),[null].concat(val));ret===errorObj&&async.throwLater(ret.e)}function successAdapter(val,nodeback){var promise=this,receiver=promise._boundValue(),ret=void 0===val?tryCatch(nodeback).call(receiver,null):tryCatch(nodeback).call(receiver,null,val);ret===errorObj&&async.throwLater(ret.e)}function errorAdapter(reason,nodeback){var promise=this;if(!reason){var newReason=new Error(reason+"");newReason.cause=reason,reason=newReason}var ret=tryCatch(nodeback).call(promise._boundValue(),reason);ret===errorObj&&async.throwLater(ret.e)}var util=_dereq_("./util"),async=Promise._async,tryCatch=util.tryCatch,errorObj=util.errorObj;Promise.prototype.asCallback=Promise.prototype.nodeify=function(nodeback,options){if("function"==typeof nodeback){var adapter=successAdapter;void 0!==options&&Object(options).spread&&(adapter=spreadAdapter),this._then(adapter,errorAdapter,void 0,this,nodeback)}return this}}},{"./util":36}],22:[function(_dereq_,module,exports){"use strict";module.exports=function(){function Proxyable(){}function check(self,executor){if("function"!=typeof executor)throw new TypeError("expecting a function but got "+util.classString(executor));if(self.constructor!==Promise)throw new TypeError("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function Promise(executor){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,executor!==INTERNAL&&(check(this,executor),this._resolveFromExecutor(executor)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function deferResolve(v){this.promise._resolveCallback(v)}function deferReject(v){this.promise._rejectCallback(v,!1)}function fillTypes(value){var p=new Promise(INTERNAL);p._fulfillmentHandler0=value,p._rejectionHandler0=value,p._promise0=value,p._receiver0=value}var getDomain,makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},reflectHandler=function(){return new Promise.PromiseInspection(this._target())},apiRejection=function(msg){return Promise.reject(new TypeError(msg))},UNDEFINED_BINDING={},util=_dereq_("./util");getDomain=util.isNode?function(){var ret=process.domain;return void 0===ret&&(ret=null),ret}:function(){return null},util.notEnumerableProp(Promise,"_getDomain",getDomain);var es5=_dereq_("./es5"),Async=_dereq_("./async"),async=new Async;es5.defineProperty(Promise,"_async",{value:async});var errors=_dereq_("./errors"),TypeError=Promise.TypeError=errors.TypeError;Promise.RangeError=errors.RangeError;var CancellationError=Promise.CancellationError=errors.CancellationError;Promise.TimeoutError=errors.TimeoutError,Promise.OperationalError=errors.OperationalError,Promise.RejectionError=errors.OperationalError,Promise.AggregateError=errors.AggregateError;var INTERNAL=function(){},APPLY={},NEXT_FILTER={},tryConvertToPromise=_dereq_("./thenables")(Promise,INTERNAL),PromiseArray=_dereq_("./promise_array")(Promise,INTERNAL,tryConvertToPromise,apiRejection,Proxyable),Context=_dereq_("./context")(Promise),createContext=Context.create,debug=_dereq_("./debuggability")(Promise,Context),PassThroughHandlerContext=(debug.CapturedTrace,_dereq_("./finally")(Promise,tryConvertToPromise)),catchFilter=_dereq_("./catch_filter")(NEXT_FILTER),nodebackForPromise=_dereq_("./nodeback"),errorObj=util.errorObj,tryCatch=util.tryCatch;return Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.caught=Promise.prototype["catch"]=function(fn){var len=arguments.length;if(len>1){var i,catchInstances=new Array(len-1),j=0;for(i=0;i<len-1;++i){var item=arguments[i];if(!util.isObject(item))return apiRejection("expecting an object but got "+util.classString(item));catchInstances[j++]=item}return catchInstances.length=j,fn=arguments[i],this.then(void 0,catchFilter(catchInstances,fn,this))}return this.then(void 0,fn)},Promise.prototype.reflect=function(){return this._then(reflectHandler,reflectHandler,void 0,this,void 0)},Promise.prototype.then=function(didFulfill,didReject){if(debug.warnings()&&arguments.length>0&&"function"!=typeof didFulfill&&"function"!=typeof didReject){var msg=".then() only accepts functions but was passed: "+util.classString(didFulfill);arguments.length>1&&(msg+=", "+util.classString(didReject)),this._warn(msg)}return this._then(didFulfill,didReject,void 0,void 0,void 0)},Promise.prototype.done=function(didFulfill,didReject){this._then(didFulfill,didReject,void 0,void 0,void 0)._setIsFinal()},Promise.prototype.spread=function(fn){return"function"!=typeof fn?apiRejection("expecting a function but got "+util.classString(fn)):this.all()._then(fn,void 0,void 0,APPLY,void 0)},Promise.prototype.toJSON=function(){var ret={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(ret.fulfillmentValue=this.value(),ret.isFulfilled=!0):this.isRejected()&&(ret.rejectionReason=this.reason(),ret.isRejected=!0),ret},Promise.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new PromiseArray(this).promise()},Promise.prototype.error=function(fn){return this.caught(util.originatesFromRejection,fn)},Promise.getNewLibraryCopy=module.exports,Promise.is=function(val){return val instanceof Promise},Promise.fromNode=Promise.fromCallback=function(fn){var ret=new Promise(INTERNAL);ret._captureStackTrace();var multiArgs=arguments.length>1&&!!Object(arguments[1]).multiArgs,result=tryCatch(fn)(nodebackForPromise(ret,multiArgs));return result===errorObj&&ret._rejectCallback(result.e,!0),ret._isFateSealed()||ret._setAsyncGuaranteed(),ret},Promise.all=function(promises){return new PromiseArray(promises).promise()},Promise.cast=function(obj){var ret=tryConvertToPromise(obj);return ret instanceof Promise||(ret=new Promise(INTERNAL),ret._captureStackTrace(),ret._setFulfilled(),ret._rejectionHandler0=obj),ret},Promise.resolve=Promise.fulfilled=Promise.cast,Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);return ret._captureStackTrace(),ret._rejectCallback(reason,!0),ret},Promise.setScheduler=function(fn){if("function"!=typeof fn)throw new TypeError("expecting a function but got "+util.classString(fn));return async.setScheduler(fn)},Promise.prototype._then=function(didFulfill,didReject,_,receiver,internalData){var haveInternalData=void 0!==internalData,promise=haveInternalData?internalData:new Promise(INTERNAL),target=this._target(),bitField=target._bitField;haveInternalData||(promise._propagateFrom(this,3),promise._captureStackTrace(),void 0===receiver&&0!==(2097152&this._bitField)&&(receiver=0!==(50397184&bitField)?this._boundValue():target===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,promise));var domain=getDomain();if(0!==(50397184&bitField)){var handler,value,settler=target._settlePromiseCtx;0!==(33554432&bitField)?(value=target._rejectionHandler0,handler=didFulfill):0!==(16777216&bitField)?(value=target._fulfillmentHandler0,handler=didReject,target._unsetRejectionIsUnhandled()):(settler=target._settlePromiseLateCancellationObserver,value=new CancellationError("late cancellation observer"),target._attachExtraTrace(value),handler=didReject),async.invoke(settler,target,{handler:null===domain?handler:"function"==typeof handler&&domain.bind(handler),promise:promise,receiver:receiver,value:value})}else target._addCallbacks(didFulfill,didReject,promise,receiver,domain);return promise},Promise.prototype._length=function(){return 65535&this._bitField},Promise.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},Promise.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},Promise.prototype._setLength=function(len){this._bitField=this._bitField&-65536|65535&len},Promise.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},Promise.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},Promise.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},Promise.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},Promise.prototype._isFinal=function(){return(4194304&this._bitField)>0},Promise.prototype._unsetCancelled=function(){this._bitField=this._bitField&-65537},Promise.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},Promise.prototype._setAsyncGuaranteed=function(){async.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},Promise.prototype._receiverAt=function(index){var ret=0===index?this._receiver0:this[4*index-4+3];if(ret!==UNDEFINED_BINDING)return void 0===ret&&this._isBound()?this._boundValue():ret},Promise.prototype._promiseAt=function(index){return this[4*index-4+2]},Promise.prototype._fulfillmentHandlerAt=function(index){return this[4*index-4+0]},Promise.prototype._rejectionHandlerAt=function(index){return this[4*index-4+1]},Promise.prototype._boundValue=function(){},Promise.prototype._migrateCallback0=function(follower){var fulfill=(follower._bitField,follower._fulfillmentHandler0),reject=follower._rejectionHandler0,promise=follower._promise0,receiver=follower._receiverAt(0);void 0===receiver&&(receiver=UNDEFINED_BINDING),this._addCallbacks(fulfill,reject,promise,receiver,null)},Promise.prototype._migrateCallbackAt=function(follower,index){var fulfill=follower._fulfillmentHandlerAt(index),reject=follower._rejectionHandlerAt(index),promise=follower._promiseAt(index),receiver=follower._receiverAt(index);void 0===receiver&&(receiver=UNDEFINED_BINDING),this._addCallbacks(fulfill,reject,promise,receiver,null)},Promise.prototype._addCallbacks=function(fulfill,reject,promise,receiver,domain){var index=this._length();if(index>=65531&&(index=0,this._setLength(0)),0===index)this._promise0=promise,this._receiver0=receiver,"function"==typeof fulfill&&(this._fulfillmentHandler0=null===domain?fulfill:domain.bind(fulfill)),"function"==typeof reject&&(this._rejectionHandler0=null===domain?reject:domain.bind(reject));else{var base=4*index-4;this[base+2]=promise,this[base+3]=receiver,"function"==typeof fulfill&&(this[base+0]=null===domain?fulfill:domain.bind(fulfill)),"function"==typeof reject&&(this[base+1]=null===domain?reject:domain.bind(reject))}return this._setLength(index+1),index},Promise.prototype._proxy=function(proxyable,arg){this._addCallbacks(void 0,void 0,arg,proxyable,null)},Promise.prototype._resolveCallback=function(value,shouldBind){if(0===(117506048&this._bitField)){if(value===this)return this._rejectCallback(makeSelfResolutionError(),!1);var maybePromise=tryConvertToPromise(value,this);if(!(maybePromise instanceof Promise))return this._fulfill(value);shouldBind&&this._propagateFrom(maybePromise,2);var promise=maybePromise._target();if(promise===this)return void this._reject(makeSelfResolutionError());var bitField=promise._bitField;if(0===(50397184&bitField)){var len=this._length();len>0&&promise._migrateCallback0(this);for(var i=1;i<len;++i)promise._migrateCallbackAt(this,i);this._setFollowing(),this._setLength(0),this._setFollowee(promise)}else if(0!==(33554432&bitField))this._fulfill(promise._value());else if(0!==(16777216&bitField))this._reject(promise._reason());else{var reason=new CancellationError("late cancellation observer");promise._attachExtraTrace(reason),this._reject(reason)}}},Promise.prototype._rejectCallback=function(reason,synchronous,ignoreNonErrorWarnings){var trace=util.ensureErrorObject(reason),hasStack=trace===reason;if(!hasStack&&!ignoreNonErrorWarnings&&debug.warnings()){var message="a promise was rejected with a non-error: "+util.classString(reason);this._warn(message,!0)}this._attachExtraTrace(trace,!!synchronous&&hasStack),this._reject(reason)},Promise.prototype._resolveFromExecutor=function(executor){var promise=this;this._captureStackTrace(),this._pushContext();var synchronous=!0,r=this._execute(executor,function(value){promise._resolveCallback(value)},function(reason){promise._rejectCallback(reason,synchronous)});synchronous=!1,this._popContext(),void 0!==r&&promise._rejectCallback(r,!0)},Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){var bitField=promise._bitField;if(0===(65536&bitField)){promise._pushContext();var x;receiver===APPLY?value&&"number"==typeof value.length?x=tryCatch(handler).apply(this._boundValue(),value):(x=errorObj,x.e=new TypeError("cannot .spread() a non-array: "+util.classString(value))):x=tryCatch(handler).call(receiver,value);var promiseCreated=promise._popContext();bitField=promise._bitField,0===(65536&bitField)&&(x===NEXT_FILTER?promise._reject(value):x===errorObj?promise._rejectCallback(x.e,!1):(debug.checkForgottenReturns(x,promiseCreated,"",promise,this),promise._resolveCallback(x)))}},Promise.prototype._target=function(){for(var ret=this;ret._isFollowing();)ret=ret._followee();return ret},Promise.prototype._followee=function(){return this._rejectionHandler0},Promise.prototype._setFollowee=function(promise){this._rejectionHandler0=promise},Promise.prototype._settlePromise=function(promise,handler,receiver,value){var isPromise=promise instanceof Promise,bitField=this._bitField,asyncGuaranteed=0!==(134217728&bitField);0!==(65536&bitField)?(isPromise&&promise._invokeInternalOnCancel(),receiver instanceof PassThroughHandlerContext&&receiver.isFinallyHandler()?(receiver.cancelPromise=promise,tryCatch(handler).call(receiver,value)===errorObj&&promise._reject(errorObj.e)):handler===reflectHandler?promise._fulfill(reflectHandler.call(receiver)):receiver instanceof Proxyable?receiver._promiseCancelled(promise):isPromise||promise instanceof PromiseArray?promise._cancel():receiver.cancel()):"function"==typeof handler?isPromise?(asyncGuaranteed&&promise._setAsyncGuaranteed(),this._settlePromiseFromHandler(handler,receiver,value,promise)):handler.call(receiver,value,promise):receiver instanceof Proxyable?receiver._isResolved()||(0!==(33554432&bitField)?receiver._promiseFulfilled(value,promise):receiver._promiseRejected(value,promise)):isPromise&&(asyncGuaranteed&&promise._setAsyncGuaranteed(),0!==(33554432&bitField)?promise._fulfill(value):promise._reject(value))},Promise.prototype._settlePromiseLateCancellationObserver=function(ctx){var handler=ctx.handler,promise=ctx.promise,receiver=ctx.receiver,value=ctx.value;"function"==typeof handler?promise instanceof Promise?this._settlePromiseFromHandler(handler,receiver,value,promise):handler.call(receiver,value,promise):promise instanceof Promise&&promise._reject(value)},Promise.prototype._settlePromiseCtx=function(ctx){this._settlePromise(ctx.promise,ctx.handler,ctx.receiver,ctx.value)},Promise.prototype._settlePromise0=function(handler,value,bitField){var promise=this._promise0,receiver=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(promise,handler,receiver,value)},Promise.prototype._clearCallbackDataAtIndex=function(index){var base=4*index-4;this[base+2]=this[base+3]=this[base+0]=this[base+1]=void 0},Promise.prototype._fulfill=function(value){var bitField=this._bitField;if(!((117506048&bitField)>>>16)){if(value===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._reject(err)}this._setFulfilled(),this._rejectionHandler0=value,(65535&bitField)>0&&(0!==(134217728&bitField)?this._settlePromises():async.settlePromises(this))}},Promise.prototype._reject=function(reason){var bitField=this._bitField;if(!((117506048&bitField)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=reason,this._isFinal())return async.fatalError(reason,util.isNode);(65535&bitField)>0?async.settlePromises(this):this._ensurePossibleRejectionHandled()}},Promise.prototype._fulfillPromises=function(len,value){for(var i=1;i<len;i++){var handler=this._fulfillmentHandlerAt(i),promise=this._promiseAt(i),receiver=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(promise,handler,receiver,value)}},Promise.prototype._rejectPromises=function(len,reason){for(var i=1;i<len;i++){var handler=this._rejectionHandlerAt(i),promise=this._promiseAt(i),receiver=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(promise,handler,receiver,reason)}},Promise.prototype._settlePromises=function(){var bitField=this._bitField,len=65535&bitField;if(len>0){if(0!==(16842752&bitField)){var reason=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,reason,bitField),this._rejectPromises(len,reason)}else{var value=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,value,bitField),this._fulfillPromises(len,value)}this._setLength(0)}this._clearCancellationData()},Promise.prototype._settledValue=function(){var bitField=this._bitField;return 0!==(33554432&bitField)?this._rejectionHandler0:0!==(16777216&bitField)?this._fulfillmentHandler0:void 0},Promise.defer=Promise.pending=function(){return debug.deprecated("Promise.defer","new Promise"),{promise:new Promise(INTERNAL),resolve:deferResolve,reject:deferReject}},util.notEnumerableProp(Promise,"_makeSelfResolutionError",makeSelfResolutionError),_dereq_("./method")(Promise,INTERNAL,tryConvertToPromise,apiRejection,debug),_dereq_("./bind")(Promise,INTERNAL,tryConvertToPromise,debug),_dereq_("./cancel")(Promise,PromiseArray,apiRejection,debug),_dereq_("./direct_resolve")(Promise),_dereq_("./synchronous_inspection")(Promise),_dereq_("./join")(Promise,PromiseArray,tryConvertToPromise,INTERNAL,debug),Promise.Promise=Promise,Promise.version="3.4.0",_dereq_("./map.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug),_dereq_("./call_get.js")(Promise),_dereq_("./using.js")(Promise,apiRejection,tryConvertToPromise,createContext,INTERNAL,debug),_dereq_("./timers.js")(Promise,INTERNAL,debug),_dereq_("./generators.js")(Promise,apiRejection,INTERNAL,tryConvertToPromise,Proxyable,debug),_dereq_("./nodeify.js")(Promise),_dereq_("./promisify.js")(Promise,INTERNAL),_dereq_("./props.js")(Promise,PromiseArray,tryConvertToPromise,apiRejection),_dereq_("./race.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection),_dereq_("./reduce.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug),_dereq_("./settle.js")(Promise,PromiseArray,debug),_dereq_("./some.js")(Promise,PromiseArray,apiRejection),_dereq_("./filter.js")(Promise,INTERNAL),_dereq_("./each.js")(Promise,INTERNAL),_dereq_("./any.js")(Promise),util.toFastProperties(Promise),util.toFastProperties(Promise.prototype),fillTypes({a:1}),fillTypes({b:2}),fillTypes({c:3}),fillTypes(1),fillTypes(function(){}),fillTypes(void 0),fillTypes(!1),fillTypes(new Promise(INTERNAL)),debug.setBounds(Async.firstLineError,util.lastLineError),Promise}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection,Proxyable){function toResolutionValue(val){switch(val){case-2:return[];case-3:return{}}}function PromiseArray(values){var promise=this._promise=new Promise(INTERNAL);values instanceof Promise&&promise._propagateFrom(values,3),promise._setOnCancel(this),this._values=values,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var util=_dereq_("./util");util.isArray;return util.inherits(PromiseArray,Proxyable),PromiseArray.prototype.length=function(){return this._length},PromiseArray.prototype.promise=function(){return this._promise},PromiseArray.prototype._init=function init(_,resolveValueIfEmpty){var values=tryConvertToPromise(this._values,this._promise);if(values instanceof Promise){values=values._target();var bitField=values._bitField;if(this._values=values,0===(50397184&bitField))return this._promise._setAsyncGuaranteed(),values._then(init,this._reject,void 0,this,resolveValueIfEmpty);if(0===(33554432&bitField))return 0!==(16777216&bitField)?this._reject(values._reason()):this._cancel();values=values._value()}if(values=util.asArray(values),null===values){var err=apiRejection("expecting an array or an iterable object but got "+util.classString(values)).reason();return void this._promise._rejectCallback(err,!1)}if(0===values.length)return void(resolveValueIfEmpty===-5?this._resolveEmptyArray():this._resolve(toResolutionValue(resolveValueIfEmpty)));this._iterate(values)},PromiseArray.prototype._iterate=function(values){var len=this.getActualLength(values.length);this._length=len,this._values=this.shouldCopyValues()?new Array(len):this._values;for(var result=this._promise,isResolved=!1,bitField=null,i=0;i<len;++i){var maybePromise=tryConvertToPromise(values[i],result);maybePromise instanceof Promise?(maybePromise=maybePromise._target(),bitField=maybePromise._bitField):bitField=null,isResolved?null!==bitField&&maybePromise.suppressUnhandledRejections():null!==bitField?0===(50397184&bitField)?(maybePromise._proxy(this,i),this._values[i]=maybePromise):isResolved=0!==(33554432&bitField)?this._promiseFulfilled(maybePromise._value(),i):0!==(16777216&bitField)?this._promiseRejected(maybePromise._reason(),i):this._promiseCancelled(i):isResolved=this._promiseFulfilled(maybePromise,i)}isResolved||result._setAsyncGuaranteed()},PromiseArray.prototype._isResolved=function(){return null===this._values},PromiseArray.prototype._resolve=function(value){this._values=null,this._promise._fulfill(value)},PromiseArray.prototype._cancel=function(){!this._isResolved()&&this._promise.isCancellable()&&(this._values=null,this._promise._cancel())},PromiseArray.prototype._reject=function(reason){this._values=null,this._promise._rejectCallback(reason,!1)},PromiseArray.prototype._promiseFulfilled=function(value,index){return this._values[index]=value,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},PromiseArray.prototype._promiseCancelled=function(){return this._cancel(),!0},PromiseArray.prototype._promiseRejected=function(reason){return this._totalResolved++,this._reject(reason),!0},PromiseArray.prototype._resultCancelled=function(){if(!this._isResolved()){var values=this._values;if(this._cancel(),values instanceof Promise)values.cancel();else for(var i=0;i<values.length;++i)values[i]instanceof Promise&&values[i].cancel()}},PromiseArray.prototype.shouldCopyValues=function(){return!0},PromiseArray.prototype.getActualLength=function(len){return len},PromiseArray}},{"./util":36}],24:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function propsFilter(key){return!noCopyPropsPattern.test(key)}function isPromisified(fn){try{return fn.__isPromisified__===!0}catch(e){return!1}}function hasPromisified(obj,key,suffix){var val=util.getDataPropertyOrDefault(obj,key+suffix,defaultPromisified);return!!val&&isPromisified(val)}function checkValid(ret,suffix,suffixRegexp){for(var i=0;i<ret.length;i+=2){var key=ret[i];if(suffixRegexp.test(key))for(var keyWithoutAsyncSuffix=key.replace(suffixRegexp,""),j=0;j<ret.length;j+=2)if(ret[j]===keyWithoutAsyncSuffix)throw new TypeError("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",suffix))}}function promisifiableMethods(obj,suffix,suffixRegexp,filter){for(var keys=util.inheritedDataKeys(obj),ret=[],i=0;i<keys.length;++i){var key=keys[i],value=obj[key],passesDefaultFilter=filter===defaultFilter||defaultFilter(key,value,obj);"function"!=typeof value||isPromisified(value)||hasPromisified(obj,key,suffix)||!filter(key,value,obj,passesDefaultFilter)||ret.push(key,value)}return checkValid(ret,suffix,suffixRegexp),ret}function makeNodePromisifiedClosure(callback,receiver,_,fn,__,multiArgs){function promisified(){var _receiver=receiver;receiver===THIS&&(_receiver=this);var promise=new Promise(INTERNAL);promise._captureStackTrace();var cb="string"==typeof method&&this!==defaultThis?this[method]:callback,fn=nodebackForPromise(promise,multiArgs);try{cb.apply(_receiver,withAppended(arguments,fn))}catch(e){promise._rejectCallback(maybeWrapAsError(e),!0,!0)}
return promise._isFateSealed()||promise._setAsyncGuaranteed(),promise}var defaultThis=function(){return this}(),method=callback;return"string"==typeof method&&(callback=fn),util.notEnumerableProp(promisified,"__isPromisified__",!0),promisified}function promisifyAll(obj,suffix,filter,promisifier,multiArgs){for(var suffixRegexp=new RegExp(escapeIdentRegex(suffix)+"$"),methods=promisifiableMethods(obj,suffix,suffixRegexp,filter),i=0,len=methods.length;i<len;i+=2){var key=methods[i],fn=methods[i+1],promisifiedKey=key+suffix;if(promisifier===makeNodePromisified)obj[promisifiedKey]=makeNodePromisified(key,THIS,key,fn,suffix,multiArgs);else{var promisified=promisifier(fn,function(){return makeNodePromisified(key,THIS,key,fn,suffix,multiArgs)});util.notEnumerableProp(promisified,"__isPromisified__",!0),obj[promisifiedKey]=promisified}}return util.toFastProperties(obj),obj}function promisify(callback,receiver,multiArgs){return makeNodePromisified(callback,receiver,void 0,callback,null,multiArgs)}var makeNodePromisifiedEval,THIS={},util=_dereq_("./util"),nodebackForPromise=_dereq_("./nodeback"),withAppended=util.withAppended,maybeWrapAsError=util.maybeWrapAsError,canEvaluate=util.canEvaluate,TypeError=_dereq_("./errors").TypeError,defaultPromisified={__isPromisified__:!0},noCopyProps=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],noCopyPropsPattern=new RegExp("^(?:"+noCopyProps.join("|")+")$"),defaultFilter=function(name){return util.isIdentifier(name)&&"_"!==name.charAt(0)&&"constructor"!==name},escapeIdentRegex=function(str){return str.replace(/([$])/,"\\$")},makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;Promise.promisify=function(fn,options){if("function"!=typeof fn)throw new TypeError("expecting a function but got "+util.classString(fn));if(isPromisified(fn))return fn;options=Object(options);var receiver=void 0===options.context?THIS:options.context,multiArgs=!!options.multiArgs,ret=promisify(fn,receiver,multiArgs);return util.copyDescriptors(fn,ret,propsFilter),ret},Promise.promisifyAll=function(target,options){if("function"!=typeof target&&"object"!=typeof target)throw new TypeError("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");options=Object(options);var multiArgs=!!options.multiArgs,suffix=options.suffix;"string"!=typeof suffix&&(suffix="Async");var filter=options.filter;"function"!=typeof filter&&(filter=defaultFilter);var promisifier=options.promisifier;if("function"!=typeof promisifier&&(promisifier=makeNodePromisified),!util.isIdentifier(suffix))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var keys=util.inheritedDataKeys(target),i=0;i<keys.length;++i){var value=target[keys[i]];"constructor"!==keys[i]&&util.isClass(value)&&(promisifyAll(value.prototype,suffix,filter,promisifier,multiArgs),promisifyAll(value,suffix,filter,promisifier,multiArgs))}return promisifyAll(target,suffix,filter,promisifier,multiArgs)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,apiRejection){function PropertiesPromiseArray(obj){var entries,isMap=!1;if(void 0!==Es6Map&&obj instanceof Es6Map)entries=mapToEntries(obj),isMap=!0;else{var keys=es5.keys(obj),len=keys.length;entries=new Array(2*len);for(var i=0;i<len;++i){var key=keys[i];entries[i]=obj[key],entries[i+len]=key}}this.constructor$(entries),this._isMap=isMap,this._init$(void 0,-3)}function props(promises){var ret,castValue=tryConvertToPromise(promises);return isObject(castValue)?(ret=castValue instanceof Promise?castValue._then(Promise.props,void 0,void 0,void 0,void 0):new PropertiesPromiseArray(castValue).promise(),castValue instanceof Promise&&ret._propagateFrom(castValue,2),ret):apiRejection("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var Es6Map,util=_dereq_("./util"),isObject=util.isObject,es5=_dereq_("./es5");"function"==typeof Map&&(Es6Map=Map);var mapToEntries=function(){function extractEntry(value,key){this[index]=value,this[index+size]=key,index++}var index=0,size=0;return function(map){size=map.size,index=0;var ret=new Array(2*map.size);return map.forEach(extractEntry,ret),ret}}(),entriesToMap=function(entries){for(var ret=new Es6Map,length=entries.length/2|0,i=0;i<length;++i){var key=entries[length+i],value=entries[i];ret.set(key,value)}return ret};util.inherits(PropertiesPromiseArray,PromiseArray),PropertiesPromiseArray.prototype._init=function(){},PropertiesPromiseArray.prototype._promiseFulfilled=function(value,index){if(this._values[index]=value,++this._totalResolved>=this._length){var val;if(this._isMap)val=entriesToMap(this._values);else{val={};for(var keyOffset=this.length(),i=0,len=this.length();i<len;++i)val[this._values[i+keyOffset]]=this._values[i]}return this._resolve(val),!0}return!1},PropertiesPromiseArray.prototype.shouldCopyValues=function(){return!1},PropertiesPromiseArray.prototype.getActualLength=function(len){return len>>1},Promise.prototype.props=function(){return props(this)},Promise.props=function(promises){return props(promises)}}},{"./es5":13,"./util":36}],26:[function(_dereq_,module,exports){"use strict";function arrayMove(src,srcIndex,dst,dstIndex,len){for(var j=0;j<len;++j)dst[j+dstIndex]=src[j+srcIndex],src[j+srcIndex]=void 0}function Queue(capacity){this._capacity=capacity,this._length=0,this._front=0}Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size},Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1),this[this._front+length&this._capacity-1]=arg,this._length=length+1},Queue.prototype._unshiftOne=function(value){var capacity=this._capacity;this._checkCapacity(this.length()+1);var front=this._front,i=(front-1&capacity-1^capacity)-capacity;this[i]=value,this._front=i,this._length=this.length()+1},Queue.prototype.unshift=function(fn,receiver,arg){this._unshiftOne(arg),this._unshiftOne(receiver),this._unshiftOne(fn)},Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length))return this._pushOne(fn),this._pushOne(receiver),void this._pushOne(arg);var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn,this[j+1&wrapMask]=receiver,this[j+2&wrapMask]=arg,this._length=length},Queue.prototype.shift=function(){var front=this._front,ret=this[front];return this[front]=void 0,this._front=front+1&this._capacity-1,this._length--,ret},Queue.prototype.length=function(){return this._length},Queue.prototype._checkCapacity=function(size){this._capacity<size&&this._resizeTo(this._capacity<<1)},Queue.prototype._resizeTo=function(capacity){var oldCapacity=this._capacity;this._capacity=capacity,arrayMove(this,0,this,oldCapacity,this._front+this._length&oldCapacity-1)},module.exports=Queue},{}],27:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){function race(promises,parent){var maybePromise=tryConvertToPromise(promises);if(maybePromise instanceof Promise)return raceLater(maybePromise);if(promises=util.asArray(promises),null===promises)return apiRejection("expecting an array or an iterable object but got "+util.classString(promises));var ret=new Promise(INTERNAL);void 0!==parent&&ret._propagateFrom(parent,3);for(var fulfill=ret._fulfill,reject=ret._reject,i=0,len=promises.length;i<len;++i){var val=promises[i];(void 0!==val||i in promises)&&Promise.cast(val)._then(fulfill,reject,void 0,ret,null)}return ret}var util=_dereq_("./util"),raceLater=function(promise){return promise.then(function(array){return race(array,promise)})};Promise.race=function(promises){return race(promises,void 0)},Promise.prototype.race=function(){return race(this,void 0)}}},{"./util":36}],28:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug){function ReductionPromiseArray(promises,fn,initialValue,_each){this.constructor$(promises);var domain=getDomain();this._fn=null===domain?fn:domain.bind(fn),void 0!==initialValue&&(initialValue=Promise.resolve(initialValue),initialValue._attachCancellationCallback(this)),this._initialValue=initialValue,this._currentCancellable=null,this._eachValues=_each===INTERNAL?[]:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function completed(valueOrReason,array){this.isFulfilled()?array._resolve(valueOrReason):array._reject(valueOrReason)}function reduce(promises,fn,initialValue,_each){return"function"!=typeof fn?apiRejection("expecting a function but got "+util.classString(fn)):new ReductionPromiseArray(promises,fn,initialValue,_each).promise()}function gotAccum(accum){this.accum=accum,this.array._gotAccum(accum);var value=tryConvertToPromise(this.value,this.array._promise);return value instanceof Promise?(this.array._currentCancellable=value,value._then(gotValue,void 0,void 0,this,void 0)):gotValue.call(this,value)}function gotValue(value){var array=this.array,promise=array._promise,fn=tryCatch(array._fn);promise._pushContext();var ret;ret=void 0!==array._eachValues?fn.call(promise._boundValue(),value,this.index,this.length):fn.call(promise._boundValue(),this.accum,value,this.index,this.length),ret instanceof Promise&&(array._currentCancellable=ret);var promiseCreated=promise._popContext();return debug.checkForgottenReturns(ret,promiseCreated,void 0!==array._eachValues?"Promise.each":"Promise.reduce",promise),ret}var getDomain=Promise._getDomain,util=_dereq_("./util"),tryCatch=util.tryCatch;util.inherits(ReductionPromiseArray,PromiseArray),ReductionPromiseArray.prototype._gotAccum=function(accum){void 0!==this._eachValues&&accum!==INTERNAL&&this._eachValues.push(accum)},ReductionPromiseArray.prototype._eachComplete=function(value){return this._eachValues.push(value),this._eachValues},ReductionPromiseArray.prototype._init=function(){},ReductionPromiseArray.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},ReductionPromiseArray.prototype.shouldCopyValues=function(){return!1},ReductionPromiseArray.prototype._resolve=function(value){this._promise._resolveCallback(value),this._values=null},ReductionPromiseArray.prototype._resultCancelled=function(sender){if(sender===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof Promise&&this._currentCancellable.cancel(),this._initialValue instanceof Promise&&this._initialValue.cancel())},ReductionPromiseArray.prototype._iterate=function(values){this._values=values;var value,i,length=values.length;if(void 0!==this._initialValue?(value=this._initialValue,i=0):(value=Promise.resolve(values[0]),i=1),this._currentCancellable=value,!value.isRejected())for(;i<length;++i){var ctx={accum:null,value:values[i],index:i,length:length,array:this};value=value._then(gotAccum,void 0,void 0,ctx,void 0)}void 0!==this._eachValues&&(value=value._then(this._eachComplete,void 0,void 0,this,void 0)),value._then(completed,completed,void 0,value,this)},Promise.prototype.reduce=function(fn,initialValue){return reduce(this,fn,initialValue,null)},Promise.reduce=function(promises,fn,initialValue,_each){return reduce(promises,fn,initialValue,_each)}}},{"./util":36}],29:[function(_dereq_,module,exports){"use strict";var schedule,util=_dereq_("./util"),noAsyncScheduler=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},NativePromise=util.getNativePromise();if(util.isNode&&"undefined"==typeof MutationObserver){var GlobalSetImmediate=global.setImmediate,ProcessNextTick=process.nextTick;schedule=util.isRecentNode?function(fn){GlobalSetImmediate.call(global,fn)}:function(fn){ProcessNextTick.call(process,fn)}}else if("function"==typeof NativePromise){var nativePromise=NativePromise.resolve();schedule=function(fn){nativePromise.then(fn)}}else schedule="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?"undefined"!=typeof setImmediate?function(fn){setImmediate(fn)}:"undefined"!=typeof setTimeout?function(fn){setTimeout(fn,0)}:noAsyncScheduler:function(){var div=document.createElement("div"),opts={attributes:!0},toggleScheduled=!1,div2=document.createElement("div");new MutationObserver(function(){div.classList.toggle("foo"),toggleScheduled=!1}).observe(div2,opts);var scheduleToggle=function(){toggleScheduled||(toggleScheduled=!0,div2.classList.toggle("foo"))};return function(fn){var o=new MutationObserver(function(){o.disconnect(),fn()});o.observe(div,opts),scheduleToggle()}}();module.exports=schedule},{"./util":36}],30:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,debug){function SettledPromiseArray(values){this.constructor$(values)}var PromiseInspection=Promise.PromiseInspection;_dereq_("./util").inherits(SettledPromiseArray,PromiseArray),SettledPromiseArray.prototype._promiseResolved=function(index,inspection){return this._values[index]=inspection,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},SettledPromiseArray.prototype._promiseFulfilled=function(value,index){var ret=new PromiseInspection;return ret._bitField=33554432,ret._settledValueField=value,this._promiseResolved(index,ret)},SettledPromiseArray.prototype._promiseRejected=function(reason,index){var ret=new PromiseInspection;return ret._bitField=16777216,ret._settledValueField=reason,this._promiseResolved(index,ret)},Promise.settle=function(promises){return debug.deprecated(".settle()",".reflect()"),new SettledPromiseArray(promises).promise()},Promise.prototype.settle=function(){return Promise.settle(this)}}},{"./util":36}],31:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection){function SomePromiseArray(values){this.constructor$(values),this._howMany=0,this._unwrap=!1,this._initialized=!1}function some(promises,howMany){if((0|howMany)!==howMany||howMany<0)return apiRejection("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var ret=new SomePromiseArray(promises),promise=ret.promise();return ret.setHowMany(howMany),ret.init(),promise}var util=_dereq_("./util"),RangeError=_dereq_("./errors").RangeError,AggregateError=_dereq_("./errors").AggregateError,isArray=util.isArray,CANCELLATION={};util.inherits(SomePromiseArray,PromiseArray),SomePromiseArray.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var isArrayResolved=isArray(this._values);!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},SomePromiseArray.prototype.init=function(){this._initialized=!0,this._init()},SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=!0},SomePromiseArray.prototype.howMany=function(){return this._howMany},SomePromiseArray.prototype.setHowMany=function(count){this._howMany=count},SomePromiseArray.prototype._promiseFulfilled=function(value){return this._addFulfilled(value),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},SomePromiseArray.prototype._promiseRejected=function(reason){return this._addRejected(reason),this._checkOutcome()},SomePromiseArray.prototype._promiseCancelled=function(){return this._values instanceof Promise||null==this._values?this._cancel():(this._addRejected(CANCELLATION),this._checkOutcome())},SomePromiseArray.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new AggregateError,i=this.length();i<this._values.length;++i)this._values[i]!==CANCELLATION&&e.push(this._values[i]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved},SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length()},SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason)},SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value},SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},SomePromiseArray.prototype._getRangeError=function(count){return new RangeError("Input array must contain at least "+this._howMany+" items but contains only "+count+" items")},SomePromiseArray.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},Promise.some=function(promises,howMany){return some(promises,howMany)},Promise.prototype.some=function(howMany){return some(this,howMany)},Promise._SomePromiseArray=SomePromiseArray}},{"./errors":12,"./util":36}],32:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function PromiseInspection(promise){void 0!==promise?(promise=promise._target(),this._bitField=promise._bitField,this._settledValueField=promise._isFateSealed()?promise._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}PromiseInspection.prototype._settledValue=function(){return this._settledValueField};var value=PromiseInspection.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},reason=PromiseInspection.prototype.error=PromiseInspection.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},isFulfilled=PromiseInspection.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},isRejected=PromiseInspection.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},isPending=PromiseInspection.prototype.isPending=function(){return 0===(50397184&this._bitField)},isResolved=PromiseInspection.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};PromiseInspection.prototype.isCancelled=Promise.prototype._isCancelled=function(){return 65536===(65536&this._bitField)},Promise.prototype.isCancelled=function(){return this._target()._isCancelled()},Promise.prototype.isPending=function(){return isPending.call(this._target())},Promise.prototype.isRejected=function(){return isRejected.call(this._target())},Promise.prototype.isFulfilled=function(){return isFulfilled.call(this._target())},Promise.prototype.isResolved=function(){return isResolved.call(this._target())},Promise.prototype.value=function(){return value.call(this._target())},Promise.prototype.reason=function(){var target=this._target();return target._unsetRejectionIsUnhandled(),reason.call(target)},Promise.prototype._value=function(){return this._settledValue()},Promise.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},Promise.PromiseInspection=PromiseInspection}},{}],33:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function tryConvertToPromise(obj,context){if(isObject(obj)){if(obj instanceof Promise)return obj;var then=getThen(obj);if(then===errorObj){context&&context._pushContext();var ret=Promise.reject(then.e);return context&&context._popContext(),ret}if("function"==typeof then){if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);return obj._then(ret._fulfill,ret._reject,void 0,ret,null),ret}return doThenable(obj,then,context)}}return obj}function doGetThen(obj){return obj.then}function getThen(obj){try{return doGetThen(obj)}catch(e){return errorObj.e=e,errorObj}}function isAnyBluebirdPromise(obj){try{return hasProp.call(obj,"_promise0")}catch(e){return!1}}function doThenable(x,then,context){function resolve(value){promise&&(promise._resolveCallback(value),promise=null)}function reject(reason){promise&&(promise._rejectCallback(reason,synchronous,!0),promise=null)}var promise=new Promise(INTERNAL),ret=promise;context&&context._pushContext(),promise._captureStackTrace(),context&&context._popContext();var synchronous=!0,result=util.tryCatch(then).call(x,resolve,reject);return synchronous=!1,promise&&result===errorObj&&(promise._rejectCallback(result.e,!0,!0),promise=null),ret}var util=_dereq_("./util"),errorObj=util.errorObj,isObject=util.isObject,hasProp={}.hasOwnProperty;return tryConvertToPromise}},{"./util":36}],34:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,debug){function HandleWrapper(handle){this.handle=handle}function successClear(value){return clearTimeout(this.handle),value}function failureClear(reason){throw clearTimeout(this.handle),reason}var util=_dereq_("./util"),TimeoutError=Promise.TimeoutError;HandleWrapper.prototype._resultCancelled=function(){clearTimeout(this.handle)};var afterValue=function(value){return delay(+this).thenReturn(value)},delay=Promise.delay=function(ms,value){var ret,handle;return void 0!==value?(ret=Promise.resolve(value)._then(afterValue,null,null,ms,void 0),debug.cancellation()&&value instanceof Promise&&ret._setOnCancel(value)):(ret=new Promise(INTERNAL),handle=setTimeout(function(){ret._fulfill()},+ms),debug.cancellation()&&ret._setOnCancel(new HandleWrapper(handle))),ret._setAsyncGuaranteed(),ret};Promise.prototype.delay=function(ms){return delay(ms,this)};var afterTimeout=function(promise,message,parent){var err;err="string"!=typeof message?message instanceof Error?message:new TimeoutError("operation timed out"):new TimeoutError(message),util.markAsOriginatingFromRejection(err),promise._attachExtraTrace(err),promise._reject(err),null!=parent&&parent.cancel()};Promise.prototype.timeout=function(ms,message){ms=+ms;var ret,parent,handleWrapper=new HandleWrapper(setTimeout(function(){ret.isPending()&&afterTimeout(ret,message,parent)},ms));return debug.cancellation()?(parent=this.then(),ret=parent._then(successClear,failureClear,void 0,handleWrapper,void 0),ret._setOnCancel(handleWrapper)):ret=this._then(successClear,failureClear,void 0,handleWrapper,void 0),ret}}},{"./util":36}],35:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,tryConvertToPromise,createContext,INTERNAL,debug){function thrower(e){setTimeout(function(){throw e},0)}function castPreservingDisposable(thenable){var maybePromise=tryConvertToPromise(thenable);return maybePromise!==thenable&&"function"==typeof thenable._isDisposable&&"function"==typeof thenable._getDisposer&&thenable._isDisposable()&&maybePromise._setDisposable(thenable._getDisposer()),maybePromise}function dispose(resources,inspection){function iterator(){if(i>=len)return ret._fulfill();var maybePromise=castPreservingDisposable(resources[i++]);if(maybePromise instanceof Promise&&maybePromise._isDisposable()){try{maybePromise=tryConvertToPromise(maybePromise._getDisposer().tryDispose(inspection),resources.promise)}catch(e){return thrower(e)}if(maybePromise instanceof Promise)return maybePromise._then(iterator,thrower,null,null,null)}iterator()}var i=0,len=resources.length,ret=new Promise(INTERNAL);return iterator(),ret}function Disposer(data,promise,context){this._data=data,this._promise=promise,this._context=context}function FunctionDisposer(fn,promise,context){this.constructor$(fn,promise,context)}function maybeUnwrapDisposer(value){return Disposer.isDisposer(value)?(this.resources[this.index]._setDisposable(value),value.promise()):value}function ResourceList(length){this.length=length,this.promise=null,this[length-1]=null}var util=_dereq_("./util"),TypeError=_dereq_("./errors").TypeError,inherits=_dereq_("./util").inherits,errorObj=util.errorObj,tryCatch=util.tryCatch,NULL={};Disposer.prototype.data=function(){return this._data},Disposer.prototype.promise=function(){return this._promise},Disposer.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():NULL},Disposer.prototype.tryDispose=function(inspection){var resource=this.resource(),context=this._context;void 0!==context&&context._pushContext();var ret=resource!==NULL?this.doDispose(resource,inspection):null;return void 0!==context&&context._popContext(),this._promise._unsetDisposable(),this._data=null,ret},Disposer.isDisposer=function(d){return null!=d&&"function"==typeof d.resource&&"function"==typeof d.tryDispose},inherits(FunctionDisposer,Disposer),FunctionDisposer.prototype.doDispose=function(resource,inspection){return this.data().call(resource,resource,inspection)},ResourceList.prototype._resultCancelled=function(){for(var len=this.length,i=0;i<len;++i){var item=this[i];item instanceof Promise&&item.cancel()}},Promise.using=function(){var len=arguments.length;if(len<2)return apiRejection("you must pass at least 2 arguments to Promise.using");var fn=arguments[len-1];if("function"!=typeof fn)return apiRejection("expecting a function but got "+util.classString(fn));var input,spreadArgs=!0;2===len&&Array.isArray(arguments[0])?(input=arguments[0],len=input.length,spreadArgs=!1):(input=arguments,len--);for(var resources=new ResourceList(len),i=0;i<len;++i){var resource=input[i];if(Disposer.isDisposer(resource)){var disposer=resource;resource=resource.promise(),resource._setDisposable(disposer)}else{var maybePromise=tryConvertToPromise(resource);maybePromise instanceof Promise&&(resource=maybePromise._then(maybeUnwrapDisposer,null,null,{resources:resources,index:i},void 0))}resources[i]=resource}for(var reflectedResources=new Array(resources.length),i=0;i<reflectedResources.length;++i)reflectedResources[i]=Promise.resolve(resources[i]).reflect();var resultPromise=Promise.all(reflectedResources).then(function(inspections){for(var i=0;i<inspections.length;++i){var inspection=inspections[i];if(inspection.isRejected())return errorObj.e=inspection.error(),errorObj;if(!inspection.isFulfilled())return void resultPromise.cancel();inspections[i]=inspection.value()}promise._pushContext(),fn=tryCatch(fn);var ret=spreadArgs?fn.apply(void 0,inspections):fn(inspections),promiseCreated=promise._popContext();return debug.checkForgottenReturns(ret,promiseCreated,"Promise.using",promise),ret}),promise=resultPromise.lastly(function(){return dispose(resources,new Promise.PromiseInspection(resultPromise))});return resources.promise=promise,promise._setOnCancel(resources),promise},Promise.prototype._setDisposable=function(disposer){this._bitField=131072|this._bitField,this._disposer=disposer},Promise.prototype._isDisposable=function(){return(131072&this._bitField)>0},Promise.prototype._getDisposer=function(){return this._disposer},Promise.prototype._unsetDisposable=function(){this._bitField=this._bitField&-131073,this._disposer=void 0},Promise.prototype.disposer=function(fn){if("function"==typeof fn)return new FunctionDisposer(fn,this,createContext());throw new TypeError}}},{"./errors":12,"./util":36}],36:[function(_dereq_,module,exports){"use strict";function tryCatcher(){try{var target=tryCatchTarget;return tryCatchTarget=null,target.apply(this,arguments)}catch(e){return errorObj.e=e,errorObj}}function tryCatch(fn){return tryCatchTarget=fn,tryCatcher}function isPrimitive(val){return null==val||val===!0||val===!1||"string"==typeof val||"number"==typeof val}function isObject(value){return"function"==typeof value||"object"==typeof value&&null!==value}function maybeWrapAsError(maybeError){return isPrimitive(maybeError)?new Error(safeToString(maybeError)):maybeError}function withAppended(target,appendee){var i,len=target.length,ret=new Array(len+1);for(i=0;i<len;++i)ret[i]=target[i];return ret[i]=appendee,ret}function getDataPropertyOrDefault(obj,key,defaultValue){if(!es5.isES5)return{}.hasOwnProperty.call(obj,key)?obj[key]:void 0;var desc=Object.getOwnPropertyDescriptor(obj,key);return null!=desc?null==desc.get&&null==desc.set?desc.value:defaultValue:void 0}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(obj,name,descriptor),obj}function thrower(r){throw r}function isClass(fn){try{if("function"==typeof fn){var keys=es5.names(fn.prototype),hasMethods=es5.isES5&&keys.length>1,hasMethodsOtherThanConstructor=keys.length>0&&!(1===keys.length&&"constructor"===keys[0]),hasThisAssignmentAndStaticMethods=thisAssignmentPattern.test(fn+"")&&es5.names(fn).length>0;if(hasMethods||hasMethodsOtherThanConstructor||hasThisAssignmentAndStaticMethods)return!0}return!1}catch(e){return!1}}function toFastProperties(obj){function FakeConstructor(){}FakeConstructor.prototype=obj;for(var l=8;l--;)new FakeConstructor;return obj}function isIdentifier(str){return rident.test(str)}function filledRange(count,prefix,suffix){for(var ret=new Array(count),i=0;i<count;++i)ret[i]=prefix+i+suffix;return ret}function safeToString(obj){try{return obj+""}catch(e){return"[no string representation]"}}function isError(obj){return null!==obj&&"object"==typeof obj&&"string"==typeof obj.message&&"string"==typeof obj.name}function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",!0)}catch(ignore){}}function originatesFromRejection(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||e.isOperational===!0)}function canAttachTrace(obj){return isError(obj)&&es5.propertyIsWritable(obj,"stack")}function classString(obj){return{}.toString.call(obj)}function copyDescriptors(from,to,filter){for(var keys=es5.names(from),i=0;i<keys.length;++i){var key=keys[i];if(filter(key))try{es5.defineProperty(to,key,es5.getDescriptor(from,key))}catch(ignore){}}}function env(key,def){return isNode?process.env[key]:def}function getNativePromise(){if("function"==typeof Promise)try{var promise=new Promise(function(){});if("[object Promise]"==={}.toString.call(promise))return Promise}catch(e){}}var es5=_dereq_("./es5"),canEvaluate="undefined"==typeof navigator,errorObj={e:{}},tryCatchTarget,globalObject="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==global?global:void 0!==this?this:null,inherits=function(Child,Parent){function T(){this.constructor=Child,this.constructor$=Parent;for(var propertyName in Parent.prototype)hasProp.call(Parent.prototype,propertyName)&&"$"!==propertyName.charAt(propertyName.length-1)&&(this[propertyName+"$"]=Parent.prototype[propertyName])}var hasProp={}.hasOwnProperty;return T.prototype=Parent.prototype,Child.prototype=new T,Child.prototype},inheritedDataKeys=function(){var excludedPrototypes=[Array.prototype,Object.prototype,Function.prototype],isExcludedProto=function(val){for(var i=0;i<excludedPrototypes.length;++i)if(excludedPrototypes[i]===val)return!0;return!1};if(es5.isES5){var getKeys=Object.getOwnPropertyNames;return function(obj){for(var ret=[],visitedKeys=Object.create(null);null!=obj&&!isExcludedProto(obj);){var keys;try{keys=getKeys(obj)}catch(e){return ret}for(var i=0;i<keys.length;++i){var key=keys[i];if(!visitedKeys[key]){visitedKeys[key]=!0;var desc=Object.getOwnPropertyDescriptor(obj,key);null!=desc&&null==desc.get&&null==desc.set&&ret.push(key)}}obj=es5.getPrototypeOf(obj)}return ret}}var hasProp={}.hasOwnProperty;return function(obj){if(isExcludedProto(obj))return[];var ret=[];enumeration:for(var key in obj)if(hasProp.call(obj,key))ret.push(key);else{for(var i=0;i<excludedPrototypes.length;++i)if(hasProp.call(excludedPrototypes[i],key))continue enumeration;ret.push(key)}return ret}}(),thisAssignmentPattern=/this\s*\.\s*\S+\s*=/,rident=/^[a-z$_][a-z$_0-9]*$/i,ensureErrorObject=function(){return"stack"in new Error?function(value){return canAttachTrace(value)?value:new Error(safeToString(value))}:function(value){if(canAttachTrace(value))return value;try{throw new Error(safeToString(value))}catch(err){return err}}}(),asArray=function(v){return es5.isArray(v)?v:null};if("undefined"!=typeof Symbol&&Symbol.iterator){
var ArrayFrom="function"==typeof Array.from?function(v){return Array.from(v)}:function(v){for(var itResult,ret=[],it=v[Symbol.iterator]();!(itResult=it.next()).done;)ret.push(itResult.value);return ret};asArray=function(v){return es5.isArray(v)?v:null!=v&&"function"==typeof v[Symbol.iterator]?ArrayFrom(v):null}}var isNode=void 0!==process&&"[object process]"===classString(process).toLowerCase(),ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,asArray:asArray,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,isError:isError,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,maybeWrapAsError:maybeWrapAsError,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,classString:classString,copyDescriptors:copyDescriptors,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:isNode,env:env,global:globalObject,getNativePromise:getNativePromise};ret.isRecentNode=ret.isNode&&function(){var version=process.versions.node.split(".").map(Number);return 0===version[0]&&version[1]>10||version[0]>0}(),ret.isNode&&ret.toFastProperties(process);try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:218}],146:[function(require,module,exports){function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}void 0!==module&&(module.exports=Emitter),Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){this.off(event,on),fn.apply(this,arguments)}return on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks["$"+event],this;for(var cb,i=0;i<callbacks.length;i++)if(cb=callbacks[i],cb===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks["$"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i)callbacks[i].apply(this,args)}return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks["$"+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],147:[function(require,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype,a.prototype=new fn,a.prototype.constructor=a}},{}],148:[function(require,module,exports){function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function formatArgs(){var args=arguments,useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0,lastC=0;return args[0].replace(/%[a-z%]/g,function(match){"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c),args}function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{null==namespaces?exports.storage.removeItem("debug"):exports.storage.debug=namespaces}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}function localstorage(){try{return window.localStorage}catch(e){}}exports=module.exports=require("./debug"),exports.log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){return JSON.stringify(v)},exports.enable(load())},{"./debug":149}],149:[function(require,module,exports){function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}function enabled(){var self=enabled,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,null==self.useColors&&(self.useColors=exports.useColors()),null==self.color&&self.useColors&&(self.color=selectColor());var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&(args=["%o"].concat(args));var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),"function"==typeof exports.formatArgs&&(args=exports.formatArgs.apply(self,args)),(enabled.log||exports.log||console.log.bind(console)).apply(self,args)}disabled.enabled=!1,enabled.enabled=!0;var fn=exports.enabled(namespace)?enabled:disabled;return fn.namespace=namespace,fn}function enable(namespaces){exports.save(namespaces);for(var split=(namespaces||"").split(/[\s,]+/),len=split.length,i=0;i<len;i++)split[i]&&(namespaces=split[i].replace(/\*/g,".*?"),"-"===namespaces[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;i<len;i++)if(exports.names[i].test(name))return!0;return!1}function coerce(val){return val instanceof Error?val.stack||val.message:val}exports=module.exports=debug,exports.coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={};var prevTime,prevColor=0},{ms:213}],150:[function(require,module,exports){!function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["exports"],factory):factory(void 0!==exports?exports:root.esprima={})}(this,function(exports){"use strict";function assert(condition,message){if(!condition)throw new Error("ASSERT: "+message)}function sliceSource(from,to){return source.slice(from,to)}function isDecimalDigit(ch){return"0123456789".indexOf(ch)>=0}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function isWhiteSpace(ch){return" "===ch||"\t"===ch||"\x0B"===ch||"\f"===ch||""===ch||ch.charCodeAt(0)>=5760&&"\ufeff".indexOf(ch)>=0}function isLineTerminator(ch){return"\n"===ch||"\r"===ch||"\u2028"===ch||"\u2029"===ch}function isIdentifierStart(ch){return"$"===ch||"_"===ch||"\\"===ch||ch>="a"&&ch<="z"||ch>="A"&&ch<="Z"||ch.charCodeAt(0)>=128&&Regex.NonAsciiIdentifierStart.test(ch)}function isIdentifierPart(ch){return"$"===ch||"_"===ch||"\\"===ch||ch>="a"&&ch<="z"||ch>="A"&&ch<="Z"||ch>="0"&&ch<="9"||ch.charCodeAt(0)>=128&&Regex.NonAsciiIdentifierPart.test(ch)}function isFutureReservedWord(id){switch(id){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0}return!1}function isStrictModeReservedWord(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0}return!1}function isRestrictedWord(id){return"eval"===id||"arguments"===id}function isKeyword(id){var keyword=!1;switch(id.length){case 2:keyword="if"===id||"in"===id||"do"===id;break;case 3:keyword="var"===id||"for"===id||"new"===id||"try"===id;break;case 4:keyword="this"===id||"else"===id||"case"===id||"void"===id||"with"===id;break;case 5:keyword="while"===id||"break"===id||"catch"===id||"throw"===id;break;case 6:keyword="return"===id||"typeof"===id||"delete"===id||"switch"===id;break;case 7:keyword="default"===id||"finally"===id;break;case 8:keyword="function"===id||"continue"===id||"debugger"===id;break;case 10:keyword="instanceof"===id}if(keyword)return!0;switch(id){case"const":return!0;case"yield":case"let":return!0}return!(!strict||!isStrictModeReservedWord(id))||isFutureReservedWord(id)}function skipComment(){var ch,blockComment,lineComment;for(blockComment=!1,lineComment=!1;index<length;)if(ch=source[index],lineComment)ch=source[index++],isLineTerminator(ch)&&(lineComment=!1,"\r"===ch&&"\n"===source[index]&&++index,++lineNumber,lineStart=index);else if(blockComment)isLineTerminator(ch)?("\r"===ch&&"\n"===source[index+1]&&++index,++lineNumber,++index,lineStart=index,index>=length&&throwError({},Messages.UnexpectedToken,"ILLEGAL")):(ch=source[index++],index>=length&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),"*"===ch&&(ch=source[index],"/"===ch&&(++index,blockComment=!1)));else if("/"===ch)if(ch=source[index+1],"/"===ch)index+=2,lineComment=!0;else{if("*"!==ch)break;index+=2,blockComment=!0,index>=length&&throwError({},Messages.UnexpectedToken,"ILLEGAL")}else if(isWhiteSpace(ch))++index;else{if(!isLineTerminator(ch))break;++index,"\r"===ch&&"\n"===source[index]&&++index,++lineNumber,lineStart=index}}function scanHexEscape(prefix){var i,len,ch,code=0;for(len="u"===prefix?4:2,i=0;i<len;++i){if(!(index<length&&isHexDigit(source[index])))return"";ch=source[index++],code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase())}return String.fromCharCode(code)}function scanIdentifier(){var ch,start,id,restore;if(ch=source[index],isIdentifierStart(ch)){if(start=index,"\\"===ch){if(++index,"u"!==source[index])return;if(++index,restore=index,ch=scanHexEscape("u")){if("\\"===ch||!isIdentifierStart(ch))return;id=ch}else index=restore,id="u"}else id=source[index++];for(;index<length&&(ch=source[index],isIdentifierPart(ch));)if("\\"===ch){if(++index,"u"!==source[index])return;if(++index,restore=index,ch=scanHexEscape("u")){if("\\"===ch||!isIdentifierPart(ch))return;id+=ch}else index=restore,id+="u"}else id+=source[index++];return 1===id.length?{type:Token.Identifier,value:id,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}:isKeyword(id)?{type:Token.Keyword,value:id,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}:"null"===id?{type:Token.NullLiteral,value:id,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}:"true"===id||"false"===id?{type:Token.BooleanLiteral,value:id,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}:{type:Token.Identifier,value:id,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}}function scanPunctuator(){var ch2,ch3,ch4,start=index,ch1=source[index];return";"===ch1||"{"===ch1||"}"===ch1?(++index,{type:Token.Punctuator,value:ch1,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):","===ch1||"("===ch1||")"===ch1?(++index,{type:Token.Punctuator,value:ch1,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):(ch2=source[index+1],"."!==ch1||isDecimalDigit(ch2)?(ch3=source[index+2],ch4=source[index+3],">"===ch1&&">"===ch2&&">"===ch3&&"="===ch4?(index+=4,{type:Token.Punctuator,value:">>>=",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):"="===ch1&&"="===ch2&&"="===ch3?(index+=3,{type:Token.Punctuator,value:"===",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):"!"===ch1&&"="===ch2&&"="===ch3?(index+=3,{type:Token.Punctuator,value:"!==",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):">"===ch1&&">"===ch2&&">"===ch3?(index+=3,{type:Token.Punctuator,value:">>>",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):"<"===ch1&&"<"===ch2&&"="===ch3?(index+=3,{type:Token.Punctuator,value:"<<=",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):">"===ch1&&">"===ch2&&"="===ch3?(index+=3,{type:Token.Punctuator,value:">>=",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):"="===ch2&&"<>=!+-*%&|^/".indexOf(ch1)>=0?(index+=2,{type:Token.Punctuator,value:ch1+ch2,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):ch1===ch2&&"+-<>&|".indexOf(ch1)>=0&&"+-<>&|".indexOf(ch2)>=0?(index+=2,{type:Token.Punctuator,value:ch1+ch2,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}):"[]<>+-*%&|^!~?:=/".indexOf(ch1)>=0?{type:Token.Punctuator,value:source[index++],lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}:void 0):{type:Token.Punctuator,value:source[index++],lineNumber:lineNumber,lineStart:lineStart,range:[start,index]})}function scanNumericLiteral(){var number,start,ch;if(ch=source[index],assert(isDecimalDigit(ch)||"."===ch,"Numeric literal must start with a decimal digit or a decimal point"),start=index,number="","."!==ch){if(number=source[index++],ch=source[index],"0"===number){if("x"===ch||"X"===ch){for(number+=source[index++];index<length&&(ch=source[index],isHexDigit(ch));)number+=source[index++];return number.length<=2&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),index<length&&(ch=source[index],isIdentifierStart(ch)&&throwError({},Messages.UnexpectedToken,"ILLEGAL")),{type:Token.NumericLiteral,value:parseInt(number,16),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(isOctalDigit(ch)){for(number+=source[index++];index<length&&(ch=source[index],isOctalDigit(ch));)number+=source[index++];return index<length&&(ch=source[index],(isIdentifierStart(ch)||isDecimalDigit(ch))&&throwError({},Messages.UnexpectedToken,"ILLEGAL")),{type:Token.NumericLiteral,value:parseInt(number,8),octal:!0,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}isDecimalDigit(ch)&&throwError({},Messages.UnexpectedToken,"ILLEGAL")}for(;index<length&&(ch=source[index],isDecimalDigit(ch));)number+=source[index++]}if("."===ch)for(number+=source[index++];index<length&&(ch=source[index],isDecimalDigit(ch));)number+=source[index++];if("e"===ch||"E"===ch)if(number+=source[index++],ch=source[index],"+"!==ch&&"-"!==ch||(number+=source[index++]),ch=source[index],isDecimalDigit(ch))for(number+=source[index++];index<length&&(ch=source[index],isDecimalDigit(ch));)number+=source[index++];else ch="character "+ch,index>=length&&(ch="<end>"),throwError({},Messages.UnexpectedToken,"ILLEGAL");return index<length&&(ch=source[index],isIdentifierStart(ch)&&throwError({},Messages.UnexpectedToken,"ILLEGAL")),{type:Token.NumericLiteral,value:parseFloat(number),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanStringLiteral(){var quote,start,ch,code,unescaped,restore,str="",octal=!1;for(quote=source[index],assert("'"===quote||'"'===quote,"String literal must starts with a quote"),start=index,++index;index<length;){if(ch=source[index++],ch===quote){quote="";break}if("\\"===ch)if(ch=source[index++],isLineTerminator(ch))++lineNumber,"\r"===ch&&"\n"===source[index]&&++index;else switch(ch){case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="\t";break;case"u":case"x":restore=index,unescaped=scanHexEscape(ch),unescaped?str+=unescaped:(index=restore,str+=ch);break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="\x0B";break;default:isOctalDigit(ch)?(code="01234567".indexOf(ch),0!==code&&(octal=!0),index<length&&isOctalDigit(source[index])&&(octal=!0,code=8*code+"01234567".indexOf(source[index++]),"0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])&&(code=8*code+"01234567".indexOf(source[index++]))),str+=String.fromCharCode(code)):str+=ch}else{if(isLineTerminator(ch))break;str+=ch}}return""!==quote&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),{type:Token.StringLiteral,value:str,octal:octal,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanRegExp(){var str,ch,start,pattern,flags,value,restore,classMarker=!1,terminated=!1;for(buffer=null,skipComment(),start=index,ch=source[index],assert("/"===ch,"Regular expression literal must start with a slash"),str=source[index++];index<length;)if(ch=source[index++],str+=ch,"\\"===ch)ch=source[index++],isLineTerminator(ch)&&throwError({},Messages.UnterminatedRegExp),str+=ch;else if(classMarker)"]"===ch&&(classMarker=!1);else{if("/"===ch){terminated=!0;break}"["===ch?classMarker=!0:isLineTerminator(ch)&&throwError({},Messages.UnterminatedRegExp)}for(terminated||throwError({},Messages.UnterminatedRegExp),pattern=str.substr(1,str.length-2),flags="";index<length&&(ch=source[index],isIdentifierPart(ch));)if(++index,"\\"===ch&&index<length)if(ch=source[index],"u"===ch)if(++index,restore=index,ch=scanHexEscape("u"))for(flags+=ch,str+="\\u";restore<index;++restore)str+=source[restore];else index=restore,flags+="u",str+="\\u";else str+="\\";else flags+=ch,str+=ch;try{value=new RegExp(pattern,flags)}catch(e){throwError({},Messages.InvalidRegExp)}return{literal:str,value:value,range:[start,index]}}function isIdentifierName(token){return token.type===Token.Identifier||token.type===Token.Keyword||token.type===Token.BooleanLiteral||token.type===Token.NullLiteral}function advance(){var ch,token;return skipComment(),index>=length?{type:Token.EOF,lineNumber:lineNumber,lineStart:lineStart,range:[index,index]}:(token=scanPunctuator(),void 0!==token?token:(ch=source[index],"'"===ch||'"'===ch?scanStringLiteral():"."===ch||isDecimalDigit(ch)?scanNumericLiteral():(token=scanIdentifier(),void 0!==token?token:void throwError({},Messages.UnexpectedToken,"ILLEGAL"))))}function lex(){var token;return buffer?(index=buffer.range[1],lineNumber=buffer.lineNumber,lineStart=buffer.lineStart,token=buffer,buffer=null,token):(buffer=null,advance())}function lookahead(){var pos,line,start;return null!==buffer?buffer:(pos=index,line=lineNumber,start=lineStart,buffer=advance(),index=pos,lineNumber=line,lineStart=start,buffer)}function peekLineTerminator(){var pos,line,start,found;return pos=index,line=lineNumber,start=lineStart,skipComment(),found=lineNumber!==line,index=pos,lineNumber=line,lineStart=start,found}function throwError(token,messageFormat){var error,args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,function(whole,index){return args[index]||""});throw"number"==typeof token.lineNumber?(error=new Error("Line "+token.lineNumber+": "+msg),error.index=token.range[0],error.lineNumber=token.lineNumber,error.column=token.range[0]-lineStart+1):(error=new Error("Line "+lineNumber+": "+msg),error.index=index,error.lineNumber=lineNumber,error.column=index-lineStart+1),error}function throwErrorTolerant(){try{throwError.apply(null,arguments)}catch(e){if(!extra.errors)throw e;extra.errors.push(e)}}function throwUnexpected(token){if(token.type===Token.EOF&&throwError(token,Messages.UnexpectedEOS),token.type===Token.NumericLiteral&&throwError(token,Messages.UnexpectedNumber),token.type===Token.StringLiteral&&throwError(token,Messages.UnexpectedString),token.type===Token.Identifier&&throwError(token,Messages.UnexpectedIdentifier),token.type===Token.Keyword){if(isFutureReservedWord(token.value))throwError(token,Messages.UnexpectedReserved);else if(strict&&isStrictModeReservedWord(token.value))return void throwErrorTolerant(token,Messages.StrictReservedWord);throwError(token,Messages.UnexpectedToken,token.value)}throwError(token,Messages.UnexpectedToken,token.value)}function expect(value){var token=lex();token.type===Token.Punctuator&&token.value===value||throwUnexpected(token)}function expectKeyword(keyword){var token=lex();token.type===Token.Keyword&&token.value===keyword||throwUnexpected(token)}function match(value){var token=lookahead();return token.type===Token.Punctuator&&token.value===value}function matchKeyword(keyword){var token=lookahead();return token.type===Token.Keyword&&token.value===keyword}function matchAssign(){var token=lookahead(),op=token.value;return token.type===Token.Punctuator&&("="===op||"*="===op||"/="===op||"%="===op||"+="===op||"-="===op||"<<="===op||">>="===op||">>>="===op||"&="===op||"^="===op||"|="===op)}function consumeSemicolon(){var token,line;if(";"===source[index])return void lex();if(line=lineNumber,skipComment(),lineNumber===line){if(match(";"))return void lex();token=lookahead(),token.type===Token.EOF||match("}")||throwUnexpected(token)}}function isLeftHandSide(expr){return expr.type===Syntax.Identifier||expr.type===Syntax.MemberExpression}function parseArrayInitialiser(){var elements=[];for(expect("[");!match("]");)match(",")?(lex(),elements.push(null)):(elements.push(parseAssignmentExpression()),match("]")||expect(","));return expect("]"),{type:Syntax.ArrayExpression,elements:elements}}function parsePropertyFunction(param,first){var previousStrict,body;return previousStrict=strict,body=parseFunctionSourceElements(),first&&strict&&isRestrictedWord(param[0].name)&&throwErrorTolerant(first,Messages.StrictParamName),strict=previousStrict,{type:Syntax.FunctionExpression,id:null,params:param,defaults:[],body:body,rest:null,generator:!1,expression:!1}}function parseObjectPropertyKey(){var token=lex();return token.type===Token.StringLiteral||token.type===Token.NumericLiteral?(strict&&token.octal&&throwErrorTolerant(token,Messages.StrictOctalLiteral),createLiteral(token)):{type:Syntax.Identifier,name:token.value}}function parseObjectProperty(){var token,key,id,param;return token=lookahead(),token.type===Token.Identifier?(id=parseObjectPropertyKey(),"get"!==token.value||match(":")?"set"!==token.value||match(":")?(expect(":"),{type:Syntax.Property,key:id,value:parseAssignmentExpression(),kind:"init"}):(key=parseObjectPropertyKey(),expect("("),token=lookahead(),token.type!==Token.Identifier?(expect(")"),throwErrorTolerant(token,Messages.UnexpectedToken,token.value),{type:Syntax.Property,key:key,value:parsePropertyFunction([]),kind:"set"}):(param=[parseVariableIdentifier()],expect(")"),{type:Syntax.Property,key:key,value:parsePropertyFunction(param,token),kind:"set"})):(key=parseObjectPropertyKey(),expect("("),expect(")"),{type:Syntax.Property,key:key,value:parsePropertyFunction([]),kind:"get"})):token.type!==Token.EOF&&token.type!==Token.Punctuator?(key=parseObjectPropertyKey(),expect(":"),{type:Syntax.Property,key:key,value:parseAssignmentExpression(),kind:"init"}):void throwUnexpected(token)}function parseObjectInitialiser(){var property,name,kind,properties=[],map={},toString=String;for(expect("{");!match("}");)property=parseObjectProperty(),name=property.key.type===Syntax.Identifier?property.key.name:toString(property.key.value),kind="init"===property.kind?PropertyKind.Data:"get"===property.kind?PropertyKind.Get:PropertyKind.Set,Object.prototype.hasOwnProperty.call(map,name)?(map[name]===PropertyKind.Data?strict&&kind===PropertyKind.Data?throwErrorTolerant({},Messages.StrictDuplicateProperty):kind!==PropertyKind.Data&&throwErrorTolerant({},Messages.AccessorDataProperty):kind===PropertyKind.Data?throwErrorTolerant({},Messages.AccessorDataProperty):map[name]&kind&&throwErrorTolerant({},Messages.AccessorGetSet),map[name]|=kind):map[name]=kind,properties.push(property),match("}")||expect(",");return expect("}"),{type:Syntax.ObjectExpression,properties:properties}}function parseGroupExpression(){var expr;return expect("("),expr=parseExpression(),expect(")"),expr}function parsePrimaryExpression(){var token=lookahead(),type=token.type;if(type===Token.Identifier)return{type:Syntax.Identifier,name:lex().value};if(type===Token.StringLiteral||type===Token.NumericLiteral)return strict&&token.octal&&throwErrorTolerant(token,Messages.StrictOctalLiteral),createLiteral(lex());if(type===Token.Keyword){if(matchKeyword("this"))return lex(),{type:Syntax.ThisExpression};if(matchKeyword("function"))return parseFunctionExpression()}return type===Token.BooleanLiteral?(lex(),token.value="true"===token.value,createLiteral(token)):type===Token.NullLiteral?(lex(),token.value=null,createLiteral(token)):match("[")?parseArrayInitialiser():match("{")?parseObjectInitialiser():match("(")?parseGroupExpression():match("/")||match("/=")?createLiteral(scanRegExp()):throwUnexpected(lex())}function parseArguments(){var args=[];if(expect("("),!match(")"))for(;index<length&&(args.push(parseAssignmentExpression()),!match(")"));)expect(",");return expect(")"),args}function parseNonComputedProperty(){var token=lex();return isIdentifierName(token)||throwUnexpected(token),{type:Syntax.Identifier,name:token.value}}function parseNonComputedMember(){return expect("."),parseNonComputedProperty()}function parseComputedMember(){var expr;return expect("["),expr=parseExpression(),expect("]"),expr}function parseNewExpression(){var expr;return expectKeyword("new"),expr={type:Syntax.NewExpression,callee:parseLeftHandSideExpression(),arguments:[]},match("(")&&(expr.arguments=parseArguments()),expr}function parseLeftHandSideExpressionAllowCall(){var expr;for(expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();match(".")||match("[")||match("(");)expr=match("(")?{type:Syntax.CallExpression,callee:expr,arguments:parseArguments()}:match("[")?{type:Syntax.MemberExpression,computed:!0,object:expr,property:parseComputedMember()}:{type:Syntax.MemberExpression,computed:!1,object:expr,property:parseNonComputedMember()};return expr}function parseLeftHandSideExpression(){var expr;for(expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();match(".")||match("[");)expr=match("[")?{type:Syntax.MemberExpression,computed:!0,object:expr,property:parseComputedMember()}:{type:Syntax.MemberExpression,computed:!1,object:expr,property:parseNonComputedMember()};return expr}function parsePostfixExpression(){var token,expr=parseLeftHandSideExpressionAllowCall();return token=lookahead(),token.type!==Token.Punctuator?expr:(!match("++")&&!match("--")||peekLineTerminator()||(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)&&throwErrorTolerant({},Messages.StrictLHSPostfix),isLeftHandSide(expr)||throwErrorTolerant({},Messages.InvalidLHSInAssignment),expr={type:Syntax.UpdateExpression,operator:lex().value,argument:expr,prefix:!1}),expr)}function parseUnaryExpression(){var token,expr;return token=lookahead(),token.type!==Token.Punctuator&&token.type!==Token.Keyword?parsePostfixExpression():match("++")||match("--")?(token=lex(),expr=parseUnaryExpression(),strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)&&throwErrorTolerant({},Messages.StrictLHSPrefix),isLeftHandSide(expr)||throwErrorTolerant({},Messages.InvalidLHSInAssignment),expr={type:Syntax.UpdateExpression,operator:token.value,argument:expr,prefix:!0}):match("+")||match("-")||match("~")||match("!")?expr={type:Syntax.UnaryExpression,operator:lex().value,argument:parseUnaryExpression(),prefix:!0}:matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")?(expr={type:Syntax.UnaryExpression,operator:lex().value,argument:parseUnaryExpression(),prefix:!0},strict&&"delete"===expr.operator&&expr.argument.type===Syntax.Identifier&&throwErrorTolerant({},Messages.StrictDelete),expr):parsePostfixExpression()}function parseMultiplicativeExpression(){for(var expr=parseUnaryExpression();match("*")||match("/")||match("%");)expr={type:Syntax.BinaryExpression,operator:lex().value,left:expr,right:parseUnaryExpression()};return expr}function parseAdditiveExpression(){for(var expr=parseMultiplicativeExpression();match("+")||match("-");)expr={type:Syntax.BinaryExpression,operator:lex().value,left:expr,right:parseMultiplicativeExpression()};return expr}function parseShiftExpression(){for(var expr=parseAdditiveExpression();match("<<")||match(">>")||match(">>>");)expr={type:Syntax.BinaryExpression,operator:lex().value,left:expr,right:parseAdditiveExpression()};return expr}function parseRelationalExpression(){var expr,previousAllowIn;for(previousAllowIn=state.allowIn,state.allowIn=!0,expr=parseShiftExpression();match("<")||match(">")||match("<=")||match(">=")||previousAllowIn&&matchKeyword("in")||matchKeyword("instanceof");)expr={type:Syntax.BinaryExpression,operator:lex().value,left:expr,right:parseShiftExpression()};return state.allowIn=previousAllowIn,expr}function parseEqualityExpression(){for(var expr=parseRelationalExpression();match("==")||match("!=")||match("===")||match("!==");)expr={type:Syntax.BinaryExpression,operator:lex().value,left:expr,right:parseRelationalExpression()};return expr}function parseBitwiseANDExpression(){for(var expr=parseEqualityExpression();match("&");)lex(),expr={type:Syntax.BinaryExpression,operator:"&",left:expr,right:parseEqualityExpression()};return expr}function parseBitwiseXORExpression(){for(var expr=parseBitwiseANDExpression();match("^");)lex(),expr={type:Syntax.BinaryExpression,operator:"^",left:expr,right:parseBitwiseANDExpression()};return expr}function parseBitwiseORExpression(){for(var expr=parseBitwiseXORExpression();match("|");)lex(),expr={type:Syntax.BinaryExpression,operator:"|",left:expr,right:parseBitwiseXORExpression()};return expr}function parseLogicalANDExpression(){for(var expr=parseBitwiseORExpression();match("&&");)lex(),expr={type:Syntax.LogicalExpression,operator:"&&",left:expr,right:parseBitwiseORExpression()};return expr}function parseLogicalORExpression(){for(var expr=parseLogicalANDExpression();match("||");)lex(),expr={type:Syntax.LogicalExpression,operator:"||",left:expr,right:parseLogicalANDExpression()};return expr}function parseConditionalExpression(){var expr,previousAllowIn,consequent;return expr=parseLogicalORExpression(),match("?")&&(lex(),previousAllowIn=state.allowIn,state.allowIn=!0,consequent=parseAssignmentExpression(),state.allowIn=previousAllowIn,expect(":"),expr={type:Syntax.ConditionalExpression,test:expr,consequent:consequent,alternate:parseAssignmentExpression()}),expr}function parseAssignmentExpression(){var token,expr;return token=lookahead(),expr=parseConditionalExpression(),matchAssign()&&(isLeftHandSide(expr)||throwErrorTolerant({},Messages.InvalidLHSInAssignment),strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)&&throwErrorTolerant(token,Messages.StrictLHSAssignment),expr={type:Syntax.AssignmentExpression,operator:lex().value,left:expr,right:parseAssignmentExpression()}),expr}function parseExpression(){var expr=parseAssignmentExpression();if(match(","))for(expr={type:Syntax.SequenceExpression,expressions:[expr]};index<length&&match(",");)lex(),expr.expressions.push(parseAssignmentExpression());return expr}function parseStatementList(){for(var statement,list=[];index<length&&!match("}")&&(statement=parseSourceElement(),void 0!==statement);)list.push(statement);return list}function parseBlock(){var block;return expect("{"),block=parseStatementList(),expect("}"),{type:Syntax.BlockStatement,body:block}}function parseVariableIdentifier(){var token=lex();return token.type!==Token.Identifier&&throwUnexpected(token),{type:Syntax.Identifier,name:token.value}}function parseVariableDeclaration(kind){var id=parseVariableIdentifier(),init=null;return strict&&isRestrictedWord(id.name)&&throwErrorTolerant({},Messages.StrictVarName),"const"===kind?(expect("="),init=parseAssignmentExpression()):match("=")&&(lex(),
init=parseAssignmentExpression()),{type:Syntax.VariableDeclarator,id:id,init:init}}function parseVariableDeclarationList(kind){var list=[];do{if(list.push(parseVariableDeclaration(kind)),!match(","))break;lex()}while(index<length);return list}function parseVariableStatement(){var declarations;return expectKeyword("var"),declarations=parseVariableDeclarationList(),consumeSemicolon(),{type:Syntax.VariableDeclaration,declarations:declarations,kind:"var"}}function parseConstLetDeclaration(kind){var declarations;return expectKeyword(kind),declarations=parseVariableDeclarationList(kind),consumeSemicolon(),{type:Syntax.VariableDeclaration,declarations:declarations,kind:kind}}function parseEmptyStatement(){return expect(";"),{type:Syntax.EmptyStatement}}function parseExpressionStatement(){var expr=parseExpression();return consumeSemicolon(),{type:Syntax.ExpressionStatement,expression:expr}}function parseIfStatement(){var test,consequent,alternate;return expectKeyword("if"),expect("("),test=parseExpression(),expect(")"),consequent=parseStatement(),matchKeyword("else")?(lex(),alternate=parseStatement()):alternate=null,{type:Syntax.IfStatement,test:test,consequent:consequent,alternate:alternate}}function parseDoWhileStatement(){var body,test,oldInIteration;return expectKeyword("do"),oldInIteration=state.inIteration,state.inIteration=!0,body=parseStatement(),state.inIteration=oldInIteration,expectKeyword("while"),expect("("),test=parseExpression(),expect(")"),match(";")&&lex(),{type:Syntax.DoWhileStatement,body:body,test:test}}function parseWhileStatement(){var test,body,oldInIteration;return expectKeyword("while"),expect("("),test=parseExpression(),expect(")"),oldInIteration=state.inIteration,state.inIteration=!0,body=parseStatement(),state.inIteration=oldInIteration,{type:Syntax.WhileStatement,test:test,body:body}}function parseForVariableDeclaration(){var token=lex();return{type:Syntax.VariableDeclaration,declarations:parseVariableDeclarationList(),kind:token.value}}function parseForStatement(){var init,test,update,left,right,body,oldInIteration;return init=test=update=null,expectKeyword("for"),expect("("),match(";")?lex():(matchKeyword("var")||matchKeyword("let")?(state.allowIn=!1,init=parseForVariableDeclaration(),state.allowIn=!0,1===init.declarations.length&&matchKeyword("in")&&(lex(),left=init,right=parseExpression(),init=null)):(state.allowIn=!1,init=parseExpression(),state.allowIn=!0,matchKeyword("in")&&(isLeftHandSide(init)||throwErrorTolerant({},Messages.InvalidLHSInForIn),lex(),left=init,right=parseExpression(),init=null)),void 0===left&&expect(";")),void 0===left&&(match(";")||(test=parseExpression()),expect(";"),match(")")||(update=parseExpression())),expect(")"),oldInIteration=state.inIteration,state.inIteration=!0,body=parseStatement(),state.inIteration=oldInIteration,void 0===left?{type:Syntax.ForStatement,init:init,test:test,update:update,body:body}:{type:Syntax.ForInStatement,left:left,right:right,body:body,each:!1}}function parseContinueStatement(){var token,label=null;return expectKeyword("continue"),";"===source[index]?(lex(),state.inIteration||throwError({},Messages.IllegalContinue),{type:Syntax.ContinueStatement,label:null}):peekLineTerminator()?(state.inIteration||throwError({},Messages.IllegalContinue),{type:Syntax.ContinueStatement,label:null}):(token=lookahead(),token.type===Token.Identifier&&(label=parseVariableIdentifier(),Object.prototype.hasOwnProperty.call(state.labelSet,label.name)||throwError({},Messages.UnknownLabel,label.name)),consumeSemicolon(),null!==label||state.inIteration||throwError({},Messages.IllegalContinue),{type:Syntax.ContinueStatement,label:label})}function parseBreakStatement(){var token,label=null;return expectKeyword("break"),";"===source[index]?(lex(),state.inIteration||state.inSwitch||throwError({},Messages.IllegalBreak),{type:Syntax.BreakStatement,label:null}):peekLineTerminator()?(state.inIteration||state.inSwitch||throwError({},Messages.IllegalBreak),{type:Syntax.BreakStatement,label:null}):(token=lookahead(),token.type===Token.Identifier&&(label=parseVariableIdentifier(),Object.prototype.hasOwnProperty.call(state.labelSet,label.name)||throwError({},Messages.UnknownLabel,label.name)),consumeSemicolon(),null!==label||state.inIteration||state.inSwitch||throwError({},Messages.IllegalBreak),{type:Syntax.BreakStatement,label:label})}function parseReturnStatement(){var token,argument=null;return expectKeyword("return"),state.inFunctionBody||throwErrorTolerant({},Messages.IllegalReturn)," "===source[index]&&isIdentifierStart(source[index+1])?(argument=parseExpression(),consumeSemicolon(),{type:Syntax.ReturnStatement,argument:argument}):peekLineTerminator()?{type:Syntax.ReturnStatement,argument:null}:(match(";")||(token=lookahead(),match("}")||token.type===Token.EOF||(argument=parseExpression())),consumeSemicolon(),{type:Syntax.ReturnStatement,argument:argument})}function parseWithStatement(){var object,body;return strict&&throwErrorTolerant({},Messages.StrictModeWith),expectKeyword("with"),expect("("),object=parseExpression(),expect(")"),body=parseStatement(),{type:Syntax.WithStatement,object:object,body:body}}function parseSwitchCase(){var test,statement,consequent=[];for(matchKeyword("default")?(lex(),test=null):(expectKeyword("case"),test=parseExpression()),expect(":");index<length&&!(match("}")||matchKeyword("default")||matchKeyword("case"))&&(statement=parseStatement(),void 0!==statement);)consequent.push(statement);return{type:Syntax.SwitchCase,test:test,consequent:consequent}}function parseSwitchStatement(){var discriminant,cases,clause,oldInSwitch,defaultFound;if(expectKeyword("switch"),expect("("),discriminant=parseExpression(),expect(")"),expect("{"),cases=[],match("}"))return lex(),{type:Syntax.SwitchStatement,discriminant:discriminant,cases:cases};for(oldInSwitch=state.inSwitch,state.inSwitch=!0,defaultFound=!1;index<length&&!match("}");)clause=parseSwitchCase(),null===clause.test&&(defaultFound&&throwError({},Messages.MultipleDefaultsInSwitch),defaultFound=!0),cases.push(clause);return state.inSwitch=oldInSwitch,expect("}"),{type:Syntax.SwitchStatement,discriminant:discriminant,cases:cases}}function parseThrowStatement(){var argument;return expectKeyword("throw"),peekLineTerminator()&&throwError({},Messages.NewlineAfterThrow),argument=parseExpression(),consumeSemicolon(),{type:Syntax.ThrowStatement,argument:argument}}function parseCatchClause(){var param;return expectKeyword("catch"),expect("("),match(")")&&throwUnexpected(lookahead()),param=parseVariableIdentifier(),strict&&isRestrictedWord(param.name)&&throwErrorTolerant({},Messages.StrictCatchVariable),expect(")"),{type:Syntax.CatchClause,param:param,body:parseBlock()}}function parseTryStatement(){var block,handlers=[],finalizer=null;return expectKeyword("try"),block=parseBlock(),matchKeyword("catch")&&handlers.push(parseCatchClause()),matchKeyword("finally")&&(lex(),finalizer=parseBlock()),0!==handlers.length||finalizer||throwError({},Messages.NoCatchOrFinally),{type:Syntax.TryStatement,block:block,guardedHandlers:[],handlers:handlers,finalizer:finalizer}}function parseDebuggerStatement(){return expectKeyword("debugger"),consumeSemicolon(),{type:Syntax.DebuggerStatement}}function parseStatement(){var expr,labeledBody,token=lookahead();if(token.type===Token.EOF&&throwUnexpected(token),token.type===Token.Punctuator)switch(token.value){case";":return parseEmptyStatement();case"{":return parseBlock();case"(":return parseExpressionStatement()}if(token.type===Token.Keyword)switch(token.value){case"break":return parseBreakStatement();case"continue":return parseContinueStatement();case"debugger":return parseDebuggerStatement();case"do":return parseDoWhileStatement();case"for":return parseForStatement();case"function":return parseFunctionDeclaration();case"if":return parseIfStatement();case"return":return parseReturnStatement();case"switch":return parseSwitchStatement();case"throw":return parseThrowStatement();case"try":return parseTryStatement();case"var":return parseVariableStatement();case"while":return parseWhileStatement();case"with":return parseWithStatement()}return expr=parseExpression(),expr.type===Syntax.Identifier&&match(":")?(lex(),Object.prototype.hasOwnProperty.call(state.labelSet,expr.name)&&throwError({},Messages.Redeclaration,"Label",expr.name),state.labelSet[expr.name]=!0,labeledBody=parseStatement(),delete state.labelSet[expr.name],{type:Syntax.LabeledStatement,label:expr,body:labeledBody}):(consumeSemicolon(),{type:Syntax.ExpressionStatement,expression:expr})}function parseFunctionSourceElements(){var sourceElement,token,directive,firstRestricted,oldLabelSet,oldInIteration,oldInSwitch,oldInFunctionBody,sourceElements=[];for(expect("{");index<length&&(token=lookahead(),token.type===Token.StringLiteral)&&(sourceElement=parseSourceElement(),sourceElements.push(sourceElement),sourceElement.expression.type===Syntax.Literal);)directive=sliceSource(token.range[0]+1,token.range[1]-1),"use strict"===directive?(strict=!0,firstRestricted&&throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)):!firstRestricted&&token.octal&&(firstRestricted=token);for(oldLabelSet=state.labelSet,oldInIteration=state.inIteration,oldInSwitch=state.inSwitch,oldInFunctionBody=state.inFunctionBody,state.labelSet={},state.inIteration=!1,state.inSwitch=!1,state.inFunctionBody=!0;index<length&&!match("}")&&(sourceElement=parseSourceElement(),void 0!==sourceElement);)sourceElements.push(sourceElement);return expect("}"),state.labelSet=oldLabelSet,state.inIteration=oldInIteration,state.inSwitch=oldInSwitch,state.inFunctionBody=oldInFunctionBody,{type:Syntax.BlockStatement,body:sourceElements}}function parseFunctionDeclaration(){var id,param,body,token,stricted,firstRestricted,message,previousStrict,paramSet,params=[];if(expectKeyword("function"),token=lookahead(),id=parseVariableIdentifier(),strict?isRestrictedWord(token.value)&&throwErrorTolerant(token,Messages.StrictFunctionName):isRestrictedWord(token.value)?(firstRestricted=token,message=Messages.StrictFunctionName):isStrictModeReservedWord(token.value)&&(firstRestricted=token,message=Messages.StrictReservedWord),expect("("),!match(")"))for(paramSet={};index<length&&(token=lookahead(),param=parseVariableIdentifier(),strict?(isRestrictedWord(token.value)&&(stricted=token,message=Messages.StrictParamName),Object.prototype.hasOwnProperty.call(paramSet,token.value)&&(stricted=token,message=Messages.StrictParamDupe)):firstRestricted||(isRestrictedWord(token.value)?(firstRestricted=token,message=Messages.StrictParamName):isStrictModeReservedWord(token.value)?(firstRestricted=token,message=Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(paramSet,token.value)&&(firstRestricted=token,message=Messages.StrictParamDupe)),params.push(param),paramSet[param.name]=!0,!match(")"));)expect(",");return expect(")"),previousStrict=strict,body=parseFunctionSourceElements(),strict&&firstRestricted&&throwError(firstRestricted,message),strict&&stricted&&throwErrorTolerant(stricted,message),strict=previousStrict,{type:Syntax.FunctionDeclaration,id:id,params:params,defaults:[],body:body,rest:null,generator:!1,expression:!1}}function parseFunctionExpression(){var token,stricted,firstRestricted,message,param,body,previousStrict,paramSet,id=null,params=[];if(expectKeyword("function"),match("(")||(token=lookahead(),id=parseVariableIdentifier(),strict?isRestrictedWord(token.value)&&throwErrorTolerant(token,Messages.StrictFunctionName):isRestrictedWord(token.value)?(firstRestricted=token,message=Messages.StrictFunctionName):isStrictModeReservedWord(token.value)&&(firstRestricted=token,message=Messages.StrictReservedWord)),expect("("),!match(")"))for(paramSet={};index<length&&(token=lookahead(),param=parseVariableIdentifier(),strict?(isRestrictedWord(token.value)&&(stricted=token,message=Messages.StrictParamName),Object.prototype.hasOwnProperty.call(paramSet,token.value)&&(stricted=token,message=Messages.StrictParamDupe)):firstRestricted||(isRestrictedWord(token.value)?(firstRestricted=token,message=Messages.StrictParamName):isStrictModeReservedWord(token.value)?(firstRestricted=token,message=Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(paramSet,token.value)&&(firstRestricted=token,message=Messages.StrictParamDupe)),params.push(param),paramSet[param.name]=!0,!match(")"));)expect(",");return expect(")"),previousStrict=strict,body=parseFunctionSourceElements(),strict&&firstRestricted&&throwError(firstRestricted,message),strict&&stricted&&throwErrorTolerant(stricted,message),strict=previousStrict,{type:Syntax.FunctionExpression,id:id,params:params,defaults:[],body:body,rest:null,generator:!1,expression:!1}}function parseSourceElement(){var token=lookahead();if(token.type===Token.Keyword)switch(token.value){case"const":case"let":return parseConstLetDeclaration(token.value);case"function":return parseFunctionDeclaration();default:return parseStatement()}if(token.type!==Token.EOF)return parseStatement()}function parseSourceElements(){for(var sourceElement,token,directive,firstRestricted,sourceElements=[];index<length&&(token=lookahead(),token.type===Token.StringLiteral)&&(sourceElement=parseSourceElement(),sourceElements.push(sourceElement),sourceElement.expression.type===Syntax.Literal);)directive=sliceSource(token.range[0]+1,token.range[1]-1),"use strict"===directive?(strict=!0,firstRestricted&&throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)):!firstRestricted&&token.octal&&(firstRestricted=token);for(;index<length&&(sourceElement=parseSourceElement(),void 0!==sourceElement);)sourceElements.push(sourceElement);return sourceElements}function parseProgram(){return strict=!1,{type:Syntax.Program,body:parseSourceElements()}}function addComment(type,value,start,end,loc){assert("number"==typeof start,"Comment must have valid position"),extra.comments.length>0&&extra.comments[extra.comments.length-1].range[1]>start||extra.comments.push({type:type,value:value,range:[start,end],loc:loc})}function scanComment(){var comment,ch,loc,start,blockComment,lineComment;for(comment="",blockComment=!1,lineComment=!1;index<length;)if(ch=source[index],lineComment)ch=source[index++],isLineTerminator(ch)?(loc.end={line:lineNumber,column:index-lineStart-1},lineComment=!1,addComment("Line",comment,start,index-1,loc),"\r"===ch&&"\n"===source[index]&&++index,++lineNumber,lineStart=index,comment=""):index>=length?(lineComment=!1,comment+=ch,loc.end={line:lineNumber,column:length-lineStart},addComment("Line",comment,start,length,loc)):comment+=ch;else if(blockComment)isLineTerminator(ch)?("\r"===ch&&"\n"===source[index+1]?(++index,comment+="\r\n"):comment+=ch,++lineNumber,++index,lineStart=index,index>=length&&throwError({},Messages.UnexpectedToken,"ILLEGAL")):(ch=source[index++],index>=length&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),comment+=ch,"*"===ch&&(ch=source[index],"/"===ch&&(comment=comment.substr(0,comment.length-1),blockComment=!1,++index,loc.end={line:lineNumber,column:index-lineStart},addComment("Block",comment,start,index,loc),comment="")));else if("/"===ch)if(ch=source[index+1],"/"===ch)loc={start:{line:lineNumber,column:index-lineStart}},start=index,index+=2,lineComment=!0,index>=length&&(loc.end={line:lineNumber,column:index-lineStart},lineComment=!1,addComment("Line",comment,start,index,loc));else{if("*"!==ch)break;start=index,index+=2,blockComment=!0,loc={start:{line:lineNumber,column:index-lineStart-2}},index>=length&&throwError({},Messages.UnexpectedToken,"ILLEGAL")}else if(isWhiteSpace(ch))++index;else{if(!isLineTerminator(ch))break;++index,"\r"===ch&&"\n"===source[index]&&++index,++lineNumber,lineStart=index}}function filterCommentLocation(){var i,entry,comment,comments=[];for(i=0;i<extra.comments.length;++i)entry=extra.comments[i],comment={type:entry.type,value:entry.value},extra.range&&(comment.range=entry.range),extra.loc&&(comment.loc=entry.loc),comments.push(comment);extra.comments=comments}function collectToken(){var loc,token,range,value;return skipComment(),index,loc={start:{line:lineNumber,column:index-lineStart}},token=extra.advance(),loc.end={line:lineNumber,column:index-lineStart},token.type!==Token.EOF&&(range=[token.range[0],token.range[1]],value=sliceSource(token.range[0],token.range[1]),extra.tokens.push({type:TokenName[token.type],value:value,range:range,loc:loc})),token}function collectRegex(){var pos,loc,regex,token;return skipComment(),pos=index,loc={start:{line:lineNumber,column:index-lineStart}},regex=extra.scanRegExp(),loc.end={line:lineNumber,column:index-lineStart},extra.tokens.length>0&&(token=extra.tokens[extra.tokens.length-1],token.range[0]===pos&&"Punctuator"===token.type&&("/"!==token.value&&"/="!==token.value||extra.tokens.pop())),extra.tokens.push({type:"RegularExpression",value:regex.literal,range:[pos,index],loc:loc}),regex}function filterTokenLocation(){var i,entry,token,tokens=[];for(i=0;i<extra.tokens.length;++i)entry=extra.tokens[i],token={type:entry.type,value:entry.value},extra.range&&(token.range=entry.range),extra.loc&&(token.loc=entry.loc),tokens.push(token);extra.tokens=tokens}function createLiteral(token){return{type:Syntax.Literal,value:token.value}}function createRawLiteral(token){return{type:Syntax.Literal,value:token.value,raw:sliceSource(token.range[0],token.range[1])}}function createLocationMarker(){var marker={};return marker.range=[index,index],marker.loc={start:{line:lineNumber,column:index-lineStart},end:{line:lineNumber,column:index-lineStart}},marker.end=function(){this.range[1]=index,this.loc.end.line=lineNumber,this.loc.end.column=index-lineStart},marker.applyGroup=function(node){extra.range&&(node.groupRange=[this.range[0],this.range[1]]),extra.loc&&(node.groupLoc={start:{line:this.loc.start.line,column:this.loc.start.column},end:{line:this.loc.end.line,column:this.loc.end.column}})},marker.apply=function(node){extra.range&&(node.range=[this.range[0],this.range[1]]),extra.loc&&(node.loc={start:{line:this.loc.start.line,column:this.loc.start.column},end:{line:this.loc.end.line,column:this.loc.end.column}})},marker}function trackGroupExpression(){var marker,expr;return skipComment(),marker=createLocationMarker(),expect("("),expr=parseExpression(),expect(")"),marker.end(),marker.applyGroup(expr),expr}function trackLeftHandSideExpression(){var marker,expr;for(skipComment(),marker=createLocationMarker(),expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();match(".")||match("[");)match("[")?(expr={type:Syntax.MemberExpression,computed:!0,object:expr,property:parseComputedMember()},marker.end(),marker.apply(expr)):(expr={type:Syntax.MemberExpression,computed:!1,object:expr,property:parseNonComputedMember()},marker.end(),marker.apply(expr));return expr}function trackLeftHandSideExpressionAllowCall(){var marker,expr;for(skipComment(),marker=createLocationMarker(),expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();match(".")||match("[")||match("(");)match("(")?(expr={type:Syntax.CallExpression,callee:expr,arguments:parseArguments()},marker.end(),marker.apply(expr)):match("[")?(expr={type:Syntax.MemberExpression,computed:!0,object:expr,property:parseComputedMember()},marker.end(),marker.apply(expr)):(expr={type:Syntax.MemberExpression,computed:!1,object:expr,property:parseNonComputedMember()},marker.end(),marker.apply(expr));return expr}function filterGroup(node){var n,i,entry;n="[object Array]"===Object.prototype.toString.apply(node)?[]:{};for(i in node)node.hasOwnProperty(i)&&"groupRange"!==i&&"groupLoc"!==i&&(entry=node[i],null===entry||"object"!=typeof entry||entry instanceof RegExp?n[i]=entry:n[i]=filterGroup(entry));return n}function wrapTrackingFunction(range,loc){return function(parseFunction){function isBinary(node){return node.type===Syntax.LogicalExpression||node.type===Syntax.BinaryExpression}function visit(node){var start,end;isBinary(node.left)&&visit(node.left),isBinary(node.right)&&visit(node.right),range&&(node.left.groupRange||node.right.groupRange?(start=node.left.groupRange?node.left.groupRange[0]:node.left.range[0],end=node.right.groupRange?node.right.groupRange[1]:node.right.range[1],node.range=[start,end]):"undefined"==typeof node.range&&(start=node.left.range[0],end=node.right.range[1],node.range=[start,end])),loc&&(node.left.groupLoc||node.right.groupLoc?(start=node.left.groupLoc?node.left.groupLoc.start:node.left.loc.start,end=node.right.groupLoc?node.right.groupLoc.end:node.right.loc.end,node.loc={start:start,end:end}):"undefined"==typeof node.loc&&(node.loc={start:node.left.loc.start,end:node.right.loc.end}))}return function(){var marker,node;return skipComment(),marker=createLocationMarker(),node=parseFunction.apply(null,arguments),marker.end(),range&&"undefined"==typeof node.range&&marker.apply(node),loc&&"undefined"==typeof node.loc&&marker.apply(node),isBinary(node)&&visit(node),node}}}function patch(){var wrapTracking;extra.comments&&(extra.skipComment=skipComment,skipComment=scanComment),extra.raw&&(extra.createLiteral=createLiteral,createLiteral=createRawLiteral),(extra.range||extra.loc)&&(extra.parseGroupExpression=parseGroupExpression,extra.parseLeftHandSideExpression=parseLeftHandSideExpression,extra.parseLeftHandSideExpressionAllowCall=parseLeftHandSideExpressionAllowCall,parseGroupExpression=trackGroupExpression,parseLeftHandSideExpression=trackLeftHandSideExpression,parseLeftHandSideExpressionAllowCall=trackLeftHandSideExpressionAllowCall,wrapTracking=wrapTrackingFunction(extra.range,extra.loc),extra.parseAdditiveExpression=parseAdditiveExpression,extra.parseAssignmentExpression=parseAssignmentExpression,extra.parseBitwiseANDExpression=parseBitwiseANDExpression,extra.parseBitwiseORExpression=parseBitwiseORExpression,extra.parseBitwiseXORExpression=parseBitwiseXORExpression,extra.parseBlock=parseBlock,extra.parseFunctionSourceElements=parseFunctionSourceElements,extra.parseCatchClause=parseCatchClause,extra.parseComputedMember=parseComputedMember,extra.parseConditionalExpression=parseConditionalExpression,extra.parseConstLetDeclaration=parseConstLetDeclaration,extra.parseEqualityExpression=parseEqualityExpression,extra.parseExpression=parseExpression,extra.parseForVariableDeclaration=parseForVariableDeclaration,extra.parseFunctionDeclaration=parseFunctionDeclaration,extra.parseFunctionExpression=parseFunctionExpression,extra.parseLogicalANDExpression=parseLogicalANDExpression,extra.parseLogicalORExpression=parseLogicalORExpression,extra.parseMultiplicativeExpression=parseMultiplicativeExpression,extra.parseNewExpression=parseNewExpression,extra.parseNonComputedProperty=parseNonComputedProperty,extra.parseObjectProperty=parseObjectProperty,extra.parseObjectPropertyKey=parseObjectPropertyKey,extra.parsePostfixExpression=parsePostfixExpression,extra.parsePrimaryExpression=parsePrimaryExpression,extra.parseProgram=parseProgram,extra.parsePropertyFunction=parsePropertyFunction,extra.parseRelationalExpression=parseRelationalExpression,extra.parseStatement=parseStatement,extra.parseShiftExpression=parseShiftExpression,extra.parseSwitchCase=parseSwitchCase,extra.parseUnaryExpression=parseUnaryExpression,extra.parseVariableDeclaration=parseVariableDeclaration,extra.parseVariableIdentifier=parseVariableIdentifier,parseAdditiveExpression=wrapTracking(extra.parseAdditiveExpression),parseAssignmentExpression=wrapTracking(extra.parseAssignmentExpression),parseBitwiseANDExpression=wrapTracking(extra.parseBitwiseANDExpression),parseBitwiseORExpression=wrapTracking(extra.parseBitwiseORExpression),parseBitwiseXORExpression=wrapTracking(extra.parseBitwiseXORExpression),parseBlock=wrapTracking(extra.parseBlock),parseFunctionSourceElements=wrapTracking(extra.parseFunctionSourceElements),parseCatchClause=wrapTracking(extra.parseCatchClause),parseComputedMember=wrapTracking(extra.parseComputedMember),parseConditionalExpression=wrapTracking(extra.parseConditionalExpression),parseConstLetDeclaration=wrapTracking(extra.parseConstLetDeclaration),parseEqualityExpression=wrapTracking(extra.parseEqualityExpression),parseExpression=wrapTracking(extra.parseExpression),parseForVariableDeclaration=wrapTracking(extra.parseForVariableDeclaration),parseFunctionDeclaration=wrapTracking(extra.parseFunctionDeclaration),parseFunctionExpression=wrapTracking(extra.parseFunctionExpression),parseLeftHandSideExpression=wrapTracking(parseLeftHandSideExpression),parseLogicalANDExpression=wrapTracking(extra.parseLogicalANDExpression),parseLogicalORExpression=wrapTracking(extra.parseLogicalORExpression),parseMultiplicativeExpression=wrapTracking(extra.parseMultiplicativeExpression),parseNewExpression=wrapTracking(extra.parseNewExpression),parseNonComputedProperty=wrapTracking(extra.parseNonComputedProperty),parseObjectProperty=wrapTracking(extra.parseObjectProperty),parseObjectPropertyKey=wrapTracking(extra.parseObjectPropertyKey),parsePostfixExpression=wrapTracking(extra.parsePostfixExpression),parsePrimaryExpression=wrapTracking(extra.parsePrimaryExpression),parseProgram=wrapTracking(extra.parseProgram),parsePropertyFunction=wrapTracking(extra.parsePropertyFunction),parseRelationalExpression=wrapTracking(extra.parseRelationalExpression),parseStatement=wrapTracking(extra.parseStatement),parseShiftExpression=wrapTracking(extra.parseShiftExpression),parseSwitchCase=wrapTracking(extra.parseSwitchCase),parseUnaryExpression=wrapTracking(extra.parseUnaryExpression),parseVariableDeclaration=wrapTracking(extra.parseVariableDeclaration),parseVariableIdentifier=wrapTracking(extra.parseVariableIdentifier)),"undefined"!=typeof extra.tokens&&(extra.advance=advance,extra.scanRegExp=scanRegExp,advance=collectToken,scanRegExp=collectRegex)}function unpatch(){"function"==typeof extra.skipComment&&(skipComment=extra.skipComment),extra.raw&&(createLiteral=extra.createLiteral),(extra.range||extra.loc)&&(parseAdditiveExpression=extra.parseAdditiveExpression,parseAssignmentExpression=extra.parseAssignmentExpression,parseBitwiseANDExpression=extra.parseBitwiseANDExpression,parseBitwiseORExpression=extra.parseBitwiseORExpression,parseBitwiseXORExpression=extra.parseBitwiseXORExpression,parseBlock=extra.parseBlock,parseFunctionSourceElements=extra.parseFunctionSourceElements,parseCatchClause=extra.parseCatchClause,parseComputedMember=extra.parseComputedMember,parseConditionalExpression=extra.parseConditionalExpression,parseConstLetDeclaration=extra.parseConstLetDeclaration,parseEqualityExpression=extra.parseEqualityExpression,parseExpression=extra.parseExpression,parseForVariableDeclaration=extra.parseForVariableDeclaration,parseFunctionDeclaration=extra.parseFunctionDeclaration,parseFunctionExpression=extra.parseFunctionExpression,parseGroupExpression=extra.parseGroupExpression,parseLeftHandSideExpression=extra.parseLeftHandSideExpression,parseLeftHandSideExpressionAllowCall=extra.parseLeftHandSideExpressionAllowCall,parseLogicalANDExpression=extra.parseLogicalANDExpression,parseLogicalORExpression=extra.parseLogicalORExpression,parseMultiplicativeExpression=extra.parseMultiplicativeExpression,parseNewExpression=extra.parseNewExpression,parseNonComputedProperty=extra.parseNonComputedProperty,parseObjectProperty=extra.parseObjectProperty,parseObjectPropertyKey=extra.parseObjectPropertyKey,parsePrimaryExpression=extra.parsePrimaryExpression,parsePostfixExpression=extra.parsePostfixExpression,parseProgram=extra.parseProgram,parsePropertyFunction=extra.parsePropertyFunction,parseRelationalExpression=extra.parseRelationalExpression,parseStatement=extra.parseStatement,parseShiftExpression=extra.parseShiftExpression,parseSwitchCase=extra.parseSwitchCase,parseUnaryExpression=extra.parseUnaryExpression,parseVariableDeclaration=extra.parseVariableDeclaration,parseVariableIdentifier=extra.parseVariableIdentifier),"function"==typeof extra.scanRegExp&&(advance=extra.advance,scanRegExp=extra.scanRegExp)}function stringToArray(str){var i,length=str.length,result=[];for(i=0;i<length;++i)result[i]=str.charAt(i);return result}function parse(code,options){var program,toString;toString=String,"string"==typeof code||code instanceof String||(code=toString(code)),source=code,index=0,lineNumber=source.length>0?1:0,lineStart=0,length=source.length,buffer=null,state={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1},extra={},void 0!==options&&(extra.range="boolean"==typeof options.range&&options.range,extra.loc="boolean"==typeof options.loc&&options.loc,extra.raw="boolean"==typeof options.raw&&options.raw,"boolean"==typeof options.tokens&&options.tokens&&(extra.tokens=[]),"boolean"==typeof options.comment&&options.comment&&(extra.comments=[]),"boolean"==typeof options.tolerant&&options.tolerant&&(extra.errors=[])),length>0&&"undefined"==typeof source[0]&&(code instanceof String&&(source=code.valueOf()),"undefined"==typeof source[0]&&(source=stringToArray(code))),patch();try{program=parseProgram(),"undefined"!=typeof extra.comments&&(filterCommentLocation(),program.comments=extra.comments),"undefined"!=typeof extra.tokens&&(filterTokenLocation(),program.tokens=extra.tokens),"undefined"!=typeof extra.errors&&(program.errors=extra.errors),(extra.range||extra.loc)&&(program.body=filterGroup(program.body))}catch(e){throw e}finally{unpatch(),extra={}}return program}var Token,TokenName,Syntax,PropertyKind,Messages,Regex,source,strict,index,lineNumber,lineStart,length,buffer,state,extra;Token={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8},TokenName={},TokenName[Token.BooleanLiteral]="Boolean",TokenName[Token.EOF]="<end>",TokenName[Token.Identifier]="Identifier",TokenName[Token.Keyword]="Keyword",TokenName[Token.NullLiteral]="Null",TokenName[Token.NumericLiteral]="Numeric",TokenName[Token.Punctuator]="Punctuator",TokenName[Token.StringLiteral]="String",Syntax={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},PropertyKind={Data:1,Get:2,Set:4},Messages={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",
IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},Regex={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},"undefined"==typeof"esprima"[0]&&(sliceSource=function(from,to){return source.slice(from,to).join("")}),exports.version="1.0.4",exports.parse=parse,exports.Syntax=function(){var name,types={};"function"==typeof Object.create&&(types=Object.create(null));for(name in Syntax)Syntax.hasOwnProperty(name)&&(types[name]=Syntax[name]);return"function"==typeof Object.freeze&&Object.freeze(types),types}()})},{}],151:[function(require,module,exports){!function(undefined){function init(){this._events={},this._conf&&configure.call(this,this._conf)}function configure(conf){conf&&(this._conf=conf,conf.delimiter&&(this.delimiter=conf.delimiter),conf.maxListeners&&(this._events.maxListeners=conf.maxListeners),conf.wildcard&&(this.wildcard=conf.wildcard),conf.newListener&&(this.newListener=conf.newListener),this.wildcard&&(this.listenerTree={}))}function EventEmitter(conf){this._events={},this.newListener=!1,configure.call(this,conf)}function searchListenerTree(handlers,type,tree,i){if(!tree)return[];var leaf,len,branch,xTree,xxTree,isolatedBranch,endReached,listeners=[],typeLength=type.length,currentType=type[i],nextType=type[i+1];if(i===typeLength&&tree._listeners){if("function"==typeof tree._listeners)return handlers&&handlers.push(tree._listeners),[tree];for(leaf=0,len=tree._listeners.length;leaf<len;leaf++)handlers&&handlers.push(tree._listeners[leaf]);return[tree]}if("*"===currentType||"**"===currentType||tree[currentType]){if("*"===currentType){for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i+1)));return listeners}if("**"===currentType){endReached=i+1===typeLength||i+2===typeLength&&"*"===nextType,endReached&&tree._listeners&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree,typeLength)));for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&("*"===branch||"**"===branch?(tree[branch]._listeners&&!endReached&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],typeLength))),listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i))):listeners=branch===nextType?listeners.concat(searchListenerTree(handlers,type,tree[branch],i+2)):listeners.concat(searchListenerTree(handlers,type,tree[branch],i)));return listeners}listeners=listeners.concat(searchListenerTree(handlers,type,tree[currentType],i+1))}if(xTree=tree["*"],xTree&&searchListenerTree(handlers,type,xTree,i+1),xxTree=tree["**"])if(i<typeLength){xxTree._listeners&&searchListenerTree(handlers,type,xxTree,typeLength);for(branch in xxTree)"_listeners"!==branch&&xxTree.hasOwnProperty(branch)&&(branch===nextType?searchListenerTree(handlers,type,xxTree[branch],i+2):branch===currentType?searchListenerTree(handlers,type,xxTree[branch],i+1):(isolatedBranch={},isolatedBranch[branch]=xxTree[branch],searchListenerTree(handlers,type,{"**":isolatedBranch},i+1)))}else xxTree._listeners?searchListenerTree(handlers,type,xxTree,typeLength):xxTree["*"]&&xxTree["*"]._listeners&&searchListenerTree(handlers,type,xxTree["*"],typeLength);return listeners}function growListenerTree(type,listener){type="string"==typeof type?type.split(this.delimiter):type.slice();for(var i=0,len=type.length;i+1<len;i++)if("**"===type[i]&&"**"===type[i+1])return;for(var tree=this.listenerTree,name=type.shift();name;){if(tree[name]||(tree[name]={}),tree=tree[name],0===type.length){if(tree._listeners){if("function"==typeof tree._listeners)tree._listeners=[tree._listeners,listener];else if(isArray(tree._listeners)&&(tree._listeners.push(listener),!tree._listeners.warned)){var m=10;"undefined"!=typeof this._events.maxListeners&&(m=this._events.maxListeners),m>0&&tree._listeners.length>m&&(tree._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",tree._listeners.length),console.trace&&console.trace())}}else tree._listeners=listener;return!0}name=type.shift()}return!0}var isArray=Array.isArray?Array.isArray:function(obj){return"[object Array]"===Object.prototype.toString.call(obj)};EventEmitter.EventEmitter2=EventEmitter,EventEmitter.prototype.delimiter=".",EventEmitter.prototype.setMaxListeners=function(n){this._events||init.call(this),this._events.maxListeners=n,this._conf||(this._conf={}),this._conf.maxListeners=n},EventEmitter.prototype.event="",EventEmitter.prototype.once=function(event,fn){return this.many(event,1,fn),this},EventEmitter.prototype.many=function(event,ttl,fn){function listener(){0===--ttl&&self.off(event,listener),fn.apply(this,arguments)}var self=this;if("function"!=typeof fn)throw new Error("many only accepts instances of Function");return listener._origin=fn,this.on(event,listener),self},EventEmitter.prototype.emit=function(){this._events||init.call(this);var type=arguments[0];if("newListener"===type&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var l=arguments.length,args=new Array(l-1),i=1;i<l;i++)args[i-1]=arguments[i];for(i=0,l=this._all.length;i<l;i++)this.event=type,this._all[i].apply(this,[type].concat(args))}if("error"===type&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var handler;if(this.wildcard){handler=[];var ns="string"==typeof type?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else handler=this._events[type];if("function"==typeof handler){if(this.event=type,1===arguments.length)handler.call(this);else if(arguments.length>1)switch(arguments.length){case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(var l=arguments.length,args=new Array(l-1),i=1;i<l;i++)args[i-1]=arguments[i];handler.apply(this,args)}return!0}if(handler){for(var l=arguments.length,args=new Array(l-1),i=1;i<l;i++)args[i-1]=arguments[i];for(var listeners=handler.slice(),i=0,l=listeners.length;i<l;i++)this.event=type,listeners[i].apply(this,args);return listeners.length>0||!!this._all}return!!this._all},EventEmitter.prototype.emitAsync=function(){this._events||init.call(this);var type=arguments[0];if("newListener"===type&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var promises=[];if(this._all){for(var l=arguments.length,args=new Array(l-1),i=1;i<l;i++)args[i-1]=arguments[i];for(i=0,l=this._all.length;i<l;i++)this.event=type,promises.push(this._all[i].apply(this,args))}if("error"===type&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");var handler;if(this.wildcard){handler=[];var ns="string"==typeof type?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else handler=this._events[type];if("function"==typeof handler){if(this.event=type,1===arguments.length)promises.push(handler.call(this));else if(arguments.length>1)switch(arguments.length){case 2:promises.push(handler.call(this,arguments[1]));break;case 3:promises.push(handler.call(this,arguments[1],arguments[2]));break;default:for(var l=arguments.length,args=new Array(l-1),i=1;i<l;i++)args[i-1]=arguments[i];promises.push(handler.apply(this,args))}}else if(handler){for(var l=arguments.length,args=new Array(l-1),i=1;i<l;i++)args[i-1]=arguments[i];for(var listeners=handler.slice(),i=0,l=listeners.length;i<l;i++)this.event=type,promises.push(listeners[i].apply(this,args))}return Promise.all(promises)},EventEmitter.prototype.on=function(type,listener){if("function"==typeof type)return this.onAny(type),this;if("function"!=typeof listener)throw new Error("on only accepts instances of Function");if(this._events||init.call(this),this.emit("newListener",type,listener),this.wildcard)return growListenerTree.call(this,type,listener),this;if(this._events[type]){if("function"==typeof this._events[type])this._events[type]=[this._events[type],listener];else if(isArray(this._events[type])&&(this._events[type].push(listener),!this._events[type].warned)){var m=10;"undefined"!=typeof this._events.maxListeners&&(m=this._events.maxListeners),m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),console.trace&&console.trace())}}else this._events[type]=listener;return this},EventEmitter.prototype.onAny=function(fn){if("function"!=typeof fn)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(fn),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.off=function(type,listener){function recursivelyGarbageCollect(root){if(void 0!==root){var keys=Object.keys(root);for(var i in keys){var key=keys[i],obj=root[key];obj instanceof Function||"object"!=typeof obj||(Object.keys(obj).length>0&&recursivelyGarbageCollect(root[key]),0===Object.keys(obj).length&&delete root[key])}}}if("function"!=typeof listener)throw new Error("removeListener only takes instances of Function");var handlers,leafs=[];if(this.wildcard){var ns="string"==typeof type?type.split(this.delimiter):type.slice();leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0)}else{if(!this._events[type])return this;handlers=this._events[type],leafs.push({_listeners:handlers})}for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];if(handlers=leaf._listeners,isArray(handlers)){for(var position=-1,i=0,length=handlers.length;i<length;i++)if(handlers[i]===listener||handlers[i].listener&&handlers[i].listener===listener||handlers[i]._origin&&handlers[i]._origin===listener){position=i;break}if(position<0)continue;return this.wildcard?leaf._listeners.splice(position,1):this._events[type].splice(position,1),0===handlers.length&&(this.wildcard?delete leaf._listeners:delete this._events[type]),this.emit("removeListener",type,listener),this}(handlers===listener||handlers.listener&&handlers.listener===listener||handlers._origin&&handlers._origin===listener)&&(this.wildcard?delete leaf._listeners:delete this._events[type],this.emit("removeListener",type,listener))}return recursivelyGarbageCollect(this.listenerTree),this},EventEmitter.prototype.offAny=function(fn){var fns,i=0,l=0;if(fn&&this._all&&this._all.length>0){for(fns=this._all,i=0,l=fns.length;i<l;i++)if(fn===fns[i])return fns.splice(i,1),this.emit("removeListenerAny",fn),this}else{for(fns=this._all,i=0,l=fns.length;i<l;i++)this.emit("removeListenerAny",fns[i]);this._all=[]}return this},EventEmitter.prototype.removeListener=EventEmitter.prototype.off,EventEmitter.prototype.removeAllListeners=function(type){if(0===arguments.length)return!this._events||init.call(this),this;if(this.wildcard)for(var ns="string"==typeof type?type.split(this.delimiter):type.slice(),leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0),iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];leaf._listeners=null}else{if(!this._events||!this._events[type])return this;this._events[type]=null}return this},EventEmitter.prototype.listeners=function(type){if(this.wildcard){var handlers=[],ns="string"==typeof type?type.split(this.delimiter):type.slice();return searchListenerTree.call(this,handlers,ns,this.listenerTree,0),handlers}return this._events||init.call(this),this._events[type]||(this._events[type]=[]),isArray(this._events[type])||(this._events[type]=[this._events[type]]),this._events[type]},EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return EventEmitter}):"object"==typeof exports?module.exports=EventEmitter:window.EventEmitter2=EventEmitter}()},{}],152:[function(require,module,exports){!function(undefined){function init(){this._events={},this._conf&&configure.call(this,this._conf)}function configure(conf){conf?(this._conf=conf,conf.delimiter&&(this.delimiter=conf.delimiter),this._events.maxListeners=void 0!==conf.maxListeners?conf.maxListeners:10,conf.wildcard&&(this.wildcard=conf.wildcard),conf.newListener&&(this.newListener=conf.newListener),conf.verboseMemoryLeak&&(this.verboseMemoryLeak=conf.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._events.maxListeners=10}function logPossibleMemoryLeak(count,eventName){var errorMsg="(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.";this.verboseMemoryLeak?(errorMsg+=" Event name: %s.",console.error(errorMsg,count,eventName)):console.error(errorMsg,count),console.trace&&console.trace()}function EventEmitter(conf){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,configure.call(this,conf)}function searchListenerTree(handlers,type,tree,i){if(!tree)return[];var leaf,len,branch,xTree,xxTree,isolatedBranch,endReached,listeners=[],typeLength=type.length,currentType=type[i],nextType=type[i+1];if(i===typeLength&&tree._listeners){if("function"==typeof tree._listeners)return handlers&&handlers.push(tree._listeners),[tree];for(leaf=0,len=tree._listeners.length;leaf<len;leaf++)handlers&&handlers.push(tree._listeners[leaf]);return[tree]}if("*"===currentType||"**"===currentType||tree[currentType]){if("*"===currentType){for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i+1)));return listeners}if("**"===currentType){endReached=i+1===typeLength||i+2===typeLength&&"*"===nextType,endReached&&tree._listeners&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree,typeLength)));for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&("*"===branch||"**"===branch?(tree[branch]._listeners&&!endReached&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],typeLength))),listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i))):listeners=branch===nextType?listeners.concat(searchListenerTree(handlers,type,tree[branch],i+2)):listeners.concat(searchListenerTree(handlers,type,tree[branch],i)));return listeners}listeners=listeners.concat(searchListenerTree(handlers,type,tree[currentType],i+1))}if(xTree=tree["*"],xTree&&searchListenerTree(handlers,type,xTree,i+1),xxTree=tree["**"])if(i<typeLength){xxTree._listeners&&searchListenerTree(handlers,type,xxTree,typeLength);for(branch in xxTree)"_listeners"!==branch&&xxTree.hasOwnProperty(branch)&&(branch===nextType?searchListenerTree(handlers,type,xxTree[branch],i+2):branch===currentType?searchListenerTree(handlers,type,xxTree[branch],i+1):(isolatedBranch={},isolatedBranch[branch]=xxTree[branch],searchListenerTree(handlers,type,{"**":isolatedBranch},i+1)))}else xxTree._listeners?searchListenerTree(handlers,type,xxTree,typeLength):xxTree["*"]&&xxTree["*"]._listeners&&searchListenerTree(handlers,type,xxTree["*"],typeLength);return listeners}function growListenerTree(type,listener){type="string"==typeof type?type.split(this.delimiter):type.slice();for(var i=0,len=type.length;i+1<len;i++)if("**"===type[i]&&"**"===type[i+1])return;for(var tree=this.listenerTree,name=type.shift();void 0!==name;){if(tree[name]||(tree[name]={}),tree=tree[name],0===type.length)return tree._listeners?("function"==typeof tree._listeners&&(tree._listeners=[tree._listeners]),tree._listeners.push(listener),!tree._listeners.warned&&this._events.maxListeners>0&&tree._listeners.length>this._events.maxListeners&&(tree._listeners.warned=!0,logPossibleMemoryLeak.call(this,tree._listeners.length,name))):tree._listeners=listener,!0;name=type.shift()}return!0}var isArray=Array.isArray?Array.isArray:function(obj){return"[object Array]"===Object.prototype.toString.call(obj)};EventEmitter.EventEmitter2=EventEmitter,EventEmitter.prototype.delimiter=".",EventEmitter.prototype.setMaxListeners=function(n){void 0!==n&&(this._events||init.call(this),this._events.maxListeners=n,this._conf||(this._conf={}),this._conf.maxListeners=n)},EventEmitter.prototype.event="",EventEmitter.prototype.once=function(event,fn){return this.many(event,1,fn),this},EventEmitter.prototype.many=function(event,ttl,fn){function listener(){return 0===--ttl&&self.off(event,listener),fn.apply(this,arguments)}var self=this;if("function"!=typeof fn)throw new Error("many only accepts instances of Function");return listener._origin=fn,this.on(event,listener),self},EventEmitter.prototype.emit=function(){this._events||init.call(this);var type=arguments[0];if("newListener"===type&&!this.newListener&&!this._events.newListener)return!1;var args,l,i,j,handler,al=arguments.length;if(this._all&&this._all.length){if(handler=this._all.slice(),al>3)for(args=new Array(al),j=0;j<al;j++)args[j]=arguments[j];for(i=0,l=handler.length;i<l;i++)switch(this.event=type,al){case 1:handler[i].call(this,type);break;case 2:handler[i].call(this,type,arguments[1]);break;case 3:handler[i].call(this,type,arguments[1],arguments[2]);break;default:handler[i].apply(this,args)}}if(this.wildcard){handler=[];var ns="string"==typeof type?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else{if(handler=this._events[type],"function"==typeof handler){switch(this.event=type,al){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];handler.apply(this,args)}return!0}handler&&(handler=handler.slice())}if(handler&&handler.length){if(al>3)for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];for(i=0,l=handler.length;i<l;i++)switch(this.event=type,al){case 1:handler[i].call(this);break;case 2:handler[i].call(this,arguments[1]);break;case 3:handler[i].call(this,arguments[1],arguments[2]);break;default:handler[i].apply(this,args)}return!0}if(!this._all&&"error"===type)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},EventEmitter.prototype.emitAsync=function(){this._events||init.call(this);var type=arguments[0];if("newListener"===type&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var args,l,i,j,handler,promises=[],al=arguments.length;if(this._all){if(al>3)for(args=new Array(al),j=1;j<al;j++)args[j]=arguments[j];for(i=0,l=this._all.length;i<l;i++)switch(this.event=type,al){case 1:promises.push(this._all[i].call(this,type));break;case 2:promises.push(this._all[i].call(this,type,arguments[1]));break;case 3:promises.push(this._all[i].call(this,type,arguments[1],arguments[2]));break;default:promises.push(this._all[i].apply(this,args))}}if(this.wildcard){handler=[];var ns="string"==typeof type?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else handler=this._events[type];if("function"==typeof handler)switch(this.event=type,al){case 1:promises.push(handler.call(this));break;case 2:promises.push(handler.call(this,arguments[1]));break;case 3:promises.push(handler.call(this,arguments[1],arguments[2]));break;default:for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];promises.push(handler.apply(this,args))}else if(handler&&handler.length){if(handler=handler.slice(),al>3)for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];for(i=0,l=handler.length;i<l;i++)switch(this.event=type,al){case 1:promises.push(handler[i].call(this));break;case 2:promises.push(handler[i].call(this,arguments[1]));break;case 3:promises.push(handler[i].call(this,arguments[1],arguments[2]));break;default:promises.push(handler[i].apply(this,args))}}else if(!this._all&&"error"===type)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(promises)},EventEmitter.prototype.on=function(type,listener){if("function"==typeof type)return this.onAny(type),this;if("function"!=typeof listener)throw new Error("on only accepts instances of Function");return this._events||init.call(this),this.emit("newListener",type,listener),this.wildcard?(growListenerTree.call(this,type,listener),this):(this._events[type]?("function"==typeof this._events[type]&&(this._events[type]=[this._events[type]]),this._events[type].push(listener),!this._events[type].warned&&this._events.maxListeners>0&&this._events[type].length>this._events.maxListeners&&(this._events[type].warned=!0,logPossibleMemoryLeak.call(this,this._events[type].length,type))):this._events[type]=listener,this)},EventEmitter.prototype.onAny=function(fn){if("function"!=typeof fn)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(fn),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.off=function(type,listener){function recursivelyGarbageCollect(root){if(void 0!==root){var keys=Object.keys(root);for(var i in keys){var key=keys[i],obj=root[key];obj instanceof Function||"object"!=typeof obj||null===obj||(Object.keys(obj).length>0&&recursivelyGarbageCollect(root[key]),0===Object.keys(obj).length&&delete root[key])}}}if("function"!=typeof listener)throw new Error("removeListener only takes instances of Function");var handlers,leafs=[];if(this.wildcard){var ns="string"==typeof type?type.split(this.delimiter):type.slice();leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0)}else{if(!this._events[type])return this;handlers=this._events[type],leafs.push({_listeners:handlers})}for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];if(handlers=leaf._listeners,isArray(handlers)){for(var position=-1,i=0,length=handlers.length;i<length;i++)if(handlers[i]===listener||handlers[i].listener&&handlers[i].listener===listener||handlers[i]._origin&&handlers[i]._origin===listener){position=i;break}if(position<0)continue;return this.wildcard?leaf._listeners.splice(position,1):this._events[type].splice(position,1),0===handlers.length&&(this.wildcard?delete leaf._listeners:delete this._events[type]),this.emit("removeListener",type,listener),this}(handlers===listener||handlers.listener&&handlers.listener===listener||handlers._origin&&handlers._origin===listener)&&(this.wildcard?delete leaf._listeners:delete this._events[type],this.emit("removeListener",type,listener))}return recursivelyGarbageCollect(this.listenerTree),this},EventEmitter.prototype.offAny=function(fn){var fns,i=0,l=0;if(fn&&this._all&&this._all.length>0){for(fns=this._all,i=0,l=fns.length;i<l;i++)if(fn===fns[i])return fns.splice(i,1),this.emit("removeListenerAny",fn),this}else{for(fns=this._all,i=0,l=fns.length;i<l;i++)this.emit("removeListenerAny",fns[i]);this._all=[]}return this},EventEmitter.prototype.removeListener=EventEmitter.prototype.off,EventEmitter.prototype.removeAllListeners=function(type){if(0===arguments.length)return!this._events||init.call(this),this;if(this.wildcard)for(var ns="string"==typeof type?type.split(this.delimiter):type.slice(),leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0),iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];leaf._listeners=null}else this._events&&(this._events[type]=null);return this},EventEmitter.prototype.listeners=function(type){if(this.wildcard){var handlers=[],ns="string"==typeof type?type.split(this.delimiter):type.slice();return searchListenerTree.call(this,handlers,ns,this.listenerTree,0),handlers}return this._events||init.call(this),this._events[type]||(this._events[type]=[]),isArray(this._events[type])||(this._events[type]=[this._events[type]]),this._events[type]},EventEmitter.prototype.listenerCount=function(type){return this.listeners(type).length},EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return EventEmitter}):"object"==typeof exports?module.exports=EventEmitter:window.EventEmitter2=EventEmitter}()},{}],153:[function(require,module,exports){function isVisible(el){var style=el.currentStyle||getComputedStyle(el),visible=el.offsetLeft>-999&&el.offsetTop>-999&&"hidden"!=style.visibility&&"none"!=style.display;return visible&&"hidden"==style.overflow&&(visible=el.offsetHeight>1&&el.offsetWidth>1),visible&&el.parentElement&&(visible=isVisible(el.parentElement)),visible}module.exports=isVisible},{}],154:[function(require,module,exports){function suppressElements($elements){var i,savedZIndices=[];for(i=0;i<$elements.length;i++)savedZIndices[i]=$elements[i].style.zIndex.replace(" !important",""),$elements[i].style.zIndex=-2147483647;return savedZIndices}function unSuppressElements($elements,savedZIndices){var i;for(i=0;i<$elements.length;i++)$elements[i].style.setProperty("z-index",savedZIndices[i],"important")}function findByBoundingClientRect(el,ignoreViewport){var rect=el.getBoundingClientRect(),efp=function(x,y){return document.elementFromPoint(x,y)},topLeft={el:efp(rect.left+1,rect.top+1)},topRight={el:efp(rect.right-1,rect.top+1)},bottomLeft={el:efp(rect.left+1,rect.bottom-1)},bottomRight={el:efp(rect.right-1,rect.bottom-1)},corners=[topLeft,topRight,bottomLeft,bottomRight];return corners.forEach(function(corner){if(null===corner.el)return void(corner.visible=!!ignoreViewport);corner.el===el||$(corner.el).closest(el).length?corner.visible=!0:corner.visible=!1}),topLeft.visible||topRight.visible||bottomLeft.visible||bottomRight.visible}function isVisible2(el,$ignoredElements,ignoreViewport){var savedZIndices,style=el.currentStyle||getComputedStyle(el),visible=el.offsetLeft>-999&&el.offsetTop>-999&&"hidden"!==style.visibility&&"none"!==style.display;return visible&&"hidden"===style.overflow&&(visible=el.offsetHeight>1&&el.offsetWidth>1),visible&&($ignoredElements.length&&(savedZIndices=suppressElements($ignoredElements)),visible=findByBoundingClientRect(el,ignoreViewport),$ignoredElements.length&&unSuppressElements($ignoredElements,savedZIndices)),visible}var $=require("jquery");module.exports=require("./archive/visible.legacy"),module.exports.isVisible2=isVisible2,module.exports.isVisibleInViewport=function(el,$ignoredElements){return isVisible2(el,$ignoredElements,!1)},module.exports.isVisibleIndependentOfViewport=function(el,$ignoredElements){return isVisible2(el,$ignoredElements,!0)}},{"./archive/visible.legacy":153,jquery:"jquery"}],155:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),Flow=function(){function Flow(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$nonPasswords=_ref.nonPasswords,nonPasswords=void 0===_ref$nonPasswords?[]:_ref$nonPasswords,_ref$passwords=_ref.passwords,passwords=void 0===_ref$passwords?[]:_ref$passwords;_classCallCheck(this,Flow),this.scrapedData={nonPasswords:nonPasswords,passwords:passwords},this.candidateData={magicElements:{passwords:[],nonPasswords:[]},newAsset:{},updateAsset:{}},this.validatedData={magicElements:{}},this.hasPasswordFieldsFoundByNewIsVisible=!!_underscore2["default"].findWhere(passwords,{foundByNewIsVisible:!0})}return _createClass(Flow,[{key:"serialize",value:function(){return{scrapedData:this.scrapedData}}},{key:"hasScrapedData",value:function(){return!!this.scrapedData.nonPasswords.length||!!this.scrapedData.passwords.length}}]),Flow}();exports["default"]=Flow},{underscore:"underscore"}],156:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function spliceFromPropertyByType(entries,property,value){for(var propertyIndex=!0,splicedEntrys=[];propertyIndex>-1;)propertyIndex=_underscore2["default"].findIndex(entries,function(entry){return entry[property]===value}),propertyIndex>-1&&splicedEntrys.push(entries.splice(propertyIndex,1)[0]);return splicedEntrys}function getCurrentDomain(){var parsed=_urlParser2["default"].parse(location.href,!0);return parsed.domain||parsed.hostname}function getCurrentHostname(){return _urlParser2["default"].parse(location.href,!0).hostname}function getCurrentStrippedUrl(){var parsed=_urlParser2["default"].parse(location.href,!0);return parsed.protocol+"//"+(parsed.host+parsed.pathname)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_urlParser=require("url-parser"),_urlParser2=_interopRequireDefault(_urlParser),_formatAssets=require("../modules/format-assets.module"),formatAssets=_interopRequireWildcard(_formatAssets),_flow=require("../classes/flow.class"),_flow2=_interopRequireDefault(_flow),State=function(){function State(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},currentInputCount=_ref.currentInputCount,fields=_ref.fields,removedFields=_ref.removedFields,injectedIcons=_ref.injectedIcons;_classCallCheck(this,State),this.activeModes={manualCredentialInjection:!1},this.activeHandlers={manualInjection:void 0},this.assets=[],this.banners=[],this.currentInputCount=currentInputCount||0,this.fields=fields||{passwords:[],nonPasswords:[],touchedByHighlighter:[]},this.removedFields=removedFields||{passwords:[],nonPasswords:[]},this.frames=[],this.injectedIcons=injectedIcons||[],this.introViews=0,this.introViewsCounterInitialized=!1,this.introViewsCounterUpdated=!1,this.activeFlow=new _flow2["default"],this.activeAssetId=void 0,this.tkLoggedInState=!1,this.backgroundDataRefreshed=!1,this.atLeastOneCatchAllInitialized=!1,this.showGeneratorOnLoadCatchAll=!1,this.lastGeneratedPassword=void 0,this.hasShownMultiAccountSelector=!1,this.unconfirmedAsset=void 0,this.magicFlows={logins:[]},this.tutorialBannerDisplayed=!1,this.domain=getCurrentDomain(),this.hostname=getCurrentHostname(),this.strippedUrl=getCurrentStrippedUrl()}return _createClass(State,[{key:"clearUserData",value:function(){this.constructor({currentInputCount:this.currentInputCount,injectedIcons:this.injectedIcons,fields:this.fields,removedFields:this.removedFields})}},{key:"isFieldInCompleteMagicLoginFlow",value:function(fieldId){var isItReallyThough=!1;return _underscore2["default"].each(this.magicFlows.logins,function(flow){flow.detectedNonPassword&&flow.detectedPassword&&(isItReallyThough=flow.detectedNonPassword.fieldId===fieldId||flow.detectedPassword.fieldId===fieldId)}),isItReallyThough}},{key:"getAllFrameElements",value:function(){return _underscore2["default"].map(this.frames,function(frameEntry){return frameEntry.frame.$el[0]})}},{key:"getAllBannerElements",value:function(){return _underscore2["default"].map(this.banners,function(bannerEntry){return bannerEntry.frame.$el[0]})}},{key:"getAllIconElements",value:function(){return _underscore2["default"].pluck(this.injectedIcons,"element")}},{key:"getAllInjectedElements",value:function(){return _underscore2["default"].union(this.getAllFrameElements(),this.getAllBannerElements(),this.getAllIconElements())}},{key:"getPasswordFieldElements",value:function(){return this.fields.passwords.map(function(password){return password.element})}},{key:"getNonPasswordFieldElements",value:function(){return this.fields.nonPasswords.map(function(nonPassword){return nonPassword.element})}},{key:"getActiveAsset",value:function(){return _underscore2["default"].find(this.assets,{assetId:this.activeAssetId})}},{key:"setAssets",value:function(assets){this.assets=formatAssets.fromBackgroundForHercules(assets)}},{key:"getAssetById",value:function(assetId){return _underscore2["default"].find(this.assets,{assetId:assetId})}},{key:"getAssetByLogin",value:function(login){return _underscore2["default"].find(this.assets,{login:login})}},{key:"getAllLoginValues",value:function(){return _underscore2["default"].pluck(this.assets,"login")}},{key:"getIconByFieldId",value:function(fieldId){return _underscore2["default"].find(this.injectedIcons,{fieldId:fieldId})}},{key:"getAllFields",value:function(){return _underscore2["default"].union(this.fields.passwords,this.fields.nonPasswords)}},{key:"getFieldByFieldId",value:function(fieldId){return _underscore2["default"].find(this.getAllFields(),{fieldId:fieldId})}},{key:"getPasswordFieldByFieldId",value:function(fieldId){return _underscore2["default"].find(this.fields.passwords,{fieldId:fieldId})}},{key:"getRemovedPasswordFieldByFieldId",value:function(fieldId){return _underscore2["default"].find(this.removedFields.passwords,{fieldId:fieldId})}},{key:"getNonPasswordFieldByFieldId",value:function(fieldId){return _underscore2["default"].find(this.fields.nonPasswords,{fieldId:fieldId})}},{key:"getInjectedIconByFieldId",value:function(fieldId){return _underscore2["default"].find(this.injectedIcons,{fieldId:fieldId})}},{key:"getFrameEntryByFieldId",value:function(fieldId){return _underscore2["default"].find(this.frames,{fieldId:fieldId})}},{key:"spliceFrameByFieldId",value:function(fieldId){var entry=void 0,index=_underscore2["default"].findIndex(this.frames,{fieldId:fieldId});return index>-1&&(entry=this.frames.splice(index,1)[0]),entry}},{key:"movePasswordFieldsByElementFromAddedToRemoved",value:function(element){var entry=void 0,index=_underscore2["default"].findIndex(this.fields.passwords,{element:element});return index>-1&&(entry=this.fields.passwords.splice(index,1)[0],this.removedFields.passwords.push(entry)),entry}},{key:"moveNonPasswordFieldsByElementFromAddedToRemoved",value:function(element){var entry=void 0,index=_underscore2["default"].findIndex(this.fields.nonPasswords,{element:element});return index>-1&&(entry=this.fields.nonPasswords.splice(index,1)[0],this.removedFields.nonPasswords.push(entry)),entry}},{key:"spliceBannersByType",value:function(bannerType){return spliceFromPropertyByType(this.banners,"bannerType",bannerType)}},{key:"spliceFramesByType",value:function(inpageCategory){return spliceFromPropertyByType(this.frames,"inpageCategory",inpageCategory)}},{key:"spliceFramesNotFieldId",value:function(fieldId){for(var frameIndex=!0,splicedFrames=[];frameIndex>-1;)frameIndex=_underscore2["default"].findIndex(this.frames,function(frame){return frame.fieldId!==fieldId}),frameIndex>-1&&splicedFrames.push(this.frames.splice(frameIndex,1)[0]);return splicedFrames}},{key:"credentialsMatchSameAsset",value:function(_ref2){var login=_ref2.login,password=_ref2.password,assetMatchedByLogin=this.getAssetByLogin(login);return!!assetMatchedByLogin&&assetMatchedByLogin.password===password}}]),State}();exports["default"]=State},{"../classes/flow.class":155,"../modules/format-assets.module":187,underscore:"underscore","url-parser":233}],157:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function initializeSubscriptions(){_emitter2["default"].on("MAIN:INIT:COMPLETE",function(){makeInitializationRequest()}),_emitter2["default"].on("METRICS:TRACK-EVENT",function(data){backgroundInterface.track(data).then(function(result){_emitter2["default"].emit("BACKGROUND:SAVE-TRACK-EVENT:SUCCESS",{result:result})})}),_emitter2["default"].on("FLOW:ENDED:STANDARD",function(){state.activeFlow.hasScrapedData()?persistActiveFlow():_emitter2["default"].emit("BACKGROUND:PERSIST-FLOW:REJECTED")}),_emitter2["default"].on("FLOW:MAGIC-SELECTORS:READY-FOR-SAVE",function(_ref){updateMagicSelectors(_ref.magicFlowType)}),_emitter2["default"].on("UI:BANNER:CREATE-ASSET:CLICKED",function(){createAsset({asset:{password:state.activeFlow.candidateData.newAsset.password.value,login:state.activeFlow.candidateData.newAsset.logins[0].value}})}),_emitter2["default"].on("UI:BANNER:UPDATE-ASSET:CLICKED",function(){updateAsset({asset:state.activeFlow.candidateData.updateAsset})}),_emitter2["default"].on("UI:BANNER:CREATE-ASSET:LOGIN-SELECTED",function(login){createAsset({asset:{password:state.activeFlow.candidateData.newAsset.password.value,login:login}})}),_emitter2["default"].on("UI:BANNER:UPDATE-ASSET:LOGIN-SELECTED",function(login){var existingAsset=state.getAssetByLogin(login);existingAsset.password=state.activeFlow.candidateData.updateAsset.password,updateAsset({asset:existingAsset})}),_emitter2["default"].on("UI:BANNER:CREATE-OR-UPDATE-ASSET:EXSISTING-LOGIN-SELECTED",function(login){var candidateAsset=state.activeFlow.candidateData.createOrUpdateAsset,existingAsset=state.getAssetByLogin(login);existingAsset.password=candidateAsset.passwordFields[0].value,updateAsset({asset:existingAsset})}),_emitter2["default"].on("UI:BANNER:CREATE-OR-UPDATE-ASSET:NEW-LOGIN-SELECTED",function(login){createAsset({asset:{password:state.activeFlow.candidateData.createOrUpdateAsset.passwordFields[0].value,login:login}})}),_emitter2["default"].on("BACKGROUND-INTERFACE:USER-LOGGED-IN",function(){state.clearUserData(),global.hercules.state.tkLoggedInState=!0,refreshBackgroundData()}),_emitter2["default"].on("BACKGROUND-INTERFACE:USER-LOGGED-OUT",function(){state.tkLoggedInState=!1,state.clearUserData()}),_emitter2["default"].on("UI:ICON:CLICKED",function(){(0,_introHelper.userShouldBeExposedToPulsatingButton)()&&!state.introViewsCounterInitialized&&(state.introViewsCounterInitialized=!0,saveIntroViewsCounterInitialisationStatus())}),_emitter2["default"].on("UI:ICON:PULSAR:ADDED",function(){(0,_introHelper.userShouldBeExposedToPulsatingButton)()&&state.introViewsCounterInitialized&&!state.introViewsCounterUpdated&&(state.introViews++,state.introViewsCounterUpdated=!0,saveIntroViewCount())}),_emitter2["default"].on("UI:BANNER:TUTORIAL:CREATED",function(){(0,_introHelper.userShouldBeExposedToTutorialPrompt)()&&(state.introViewsCountInitialized||(state.introViewsCountInitialized=!0,saveIntroViewsCounterInitialisationStatus()),state.introViewsCounterUpdated||(state.introViews++,state.introViewsCounterUpdated=!0,saveIntroViewCount()))}),_emitter2["default"].on("INTRO:COMPLETED",function(){saveIntroViewCount()}),_emitter2["default"].on("FLOW:UNCONFIRMED-USER-DATA:READY-FOR-SAVE",function(){persistUnconfirmedAsset()}),_emitter2["default"].on("UI:BANNER:USER-ACTION:PERFORMED",function(){clearUnconfirmedAsset()}),_emitter2["default"].emit("BACKGROUND:LISTENERS:ADDED")}function refreshBackgroundData(){_emitter2["default"].once("BACKGROUND:INITIAL-REQUEST:*",function(_ref2){_ref2.success?(_emitter2["default"].once("MAGIC:FIELDS-REPROCESSED",function(){state.backgroundDataRefreshed=!0,_emitter2["default"].emit("BACKGROUND:BACKGROUND-DATA-REFRESHED:SUCCESS")}),_emitter2["default"].emit("MAGIC:FIELDS-REQUIRE-REPROCESSING")):(state.assets=[],_emitter2["default"].emit("BACKGROUND:BACKGROUND-DATA-REFRESHED:FAIL"))}),requestUserData()}function makeInitializationRequest(){backgroundInterface.getLoggedInState().then(function(tkLoggedInState){state.tkLoggedInState=tkLoggedInState,_emitter2["default"].emit("BACKGROUND:LOGGED-IN-STATE:RETRIEVED",{tkLoggedInState:tkLoggedInState}),tkLoggedInState?requestUserData():(_emitter2["default"].emit("BACKGROUND:EXIT:NOT-LOGGED-IN"),_emitter2["default"].emit("BACKGROUND:INITIAL-REQUEST:COMPLETE"))})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:INITIAL-LOGIN-STATE-REQUEST:FAIL")})}function requestUserData(){var promises=[backgroundInterface.getAssets(),backgroundInterface.popTempData(),backgroundInterface.getUserData(MAGIC_SELECTOR_KEY),backgroundInterface.getUserData("intro_view"),backgroundInterface.getUserData("intro_view_init"),backgroundInterface.getUserData(UNCONFIRMED_USER_DATA_KEY)];Promise.all(promises).then(function(value){var assets=value[0],tempData=value[1],magicElements=value[2];value[3]&&(state.introViews=value[3]),value[4]&&(state.introViewsCounterInitialized=value[4]),value[5]&&(state.unconfirmedAsset=value[5],state.unconfirmedAsset.fromBackground=!0),state.setAssets(assets),tempData&&tempData.domain&&tempData.domain===state.domain&&(state.activeFlow=new _flow2["default"]({nonPasswords:tempData.scrapedData.nonPasswords,passwords:tempData.scrapedData.passwords})),state.activeFlow.validatedData.magicElements=magicElements,_emitter2["default"].emit("BACKGROUND:INITIAL-REQUEST:COMPLETE",{success:!0})})["catch"](function(error){(0,_logger2["default"])(error),(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:INITIAL-REQUEST:FAIL",{success:!1})})}function persistActiveFlow(){var serializedFlow=state.activeFlow.serialize();serializedFlow.domain=state.domain,backgroundInterface.pushTempData(serializedFlow).then(function(result){_emitter2["default"].emit("BACKGROUND:PERSIST-FLOW:SUCCESS",{result:result})})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:PERSIST-FLOW:FAIL",error)})}function persistUnconfirmedAsset(){var unconfirmedAsset=state.unconfirmedAsset;backgroundInterface.setUserData(UNCONFIRMED_USER_DATA_KEY,unconfirmedAsset).then(function(result){_emitter2["default"].emit("BACKGROUND:PERSIST-UNCONFIRMED-USER_DATA:SUCCESS",{result:result})})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:PERSIST-UNCONFIRMED-USER_DATA:FAIL",error)})}function clearUnconfirmedAsset(){backgroundInterface.setUserData(UNCONFIRMED_USER_DATA_KEY,!1).then(function(result){_emitter2["default"].emit("BACKGROUND:CLEAR-UNCONFIRMED-USER-DATA:SUCCESS",{result:result})})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:CLEAR-UNCONFIRMED-USER-DATA:FAIL",error)})}function createAsset(_ref3){var asset=_ref3.asset;backgroundInterface.createAsset(asset).then(function(result){refreshAssetsOnDashboard(),_emitter2["default"].emit("BACKGROUND:CREATE-ASSET:SUCCESS",{result:result})})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:CREATE-ASSET:FAIL",error)})}function updateAsset(_ref4){var asset=_ref4.asset;backgroundInterface.updateAsset(asset).then(function(result){refreshAssetsOnDashboard(),_emitter2["default"].emit("BACKGROUND:UPDATE-ASSET:SUCCESS",{result:result})})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:UPDATE-ASSET:FAIL",error)})}function refreshAssetsOnDashboard(){backgroundInterface.refreshAssetsOnDashboard().then(function(){_emitter2["default"].emit("BACKGROUND:REFRESH-ASSETS:SUCCESS")})}function updateMagicSelectors(magicFlowType){var existingMagicElements={passwords:[],nonPasswords:[]},updateRequired=!1,magicElementsToUpdate=state.activeFlow.candidateData.magicElements;backgroundInterface.getUserData(MAGIC_SELECTOR_KEY).then(function(result){_emitter2["default"].emit("BACKGROUND:GET-MAGIC-SELECTORS:SUCCESS",{result:result}),result&&(existingMagicElements=result);var mergedPasswords=(0,_backgroundHelper.mergeMagicSelectorsIfNeeded)(existingMagicElements.passwords,magicElementsToUpdate.passwords),mergedNonPasswords=(0,_backgroundHelper.mergeMagicSelectorsIfNeeded)(existingMagicElements.nonPasswords,magicElementsToUpdate.nonPasswords);mergedPasswords&&(existingMagicElements.passwords=mergedPasswords),mergedNonPasswords&&(existingMagicElements.nonPasswords=mergedNonPasswords),updateRequired=mergedPasswords||mergedNonPasswords,updateRequired?saveMagicElements(existingMagicElements,magicFlowType):_emitter2["default"].emit("BACKGROUND:UPDATE-MAGIC-SELECTORS:FAIL:NO-NEW-SELECTORS")})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:GET-MAGIC-SELECTORS:FAIL",error)})}function saveMagicElements(existingMagicElements,magicFlowType){backgroundInterface.setUserData(MAGIC_SELECTOR_KEY,existingMagicElements).then(function(result){_emitter2["default"].emit("BACKGROUND:UPDATE-MAGIC-SELECTORS:SUCCESS",{result:result,magicFlowType:magicFlowType})})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:UPDATE-MAGIC-SELECTORS:FAIL",error)})}function saveIntroViewCount(){backgroundInterface.setUserData("intro_view",state.introViews).then(function(result){_emitter2["default"].emit("BACKGROUND:SAVE-INTRO-VIEW-COUNT:SUCCESS",{result:result})})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:SAVE-INTRO-VIEW-COUNT:FAIL",error)})}function saveIntroViewsCounterInitialisationStatus(){backgroundInterface.setUserData("intro_view_init",state.introViewsCounterInitialized).then(function(result){_emitter2["default"].emit("BACKGROUND:SAVE-INTRO-VIEW-INIT-STATUS:SUCCESS",{result:result})})["catch"](function(error){(0,_logger2["default"])(error.message),_emitter2["default"].emit("BACKGROUND:SAVE-INTRO-VIEW-INIT-STATUS:FAIL",error)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){state=global.hercules.state,MAGIC_SELECTOR_KEY=MAGIC_SELECTOR_KEY||"magic_selector_"+state.domain,UNCONFIRMED_USER_DATA_KEY=UNCONFIRMED_USER_DATA_KEY||"unconfirmed_user_data_"+state.domain,backgroundInterface.init(),piSession.setupListeners(),frameRouterController.initializeSubscriptions(),initializeSubscriptions(),_emitter2["default"].emit("BACKGROUND:INIT:COMPLETE")};var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_logger=require("../utils/logger.util"),_logger2=_interopRequireDefault(_logger),_flow=require("../classes/flow.class"),_flow2=_interopRequireDefault(_flow),_introHelper=require("../modules/intro-helper.module"),_backgroundInterface=require("../modules/background-interface.module"),backgroundInterface=_interopRequireWildcard(_backgroundInterface),_backgroundHelper=require("../modules/background-helper.module"),_piSession=require("./pi-session.controller"),piSession=_interopRequireWildcard(_piSession),_backgroundFrameRouter=require("./background.frame-router.controller"),frameRouterController=_interopRequireWildcard(_backgroundFrameRouter),MAGIC_SELECTOR_KEY=void 0,UNCONFIRMED_USER_DATA_KEY=void 0,state=void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../classes/flow.class":155,"../modules/background-helper.module":175,"../modules/background-interface.module":176,"../modules/intro-helper.module":201,"../utils/emitter.util":210,"../utils/logger.util":211,"./background.frame-router.controller":158,"./pi-session.controller":165}],158:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function initializeSubscriptions(){_emitter2["default"].on("UI:FRAME-CREATED-FROM-CHILD-SCRIPT:MESSAGE-RECEIVED",function(_ref){var inpageName=_ref.inpageName,inpageCategory=_ref.inpageCategory,inpageOptions=_ref.inpageOptions,messageName=_ref.messageName,messageResult=_ref.messageResult,associatedChildScriptId=_ref.associatedChildScriptId,message=void 0;switch(inpageCategory){case BANNER:message=HANDLE_BANNER_MESSAGE;break;case TOOLTIP:message=HANDLE_TOOLTIP_MESSAGE;break;default:return void _emitter2["default"].emit("BACKGROUND:FRAME-ROUTER:UNHANDLED-INPAGE-CATEGORY")}(0,_backgroundInterface.emitMessageToChildFrames)({message:message,options:{inpageName:inpageName,inpageOptions:inpageOptions,messageName:messageName,messageResult:messageResult},receiverId:associatedChildScriptId}).then(function(result){_emitter2["default"].emit("BACKGROUND:FRAME-ROUTER:EMIT-MESSAGE-TO-CHILD-FRAMES:SUCCESS",{result:result})})}),_emitter2["default"].on("BANNER-FACTORY:DELEGATING-BANNER-TO-PARENT-FRAME",function(_ref2){var inpageName=_ref2.inpageName,inpageOptions=_ref2.inpageOptions;return(0,_backgroundInterface.emitMessageToParentFrames)({message:SHOW_BANNER,options:{activeFlow:global.hercules.state.activeFlow,inpageName:inpageName,inpageOptions:inpageOptions}}).then(function(result){_emitter2["default"].emit("BACKGROUND:FRAME-ROUTER:DELEGATING-BANNER-TO-PARENT-FRAME:SUCCESS",{result:result})})}),_emitter2["default"].on("TOOLTIP-FACTORY:DELEGATING-TOOLTIP-TO-PARENT-FRAME",function(_ref3){var inpageName=_ref3.inpageName,attachmentPointBoundingRectangle=_ref3.attachmentPointBoundingRectangle,fieldId=_ref3.fieldId,isMagic=_ref3.isMagic,assets=global.hercules.state.assets,iframeIndex=(0,_iframeUtils.getFrameIndex)(),iframeUrl=location.href;(0,_backgroundInterface.emitMessageToParentFrames)({message:SHOW_TOOLTIP,options:{inpageName:inpageName,inpageOptions:{assets:assets,attachmentPointBoundingRectangle:attachmentPointBoundingRectangle,fieldId:fieldId,iframeUrl:iframeUrl,iframeIndex:iframeIndex,isMagic:isMagic}}}).then(function(result){_emitter2["default"].emit("BACKGROUND:FRAME-ROUTER:DELEGATING-TOOLTIP-TO-PARENT-FRAME:SUCCESS",{result:result})})}),_emitter2["default"].on("BACKGROUND-INTERFACE:PARENT-FRAME-MESSAGE:RECEIVED",function(response){return handleParentFrameMessage(response)}),_emitter2["default"].on("BACKGROUND-INTERFACE:CHILD-FRAME-MESSAGE:RECEIVED",function(response){return handleChildFrameMessage(response)}),_emitter2["default"].emit("BACKGROUND:FRAME-ROUTER:LISTENERS-ADDED")}function handleParentFrameMessage(_ref4){var message=_ref4.message,options=_ref4.options;switch(message){case HANDLE_BANNER_MESSAGE:handleBannerMessageFromParentFrame(options);break;case HANDLE_TOOLTIP_MESSAGE:handleTooltipMessageFromParentFrame(options);break;default:_emitter2["default"].emit("BACKGROUND:FRAME-ROUTER:UNHANDLED-PARENT-MESSAGE")}}function handleChildFrameMessage(_ref5){var message=_ref5.message,senderId=_ref5.senderId,_ref5$options=_ref5.options;_ref5$options=void 0===_ref5$options?{}:_ref5$options;var activeFlow=_ref5$options.activeFlow,_ref5$options$inpageO=_ref5$options.inpageOptions,inpageOptions=void 0===_ref5$options$inpageO?{}:_ref5$options$inpageO,inpageName=_ref5$options.inpageName,extendedInpageOptions=void 0;switch(message){case SHOW_BANNER:extendedInpageOptions=Object.assign(inpageOptions,{activeFlow:activeFlow,associatedChildScriptId:senderId}),(0,_banner.create)(inpageName,extendedInpageOptions);break;case SHOW_TOOLTIP:extendedInpageOptions=Object.assign(inpageOptions,{associatedChildScriptId:senderId}),(0,_tooltip.create)(inpageName,extendedInpageOptions);break;default:_emitter2["default"].emit("BACKGROUND:FRAME-ROUTER:UNHANDLED-CHILD-MESSAGE")}}function handleBannerMessageFromParentFrame(_ref6){var inpageName=_ref6.inpageName,messageName=_ref6.messageName,messageResult=_ref6.messageResult,activeFlow=global.hercules.state.activeFlow;_banner.getBannerConfig[inpageName](activeFlow).listeners[messageName](messageResult)}function handleTooltipMessageFromParentFrame(_ref7){var inpageName=_ref7.inpageName,inpageOptions=_ref7.inpageOptions,messageName=_ref7.messageName,messageResult=_ref7.messageResult;_tooltip.getTooltipConfig[inpageName](inpageOptions).listeners[messageName](messageResult)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.initializeSubscriptions=initializeSubscriptions;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_backgroundInterface=require("../modules/background-interface.module"),_constants=require("../modules/constants.module"),_iframeUtils=require("../modules/iframe-utils.module"),_banner=require("../factories/banner.factory"),_tooltip=require("../factories/tooltip.factory"),SHOW_BANNER=_constants.FRAME_MESSAGES.SHOW_BANNER,SHOW_TOOLTIP=_constants.FRAME_MESSAGES.SHOW_TOOLTIP,HANDLE_BANNER_MESSAGE=_constants.FRAME_MESSAGES.HANDLE_BANNER_MESSAGE,HANDLE_TOOLTIP_MESSAGE=_constants.FRAME_MESSAGES.HANDLE_TOOLTIP_MESSAGE,BANNER=_constants.INPAGE_CATEGORIES.BANNER,TOOLTIP=_constants.INPAGE_CATEGORIES.TOOLTIP}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../factories/banner.factory":171,"../factories/tooltip.factory":173,"../modules/background-interface.module":176,"../modules/constants.module":178,"../modules/iframe-utils.module":193,"../utils/emitter.util":210}],159:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function getVisibleInputCount(){var externalOverrideIgnoreAttribute=global.hercules.config.externalOverrideIgnoreAttribute,visibleInputCount=0,visibleInputsWithYieldHandlingCount=0;return(0,_jquery2["default"])("input").each(function(index,field){if(("password"===field.type||"text"===field.type||"email"===field.type||"tel"===field.type)&&(0,_domHelpers.isVisible)(field)){visibleInputCount++;var $parentForms=(0,_jquery2["default"])(field).parents("form");$parentForms.length&&$parentForms[0].getAttribute(externalOverrideIgnoreAttribute)&&visibleInputsWithYieldHandlingCount++}}),{visibleInputCount:visibleInputCount,visibleInputsWithYieldHandlingCount:visibleInputsWithYieldHandlingCount}}function detectFieldEvents(){(0,_jquery2["default"])("html").on("input",_inputSelectors2["default"].password,inputEventHandler)}function inputEventHandler(event){var target=event.target;target.attributes[_simulateEvents.FILL_EVENT_IN_PROGRESS_ATTRIBUTE]?target.removeAttribute(_simulateEvents.FILL_EVENT_IN_PROGRESS_ATTRIBUTE):global.hercules.userInteractedManuallyWithPasswordField||(global.hercules.userInteractedManuallyWithPasswordField=!0,_emitter2["default"].emit("DETECTOR:PASSWORD-FIELD:MANUAL-USER-INPUT"))}function detectFields(){detectPasswordFields(),detectNonPasswordFields(),_emitter2["default"].emit("DETECTOR:CYCLE:COMPLETE")}function detectPasswordFields(){var validPasswordFields=(0,_fieldFinder.getAllValidFields)({selector:_inputSelectors2["default"].password}),diff=(0,_diffFields2["default"])(validPasswordFields,state.getPasswordFieldElements());diff.addedFields.forEach(function(element){var isMagic=(0,_magicFieldHelpers.checkIfFieldIsMagic)({element:element,isPassword:!0}),addedField=(0,_createFieldEntry2["default"])(element,isMagic),handler=new _inputActivityHandlers.PasswordHandler(addedField.fieldId),foundByNewIsVisible=!(0,_visible2["default"])(element);addedField.foundByNewIsVisible=foundByNewIsVisible,state.fields.passwords.push(addedField),(0,_bindInputListener2["default"])(element,handler),_emitter2["default"].emit("DETECTOR:PASSWORD:ADDED-OR-REVEALED",{foundByNewIsVisible:foundByNewIsVisible,fieldId:addedField.fieldId})});var removedPasswordFieldIds=[];diff.removedFields.forEach(function(element){var removedField=state.movePasswordFieldsByElementFromAddedToRemoved(element);removedPasswordFieldIds.push(removedField.fieldId)}),removedPasswordFieldIds.length&&_emitter2["default"].emit("DETECTOR:PASSWORD:REMOVED-OR-HIDDEN",{fieldIds:removedPasswordFieldIds})}function detectNonPasswordFields(){var nonPasswordInputSelector=_inputSelectors2["default"].nonPassword,validNonPasswordFields=(0,_fieldFinder.getAllValidFields)({selector:nonPasswordInputSelector}),diff=(0,_diffFields2["default"])(validNonPasswordFields,state.getNonPasswordFieldElements());diff.addedFields.forEach(function(element){var isMagic=(0,_magicFieldHelpers.checkIfFieldIsMagic)({element:element,isPassword:!1}),addedField=(0,_createFieldEntry2["default"])(element,isMagic),handler=new _inputActivityHandlers.NonPasswordHandler(addedField.fieldId);state.fields.nonPasswords.push(addedField),(0,_bindInputListener2["default"])(element,handler),_emitter2["default"].emit("DETECTOR:NON-PASSWORD:ADDED-OR-REVEALED",{fieldId:addedField.fieldId})}),diff.removedFields.forEach(function(field){var removedField=state.moveNonPasswordFieldsByElementFromAddedToRemoved(field);_emitter2["default"].emit("DETECTOR:NON-PASSWORD:REMOVED-OR-HIDDEN",{fieldId:removedField.fieldId})})}function overrideDetectorInterval(interval){DETECTOR_INTERVAL=interval}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){state=global.hercules.state;var inputCount=getVisibleInputCount();state.currentInputCount=inputCount.visibleInputCount,state.currentInputWithYieldHandlingCount=inputCount.visibleInputsWithYieldHandlingCount,detectFieldEvents(),detectFields(),(0,_detectPageUnload2["default"])(),setInterval(function(){var _getVisibleInputCount=getVisibleInputCount(),visibleInputCount=_getVisibleInputCount.visibleInputCount,visibleInputsWithYieldHandlingCount=_getVisibleInputCount.visibleInputsWithYieldHandlingCount;state.currentInputCount===visibleInputCount&&state.currentInputWithYieldHandlingCount===visibleInputsWithYieldHandlingCount||(state.currentInputCount=visibleInputCount,state.currentInputWithYieldHandlingCount=visibleInputsWithYieldHandlingCount,detectFields())},DETECTOR_INTERVAL),_emitter2["default"].emit("DETECTOR:INIT:COMPLETE")},exports.getVisibleInputCount=getVisibleInputCount,exports.overrideDetectorInterval=overrideDetectorInterval;var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_domHelpers=require("../modules/dom-helpers.module"),_emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_detectPageUnload=require("../modules/detect-page-unload.module"),_detectPageUnload2=_interopRequireDefault(_detectPageUnload),_diffFields=require("../modules/diff-fields.module"),_diffFields2=_interopRequireDefault(_diffFields),_createFieldEntry=require("../modules/create-field-entry.module"),_createFieldEntry2=_interopRequireDefault(_createFieldEntry),_bindInputListener=require("../modules/bind-input-listener.module"),_bindInputListener2=_interopRequireDefault(_bindInputListener),_inputSelectors=require("../modules/input-selectors.module"),_inputSelectors2=_interopRequireDefault(_inputSelectors),_simulateEvents=require("../modules/simulate-events.module"),_magicFieldHelpers=require("../modules/magic-field-helpers.module"),_inputActivityHandlers=require("../modules/input-activity-handlers.module"),_fieldFinder=require("../modules/field-finder.module"),_visible=require("visible"),_visible2=_interopRequireDefault(_visible),DETECTOR_INTERVAL=500,state=void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../modules/bind-input-listener.module":177,"../modules/create-field-entry.module":179,"../modules/detect-page-unload.module":180,"../modules/diff-fields.module":181,"../modules/dom-helpers.module":183,"../modules/field-finder.module":185,"../modules/input-activity-handlers.module":198,"../modules/input-selectors.module":200,"../modules/magic-field-helpers.module":202,"../modules/simulate-events.module":207,"../utils/emitter.util":210,jquery:"jquery",visible:154}],160:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function initializeSubscriptions(){state=global.hercules.state,
_emitter2["default"].on("DETECTOR:NON-PASSWORD:ADDED-OR-REVEALED",function(_ref){var fieldId=_ref.fieldId;if(state.tkLoggedInState){if(state.getNonPasswordFieldByFieldId(fieldId).isMagic)return void _emitter2["default"].emit("FIELDS:MAGIC-NON-PASSWORD-FIELD:FOUND",{fieldId:fieldId});(0,_magicFieldHelpers.checkForSimpleLoginPremonition)()}}),_emitter2["default"].on("DETECTOR:PASSWORD:ADDED-OR-REVEALED",function(_ref2){var fieldId=_ref2.fieldId;if((0,_injectIcon2["default"])(fieldId),(0,_elementFocusHandler.elementFocusHandler)(fieldId),state.tkLoggedInState){var field=state.getPasswordFieldByFieldId(fieldId);if(field.isMagic)return void _emitter2["default"].emit("FIELDS:MAGIC-PASSWORD-FIELD:FOUND",{fieldId:fieldId});(0,_magicFieldHelpers.checkForSimpleLoginPremonition)(),(0,_magicFieldHelpers.isElementInASimpleLogin)(field.element)||tutorialFlow(fieldId)}else _emitter2["default"].emit("FIELDS:PASSWORD-FIELD:PROCESSED-WITH-LOGGED-OUT-STATE",{fieldId:fieldId})})}function tutorialFlow(fieldId){var shouldDisplayBanner=state.assets.length&&!state.tutorialBannerDisplayed;if((0,_introHelper.userShouldBeExposedToPulsatingButton)()&&state.assets.length)return void(0,_pulsateButton.addPulseToButtonInField)(fieldId);(0,_introHelper.userShouldBeExposedToTutorialPrompt)()&&shouldDisplayBanner&&(bannerFactory.create("TutorialBanner"),state.tutorialBannerDisplayed=!0)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){initializeSubscriptions()},exports.initializeSubscriptions=initializeSubscriptions;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_injectIcon=require("../modules/inject-icon.module"),_injectIcon2=_interopRequireDefault(_injectIcon),_pulsateButton=require("../modules/pulsate-button.module"),_magicFieldHelpers=require("../modules/magic-field-helpers.module"),_elementFocusHandler=require("../modules/element-focus-handler.module"),_introHelper=require("../modules/intro-helper.module"),_banner=require("../factories/banner.factory"),bannerFactory=_interopRequireWildcard(_banner),state=void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../factories/banner.factory":171,"../modules/element-focus-handler.module":184,"../modules/inject-icon.module":195,"../modules/intro-helper.module":201,"../modules/magic-field-helpers.module":202,"../modules/pulsate-button.module":206,"../utils/emitter.util":210}],161:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function setupListeners(){_emitter2["default"].on("DETECTOR:WINDOW-UNLOADING",function(){endStandardFlow(),state.unconfirmedAsset&&!state.unconfirmedAsset.fromBackground&&_emitter2["default"].emit("FLOW:UNCONFIRMED-USER-DATA:READY-FOR-SAVE")}),_emitter2["default"].on("DETECTOR:PASSWORD:REMOVED-OR-HIDDEN",function(){endAjaxFlow()}),_emitter2["default"].on("BACKGROUND:INITIAL-REQUEST:COMPLETE",function(){if(state.activeFlow.hasScrapedData()){var result=diffAndHandleScrapedData();if("create_asset"===result||"existing_asset_update"===result||"create_or_update_asset"===result)return}state.unconfirmedAsset&&(0,_persistUserActions.handlePersistedUserAction)()}),_emitter2["default"].on("DETECTOR:PASSWORD-FIELD:UPDATED",function(_ref){var fieldId=_ref.fieldId,value=_ref.value,passwordField=state.getPasswordFieldByFieldId(fieldId);passwordField&&(passwordField.modified=!0,passwordField.value=value)}),_emitter2["default"].on("DETECTOR:NON-PASSWORD-FIELD:UPDATED",function(_ref2){var fieldId=_ref2.fieldId,value=_ref2.value,nonPasswordField=state.getNonPasswordFieldByFieldId(fieldId);nonPasswordField&&(nonPasswordField.modified=!0,nonPasswordField.value=value)}),_emitter2["default"].on("FLOW:EXISTING-ASSET-LOGIN",handleExistingAssetLogin),_emitter2["default"].on("UI:BANNER:CREATE-ASSET:CLICKED",handleAssetCreatedThroughSimpleBanner)}function endStandardFlow(){state.activeFlow=new _flow2["default"]({passwords:(0,_getValidFieldsForFlow.getValidFieldsForStandardFlow)({fields:state.fields.passwords}),nonPasswords:(0,_getValidFieldsForFlow.getValidFieldsForStandardFlow)({fields:state.fields.nonPasswords})}),_emitter2["default"].emit("FLOW:ENDED:STANDARD")}function endAjaxFlow(){state.activeFlow=new _flow2["default"]({passwords:(0,_getValidFieldsForFlow.getValidFieldsForAjaxFlow)({existingFields:state.fields.passwords,removedFields:state.removedFields.passwords}),nonPasswords:(0,_getValidFieldsForFlow.getValidFieldsForAjaxFlow)({existingFields:state.fields.nonPasswords,removedFields:state.removedFields.nonPasswords})}),diffAndHandleScrapedData(),_emitter2["default"].emit("FLOW:ENDED:AJAX")}function diffAndHandleScrapedData(){var scrapedDiffResult=(0,_diffScrapedDataAgainstAssets2["default"])({scrapedPasswords:state.activeFlow.scrapedData.passwords,scrapedLogins:state.activeFlow.scrapedData.nonPasswords,currentAssets:state.assets});return(0,_handleScrapedData2["default"])(scrapedDiffResult)}function handleExistingAssetLogin(){var candidateData=state.activeFlow.candidateData;(0,_domHelpers.isFormGone)(candidateData.magicElements)&&_emitter2["default"].emit("FLOW:MAGIC-SELECTORS:READY-FOR-SAVE",{magicFlowType:"existing_asset_login"})}function handleAssetCreatedThroughSimpleBanner(){var scrapedData=state.activeFlow.scrapedData,candidateData=state.activeFlow.candidateData;1===scrapedData.passwords.length?(candidateData.magicElements.passwords.push({cssSelector:candidateData.newAsset.password.cssSelector}),candidateData.magicElements.nonPasswords.push({cssSelector:candidateData.newAsset.logins[0].cssSelector}),_emitter2["default"].emit("FLOW:MAGIC-SELECTORS:READY-FOR-SAVE",{magicFlowType:"asset_created"})):_emitter2["default"].emit("FLOW:MAGIC-SELECTORS:UNSUPPORTED-FLOW")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){state=global.hercules.state,setupListeners(),_emitter2["default"].emit("FLOW:INIT:COMPLETE")};var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_diffScrapedDataAgainstAssets=require("../modules/diff-scraped-data-against-assets.module"),_diffScrapedDataAgainstAssets2=_interopRequireDefault(_diffScrapedDataAgainstAssets),_flow=require("../classes/flow.class"),_flow2=_interopRequireDefault(_flow),_handleScrapedData=require("../modules/handle-scraped-data.module"),_handleScrapedData2=_interopRequireDefault(_handleScrapedData),_getValidFieldsForFlow=require("../modules/get-valid-fields-for-flow.module"),_domHelpers=require("../modules/dom-helpers.module"),_persistUserActions=require("../modules/persist-user-actions.module"),state=void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../classes/flow.class":155,"../modules/diff-scraped-data-against-assets.module":182,"../modules/dom-helpers.module":183,"../modules/get-valid-fields-for-flow.module":191,"../modules/handle-scraped-data.module":192,"../modules/persist-user-actions.module":204,"../utils/emitter.util":210}],162:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function setupListeners(){_emitter2["default"].on("FIELDS:MAGIC-PASSWORD-FIELD:FOUND",function(_ref){var fieldId=_ref.fieldId;(0,_magicFieldHelpers.updateLoginFlowWithNewMagicField)({fieldId:fieldId,isPassword:!0})}),_emitter2["default"].on("FIELDS:MAGIC-NON-PASSWORD-FIELD:FOUND",function(_ref2){var fieldId=_ref2.fieldId;(0,_magicFieldHelpers.updateLoginFlowWithNewMagicField)({fieldId:fieldId,isPassword:!1})}),_emitter2["default"].on("UI:MAGIC-CREDENTIAL-INJECTION:SUCCESS",function(_ref3){var fieldId=_ref3.fieldId;state.getFieldByFieldId(fieldId).hasPerformedAMagicAutoFill=!0}),_emitter2["default"].on("MAGIC:FIELDS-REQUIRE-REPROCESSING",reprocessAllFields),_emitter2["default"].emit("MAGIC:LISTENERS:ADDED")}function reprocessAllFields(){var fields=state.fields;(0,_magicFieldHelpers.checkIfFieldsAreMagicAndUpdateLoginFlow)({fields:fields.nonPasswords,isPassword:!1}),(0,_magicFieldHelpers.checkIfFieldsAreMagicAndUpdateLoginFlow)({fields:fields.passwords,isPassword:!0}),_emitter2["default"].emit("MAGIC:FIELDS-REPROCESSED")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){state=global.hercules.state,setupListeners(),_emitter2["default"].emit("MAGIC:INIT:COMPLETE")};var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_magicFieldHelpers=require("../modules/magic-field-helpers.module"),state=void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../modules/magic-field-helpers.module":202,"../utils/emitter.util":210}],163:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function init(_ref){var environment=_ref.environment,browser=_ref.browser,browserVersion=_ref.browserVersion,contentscriptInitMoment=_ref.contentscriptInitMoment,context=_ref.context,cssPath=_ref.cssPath,domain=_ref.domain,frameFactory=_ref.frameFactory,CBMS=_ref.CBMS,externalIgnoreAttribute=_ref.externalIgnoreAttribute,externalOverrideIgnoreAttribute=_ref.externalOverrideIgnoreAttribute,loggerOverride=_ref.loggerOverride,contentscriptId=(0,_generateContentscriptId2["default"])();global.hercules={config:{environment:environment,browser:browser,browserVersion:browserVersion,contentscriptInitMoment:contentscriptInitMoment,context:context,contentscriptId:contentscriptId,cssPath:cssPath,domain:domain,frameFactory:frameFactory,CBMS:CBMS,externalIgnoreAttribute:externalIgnoreAttribute,externalOverrideIgnoreAttribute:externalOverrideIgnoreAttribute,loggerOverride:loggerOverride},state:new _state2["default"]},logger.init({browser:browser,environment:environment,loggerOverride:loggerOverride,contentscriptInitMoment:contentscriptInitMoment||Date.now()}),piSession.setupForwarder(),_emitter2["default"].emit("MAIN:INIT-LEVEL-0:COMPLETE")}function firstBackgroundResponseInit(_ref2){var csVersion=_ref2.csVersion,formsToIgnoreSelector=_ref2.formsToIgnoreSelector,tabId=_ref2.tabId,piSessionCoreVersion=_ref2.piSessionCoreVersion,tutorialExperimentBucket=_ref2.tutorialExperimentBucket,isLoginPromptDisabled=_ref2.isLoginPromptDisabled;_underscore2["default"].extend(global.hercules.config,{csVersion:csVersion,tabId:tabId,formsToIgnoreSelector:formsToIgnoreSelector,piSessionCoreVersion:piSessionCoreVersion||0,tutorialExperimentBucket:tutorialExperimentBucket,isLoginPromptDisabled:isLoginPromptDisabled}),_emitter2["default"].emit("MAIN:INIT-LEVEL-1:COMPLETE")}function secondBackgroundResponseInit(_ref3){var tkLoggedInState=_ref3.tkLoggedInState;_underscore2["default"].extend(global.hercules.config,{tkLoggedInState:tkLoggedInState}),_emitter2["default"].emit("MAIN:INIT-LEVEL-2:COMPLETE")}function start(){(0,_field2["default"])(),(0,_metrics2["default"])(),(0,_magic2["default"])(),(0,_ui2["default"])(),(0,_flow2["default"])(),(0,_background2["default"])(),_emitter2["default"].emit("MAIN:INIT:COMPLETE"),_emitter2["default"].on("BACKGROUND:INITIAL-REQUEST:COMPLETE",function(){(0,_detector2["default"])()})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.piSession=exports.domHelpers=void 0,exports.init=init,exports.firstBackgroundResponseInit=firstBackgroundResponseInit,exports.secondBackgroundResponseInit=secondBackgroundResponseInit,exports.start=start;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_logger=require("../utils/logger.util"),logger=_interopRequireWildcard(_logger),_generateContentscriptId=require("../modules/generate-contentscript-id.modules"),_generateContentscriptId2=_interopRequireDefault(_generateContentscriptId),_background=require("./background.controller"),_background2=_interopRequireDefault(_background),_metrics=require("./metrics.controller"),_metrics2=_interopRequireDefault(_metrics),_flow=require("./flow.controller"),_flow2=_interopRequireDefault(_flow),_detector=require("./detector.controller"),_detector2=_interopRequireDefault(_detector),_ui=require("./ui.controller"),_ui2=_interopRequireDefault(_ui),_magic=require("./magic.controller"),_magic2=_interopRequireDefault(_magic),_field=require("./field.controller"),_field2=_interopRequireDefault(_field),_state=require("../classes/state.class"),_state2=_interopRequireDefault(_state),_domHelpers=require("../modules/dom-helpers.module"),domHelpers=_interopRequireWildcard(_domHelpers),_piSession=require("./pi-session.controller"),piSession=_interopRequireWildcard(_piSession),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore);exports.domHelpers=domHelpers,exports.piSession=piSession}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../classes/state.class":156,"../modules/dom-helpers.module":183,"../modules/generate-contentscript-id.modules":188,"../utils/emitter.util":210,"../utils/logger.util":211,"./background.controller":157,"./detector.controller":159,"./field.controller":160,"./flow.controller":161,"./magic.controller":162,"./metrics.controller":164,"./pi-session.controller":165,"./ui.controller":167,underscore:"underscore"}],164:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function setupListeners(){function formAutomaticallyFilled(parentFormSelector){var params={website_url:getCurrentStrippedUrl(),domain:getCurrentDomain(),pb_cs_version:global.hercules.config.csVersion,browser_name:global.hercules.config.browser,browser_version:global.hercules.config.browserVersion,context:global.hercules.config.context,asset_count_for_domain:getAssetCount(),form_type:"login",form_is_in_iframe:(0,_iframeUtils.areWeInAnIframe)(),form_detection_technique:"hercules",form_is_visible:!0,form_selector:parentFormSelector},data={mixpanel_event:"fillForm",mixpanel_params:params};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}var state=global.hercules.state;_emitter2["default"].on("UI:ICON:INJECTED",function(_ref){var foundByNewIsVisible=_ref.foundByNewIsVisible,data={mixpanel_event:"catch_all_action_triggered",mixpanel_params:{catchall_action:"injected_icon",context:"browser_desktop",domain:getCurrentDomain(),hercules_found_with_new_visibility_lib:foundByNewIsVisible,website_url:getCurrentStrippedUrl()}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].on("UI:ICON:CLICKED",function(_ref2){var fieldId=_ref2.fieldId,data={mixpanel_event:"catch_all_action_triggered",mixpanel_params:{context:"browser_desktop",website_url:getCurrentStrippedUrl(),domain:getCurrentDomain(),catchall_action:"clicked_icon",hercules_icon_is_highlighted:state.getIconByFieldId(fieldId).isHighlighted||!1}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].on("UI:ICON:PULSAR:ADDED",function(){var data={mixpanel_event:"catch_all_action_triggered",mixpanel_params:{context:"browser_desktop",website_url:getCurrentStrippedUrl(),domain:getCurrentDomain(),catchall_action:"highlighted_icon"}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].on("UI:MANUAL-CREDENTIAL-INJECTION:SUCCESS",function(_ref3){var notBoundToField=_ref3.notBoundToField,isPassword=_ref3.isPassword,type=isPassword?"password":"username",data={mixpanel_event:"catch_all_action_triggered",mixpanel_params:{context:"browser_desktop",website_url:getCurrentStrippedUrl(),domain:getCurrentDomain(),catchall_action:"manually_injected_"+type,catchall_not_bound_to_field:notBoundToField}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].on("UI:PASSWORD-INJECTION:SUCCESS",function(){var data={mixpanel_event:"catch_all_action_triggered",mixpanel_params:{context:"browser_desktop",website_url:getCurrentStrippedUrl(),domain:getCurrentDomain(),catchall_action:"injected_password"}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].on("UI:MAGIC-CREDENTIAL-INJECTION:SUCCESS",function(_ref4){var parentFormSelector=_ref4.parentFormSelector,data={mixpanel_event:"catch_all_action_triggered",mixpanel_params:{context:"browser_desktop",website_url:getCurrentStrippedUrl(),domain:getCurrentDomain(),catchall_action:"injected_magic_credentials"}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data),formAutomaticallyFilled(parentFormSelector)}),_emitter2["default"].on("BACKGROUND:UPDATE-MAGIC-SELECTORS:SUCCESS",function(_ref5){var magicFlowType=_ref5.magicFlowType,data={mixpanel_event:"catch_all_action_triggered",mixpanel_params:{context:"browser_desktop",website_url:getCurrentStrippedUrl(),domain:getCurrentDomain(),asset_count:getAssetCount(),catchall_action:"magic_selectors_saved_"+magicFlowType}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].on("BACKGROUND:UPDATE-ASSET:SUCCESS",function(_ref6){var result=_ref6.result,data={mixpanel_event:"edit_password",mixpanel_params:{asset_title:result.name,context:"browser_desktop",type:"auto-update",website_url:getCurrentStrippedUrl(),domain:getCurrentDomain(),form_detection_technique:"hercules"}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].on("BACKGROUND:CREATE-ASSET:SUCCESS",function(_ref7){var result=_ref7.result,data={mixpanel_event:"create_password",mixpanel_params:{asset_title:result.name,asset_login_type:"standard",context:"browser_desktop",type:"auto-save",website_url:getCurrentStrippedUrl(),domain:getCurrentDomain(),form_detection_technique:"hercules"}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].on("DETECTOR:PASSWORD-FIELD:MANUAL-USER-INPUT",function(){var data={mixpanel_event:"interacted_with_password_field",mixpanel_params:{origin_script:"hercules",website_url:getCurrentStrippedUrl(),context:"browser_desktop",domain:getCurrentDomain(),asset_count_for_domain:getAssetCount()}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].on("UI:ANY-ASSET-ACTION-BANNER:DECLINED-OR-CLOSED",function(){var data={mixpanel_event:"catch_all_action_triggered",mixpanel_params:{catchall_action:"declined_create_or_update_asset",context:"browser_desktop",domain:getCurrentDomain(),hercules_has_passwords_found_with_new_visibility_lib:state.activeFlow.hasPasswordFieldsFoundByNewIsVisible,website_url:getCurrentStrippedUrl()}};_emitter2["default"].emit("METRICS:TRACK-EVENT",data)}),_emitter2["default"].emit("METRICS:LISTENERS:ADDED")}function getAssetCount(){return global.hercules.state.assets.length}function getCurrentDomain(){return global.hercules.state.domain}function getCurrentStrippedUrl(){return global.hercules.state.strippedUrl}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){setupListeners(),_emitter2["default"].emit("METRICS:INIT:COMPLETE")};var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_iframeUtils=require("../modules/iframe-utils.module")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../modules/iframe-utils.module":193,"../utils/emitter.util":210}],165:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function setupListeners(){_emitter2["default"].on("UI:PASSWORD-INJECTION:SUCCESS",function(_ref){var element=_ref.element,trigger=_ref.trigger;return emitPISessionOperation("injected_password",{authFlowMarker:!0,extendSession:!0,element:(0,_domHelpers.buildElementModel)({element:element}),triggerActor:trigger})}),_emitter2["default"].on("DETECTOR:WINDOW-UNLOADING",function(){return emitPISessionOperation("window_unloading")}),_emitter2["default"].on("UI:MANUAL-CREDENTIAL-INJECTION:SUCCESS",function(_ref2){var targetElement=_ref2.targetElement;_ref2.isPassword?emitPISessionOperation("injected_password",{authFlowMarker:!0,extendSession:!0,element:(0,_domHelpers.buildElementModel)({element:targetElement}),triggerActor:_constants.PI_SESSION_TRIGGER_ACTORS.USER}):emitPISessionOperation("injected_username",{authFlowMarker:!0,extendSession:!0,element:(0,_domHelpers.buildElementModel)({element:targetElement}),triggerActor:_constants.PI_SESSION_TRIGGER_ACTORS.USER})}),_emitter2["default"].on("UI:MAGIC-CREDENTIAL-INJECTION:SUCCESS",function(_ref3){var usernameElement=_ref3.usernameElement,passwordElement=_ref3.passwordElement;emitPISessionOperation("catchall_injected_credentials",{authFlowMarker:!0,extendSession:!0,usernameTarget:(0,_domHelpers.buildElementModel)({element:usernameElement}),passwordTarget:(0,_domHelpers.buildElementModel)({element:passwordElement})})}),_emitter2["default"].on("UI:CATCH-ALL:INITIALIZED",function(_ref4){var fieldElement=_ref4.fieldElement;emitPISessionOperation("catchall_initialized",{authFlowMarker:!0,extendSession:!0,triggerField:(0,_domHelpers.buildElementModel)({element:fieldElement})})})}function catchNextTenClicks(){var clickCount=0,clickEvent="click.catchall_track_initialized",buttonSelector=_constants.SELECTORS.PI_SESSION_SUBMIT_BUTTONS;(0,_jquery2["default"])("body").off(clickEvent),(0,_jquery2["default"])("body").on(clickEvent,buttonSelector,function(event){if(clickCount++,clickCount>10)return void(0,_jquery2["default"])("body").off(clickEvent);emitPISessionOperation("clicked_button",{extendSession:!0,element:(0,_domHelpers.buildElementModel)({element:event.target})})})}function emitPISessionOperation(name){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{_emitPISessionOperation(name,data)}catch(error){}}function _emitPISessionOperation(name){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"Chrome"===global.hercules.config.browser&&(data.domain=global.hercules.state.domain,data.url=global.hercules.state.strippedUrl,data.tabId=global.hercules.config.tabId,_underscore2["default"].isUndefined(data.tabId)||(data.authFlowMarker&&catchNextTenClicks(),_emitter2["default"].emit("PI-SESSION:OPERATION:EMITTED",{name:name,data:data})))}function setupForwarder(){_emitter2["default"].on("PI-SESSION:OPERATION:EMITTED",function(data){backgroundInterface.buildPageInteractionSession(data).then(function(){_emitter2["default"].emit("PI-SESSION:OPERATION:CREATED")})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.setupListeners=setupListeners,exports.emitPISessionOperation=emitPISessionOperation,exports.setupForwarder=setupForwarder;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_domHelpers=require("../modules/dom-helpers.module"),_backgroundInterface=require("../modules/background-interface.module"),backgroundInterface=_interopRequireWildcard(_backgroundInterface),_constants=require("../modules/constants.module"),_jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../modules/background-interface.module":176,"../modules/constants.module":178,"../modules/dom-helpers.module":183,"../utils/emitter.util":210,jquery:"jquery",underscore:"underscore"}],166:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function initializeSubscriptions(){var state=global.hercules.state;_emitter2["default"].on("UI:CATCH-ALL:INITIALIZED",function(){state.atLeastOneCatchAllInitialized=!0}),_emitter2["default"].on("UI:CATCH-ALL:PASSWORD-GENERATOR:GENERATED:*",function(_ref){var password=_ref.password,fieldId=_ref.fieldId,notBoundToField=_ref.notBoundToField;if(notBoundToField){bannerFactory.create("PasswordFieldSelectionBanner");(0,_inputHighlighter.startInputHighlightMode)(!0),(0,_manualCredentialInjection.startManualPasswordInjection)({fieldId:fieldId,notBoundToField:notBoundToField,password:password}),state.lastGeneratedPassword=password}else state.lastGeneratedPassword=password,(0,_injectPassword2["default"])({fieldId:fieldId,password:password,trigger:constants.PI_SESSION_TRIGGER_ACTORS.PASSWORD_GENERATOR})}),_emitter2["default"].on("UI:CATCH-ALL:USERNAME-INJECTION:CLICKED",function(_ref2){var fieldId=_ref2.fieldId,notBoundToField=_ref2.notBoundToField;bannerFactory.create("UsernameFieldSelectionBanner");(0,_inputHighlighter.startInputHighlightMode)(!1),(0,_manualCredentialInjection.startManualUsernameInjection)({fieldId:fieldId,notBoundToField:notBoundToField})}),_emitter2["default"].on("UI:CATCH-ALL:PASSWORD-INJECTION:CLICKED",function(_ref3){var fieldId=_ref3.fieldId,notBoundToField=_ref3.notBoundToField;if(notBoundToField){bannerFactory.create("PasswordFieldSelectionBanner");(0,_inputHighlighter.startInputHighlightMode)(!0),(0,_manualCredentialInjection.startManualPasswordInjection)({fieldId:fieldId,notBoundToField:notBoundToField})}else(0,_injectPassword2["default"])({fieldId:fieldId,password:state.getActiveAsset().password,trigger:constants.PI_SESSION_TRIGGER_ACTORS.USER})}),_emitter2["default"].on("UI:CATCH-ALL:DESTROYED",function(){var _ref4=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},fieldId=_ref4.fieldId;if(fieldId){state.getInjectedIconByFieldId(fieldId).element.setDefaultState()}else _emitter2["default"].emit("UI:CATCH-ALL:DESTROYED:NO-FIELD-ID")})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.initializeSubscriptions=initializeSubscriptions;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_banner=require("../factories/banner.factory"),bannerFactory=_interopRequireWildcard(_banner),_manualCredentialInjection=require("../modules/manual-credential-injection.module"),_inputHighlighter=require("../modules/input-highlighter.module"),_injectPassword=require("../modules/inject-password.module"),_injectPassword2=_interopRequireDefault(_injectPassword),_constants=require("../modules/constants.module"),constants=_interopRequireWildcard(_constants)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../factories/banner.factory":171,"../modules/constants.module":178,"../modules/inject-password.module":196,"../modules/input-highlighter.module":199,"../modules/manual-credential-injection.module":203,"../utils/emitter.util":210}],167:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function initializeSubscriptions(){catchAllUIController.initializeSubscriptions(),iconUIController.initializeSubscriptions(),passwordFieldUIController.initializeSubscriptions(),magicUIController.initializeSubscriptions(),_emitter2["default"].on("DETECTOR:PASSWORD:REMOVED-OR-HIDDEN",function(_ref){_ref.fieldIds.forEach(function(fieldId){tooltipFactory.destroyCatchAllByFieldId(fieldId);var iconElement=state.getIconByFieldId(fieldId).element;(0,_jquery2["default"])(iconElement).remove(),(0,_elementFocusHandler.removedElementFocusHandler)(fieldId)})}),_emitter2["default"].on("BACKGROUND-INTERFACE:TOOLBAR-ICON-CLICKED:SUCCESS",function(){var assets=state.assets;tooltipFactory.create(CATCH_ALL,{assets:assets})}),_emitter2["default"].on("UI:MANUAL-CREDENTIAL-INJECTION:SUCCESS",function(_ref2){var fieldId=_ref2.fieldId;_ref2.isPassword?(bannerFactory.destroyAllBanners(),(0,_inputHighlighter.endInputHighlightMode)()):((0,_injectPassword2["default"])({fieldId:fieldId,password:state.getActiveAsset().password,trigger:constants.PI_SESSION_TRIGGER_ACTORS.USERNAME_INJECTION}),bannerFactory.destroyAllBanners(),(0,_inputHighlighter.endInputHighlightMode)(),fieldId&&1===state.fields.passwords.length&&1===state.fields.nonPasswords.length&&bannerFactory.create("NowLoginBanner"))}),_emitter2["default"].on("UI:MANUAL-CREDENTIAL-INJECTION:FAIL",function(){bannerFactory.destroyAllBanners(),(0,_inputHighlighter.endInputHighlightMode)()}),_emitter2["default"].on("UI:BANNER:USERNAME-SELECTION-BANNER:CLOSED",function(){bannerFactory.destroyAllBanners(),(0,_inputHighlighter.endInputHighlightMode)(),(0,_manualCredentialInjection.cancelManualCredentialInjection)()}),_emitter2["default"].on("FLOW:ASSET-READY-FOR-CREATE",function(){var isInpageReplay=arguments.length>0&&void 0!==arguments[0]&&arguments[0];isInpageReplay||(0,_persistUserActions.persistUserAction)({assetData:state.activeFlow.candidateData.newAsset,assetDataType:"create",replayActionMessage:"FLOW:ASSET-READY-FOR-CREATE"});var activeFlow=state.activeFlow;state.activeFlow.candidateData.newAsset.logins.length>1?bannerFactory.create("CreateAssetWithUsernameSelectorBanner",{activeFlow:activeFlow,isInpageReplay:isInpageReplay}):bannerFactory.create("CreateAssetBanner",{activeFlow:activeFlow,isInpageReplay:isInpageReplay})}),_emitter2["default"].on("FLOW:ASSET-READY-FOR-UPDATE",function(){var isInpageReplay=arguments.length>0&&void 0!==arguments[0]&&arguments[0];isInpageReplay||(0,_persistUserActions.persistUserAction)({assetData:state.activeFlow.candidateData.updateAsset,assetDataType:"update",replayActionMessage:"FLOW:ASSET-READY-FOR-UPDATE"}),bannerFactory.create("UpdateSingleAssetBanner",{isInpageReplay:isInpageReplay})}),_emitter2["default"].on("FLOW:ASSET-REQUIRES-USERNAME-SELECTION",function(){var isInpageReplay=arguments.length>0&&void 0!==arguments[0]&&arguments[0],activeFlow=state.activeFlow;isInpageReplay||(0,_persistUserActions.persistUserAction)({assetData:activeFlow.candidateData.updateAsset,assetDataType:"update",replayActionMessage:"FLOW:ASSET-REQUIRES-USERNAME-SELECTION"}),bannerFactory.create("UpdateAssetWithUsernameSelectorBanner",{activeFlow:activeFlow,isInpageReplay:isInpageReplay})}),_emitter2["default"].on("FLOW:ASSET-REQUIRES-USERNAME-ENTRY",function(){var isInpageReplay=arguments.length>0&&void 0!==arguments[0]&&arguments[0];isInpageReplay||(0,_persistUserActions.persistUserAction)({assetData:state.activeFlow.candidateData.newAsset,assetDataType:"create",replayActionMessage:"FLOW:ASSET-REQUIRES-USERNAME-ENTRY"}),bannerFactory.create("CreateAssetWithUsernameInputBanner",{isInpageReplay:isInpageReplay})}),_emitter2["default"].on("FLOW:ASSET-REQUIRES-CREATE-OR-UPDATE",function(){var isInpageReplay=arguments.length>0&&void 0!==arguments[0]&&arguments[0],activeFlow=state.activeFlow;isInpageReplay||(0,_persistUserActions.persistUserAction)({assetData:state.activeFlow.candidateData.createOrUpdateAsset,assetDataType:"create_or_update",replayActionMessage:"FLOW:ASSET-REQUIRES-CREATE-OR-UPDATE"}),bannerFactory.create("CreateOrUpdateBanner",{activeFlow:activeFlow,isInpageReplay:isInpageReplay})}),_emitter2["default"].on("UI:LOGIN-TOOLTIP:LOGIN-SUCCESS",function(_ref3){var fieldId=_ref3.fieldId
;state.backgroundDataRefreshed?checkForPremonitionAndResumeNonMagicFlow(fieldId):_emitter2["default"].once("BACKGROUND:BACKGROUND-DATA-REFRESHED:SUCCESS",function(){checkForPremonitionAndResumeNonMagicFlow(fieldId)})}),_emitter2["default"].on("UI:BANNER:TUTORIAL:SHOW-ME:CLICKED",function(){window.open("http://www.truekey.com/a-different-way-to-use-TrueKey"),(0,_introHelper.completeIntro)(),(0,_pulsateButton.addPulseToButtonInAllFields)()}),_emitter2["default"].emit("UI:LISTENERS:ADDED")}function checkForPremonitionAndResumeNonMagicFlow(fieldId){if(state.isFieldInCompleteMagicLoginFlow(fieldId)||(0,_magicFieldHelpers.checkForSimpleLoginPremonition)(),!state.assets.length||!state.isFieldInCompleteMagicLoginFlow(fieldId))switch(state.lastLoggedOutAction){case PASSWORD_FOCUSED:return void _emitter2["default"].emit("UI:PASSWORD:FOCUS",{fieldId:fieldId});case ICON_CLICKED:return void _emitter2["default"].emit("UI:ICON:CLICKED",{fieldId:fieldId})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){state=global.hercules.state,(0,_injectCustomStyles2["default"])(),initializeSubscriptions(),_emitter2["default"].emit("UI:INIT:COMPLETE")};var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_uiCatchAll=require("./ui.catch-all.controller"),catchAllUIController=_interopRequireWildcard(_uiCatchAll),_uiIcon=require("./ui.icon.controller"),iconUIController=_interopRequireWildcard(_uiIcon),_uiPasswordField=require("./ui.password-field.controller"),passwordFieldUIController=_interopRequireWildcard(_uiPasswordField),_uiMagic=require("./ui.magic.controller"),magicUIController=_interopRequireWildcard(_uiMagic),_banner=require("../factories/banner.factory"),bannerFactory=_interopRequireWildcard(_banner),_tooltip=require("../factories/tooltip.factory"),tooltipFactory=_interopRequireWildcard(_tooltip),_injectCustomStyles=require("../modules/inject-custom-styles.module"),_injectCustomStyles2=_interopRequireDefault(_injectCustomStyles),_injectPassword=require("../modules/inject-password.module"),_injectPassword2=_interopRequireDefault(_injectPassword),_elementFocusHandler=require("../modules/element-focus-handler.module"),_manualCredentialInjection=require("../modules/manual-credential-injection.module"),_inputHighlighter=require("../modules/input-highlighter.module"),_introHelper=require("../modules/intro-helper.module"),_pulsateButton=require("../modules/pulsate-button.module"),_uiHelpers=require("../modules/ui-helpers.module"),uiHelpers=_interopRequireWildcard(_uiHelpers),_magicFieldHelpers=require("../modules/magic-field-helpers.module"),_persistUserActions=require("../modules/persist-user-actions.module"),_constants=require("../modules/constants.module"),constants=_interopRequireWildcard(_constants),state=void 0,PASSWORD_FOCUSED=uiHelpers.ACTIONS.PASSWORD_FOCUSED,ICON_CLICKED=uiHelpers.ACTIONS.ICON_CLICKED,CATCH_ALL=constants.TOOLTIP_TYPES.CATCH_ALL}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../factories/banner.factory":171,"../factories/tooltip.factory":173,"../modules/constants.module":178,"../modules/element-focus-handler.module":184,"../modules/inject-custom-styles.module":194,"../modules/inject-password.module":196,"../modules/input-highlighter.module":199,"../modules/intro-helper.module":201,"../modules/magic-field-helpers.module":202,"../modules/manual-credential-injection.module":203,"../modules/persist-user-actions.module":204,"../modules/pulsate-button.module":206,"../modules/ui-helpers.module":208,"../utils/emitter.util":210,"./ui.catch-all.controller":166,"./ui.icon.controller":168,"./ui.magic.controller":169,"./ui.password-field.controller":170,jquery:"jquery"}],168:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function initializeSubscriptions(){state=global.hercules.state,_emitter2["default"].on("UI:ICON:INJECTED",function(_ref){var fieldId=_ref.fieldId,element=_ref.element;state.injectedIcons.push({fieldId:fieldId,element:element})}),_emitter2["default"].on("UI:ICON:NOT-INJECTED:FIELD-TOO-SMALL",function(_ref2){var fieldId=_ref2.fieldId;state.getPasswordFieldByFieldId(fieldId).iconIsDisabled=!0}),_emitter2["default"].on("UI:ICON:CLICKED",function(_ref3){var fieldId=_ref3.fieldId;if(state.activeModes.manualCredentialInjection)return void _emitter2["default"].emit("UI:ICON:DISABLED:BY-USERNAME-INJECTION-MODE",{fieldId:fieldId});if(!state.tkLoggedInState)return void(0,_uiHelpers.createLoginPromptTooltip)({fieldId:fieldId,lastLoggedOutAction:ICON_CLICKED});var field=state.getPasswordFieldByFieldId(fieldId),isMagic=!field.hasPerformedAMagicAutoFill&&field.isMagic&&state.isFieldInCompleteMagicLoginFlow(fieldId);if(state.getFrameEntryByFieldId(fieldId))tooltipFactory.destroyCatchAllByFieldId(fieldId),state.getInjectedIconByFieldId(fieldId).element.setDefaultState();else{var assets=state.assets;tooltipFactory.create(CATCH_ALL,{assets:assets,fieldId:fieldId,isMagic:isMagic})}})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.initializeSubscriptions=initializeSubscriptions;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_tooltip=require("../factories/tooltip.factory"),tooltipFactory=_interopRequireWildcard(_tooltip),_uiHelpers=require("../modules/ui-helpers.module"),_constants=require("../modules/constants.module"),CATCH_ALL=_constants.TOOLTIP_TYPES.CATCH_ALL,ICON_CLICKED=_uiHelpers.ACTIONS.ICON_CLICKED,state=void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../factories/tooltip.factory":173,"../modules/constants.module":178,"../modules/ui-helpers.module":208,"../utils/emitter.util":210}],169:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function initializeSubscriptions(){state=global.hercules.state,_emitter2["default"].on("MAGIC:LOGIN-FLOW:READY",function(_ref){var password=_ref.password,nonPassword=_ref.nonPassword,passwordField=state.getPasswordFieldByFieldId(password.fieldId),nonPasswordField=state.getNonPasswordFieldByFieldId(nonPassword.fieldId),parentFormSelector=(0,_domHelpers.getFirstParentFormSelectorOfElement)(passwordField.element);if(passwordField.isPremonition&&nonPasswordField.isPremonition){var candidateData=state.activeFlow.candidateData;candidateData.magicElements.passwords.push({cssSelector:passwordField.cssSelector}),candidateData.magicElements.nonPasswords.push({cssSelector:nonPasswordField.cssSelector}),_emitter2["default"].emit("FLOW:MAGIC-SELECTORS:READY-FOR-SAVE",{magicFlowType:"premonition"})}if(1===state.assets.length&&fillUsernameAndPassword({usernameField:nonPasswordField,passwordFieldId:password.fieldId,parentFormSelector:parentFormSelector,asset:state.assets[0]}),state.assets.length>1){if(state.hasShownMultiAccountSelector)_emitter2["default"].emit("UI:MAGIC-LOGIN-FLOW:MULTI-ACCOUNT-NOT-SHOWN");else{state.hasShownMultiAccountSelector=!0;var assets=state.assets;tooltipFactory.create(CATCH_ALL,{assets:assets,fieldId:password.fieldId,isMagic:!0})}}if(!(state.assets.length>=1))return void _emitter2["default"].emit("UI:MAGIC-CREDENTIAL-INJECTION:FAIL:NO-ASSETS");_emitter2["default"].on("UI:CATCH-ALL:ACCOUNT-SELECTED:MULTI-ASSET-INJECTION",function(_ref2){var assetId=_ref2.assetId;if(_ref2.fieldId===passwordField.fieldId){var fillAsset=state.getAssetById(assetId);fillUsernameAndPassword({usernameField:nonPasswordField,passwordFieldId:password.fieldId,parentFormSelector:parentFormSelector,asset:fillAsset})}})})}function fillUsernameAndPassword(_ref3){var usernameField=_ref3.usernameField,passwordFieldId=_ref3.passwordFieldId,parentFormSelector=_ref3.parentFormSelector,asset=_ref3.asset,passwordField=state.getPasswordFieldByFieldId(passwordFieldId);(0,_simulateEvents.fillInput)(passwordField.element,asset.password),(0,_simulateEvents.fillInput)(usernameField.element,asset.login),_emitter2["default"].emit("UI:MAGIC-CREDENTIAL-INJECTION:SUCCESS",{parentFormSelector:parentFormSelector,fieldId:passwordFieldId,usernameElement:usernameField.element,passwordElement:passwordField.element})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.initializeSubscriptions=initializeSubscriptions;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_tooltip=require("../factories/tooltip.factory"),tooltipFactory=_interopRequireWildcard(_tooltip),_simulateEvents=require("../modules/simulate-events.module"),_domHelpers=require("../modules/dom-helpers.module"),_constants=require("../modules/constants.module"),CATCH_ALL=_constants.TOOLTIP_TYPES.CATCH_ALL,state=void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../factories/tooltip.factory":173,"../modules/constants.module":178,"../modules/dom-helpers.module":183,"../modules/simulate-events.module":207,"../utils/emitter.util":210}],170:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function initializeSubscriptions(){var state=global.hercules.state;_emitter2["default"].on("UI:PASSWORD:FOCUS",function(_ref){var fieldId=_ref.fieldId,field=state.getPasswordFieldByFieldId(fieldId);if(field.iconIsDisabled)return void _emitter2["default"].emit("UI:PASSWORD:DISABLED",{fieldId:fieldId});if(state.tkLoggedInState||(global.hercules.config.isLoginPromptDisabled?_emitter2["default"].emit("UI:PASSWORD:FOCUS:LOGIN-PROMPT:DISABLED-BY-USER",{fieldId:fieldId}):(0,_uiHelpers.createLoginPromptTooltip)({fieldId:fieldId,lastLoggedOutAction:PASSWORD_FOCUSED})),state.assets.length&&state.tkLoggedInState&&(field.isMagic||field.isPremonition))return void _emitter2["default"].emit("UI:PASSWORD:FOCUS:IS-MAGIC",{fieldId:fieldId});if(state.tkLoggedInState&&!state.activeModes.manualCredentialInjection){if(!!state.getFrameEntryByFieldId(fieldId))_emitter2["default"].emit("UI:PASSWORD:FOCUS:FRAME-EXISTS",{fieldId:fieldId});else if(state.atLeastOneCatchAllInitialized)_emitter2["default"].emit("UI:PASSWORD:FOCUS:FRAME-ALREADY-DISPLAYED",{fieldId:fieldId});else{var assets=state.assets;tooltipFactory.create(CATCH_ALL,{assets:assets,fieldId:fieldId})}}})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.initializeSubscriptions=initializeSubscriptions;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_tooltip=require("../factories/tooltip.factory"),tooltipFactory=_interopRequireWildcard(_tooltip),_uiHelpers=require("../modules/ui-helpers.module"),_constants=require("../modules/constants.module"),CATCH_ALL=_constants.TOOLTIP_TYPES.CATCH_ALL,PASSWORD_FOCUSED=_uiHelpers.ACTIONS.PASSWORD_FOCUSED}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../factories/tooltip.factory":173,"../modules/constants.module":178,"../modules/ui-helpers.module":208,"../utils/emitter.util":210}],171:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function destroyAllBanners(){_underscore2["default"].pluck(global.hercules.state.banners,"frame").forEach(function(frame){return frame.destroy()}),global.hercules.state.banners=[]}function create(inpageName){var _ref=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},activeFlow=_ref.activeFlow,_ref$isInpageReplay=_ref.isInpageReplay,isInpageReplay=void 0!==_ref$isInpageReplay&&_ref$isInpageReplay,associatedChildScriptId=_ref.associatedChildScriptId;if(_emitter2["default"].emit("UI:BANNER:CREATE:INITIALIZED"),(0,_iframeUtils.areWeInAnIframe)())return void _emitter2["default"].emit("BANNER-FACTORY:DELEGATING-BANNER-TO-PARENT-FRAME",{inpageName:inpageName,inpageConfig:{isInpageReplay:isInpageReplay}});destroyAllBanners();var config=global.hercules.config,state=global.hercules.state,bannerConfig=getBannerConfig[inpageName](activeFlow),id=bannerConfig.id,bannerType=bannerConfig.bannerType,listeners=bannerConfig.listeners,_bannerConfig$inpageC=bannerConfig.inpageConfig,inpageConfig=void 0===_bannerConfig$inpageC?{}:_bannerConfig$inpageC,_bannerConfig$persist=bannerConfig.persistsUntilAssetConfirmed,persistsUntilAssetConfirmed=void 0!==_bannerConfig$persist&&_bannerConfig$persist,afterCreate=bannerConfig.afterCreate,options=_underscore2["default"].extend(inpageConfig,{isInpageReplay:isInpageReplay,id:id,domain:state.domain,siteName:state.domain,originScript:"hercules",formIsInIframe:(0,_iframeUtils.areWeInAnIframe)()}),frame=config.frameFactory.create({id:id,options:options}),banner={bannerId:(0,_generateId2["default"])(),bannerType:bannerType,frame:frame};listeners&&setupListeners({listeners:listeners,inpageName:inpageName,frame:frame,persistsUntilAssetConfirmed:persistsUntilAssetConfirmed,associatedChildScriptId:associatedChildScriptId}),state.banners.push(banner),state.activeBanner=banner,afterCreate&&afterCreate()}function setupListeners(_ref2){var listeners=_ref2.listeners,inpageName=_ref2.inpageName,frame=_ref2.frame,persistsUntilAssetConfirmed=_ref2.persistsUntilAssetConfirmed,associatedChildScriptId=_ref2.associatedChildScriptId;Object.getOwnPropertyNames(listeners).forEach(function(messageName){frame.on(messageName,function(result){_underscore2["default"].isUndefined(associatedChildScriptId)?(listeners[messageName](result),persistsUntilAssetConfirmed&&(0,_persistUserActions.handleUserBannerInteraction)(),_emitter2["default"].emit("UI:FRAME:MESSAGE-RECEIVED",{messageName:messageName,result:result})):_emitter2["default"].emit("UI:FRAME-CREATED-FROM-CHILD-SCRIPT:MESSAGE-RECEIVED",{inpageName:inpageName,messageName:messageName,messageResult:result,associatedChildScriptId:associatedChildScriptId})})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBannerConfig=void 0,exports.destroyAllBanners=destroyAllBanners,exports.create=create;var _iframeUtils=require("../modules/iframe-utils.module"),_generateId=require("../modules/generate-id.module"),_generateId2=_interopRequireDefault(_generateId),_persistUserActions=require("../modules/persist-user-actions.module"),_prioritizePotentialLogins=require("../modules/prioritize-potential-logins.module"),_prioritizePotentialLogins2=_interopRequireDefault(_prioritizePotentialLogins),_emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),getBannerConfig=exports.getBannerConfig={UsernameFieldSelectionBanner:function(){return{id:"banner-insertUsername",bannerType:"insertUsername",listeners:{close:function(){_emitter2["default"].emit("UI:BANNER:USERNAME-SELECTION-BANNER:CLOSED")}},afterCreate:function(){_emitter2["default"].emit("UI:BANNER:USERNAME-SELECTION-BANNER:CREATED")}}},PasswordFieldSelectionBanner:function(){return{id:"banner-insertPassword",bannerType:"insertPassword",listeners:{close:function(){_emitter2["default"].emit("UI:BANNER:PASSWORD-SELECTION-BANNER:CLOSED")}}}},NowLoginBanner:function(){return{id:"banner-catchAllTutorialLoginPrompt",bannerType:"nowLogin"}},TutorialBanner:function(){return{id:"banner-catchAllTutorial",bannerType:"tutorial",listeners:{onShowMeButtonClick:function(){_emitter2["default"].emit("UI:BANNER:TUTORIAL:SHOW-ME:CLICKED")}},afterCreate:function(){_emitter2["default"].emit("UI:BANNER:TUTORIAL:CREATED")}}},CreateAssetBanner:function(activeFlow){return{id:"banner-askCreate",bannerType:"askCreate",persistsUntilAssetConfirmed:!0,inpageConfig:{username:activeFlow.candidateData.newAsset.logins[0].value},listeners:{onCreateAsset:function(){_emitter2["default"].emit("UI:BANNER:CREATE-ASSET:CLICKED")},onDontCreateAsset:function(){_emitter2["default"].emit("UI:BANNER:DONT-CREATE-ASSET:CLICKED"),_emitter2["default"].emit("UI:ANY-ASSET-ACTION-BANNER:DECLINED-OR-CLOSED")},close:function(){_emitter2["default"].emit("UI:ANY-ASSET-ACTION-BANNER:DECLINED-OR-CLOSED")}}}},CreateOrUpdateBanner:function(activeFlow){var createOrUpdateAsset=activeFlow.candidateData.createOrUpdateAsset,newLogins=_underscore2["default"].pluck(createOrUpdateAsset.newLoginFields,"value");return{id:"banner-createOrUpdateAsset",bannerType:"createOrUpdateAsset",persistsUntilAssetConfirmed:!0,inpageConfig:{inpageType:"banner_create_or_update_asset",existingLogins:createOrUpdateAsset.existingLogins,newLogins:newLogins,showHelpIcon:!1},listeners:{updateAssetWithSelectedLogin:function(result){_emitter2["default"].emit("UI:BANNER:CREATE-OR-UPDATE-ASSET:EXSISTING-LOGIN-SELECTED",result.login)},createAssetWithSelectedLogin:function(result){_emitter2["default"].emit("UI:BANNER:CREATE-OR-UPDATE-ASSET:NEW-LOGIN-SELECTED",result.login)},createAssetWithInputedLogin:function(result){_emitter2["default"].emit("UI:BANNER:CREATE-OR-UPDATE-ASSET:NEW-LOGIN-SELECTED",result.login)},close:function(){_emitter2["default"].emit("UI:ANY-ASSET-ACTION-BANNER:DECLINED-OR-CLOSED")}},afterCreate:function(){_emitter2["default"].emit("UI:BANNER:CREATE-OR-UPDATE-ASSET:CREATED")}}},CreateAssetWithUsernameSelectorBanner:function(activeFlow){var usernames=_underscore2["default"].pluck(activeFlow.candidateData.newAsset.logins,"value");return usernames=(0,_prioritizePotentialLogins2["default"])(usernames),{id:"banner-lastChanceChooseUsername",bannerType:"askCreateSelectableUsername",persistsUntilAssetConfirmed:!0,inpageConfig:{inpageType:"banner_choose_username_hercules",usernames:usernames,showHelpIcon:!1},listeners:{saveAssetWithSelectedUsername:function(result){_emitter2["default"].emit("UI:BANNER:CREATE-ASSET:LOGIN-SELECTED",result.login)},close:function(){_emitter2["default"].emit("UI:ANY-ASSET-ACTION-BANNER:DECLINED-OR-CLOSED")}}}},CreateAssetWithUsernameInputBanner:function(){return{id:"banner-createAssetInputUsername",bannerType:"askCreateUsernameEntry",persistsUntilAssetConfirmed:!0,listeners:{saveAssetWithSelectedUsername:function(result){_emitter2["default"].emit("UI:BANNER:CREATE-ASSET:LOGIN-SELECTED",result.login)},close:function(){_emitter2["default"].emit("UI:ANY-ASSET-ACTION-BANNER:DECLINED-OR-CLOSED")}}}},UpdateAssetWithUsernameSelectorBanner:function(activeFlow){var usernames=activeFlow.candidateData.updateAsset.logins;return{id:"banner-updateAssetChooseUsername",bannerType:"askUpdateSelectableUsername",persistsUntilAssetConfirmed:!0,inpageConfig:{inpageType:"update_asset_choose_username",usernames:usernames,showHelpIcon:!1},listeners:{updateAssetWithSelectedUsername:function(result){_emitter2["default"].emit("UI:BANNER:UPDATE-ASSET:LOGIN-SELECTED",result.login)},close:function(){_emitter2["default"].emit("UI:ANY-ASSET-ACTION-BANNER:DECLINED-OR-CLOSED")}},afterCreate:function(){_emitter2["default"].emit("UI:BANNER:UPDATE-ASSET:CREATED",{usernames:usernames})}}},UpdateSingleAssetBanner:function(){return{id:"banner-update",bannerType:"askUpdate",persistsUntilAssetConfirmed:!0,inpageConfig:{inpageType:"banner_update_hercules"},listeners:{updateAsset:function(){_emitter2["default"].emit("UI:BANNER:UPDATE-ASSET:CLICKED")},dontUpdateAsset:function(){_emitter2["default"].emit("UI:BANNER:DONT-UPDATE-ASSET:CLICKED"),_emitter2["default"].emit("UI:ANY-ASSET-ACTION-BANNER:DECLINED-OR-CLOSED")},close:function(){_emitter2["default"].emit("UI:ANY-ASSET-ACTION-BANNER:DECLINED-OR-CLOSED")}}}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../modules/generate-id.module":189,"../modules/iframe-utils.module":193,"../modules/persist-user-actions.module":204,"../modules/prioritize-potential-logins.module":205,"../utils/emitter.util":210,underscore:"underscore"}],172:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function createIcon(fieldElement){var $icon=(0,_jquery2["default"])("<tkherculesicon />"),iconSideDimension=getIconSideDimensionForField(fieldElement);BASE_STYLE.width=iconSideDimension,BASE_STYLE.height=iconSideDimension;var elementZIndex=(0,_jquery2["default"])(fieldElement).css("z-index"),zIndexToBe="auto"===elementZIndex?1:parseInt(elementZIndex,10)+1;BASE_STYLE["z-index"]=zIndexToBe,$icon.css(BASE_STYLE);var icon=$icon[0];return icon.setDefaultState=setDefaultState,icon.setActiveState=setActiveState,icon.setDefaultState(),icon}function getIconSideDimensionForField(fieldElement){var fieldHeight=(0,_jquery2["default"])(fieldElement).outerHeight(),iconSideDimension=22;return iconSideDimension>fieldHeight&&(iconSideDimension=fieldHeight,iconSideDimension-=2),iconSideDimension}function setDefaultState(){var $this=(0,_jquery2["default"])(this);$this.css("box-shadow",BOX_SHADOW),$this.css("background-image","url("+ICON_URL_DEFAULT_STATE+")"),$this.hover(function(){setHoverState(),$this.css("box-shadow","none")},function(){setDefaultState(),$this.css("box-shadow",BOX_SHADOW)})}function setActiveState(){var $this=(0,_jquery2["default"])(this);$this.css("background-image","url("+ICON_URL_ACTIVE_STATE+")"),$this.css("box-shadow","none"),$this.hover(function(){$this.css("box-shadow","none")})}function setHoverState(){(0,_jquery2["default"])(this).css("background-image","url("+ICON_URL_HOVER_STATE+")")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createIcon=createIcon,exports.getIconSideDimensionForField=getIconSideDimensionForField;var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_icons=require("../static/icons.json"),_icons2=_interopRequireDefault(_icons),ICON_URL_DEFAULT_STATE=_icons2["default"].main["default"],ICON_URL_ACTIVE_STATE=_icons2["default"].main.active,ICON_URL_HOVER_STATE=_icons2["default"].main.hover,BOX_SHADOW="0px 2px 2px 0px rgba(0, 0, 0, 0.5)",BASE_STYLE={"border-radius":"2px",cursor:"pointer",display:"none","background-color":"#0070C3","background-image":"url("+ICON_URL_DEFAULT_STATE+")","background-position":"center center","background-repeat":"no-repeat","background-size":"cover","box-shadow":BOX_SHADOW,position:"absolute"}},{"../static/icons.json":209,jquery:"jquery"}],173:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function create(inpageName,_ref7){var attachmentPointBoundingRectangle=_ref7.attachmentPointBoundingRectangle,iframeUrl=_ref7.iframeUrl,fieldId=_ref7.fieldId,isMagic=_ref7.isMagic,iframeIndex=_ref7.iframeIndex,assets=_ref7.assets,associatedChildScriptId=_ref7.associatedChildScriptId;if(fieldId&&(0,_iframeUtils.areWeInAnIframe)())return void _emitter2["default"].emit("TOOLTIP-FACTORY:DELEGATING-TOOLTIP-TO-PARENT-FRAME",{inpageName:inpageName,attachmentPointBoundingRectangle:(0,_inpagePositioningUtils.getAttachmentPointBoundingRectangle)(fieldId),fieldId:fieldId,isMagic:isMagic});var frameFactory=global.hercules.config.frameFactory,state=global.hercules.state,inpageOptions={assets:assets,fieldId:fieldId,isMagic:isMagic},config=getTooltipConfig[inpageName](inpageOptions),beforeCreate=config.beforeCreate,afterCreate=config.afterCreate,listeners=config.listeners;beforeCreate&&beforeCreate(),fieldId||(config.isToolbar=!0),attachmentPointBoundingRectangle&&(config.attachmentPoint=(0,_inpagePositioningUtils.calculatePositioningRelativeToChildFrame)({attachmentPointBoundingRectangle:attachmentPointBoundingRectangle,iframeIndex:iframeIndex,iframeUrl:iframeUrl}));var frame=frameFactory.create(config);if(state.frames.push({fieldId:fieldId,inpageName:inpageName,frame:frame}),fieldId&&!attachmentPointBoundingRectangle){state.getInjectedIconByFieldId(fieldId).element.setActiveState()}setupListeners({frame:frame,inpageName:inpageName,inpageOptions:inpageOptions,listeners:listeners,associatedChildScriptId:associatedChildScriptId}),afterCreate()}function setupListeners(_ref8){var frame=_ref8.frame,inpageName=_ref8.inpageName,inpageOptions=_ref8.inpageOptions,listeners=_ref8.listeners,associatedChildScriptId=_ref8.associatedChildScriptId;Object.getOwnPropertyNames(listeners).forEach(function(messageName){frame.on(messageName,function(result){_underscore2["default"].isUndefined(associatedChildScriptId)?(listeners[messageName](result),_emitter2["default"].emit("UI:FRAME:MESSAGE-RECEIVED",{messageName:messageName,result:result})):_emitter2["default"].emit("UI:FRAME-CREATED-FROM-CHILD-SCRIPT:MESSAGE-RECEIVED",{inpageName:inpageName,inpageOptions:inpageOptions,inpageCategory:TOOLTIP,messageName:messageName,messageResult:result,associatedChildScriptId:associatedChildScriptId})})})}function destroyCatchAllByFieldId(fieldId){var state=global.hercules.state,removedFrameEntry=state.spliceFrameByFieldId(fieldId);removedFrameEntry?destroyFrame(removedFrameEntry):_emitter2["default"].emit("UI:CATCH-ALL:NO-FRAME-TO-DESTROY",{fieldId:fieldId})}function destroyAll(){global.hercules.state.spliceFramesByType(CATCH_ALL).forEach(function(frameEntry){destroyFrame(frameEntry)}),(0,_jquery2["default"])("body").off("click.catchall_tooltip"),_emitter2["default"].emit("UI:CATCH-ALL:ALL-DESTROYED")}function destroyFrame(frameEntry){var fieldId=frameEntry.fieldId;frameEntry.frame.destroy(),_emitter2["default"].emit("UI:CATCH-ALL:DESTROYED",{fieldId:fieldId})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getTooltipConfig=void 0,exports.create=create,exports.destroyCatchAllByFieldId=destroyCatchAllByFieldId,exports.destroyAll=destroyAll;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_iframeUtils=require("../modules/iframe-utils.module"),_inpagePositioningUtils=require("../modules/inpage-positioning-utils.module"),_formatAssets=require("../modules/format-assets.module"),formatAssets=_interopRequireWildcard(_formatAssets),_inputHighlighter=require("../modules/input-highlighter.module"),_manualCredentialInjection=require("../modules/manual-credential-injection.module"),_constants=require("../modules/constants.module"),_jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),TOOLTIP=_constants.INPAGE_CATEGORIES.TOOLTIP,CATCH_ALL=_constants.TOOLTIP_TYPES.CATCH_ALL,getTooltipConfig=exports.getTooltipConfig={CatchAll:function(_ref){var fieldId=_ref.fieldId,isMagic=_ref.isMagic,assets=_ref.assets,state=global.hercules.state,field=state.getPasswordFieldByFieldId(fieldId)||{},icon=state.getInjectedIconByFieldId(fieldId),iconElement=!!icon&&icon.element,formattedAssets=formatAssets.fromHerculesForFrames(assets),multiAssetInjection=isMagic,notBoundToField=!fieldId;return{id:"tooltip-catchAll",attachTo:icon?iconElement:"body",options:{assets:formattedAssets,notBoundToField:notBoundToField,originScript:"hercules",formIsInIframe:(0,_iframeUtils.areWeInAnIframe)(),lastGeneratedPassword:state.lastGeneratedPassword,showGeneratorOnLoad:state.showGeneratorOnLoadCatchAll,multiAssetInjection:multiAssetInjection,selectPasswordClicked:state.selectPasswordClicked},listeners:{accountSelected:function(_ref2){var assetId=_ref2.assetId;multiAssetInjection?_emitter2["default"].emit("UI:CATCH-ALL:ACCOUNT-SELECTED:MULTI-ASSET-INJECTION",{fieldId:fieldId,assetId:assetId}):(state.activeAssetId=assetId,_emitter2["default"].emit("UI:ACTIVE-ASSET:SET",{assetId:assetId}),_emitter2["default"].emit("UI:CATCH-ALL:ACCOUNT-SELECTED",{fieldId:fieldId}))},onUsernameSelected:function(){_emitter2["default"].emit("UI:CATCH-ALL:USERNAME-INJECTION:CLICKED",{fieldId:fieldId,notBoundToField:notBoundToField})},onPasswordSelected:function(){state.selectPasswordClicked=!0,_emitter2["default"].emit("UI:CATCH-ALL:PASSWORD-INJECTION:CLICKED",{fieldId:fieldId,notBoundToField:notBoundToField})},passwordGenerated:function(_ref3){var password=_ref3.password;state.showGeneratorOnLoadCatchAll=!0,_emitter2["default"].emit("UI:CATCH-ALL:PASSWORD-GENERATOR:GENERATED:NEW",{password:password,fieldId:fieldId,notBoundToField:notBoundToField})},useLastGeneratedPassword:function(_ref4){var password=_ref4.password;state.showGeneratorOnLoadCatchAll=!0,_emitter2["default"].emit("UI:CATCH-ALL:PASSWORD-GENERATOR:GENERATED:USE-LAST",{password:password,fieldId:fieldId,notBoundToField:notBoundToField})},copyToClipboard:function(_ref5){var string=_ref5.string;_emitter2["default"].emit("UI:CATCH-ALL:PASSWORD-GENERATOR:COPY-TO-CLIPBOARD",{string:string})},destroy:function(){_emitter2["default"].emit("UI:CATCH-ALL:DESTROYED:BY-CLOSE",{fieldId:fieldId}),iconElement&&iconElement.setDefaultState(),state.spliceFrameByFieldId(fieldId)}},beforeCreate:function(){destroyAll(),(0,_inputHighlighter.endInputHighlightMode)(),(0,_manualCredentialInjection.cancelManualCredentialInjection)()},afterCreate:function(){(0,_jquery2["default"])("body").on("click.catchall_tooltip",function(event){event.target!==field.element&&event.target.className!==_constants.INPAGE_TOOLTIP_CLASS&&destroyAll()}),_emitter2["default"].emit("UI:CATCH-ALL:INITIALIZED",{fieldId:fieldId,fieldElement:field.element,multiAssetInjection:multiAssetInjection,notBoundToField:notBoundToField,isMagic:isMagic})}}},LoginPrompt:function(_ref6){var fieldId=_ref6.fieldId,state=global.hercules.state,icon=state.getInjectedIconByFieldId(fieldId),iconElement=!!icon&&icon.element;return{id:"tooltip-loginPrompt",attachTo:icon?iconElement:"body",options:{originScript:"hercules"},listeners:{loginSucceeded:function(){iconElement.setDefaultState(),state.spliceFrameByFieldId(fieldId),_emitter2["default"].emit("UI:LOGIN-TOOLTIP:LOGIN-SUCCESS",{fieldId:fieldId})},destroy:function(){_emitter2["default"].emit("UI:LOGIN-TOOLTIP:DESTROYED:BY-CLOSE",{fieldId:fieldId}),iconElement&&iconElement.setDefaultState(),state.spliceFrameByFieldId(fieldId)}},afterCreate:function(){_emitter2["default"].emit("UI:LOGIN-TOOLTIP:INITIALIZED",{fieldId:fieldId,TOOLTIP:TOOLTIP})}}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../modules/constants.module":178,"../modules/format-assets.module":187,"../modules/iframe-utils.module":193,"../modules/inpage-positioning-utils.module":197,"../modules/input-highlighter.module":199,"../modules/manual-credential-injection.module":203,"../utils/emitter.util":210,jquery:"jquery",underscore:"underscore"}],174:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function($element,styleProperty,styleValue){var newStyle=styleProperty+":"+styleValue+" !important;",oldStyle=void 0;$element.css(styleProperty,""),oldStyle=$element.attr("style"),oldStyle=oldStyle?oldStyle+" ":"",$element.attr("style",oldStyle+newStyle)}},{}],175:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function mergeMagicSelectorsIfNeeded(existingMagicElements,potentiallyNewMagicElements){var newMagicElements=[]
;return potentiallyNewMagicElements.forEach(function(potentiallyNewElement){_underscore2["default"].where(existingMagicElements,{cssSelector:potentiallyNewElement.cssSelector}).length||newMagicElements.push(potentiallyNewElement)}),!!newMagicElements.length&&existingMagicElements.concat(newMagicElements)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeMagicSelectorsIfNeeded=mergeMagicSelectorsIfNeeded;var _underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore)},{underscore:"underscore"}],176:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function init(){var _global$hercules$conf=global.hercules.config;CBMS=_global$hercules$conf.CBMS,tabId=_global$hercules$conf.tabId,contentscriptId=_global$hercules$conf.contentscriptId,listenForLogin(),listenForLogout(),listenForFrameMessages()}function getAssets(){var hostname=global.hercules.state.hostname;return CBMS.request("logins.getLoginsByDomain",{hostname:hostname})}function track(data){var timeNow=(new Date).getTime(),config=global.hercules.config;return _underscore2["default"].extend(data.mixpanel_params,{browser_name:config.browser,browser_version:config.browserVersion,perf_timing_since_contentscript_init:timeNow-config.contentscriptInitMoment,perf_timing_since_dom_loading:timeNow-window.performance.timing.domLoading,perf_timing_since_dom_interactive:timeNow-window.performance.timing.domInteractive}),CBMS.request("track2",data)}function buildPageInteractionSession(data){return global.hercules.config.CBMS.request("piSession.buildPageInteractionSession",data)}function getLoggedInState(){return CBMS.request("isLoggedIn")}function pushTempData(data){return CBMS.request("volatileStorage.push",data)}function popTempData(){return CBMS.request("volatileStorage.pop")}function createAsset(asset){var formattedAsset=formatAssets.fromHerculesForBackground([asset])[0];return CBMS.request("logins.create",formattedAsset)}function refreshAssetsOnDashboard(){return CBMS.request("refreshAssetsOnDashboard")}function updateAsset(asset){var formattedAsset=formatAssets.fromHerculesForBackground([asset])[0];return CBMS.request("logins.update",formattedAsset)}function getUserData(key){return CBMS.request("storage.userDataLowShared.get",{key:key})}function setUserData(key,value){return CBMS.request("storage.userDataLowShared.set",{key:key,value:value})}function listenForLogin(){CBMS.onLogin.addListener(function(){_emitter2["default"].emit("BACKGROUND-INTERFACE:USER-LOGGED-IN")})}function listenForFrameMessages(){CBMS.onMessageAllFramesInTab.addListener(function(){var response=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return response.isFromChildToParent&&!(0,_iframeUtils.areWeInAnIframe)()&&response.tabId===tabId?void _emitter2["default"].emit("BACKGROUND-INTERFACE:CHILD-FRAME-MESSAGE:RECEIVED",response):response.receiverId&&response.receiverId!==contentscriptId?void _emitter2["default"].emit("BACKGROUND-INTERFACE:UNSPECIFIED-FRAME-MESSAGE:RECEIVED",response):void _emitter2["default"].emit("BACKGROUND-INTERFACE:PARENT-FRAME-MESSAGE:RECEIVED",response)})}function emitMessageToChildFrames(_ref){var message=_ref.message,options=_ref.options,receiverId=_ref.receiverId;return CBMS.request("contentscript.messageAllFramesInTab",{message:message,options:options,tabId:tabId,isFromParentToChild:!0,receiverId:receiverId})}function emitMessageToParentFrames(_ref2){var message=_ref2.message,options=_ref2.options;return CBMS.request("contentscript.messageAllFramesInTab",{message:message,options:options,tabId:tabId,isFromChildToParent:!0,senderId:contentscriptId})}function listenForLogout(){CBMS.onLogout.addListener(function(){_emitter2["default"].emit("BACKGROUND-INTERFACE:USER-LOGGED-OUT")})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=init,exports.getAssets=getAssets,exports.track=track,exports.buildPageInteractionSession=buildPageInteractionSession,exports.getLoggedInState=getLoggedInState,exports.pushTempData=pushTempData,exports.popTempData=popTempData,exports.createAsset=createAsset,exports.refreshAssetsOnDashboard=refreshAssetsOnDashboard,exports.updateAsset=updateAsset,exports.getUserData=getUserData,exports.setUserData=setUserData,exports.listenForLogin=listenForLogin,exports.listenForFrameMessages=listenForFrameMessages,exports.emitMessageToChildFrames=emitMessageToChildFrames,exports.emitMessageToParentFrames=emitMessageToParentFrames,exports.listenForLogout=listenForLogout;var _underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_formatAssets=require("./format-assets.module"),formatAssets=_interopRequireWildcard(_formatAssets),_iframeUtils=require("../modules/iframe-utils.module"),_emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),CBMS=void 0,tabId=void 0,contentscriptId=void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../modules/iframe-utils.module":193,"../utils/emitter.util":210,"./format-assets.module":187,underscore:"underscore"}],177:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(element,callback){(0,_jquery2["default"])(element).on("input",function(event){callback(event)})};var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery)},{jquery:"jquery"}],178:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.PI_SESSION_TRIGGER_ACTORS={UNKNOWN:"unknown",PASSWORD_GENERATOR:"password_generator",USERNAME_INJECTION:"username_injection",USER:"user"},exports.SELECTORS={PI_SESSION_SUBMIT_BUTTONS:"input[type=button], input[type=submit], a, paper-button, button"},exports.FRAME_MESSAGES={SHOW_BANNER:"show_banner",HANDLE_BANNER_MESSAGE:"handle_banner_message",SHOW_TOOLTIP:"show_tooltip",HANDLE_TOOLTIP_MESSAGE:"handle_tooltip_message"},exports.TOOLTIP_TYPES={CATCH_ALL:"CatchAll",LOGIN_PROMPT:"LoginPrompt"},exports.INPAGE_TOOLTIP_CLASS="PBTooltipFrame",exports.INPAGE_CATEGORIES={BANNER:"banner",TOOLTIP:"tooltip"},exports.CONTENTSCRIPT_ID_ATTRIBUTE="tk_contentscript_id"},{}],179:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(field){var isMagic=arguments.length>1&&void 0!==arguments[1]&&arguments[1],cssPath=global.hercules.config.cssPath;return{element:field,fieldId:(0,_generateId2["default"])(),isMagic:isMagic,iconIsDisabled:!1,hasPerformedAMagicAutoFill:!1,cssSelector:cssPath(field),modified:!1,value:field.value}};var _generateId=require("./generate-id.module"),_generateId2=_interopRequireDefault(_generateId)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./generate-id.module":189}],180:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function unloadEvent(){_emitter2["default"].emit("DETECTOR:WINDOW-UNLOADING")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){window.onbeforeunload=unloadEvent},exports.unloadEvent=unloadEvent;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter)},{"../utils/emitter.util":210}],181:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(detectedFields,currentFields){return{removedFields:_underscore2["default"].filter(currentFields,function(currentField){var $currentField=(0,_jquery2["default"])(currentField);return!_underscore2["default"].find(detectedFields,function(detectedField){return $currentField.is((0,_jquery2["default"])(detectedField))})}),addedFields:_underscore2["default"].filter(detectedFields,function(detectedField){var $detectedField=(0,_jquery2["default"])(detectedField);return!_underscore2["default"].find(currentFields,function(currentField){return $detectedField.is((0,_jquery2["default"])(currentField))})})}};var _underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery)},{jquery:"jquery",underscore:"underscore"}],182:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();exports["default"]=function(_ref){var scrapedPasswords=_ref.scrapedPasswords,scrapedLogins=_ref.scrapedLogins,currentAssets=_ref.currentAssets,_$partition=_underscore2["default"].partition(scrapedPasswords,function(tempPassword){return _underscore2["default"].where(currentAssets,{password:tempPassword.value}).length}),_$partition2=_slicedToArray(_$partition,2),existingScrapedPasswords=_$partition2[0],newScrapedPasswords=_$partition2[1],_$partition3=_underscore2["default"].partition(scrapedLogins,function(tempLogin){return _underscore2["default"].where(currentAssets,{login:tempLogin.value}).length}),_$partition4=_slicedToArray(_$partition3,2),existingScrapedLogins=_$partition4[0];return{newScrapedPasswords:newScrapedPasswords,newScrapedLogins:_$partition4[1],existingScrapedPasswords:existingScrapedPasswords,existingScrapedLogins:existingScrapedLogins}};var _underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore)},{underscore:"underscore"}],183:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function isFormGone(magicFormElements){var passwordSelectors=_underscore2["default"].pluck(magicFormElements.passwords,"cssSelector"),nonPasswordSelectors=_underscore2["default"].pluck(magicFormElements.nonPasswords,"cssSelector"),passwordsAreGone=areElementsGone(passwordSelectors),nonPasswordAreGone=areElementsGone(nonPasswordSelectors);return passwordsAreGone&&nonPasswordAreGone}function areElementsGone(selectors){return _underscore2["default"].every(selectors,function(selector){return isElementGone(selector)})}function getParentForm(element){return(0,_jquery2["default"])(element).parents("form")[0]}function getFirstParentFormSelectorOfElement(element){var selector=!1,cssPath=global.hercules.config.cssPath,$parentForms=(0,_jquery2["default"])(element).parents("form");return $parentForms.length&&(selector=cssPath($parentForms[0])),selector}function buildElementModel(_ref){var element=_ref.element,$target=(0,_jquery2["default"])(element);if(0===$target.length)return null;var model={cssPath:global.hercules.config.cssPath($target[0]),tag:$target.prop("tagName")},parentFormPath=getFirstParentFormSelectorOfElement($target);parentFormPath!==!1&&(model.parentFormCSSPath=parentFormPath);var attrs={},hasAttrs=!1;_underscore2["default"].forEach(["placeholder","title","name","type"],function(attr){var value=$target.attr(attr);void 0!==value&&(attrs[attr]=value,hasAttrs=!0)}),hasAttrs&&(model.attr=attrs),model.cls=getSplitClasses($target);var text=$target.text();text.length<75&&""!==text&&(model.text=text),model.w=$target.outerWidth(),model.h=$target.outerHeight();var offset=$target.offset();return model.l=parseInt(offset.left,0),model.t=parseInt(offset.top,0),model}function getSplitClasses($element){var cls=$element.attr("class");return"string"==typeof cls&&""!==cls?cls.split(/\s+/):[]}function isElementGone(selector){var state=global.hercules.state,$element=(0,_jquery2["default"])(selector),$ignoredElements=(0,_jquery2["default"])(state.getAllInjectedElements());return!$element.length||!(0,_visible2["default"])($element[0])||!(0,_visible.isVisibleInViewport)($element[0],$ignoredElements)}function isVisible(element){var state=global.hercules.state,$ignoredElements=(0,_jquery2["default"])(state.getAllInjectedElements());return(0,_visible2["default"])(element)||(0,_visible.isVisibleInViewport)(element,$ignoredElements)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isFormGone=isFormGone,exports.areElementsGone=areElementsGone,exports.getParentForm=getParentForm,exports.getFirstParentFormSelectorOfElement=getFirstParentFormSelectorOfElement,exports.buildElementModel=buildElementModel,exports.getSplitClasses=getSplitClasses,exports.isElementGone=isElementGone,exports.isVisible=isVisible;var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_visible=require("visible"),_visible2=_interopRequireDefault(_visible)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jquery:"jquery",underscore:"underscore",visible:154}],184:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function elementFocusHandler(fieldId){var state=global.hercules.state,$field=(0,_jquery2["default"])(state.getPasswordFieldByFieldId(fieldId).element);$field.unbind("focus"),$field.focus(function(){_emitter2["default"].emit("UI:PASSWORD:FOCUS",{fieldId:fieldId}),$field.unbind("focus")}),_emitter2["default"].emit("UI:PASSWORD:FOCUS-HANDLER:ADDED",{fieldId:fieldId})}function removedElementFocusHandler(fieldId){var state=global.hercules.state,removedFieldElement=state.getRemovedPasswordFieldByFieldId(fieldId).element;(0,_jquery2["default"])(removedFieldElement).unbind("focus"),_emitter2["default"].emit("UI:PASSWORD:FOCUS-HANDLER:REMOVE:SUCCESS",{fieldId:fieldId})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.elementFocusHandler=elementFocusHandler,exports.removedElementFocusHandler=removedElementFocusHandler;var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/emitter.util":210,jquery:"jquery"}],185:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function getAllValidFields(_ref){var selector=_ref.selector,ignoreAttribute=global.hercules.config.externalIgnoreAttribute,formsToIgnoreSelector=global.hercules.config.formsToIgnoreSelector,overrideIgnoreAttribute=global.hercules.config.externalOverrideIgnoreAttribute,$ignoredForms=void 0,$results=[];return $results=(0,_jquery2["default"])(selector).not("["+ignoreAttribute+"]").not("[readonly]").not('[type="hidden"]').filter(function(index,field){return(0,_domHelpers.isVisible)(field)}),$results.length&&($ignoredForms=(0,_jquery2["default"])(formsToIgnoreSelector).not("["+overrideIgnoreAttribute+'="true"]'),$ignoredForms.length&&($results=$results.filter(function(index,field){return!(0,_jquery2["default"])(field).closest($ignoredForms).length}))),$results}function doesItMatch(element,selector){return(0,_jquery2["default"])(element).is(selector)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAllValidFields=getAllValidFields,exports.doesItMatch=doesItMatch;var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_domHelpers=require("./dom-helpers.module")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./dom-helpers.module":183,jquery:"jquery"}],186:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(assets){var domain=_urlParser2["default"].parse(window.location.href).domain,filteredAssets=_underscore2["default"].where(assets,{protectedWithPassword:!1});return filteredAssets=_underscore2["default"].filter(filteredAssets,function(asset){return asset.domain===domain})};var _urlParser=require("url-parser"),_urlParser2=_interopRequireDefault(_urlParser),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore)},{underscore:"underscore","url-parser":233}],187:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function fromBackgroundForHercules(assets){return(0,_filterAssets2["default"])(assets).map(function(asset){return _underscore2["default"].chain(asset).clone().extend(asset,{password:asset.clearPassword,assetId:asset.id}).value()})}function fromHerculesForFrames(assets){return assets.map(function(asset){return{id:asset.id,username:asset.login,title:asset.name}})}function fromHerculesForBackground(assets){var parsed=_urlParser2["default"].parse(location.href,!0),strippedURL=parsed.protocol+"//"+(parsed.host+parsed.pathname);return assets.map(function(asset){return _underscore2["default"].extend(asset,{name:asset.name||parsed.domain,login:asset.login,clearPassword:asset.password,url:asset.url||strippedURL})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromBackgroundForHercules=fromBackgroundForHercules,exports.fromHerculesForFrames=fromHerculesForFrames,exports.fromHerculesForBackground=fromHerculesForBackground;var _urlParser=require("url-parser"),_urlParser2=_interopRequireDefault(_urlParser),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_filterAssets=require("../modules/filter-assets.module"),_filterAssets2=_interopRequireDefault(_filterAssets)},{"../modules/filter-assets.module":186,underscore:"underscore","url-parser":233}],188:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){return(new Date).getTime()}},{}],189:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){return id++,id};var id=0},{}],190:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(fieldDimensions,iconDimensions){var top=0,left=iconDimensions.width;if(fieldDimensions.height>iconDimensions.height){var buffer=(fieldDimensions.height-iconDimensions.height)/2;top=buffer,left+=buffer>5?5:buffer}return{top:top,left:left}}},{}],191:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function getValidFieldsForStandardFlow(_ref){var fields=_ref.fields,validFields=_underscore2["default"].filter(fields,function(field){return!!field.value});return validFields=_underscore2["default"].map(validFields,function(field){return _underscore2["default"].omit(field,"element")})}function getValidFieldsForAjaxFlow(_ref2){var existingFields=_ref2.existingFields,removedFields=_ref2.removedFields,validFields=[];return _underscore2["default"].each(removedFields,function(removedField){_underscore2["default"].findWhere(existingFields,{cssSelector:removedField.cssSelector})||validFields.push(removedField)}),validFields=validFields.concat(existingFields),validFields=_underscore2["default"].filter(validFields,function(field){return!!field.value}),validFields=_underscore2["default"].map(validFields,function(field){return _underscore2["default"].omit(field,"element")})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getValidFieldsForStandardFlow=getValidFieldsForStandardFlow,exports.getValidFieldsForAjaxFlow=getValidFieldsForAjaxFlow;var _underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore)},{underscore:"underscore"}],192:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function handleExistingAssetLoginScenarios(){return!!(meta.noNewPasswords&&meta.atLeastOneExistingLogin&&meta.atLeastOneExistingPassword&&allValuesAreEqual(meta.diffedExistingLogins)&&meta.allExistingPasswordsAreEqual&&state.credentialsMatchSameAsset({login:meta.diffedExistingLogins[0].value,password:meta.diffedExistingPasswords[0].value}))&&(candidateData.magicElements.passwords.push({cssSelector:meta.diffedExistingPasswords[0].cssSelector}),candidateData.magicElements.nonPasswords.push({cssSelector:meta.diffedExistingLogins[0].cssSelector}),_emitter2["default"].emit("FLOW:EXISTING-ASSET-LOGIN"),!0)}function handleNewAssetScenarios(){if(meta.exactlyOneNewLogin&&meta.noNewPasswords&&meta.exactlyOneExistingPassword)return candidateData.newAsset={logins:meta.diffedNewLogins,password:meta.diffedExistingPasswords[0]},_emitter2["default"].emit("FLOW:ASSET-READY-FOR-CREATE"),!0;if(meta.noExistingAssets&&meta.atLeastOneNewLogin&&meta.noExistingLogins&&meta.oneOrMoreExistingXOrNewPasswords){var passwords=meta.diffedNewPasswords.length?meta.diffedNewPasswords:meta.diffedExistingPasswords;if(allValuesAreEqual(passwords))return candidateData.newAsset={logins:meta.diffedNewLogins,password:passwords[0]},_emitter2["default"].emit("FLOW:ASSET-READY-FOR-CREATE"),!0}return!!(meta.noExistingAssets&&meta.noLogins&&meta.atLeastOneNewPassword&&meta.allNewPasswordsAreEqual)&&(candidateData.newAsset={logins:void 0,password:meta.diffedNewPasswords[0]},_emitter2["default"].emit("FLOW:ASSET-REQUIRES-USERNAME-ENTRY"),!0)}function handleExistingAssetUpdateScenarios(){if(meta.exactlyOneExistingLogin&&meta.noExistingPasswords&&meta.atLeastOneNewPassword&&meta.allNewPasswordsAreEqual){var assetToUpdate=_underscore2["default"].clone(state.getAssetByLogin(meta.diffedExistingLogins[0].value));return assetToUpdate.password=meta.diffedNewPasswords[0].value,candidateData.updateAsset=assetToUpdate,_emitter2["default"].emit("FLOW:ASSET-READY-FOR-UPDATE"),!0}return!1}function handleCreateOrUpdateAssetScenarios(){return!!meta.atLeastOneExistingAsset&&(meta.atLeastOneNewPassword&&meta.allNewPasswordsAreEqual?(candidateData.createOrUpdateAsset={existingLogins:state.getAllLoginValues(),newLoginFields:meta.diffedNewLogins,passwordFields:meta.diffedNewPasswords},_emitter2["default"].emit("FLOW:ASSET-REQUIRES-CREATE-OR-UPDATE"),!0):!!(meta.atLeastTwoExistingPasswords&&meta.noNewPasswords&&meta.allExistingPasswordsAreEqual)&&(candidateData.createOrUpdateAsset={existingLogins:state.getAllLoginValues(),newLoginFields:meta.diffedNewLogins,passwordFields:meta.diffedExistingPasswords},_emitter2["default"].emit("FLOW:ASSET-REQUIRES-CREATE-OR-UPDATE"),!0))}function allValuesAreEqual(entries){return _underscore2["default"].every(entries,function(entry){return entry.value===entries[0].value})}function extrapolateMetaFromScrapedDiff(scrapedDiffResult){meta.diffedNewPasswords=scrapedDiffResult.newScrapedPasswords,meta.diffedNewLogins=scrapedDiffResult.newScrapedLogins,meta.diffedExistingPasswords=scrapedDiffResult.existingScrapedPasswords,meta.diffedExistingLogins=scrapedDiffResult.existingScrapedLogins,meta.exactlyOneAsset=1===state.assets.length,meta.moreThanOneAsset=state.assets.length>1,meta.atLeastOneExistingAsset=state.assets.length>=1,meta.noExistingAssets=0===state.assets.length,meta.noNewLogins=0===meta.diffedNewLogins.length,meta.noNewPasswords=0===meta.diffedNewPasswords.length,meta.noExistingLogins=0===meta.diffedExistingLogins.length,meta.noExistingPasswords=0===meta.diffedExistingPasswords.length,meta.noLogins=meta.noNewLogins&&meta.noExistingLogins,meta.exactlyOneNewLogin=1===meta.diffedNewLogins.length,meta.exactlyOneExistingLogin=1===meta.diffedExistingLogins.length,meta.exactlyOneNewPassword=1===meta.diffedNewPasswords.length,meta.exactlyOneExistingPassword=1===meta.diffedExistingPasswords.length,meta.atLeastOneNewLogin=meta.diffedNewLogins.length>=1,meta.atLeastOneExistingLogin=meta.diffedExistingLogins.length>=1,meta.atLeastOneNewPassword=meta.diffedNewPasswords.length>=1,meta.atLeastOneExistingPassword=meta.diffedExistingPasswords.length>=1,meta.atLeastTwoNewPasswords=meta.diffedNewPasswords.length>=2,meta.atLeastTwoExistingPasswords=meta.diffedExistingPasswords.length>=2,meta.allNewPasswordsAreEqual=allValuesAreEqual(meta.diffedNewPasswords),meta.allExistingPasswordsAreEqual=allValuesAreEqual(meta.diffedExistingPasswords),meta.oneOrMoreExistingXOrNewPasswords=meta.atLeastOneNewPassword&&meta.noExistingPasswords||meta.noNewPasswords&&meta.atLeastOneExistingPassword}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(scrapedDiffResult){return state=global.hercules.state,candidateData=state.activeFlow.candidateData,extrapolateMetaFromScrapedDiff(scrapedDiffResult),handleExistingAssetLoginScenarios()?"existing_asset_login":handleNewAssetScenarios()?"create_asset":handleExistingAssetUpdateScenarios()?"existing_asset_update":handleCreateOrUpdateAssetScenarios()?"create_or_update_asset":(_emitter2["default"].emit("FLOW:UNHANDLED-ASSET-COMBINATION"),"unhandled")};var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),state=void 0,candidateData=void 0,meta={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/emitter.util":210,underscore:"underscore"}],193:[function(require,module,exports){"use strict";function areWeInAnIframe(){var windowSelfIsNotTop=window.self!==window.top;return void 0===overrideValue?windowSelfIsNotTop:overrideValue}function getFrameIndex(){for(var length=window.parent.frames.length,i=0;i<length;i++)if(window.parent.frames[i]===window)return i;return null}function getIframeElement(_ref){var iframeIndex=_ref.iframeIndex,iframeUrl=_ref.iframeUrl,iframe=window.frames[iframeIndex],iframeElement=void 0;try{iframeElement=iframe.frameElement}catch(e){iframeElement=getIframeElementBySrc(iframeUrl)}return iframeElement}function getIframeElementBySrc(url){for(var iframes=window.document.getElementsByTagName("iframe"),iframeElement=void 0,i=0;i<iframes.length;i++)iframes[i].src===url&&(iframeElement=iframes[i]);return iframeElement}function _override(val){overrideValue=val}Object.defineProperty(exports,"__esModule",{value:!0}),exports.areWeInAnIframe=areWeInAnIframe,exports.getFrameIndex=getFrameIndex,exports.getIframeElement=getIframeElement,exports.getIframeElementBySrc=getIframeElementBySrc,exports._override=_override;var overrideValue=void 0},{}],194:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){(0,_jquery2["default"])(function(){var styleNode=document.createElement("style");styleNode.innerHTML="\n  tkpulsar {\n    box-shadow: 0 0 0 0 #DCEBF6;\n    -webkit-animation: truekey-pulsate 1.5s ease-in;\n    -webkit-animation-iteration-count: infinite;\n  }\n\n  tkdelayedpulsar {\n    box-shadow: 0 0 0 0 #DCEBF6;\n    -webkit-animation: truekey-pulsate 1.5s ease-in;\n    -webkit-animation-iteration-count: infinite;\n    animation-delay: 400ms;\n  }\n\n  @-webkit-keyframes truekey-pulsate {\n    0% {\n      box-shadow: 0 0 0 5px #DCEBF6;\n      opacity: 0.0;\n    }\n    50% {\n      opacity: 1;\n    }\n    100% {\n      box-shadow: 0 0 0 25px #DCEBF6;\n      opacity: 0.0;\n    }\n  }",document.body.appendChild(styleNode)})};var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery)},{jquery:"jquery"}],195:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function updatePosition(field,icon,fieldId){var state=global.hercules.state,position=field.$element.position(),localIcon=state.getIconByFieldId(fieldId)||icon,iconSideDimension=(0,_icon.getIconSideDimensionForField)(field.element);localIcon.width=iconSideDimension,localIcon.height=iconSideDimension;var calculatedIconOffset=(0,_getIconOffset2["default"])(field,localIcon),calculatedTop=position.top+calculatedIconOffset.top,calculatedLeft=position.left+field.$element.outerWidth(!0)-calculatedIconOffset.left;icon.$element.css({top:calculatedTop,left:calculatedLeft,height:localIcon.width,width:localIcon.height}),localIcon.$pulsarElements&&localIcon.$pulsarElements.css({top:calculatedTop,left:calculatedLeft})}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(fieldId){var state=global.hercules.state,fieldEntry=state.getPasswordFieldByFieldId(fieldId),fieldElement=fieldEntry.element;if(fieldElement.offsetWidth<"40")return _emitter2["default"].emit("UI:ICON:NOT-INJECTED:FIELD-TOO-SMALL",{fieldId:fieldId}),null;var field={element:fieldElement,$element:(0,_jquery2["default"])(fieldElement)};field.offset=field.$element.offset(),field.width=field.$element.outerWidth(),field.height=field.$element.outerHeight();var iconElement=(0,_icon.createIcon)(field.element),icon={element:iconElement,$element:(0,_jquery2["default"])(iconElement)};field.$element.parent().append(icon.$element),updatePosition(field,icon),icon.$element.click(function(e){e.preventDefault(),e.stopPropagation(),_emitter2["default"].emit("UI:ICON:CLICKED",{fieldId:fieldId})});var intervalId=setInterval(function(){if(!(0,_domHelpers.isVisible)(field.element))return icon.$element.remove(),void clearInterval(intervalId);var currentFieldPosition={offset:field.$element.offset(),width:field.$element.outerWidth(),height:field.$element.outerHeight()};(!_underscore2["default"].isEqual(currentFieldPosition.offset,field.offset)||currentFieldPosition.width!==field.width||currentFieldPosition.height!==field.height)&&(field=_underscore2["default"].extend(field,currentFieldPosition),updatePosition(field,icon,fieldId),icon.$element.trigger("pbOnMove"))},50);return icon.$element.fadeIn(800),_emitter2["default"].emit("UI:ICON:INJECTED",{fieldId:fieldId,foundByNewIsVisible:fieldEntry.foundByNewIsVisible,element:icon.element}),{fieldId:fieldId,element:icon.element,icon:icon}};var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_getIconOffset=require("./get-icon-offset.module"),_getIconOffset2=_interopRequireDefault(_getIconOffset),_icon=require("../factories/icon.factory"),_domHelpers=require("./dom-helpers.module")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../factories/icon.factory":172,"../utils/emitter.util":210,"./dom-helpers.module":183,"./get-icon-offset.module":190,jquery:"jquery",underscore:"underscore"}],196:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,
newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(_ref){var fieldId=_ref.fieldId,password=_ref.password,_ref$trigger=_ref.trigger,trigger=void 0===_ref$trigger?UNKNOWN:_ref$trigger,state=global.hercules.state,passwordField=state.getPasswordFieldByFieldId(fieldId);passwordField?((0,_simulateEvents.fillInput)(passwordField.element,password),_emitter2["default"].emit("UI:PASSWORD-INJECTION:SUCCESS",{fieldId:fieldId,element:passwordField.element,trigger:trigger})):_emitter2["default"].emit("UI:PASSWORD-INJECTION:FAIL",{fieldId:fieldId})};var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_simulateEvents=require("./simulate-events.module"),_constants=require("./constants.module"),constants=_interopRequireWildcard(_constants),UNKNOWN=constants.PI_SESSION_TRIGGER_ACTORS.UNKNOWN}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/emitter.util":210,"./constants.module":178,"./simulate-events.module":207}],197:[function(require,module,exports){(function(global){"use strict";function getAttachmentPointBoundingRectangle(fieldId){var iconElement=global.hercules.state.getInjectedIconByFieldId(fieldId).element,_iconElement$getBound=iconElement.getBoundingClientRect();return{top:_iconElement$getBound.top,left:_iconElement$getBound.left,bottom:_iconElement$getBound.bottom,right:_iconElement$getBound.right,height:_iconElement$getBound.height,width:_iconElement$getBound.width}}function calculatePositioningRelativeToChildFrame(_ref){var attachmentPointBoundingRectangle=_ref.attachmentPointBoundingRectangle,iframeIndex=_ref.iframeIndex,_ref$iframeUrl=_ref.iframeUrl,iframeUrl=void 0===_ref$iframeUrl?"":_ref$iframeUrl,iframeElement=(0,_iframeUtils.getIframeElement)({iframeIndex:iframeIndex,iframeUrl:iframeUrl}),documentBoundingRectangle=document.documentElement.getBoundingClientRect();if(iframeElement){var iframeElementBoundingRectangle=iframeElement.getBoundingClientRect();return{top:iframeElementBoundingRectangle.top+attachmentPointBoundingRectangle.top-documentBoundingRectangle.top,left:iframeElementBoundingRectangle.left+attachmentPointBoundingRectangle.left-documentBoundingRectangle.left,height:attachmentPointBoundingRectangle.height,width:attachmentPointBoundingRectangle.width}}return{top:0,left:documentBoundingRectangle.width,height:0,width:0}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAttachmentPointBoundingRectangle=getAttachmentPointBoundingRectangle,exports.calculatePositioningRelativeToChildFrame=calculatePositioningRelativeToChildFrame;var _iframeUtils=require("../modules/iframe-utils.module")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../modules/iframe-utils.module":193}],198:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function PasswordHandler(fieldId){return function(event){_emitter2["default"].emit("DETECTOR:PASSWORD-FIELD:UPDATED",{fieldId:fieldId,value:event.target.value})}}function NonPasswordHandler(fieldId){return function(event){_emitter2["default"].emit("DETECTOR:NON-PASSWORD-FIELD:UPDATED",{fieldId:fieldId,value:event.target.value})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PasswordHandler=PasswordHandler,exports.NonPasswordHandler=NonPasswordHandler;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter)},{"../utils/emitter.util":210}],199:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function startInputHighlightMode(){var isPassword=arguments.length>0&&void 0!==arguments[0]&&arguments[0],state=global.hercules.state;(0,_addImportantStyle2["default"])((0,_jquery2["default"])("html"),"cursor","pointer"),(0,_addImportantStyle2["default"])((0,_jquery2["default"])("input"),"cursor","pointer"),inputSelector=isPassword?_inputSelectors2["default"].password:_inputSelectors2["default"].nonPassword,(0,_jquery2["default"])(inputSelector).on("mouseenter.tk",function(e){var $element=(0,_jquery2["default"])(e.target),originalBackgroundColor=$element.css("background-color"),originalBorder={top:$element[0].style.borderTop,bottom:$element[0].style.borderBottom,left:$element[0].style.borderLeft,right:$element[0].style.borderRight};$element.css({"background-color":"rgb(128, 191, 255)","border-style":"solid","border-color":"rgb(0,113,197)"}),state.fields.touchedByHighlighter.push({$element:$element,originalBackgroundColor:originalBackgroundColor,originalBorder:originalBorder}),$element.on("mouseleave.tk",function(){$element.css("background-color",originalBackgroundColor),$element.css({"border-top":originalBorder.top,"border-bottom":originalBorder.bottom,"border-left":originalBorder.left,"border-right":originalBorder.right})})})}function endInputHighlightMode(){var state=global.hercules.state;(0,_jquery2["default"])("html").css("cursor","default"),(0,_jquery2["default"])("input").css("cursor","default"),(0,_jquery2["default"])(inputSelector).off("mouseenter.tk"),_underscore2["default"].forEach(state.fields.touchedByHighlighter,function(touchedField){touchedField.$element.css("background-color",touchedField.originalBackgroundColor),touchedField.$element.css({"border-top":touchedField.originalBorder.top,"border-bottom":touchedField.originalBorder.bottom,"border-left":touchedField.originalBorder.left,"border-right":touchedField.originalBorder.right}),touchedField.$element.unbind("mouseleave.tk"),state.fields.touchedByHighlighter=[]})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.startInputHighlightMode=startInputHighlightMode,exports.endInputHighlightMode=endInputHighlightMode;var _underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_addImportantStyle=require("./add-important-style"),_addImportantStyle2=_interopRequireDefault(_addImportantStyle),_inputSelectors=require("./input-selectors.module"),_inputSelectors2=_interopRequireDefault(_inputSelectors),inputSelector=void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./add-important-style":174,"./input-selectors.module":200,jquery:"jquery",underscore:"underscore"}],200:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]={nonPassword:'\n   input[type="text"],\n   input[type="email"],\n   input[type="tel"],\n   input[type="input"],\n   input:not([type])',password:":password"}},{}],201:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function introViewsAreBelowThreshold(){return global.hercules.state.introViews<5}function userShouldBeExposedToPulsatingButton(){var config=global.hercules.config,state=global.hercules.state;return"pulsating_button"===config.tutorialExperimentBucket&&!(!introViewsAreBelowThreshold()&&!state.introViewsCounterUpdated)}function userShouldBeExposedToTutorialPrompt(){return introViewsAreBelowThreshold()&&"tutorial_prompt"===global.hercules.config.tutorialExperimentBucket}function completeIntro(){global.hercules.state.introViews<5?(global.hercules.state.introViews=5,_emitter2["default"].emit("INTRO:COMPLETED")):_emitter2["default"].emit("INTRO:ALREADY-COMPLETE")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.introViewsAreBelowThreshold=introViewsAreBelowThreshold,exports.userShouldBeExposedToPulsatingButton=userShouldBeExposedToPulsatingButton,exports.userShouldBeExposedToTutorialPrompt=userShouldBeExposedToTutorialPrompt,exports.completeIntro=completeIntro;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/emitter.util":210}],202:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function checkIfFieldIsMagic(_ref){var element=_ref.element,isPassword=_ref.isPassword,type=isPassword?"passwords":"nonPasswords",validatedData=global.hercules.state.activeFlow.validatedData,isMagic=!1;if(validatedData.magicElements){var validatedMagicSeletors=validatedData.magicElements[type];_underscore2["default"].each(validatedMagicSeletors,function(magicSelector){(0,_fieldFinder.doesItMatch)(element,magicSelector.cssSelector)&&(isMagic=!0)})}return isMagic}function checkIfFieldsAreMagicAndUpdateLoginFlow(_ref2){var fields=_ref2.fields,isPassword=_ref2.isPassword;return _underscore2["default"].map(fields,function(field){var fieldId=field.fieldId,isMagic=checkIfFieldIsMagic({element:field.element,isPassword:isPassword});return field.isMagic=isMagic,isMagic&&updateLoginFlowWithNewMagicField({fieldId:fieldId,isPassword:isPassword}),field})}function updateLoginFlowWithNewMagicField(_ref3){var fieldId=_ref3.fieldId,isPassword=_ref3.isPassword,state=global.hercules.state,field=state.getFieldByFieldId(fieldId),matchedLoginFlow=getLoginFlowByCheckingFieldAgainstContainerForm(field);if(matchedLoginFlow)handleNewMagicFieldForLoginFlow(matchedLoginFlow,fieldId,isPassword);else{var $parentForms=(0,_jquery2["default"])(field.element).parents("form");if($parentForms.length){var newLoginFlow={formParent:$parentForms[0]};isPassword?newLoginFlow.detectedPassword={fieldId:field.fieldId}:newLoginFlow.detectedNonPassword={fieldId:field.fieldId},state.magicFlows.logins.push(newLoginFlow)}}}function getLoginFlowByCheckingFieldAgainstContainerForm(field){var loginFlows=global.hercules.state.magicFlows.logins;return _underscore2["default"].find(loginFlows,function(loginFlow){return(0,_jquery2["default"])(loginFlow.formParent).find(field.element).length})}function handleNewMagicFieldForLoginFlow(matchedLoginFlow,fieldId,isPassword){matchedLoginFlow.detectedPassword&&matchedLoginFlow.detectedNonPassword||(isPassword&&!matchedLoginFlow.detectedPassword&&(matchedLoginFlow.detectedPassword={fieldId:fieldId}),isPassword||matchedLoginFlow.detectedNonPassword||(matchedLoginFlow.detectedNonPassword={fieldId:fieldId}),matchedLoginFlow.detectedPassword&&matchedLoginFlow.detectedNonPassword?_emitter2["default"].emit("MAGIC:LOGIN-FLOW:READY",{password:matchedLoginFlow.detectedPassword,nonPassword:matchedLoginFlow.detectedNonPassword}):_emitter2["default"].emit("MAGIC:LOGIN-FLOW:PARTIALLY-COMPLETED"))}function checkForSimpleLoginPremonition(){var state=global.hercules.state;if(!state.fields.passwords.length&&!state.fields.nonPasswords.length)return void _emitter2["default"].emit("FIELD:PREMONITION:EXIT:INSUFFICIENT-FIELDS");_underscore2["default"].each(state.fields.passwords,function(password){var parentForm=(0,_domHelpers.getParentForm)(password.element);if(!parentForm)return void _emitter2["default"].emit("FIELD:PREMONITION:SKIPPING-FIELD:NO-PARENT-FORM");var $formParent=(0,_jquery2["default"])(parentForm),matchingNonPasswords=getFieldEntriesInContainerElement(state.fields.nonPasswords,$formParent),matchingPasswords=getFieldEntriesInContainerElement(state.fields.passwords,$formParent);if(1===matchingNonPasswords.length&&1===matchingPasswords.length){var matchingNonPassword=state.getNonPasswordFieldByFieldId(matchingNonPasswords[0].fieldId);if(isFormSimpleLogin($formParent)){var matchingPassword=state.getPasswordFieldByFieldId(matchingPasswords[0].fieldId);matchingNonPassword.isPremonition=!0,matchingPassword.isPremonition=!0,matchingNonPassword.isMagic=!0,matchingPassword.isMagic=!0,_emitter2["default"].emit("FIELDS:MAGIC-NON-PASSWORD-FIELD:FOUND",{fieldId:matchingNonPassword.fieldId}),_emitter2["default"].emit("FIELDS:MAGIC-PASSWORD-FIELD:FOUND",{fieldId:password.fieldId})}else _emitter2["default"].emit("FIELD:PREMONITION:SKIPPING-FIELD:TOO-MANY-MATCHING-FIELDS-IN-FORM")}else _emitter2["default"].emit("FIELD:PREMONITION:SKIPPING-FIELD:TOO-MANY-MATCHING-FIELDS-ON-STATE")})}function isFormSimpleLogin($form){var hasOneVisibleNonPassword=checkForOneVisibleMatchInContainer($form,_inputSelectors2["default"].nonPassword),hasOneVisiblePassword=checkForOneVisibleMatchInContainer($form,_inputSelectors2["default"].password);return hasOneVisibleNonPassword&&hasOneVisiblePassword}function isElementInASimpleLogin(element){var form=(0,_domHelpers.getParentForm)(element);return!!form&&isFormSimpleLogin((0,_jquery2["default"])(form))}function checkForOneVisibleMatchInContainer($elementContainer,selector){return 1===$elementContainer.find(selector).filter(function(index,field){return(0,_domHelpers.isVisible)(field)}).length}function getFieldEntriesInContainerElement(fieldEntries,$containerElement){return _underscore2["default"].filter(fieldEntries,function(fieldEntry){return $containerElement.find(fieldEntry.element).length})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkIfFieldIsMagic=checkIfFieldIsMagic,exports.checkIfFieldsAreMagicAndUpdateLoginFlow=checkIfFieldsAreMagicAndUpdateLoginFlow,exports.updateLoginFlowWithNewMagicField=updateLoginFlowWithNewMagicField,exports.checkForSimpleLoginPremonition=checkForSimpleLoginPremonition,exports.isFormSimpleLogin=isFormSimpleLogin,exports.isElementInASimpleLogin=isElementInASimpleLogin;var _underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_domHelpers=require("./dom-helpers.module"),_fieldFinder=require("../modules/field-finder.module"),_inputSelectors=require("../modules/input-selectors.module"),_inputSelectors2=_interopRequireDefault(_inputSelectors),_emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../modules/field-finder.module":185,"../modules/input-selectors.module":200,"../utils/emitter.util":210,"./dom-helpers.module":183,jquery:"jquery",underscore:"underscore"}],203:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function startManualUsernameInjection(_ref){var fieldId=_ref.fieldId,_ref$notBoundToField=_ref.notBoundToField;startInjection({fieldId:fieldId,notBoundToField:void 0!==_ref$notBoundToField&&_ref$notBoundToField,isPassword:!1})}function startManualPasswordInjection(_ref2){var fieldId=_ref2.fieldId,_ref2$notBoundToField=_ref2.notBoundToField;startInjection({fieldId:fieldId,notBoundToField:void 0!==_ref2$notBoundToField&&_ref2$notBoundToField,isPassword:!0,password:_ref2.password})}function startInjection(_ref3){var fieldId=_ref3.fieldId,notBoundToField=_ref3.notBoundToField,isPassword=_ref3.isPassword,password=_ref3.password,state=global.hercules.state,activePassword=password||state.getActiveAsset().password,credential=isPassword?activePassword:state.getActiveAsset().login;state.activeModes.manualCredentialInjection=!0,state.$manualInjectionModeCursor=createCursor({credential:credential,isPassword:isPassword});var injectionHandler=makeInjectionHandler({credential:credential,isPassword:isPassword,notBoundToField:notBoundToField,fieldId:fieldId});state.activeHandlers.manualInjection=injectionHandler,(0,_jquery2["default"])("body").find("*").one("click",injectionHandler),_emitter2["default"].emit("UI:MANUAL-CREDENTIAL-INJECTION:STARTED",{fieldId:fieldId,isPassword:isPassword,activePassword:activePassword})}function createCursor(_ref4){var credential=_ref4.credential,isPassword=_ref4.isPassword,displayValue=isPassword?"*********":credential,$cursor=(0,_jquery2["default"])("<tkherculescursor>"+displayValue+"</tkherculescursor>");return $cursor.css({"background-color":"black","border-radius":".25em",padding:".5em",color:"white",position:"absolute",opacity:.8,"z-index":2147483647,visibility:"hidden"}),isPassword&&$cursor.css({"padding-top":"9px","padding-bottom":"4px"}),(0,_jquery2["default"])("html").append($cursor).on("mousemove",mouseMoveHandler),$cursor}function mouseMoveHandler(event){var $cursor=global.hercules.state.$manualInjectionModeCursor;$cursor.css({left:event.pageX+5,top:event.pageY+5}),"visible"!==$cursor.css("visibility")&&setTimeout(function(){$cursor.css({visibility:"visible"})},250)}function makeInjectionHandler(_ref5){var credential=_ref5.credential,isPassword=_ref5.isPassword,notBoundToField=_ref5.notBoundToField,fieldId=_ref5.fieldId,targetSelector=isPassword?_inputSelectors2["default"].password:_inputSelectors2["default"].nonPassword;return function(event){var targetElement=event.target,$filteredTarget=(0,_jquery2["default"])(targetElement).filter(targetSelector);$filteredTarget.length?((0,_simulateEvents.fillInput)($filteredTarget[0],credential),_emitter2["default"].emit("UI:MANUAL-CREDENTIAL-INJECTION:SUCCESS",{fieldId:fieldId,notBoundToField:notBoundToField,targetElement:targetElement,isPassword:isPassword})):_emitter2["default"].emit("UI:MANUAL-CREDENTIAL-INJECTION:FAIL",{fieldId:fieldId,notBoundToField:notBoundToField,targetElement:targetElement,isPassword:isPassword}),cancelManualCredentialInjection()}}function cancelManualCredentialInjection(){var state=global.hercules.state;if(state.activeModes.manualCredentialInjection){var injectionHandler=state.activeHandlers.manualInjection;(0,_jquery2["default"])("body").find("*").unbind("click",injectionHandler),(0,_jquery2["default"])("html").unbind("mousemove",mouseMoveHandler),state.$manualInjectionModeCursor&&(state.$manualInjectionModeCursor.remove(),state.$manualInjectionModeCursor=void 0),state.activeModes.manualCredentialInjection=!1,state.activeHandlers.manualInjection=void 0,_emitter2["default"].emit("UI:MANUAL-CREDENTIAL-INJECTION:CANCELLED")}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.startManualUsernameInjection=startManualUsernameInjection,exports.startManualPasswordInjection=startManualPasswordInjection,exports.cancelManualCredentialInjection=cancelManualCredentialInjection;var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter),_simulateEvents=require("./simulate-events.module"),_inputSelectors=require("./input-selectors.module"),_inputSelectors2=_interopRequireDefault(_inputSelectors)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/emitter.util":210,"./input-selectors.module":200,"./simulate-events.module":207,jquery:"jquery"}],204:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function persistUserAction(_ref){var assetData=_ref.assetData,assetDataType=_ref.assetDataType,replayActionMessage=_ref.replayActionMessage;global.hercules.state.unconfirmedAsset={assetData:assetData,assetDataType:assetDataType,replayActionMessage:replayActionMessage,fromBackground:!1}}function handlePersistedUserAction(){var state=global.hercules.state;"create"===state.unconfirmedAsset.assetDataType&&(state.activeFlow.candidateData.newAsset=state.unconfirmedAsset.assetData),"update"===state.unconfirmedAsset.assetDataType&&(state.activeFlow.candidateData.updateAsset=state.unconfirmedAsset.assetData),"create_or_update"===state.unconfirmedAsset.assetDataType&&(state.activeFlow.candidateData.createOrUpdateAsset=state.unconfirmedAsset.assetData),_emitter2["default"].emit(state.unconfirmedAsset.replayActionMessage,!0)}function handleUserBannerInteraction(){global.hercules.state.unconfirmedAsset=void 0,_emitter2["default"].emit("UI:BANNER:USER-ACTION:PERFORMED")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.persistUserAction=persistUserAction,exports.handlePersistedUserAction=handlePersistedUserAction,exports.handleUserBannerInteraction=handleUserBannerInteraction;var _emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/emitter.util":210}],205:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function prioritizePotentialLogins(logins){return _underscore2["default"].sortBy(logins,function(login){var rank=1,ampersandMatches=login.match(/[@]{1}/g);return ampersandMatches&&1===ampersandMatches.length&&(rank=0),/^[\d-+()\s]*$/g.test(login)?rank=2:/[^\w.@\\\/-]/g.test(login)?rank=3:/^[\d\\\/]*$/g.test(login)?rank=4:rank})}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=prioritizePotentialLogins;var _underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore)},{underscore:"underscore"}],206:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function addPulseToButtonInField(fieldId){var state=global.hercules.state,button=state.getIconByFieldId(fieldId),$button=(0,_jquery2["default"])(button.element),$pulsar=(0,_jquery2["default"])("<tkpulsar>"),$delayedPulsar=(0,_jquery2["default"])("<tkdelayedpulsar>"),$pulsarElements=(0,_jquery2["default"])("").add([$pulsar[0],$delayedPulsar[0]]),width=$button.width();$button.after($pulsarElements),$pulsarElements.css({"border-radius":width,height:width,position:"absolute",left:$button.css("left"),top:$button.css("top"),"z-index":$button.css("z-index")-1,width:width}),button.$pulsarElements=$pulsarElements,button.isHighlighted=!0,_emitter2["default"].emit("UI:ICON:PULSAR:ADDED")}function addPulseToButtonInAllFields(){var state=global.hercules.state;_underscore2["default"].each(state.fields.passwords,function(field){addPulseToButtonInField(field.fieldId)})}function removePulseFromButtonInField(fieldId){var state=global.hercules.state,button=state.getIconByFieldId(fieldId),$pulsarElements=button.$pulsarElements;$pulsarElements.each(function(index,$pulsar){return $pulsar.remove()}),$pulsarElements=null,button.isHighlighted=!1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addPulseToButtonInField=addPulseToButtonInField,exports.addPulseToButtonInAllFields=addPulseToButtonInAllFields,exports.removePulseFromButtonInField=removePulseFromButtonInField;var _jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_underscore=require("underscore"),_underscore2=_interopRequireDefault(_underscore),_emitter=require("../utils/emitter.util"),_emitter2=_interopRequireDefault(_emitter)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/emitter.util":210,jquery:"jquery",underscore:"underscore"}],207:[function(require,module,exports){(function(global){"use strict";function triggerClick(el){triggerEvent(el,"mousedown",{detail:0}),triggerEvent(el,"mouseup",{detail:0}),el.click(),"IOS"!==global.hercules.config.browser&&"ANDROID"!==global.hercules.config.browser||(triggerEvent(el,"touchstart",{detail:0}),triggerEvent(el,"touchend",{detail:0}))}function fillInput(paramInput,value){var input=paramInput;"password"===input.type&&input.setAttribute(FILL_EVENT_IN_PROGRESS_ATTRIBUTE,"true"),input.focus(),triggerEvent(input,"focus"),triggerEvent(input,"keydown"),input.value=value,triggerEvent(input,"input",{bubbles:!0}),triggerEvent(input,"change"),triggerEvent(input,"keyup"),triggerEvent(input,"keypress"),triggerEvent(input,"payload"),triggerEvent(input,"blur")}function triggerEvent(paramEl,paramType,paramOptions){var el=paramEl,options=paramOptions,type=paramType;"string"==typeof paramEl&&(options=type,type=paramEl,el=document);var e=createEvent(type,options);el.dispatchEvent?el.dispatchEvent(e):el.fireEvent("on"+type,e)}function createEvent(type,options){if(!document.createEvent)return createIeEvent(type,options);switch(type){case"dblclick":case"click":case"mousedown":case"mouseup":return createMouseEvent(type,options);case"keydown":case"keyup":return createKeyboardEvent(type,options);case"change":case"blur":return createHtmlEvent(type,options);default:return createCustomEvent(type,options)}}function createCustomEvent(type,options){var e=document.createEvent("CustomEvent"),newOptions=eventOptions(options);try{e.initCustomEvent(type,newOptions.bubbles,newOptions.cancelable)}catch(err){e.initEvent(type,newOptions.bubbles,newOptions.cancelable,newOptions.view)}return e}function createIeEvent(type,options){var e=document.createEventObject(),newOptions=eventOptions(type,options);return e.altKey=newOptions.alt,e.bubbles=newOptions.bubbles,e.button=newOptions.button,e.cancelable=newOptions.cancelable,e.clientX=newOptions.clientX,e.clientY=newOptions.clientY,e.ctrlKey=newOptions.ctrl,e.detail=newOptions.detail,e.metaKey=newOptions.meta,e.screenX=newOptions.screenX,e.screenY=newOptions.screenY,e.shiftKey=newOptions.shift,e.keyCode=newOptions.key,e.charCode=newOptions.key,e.view=newOptions.view,e}function eventOptions(type,options){var defaults={alt:!1,bubbles:!0,button:0,cancelable:!0,clientX:0,clientY:0,ctrl:!1,detail:1,key:0,meta:!1,relatedTarge:null,screenX:0,screenY:0,shift:!1,view:window},opts={},newOptions=options||{};return Object.keys(defaults).forEach(function(prop){opts[prop]=newOptions[prop]||defaults[prop]}),"dblclick"===type&&(opts.detail=2),opts}function createMouseEvent(type,options){var e=document.createEvent("MouseEvent"),newOptions=eventOptions(type,options);try{e.initMouseEvent(type,newOptions.bubbles,newOptions.cancelable,newOptions.view,newOptions.detail,newOptions.screenX,newOptions.screenY,newOptions.clientX,newOptions.clientY,newOptions.ctrl,newOptions.alt,newOptions.shift,newOptions.meta,newOptions.button,newOptions.relatedTarget)}catch(err){e.initEvent(type,newOptions.bubbles,newOptions.cancelable,newOptions.view)}return e}function createKeyboardEvent(type,options){var e=document.createEvent("KeyboardEvent"),newOptions=eventOptions(type,options);try{(e.initKeyboardEvent||e.initKeyEvent).call(e,type,newOptions.bubbles,newOptions.cancelable,newOptions.view,newOptions.ctrl,newOptions.alt,newOptions.shift,newOptions.meta,newOptions.key,newOptions.key),e.keyCode!==newOptions.key&&(Object.defineProperty(e,"keyCode",{get:function(){return newOptions.key}}),Object.defineProperty(e,"charCode",{get:function(){return newOptions.key}}),Object.defineProperty(e,"which",{get:function(){return newOptions.key}}))}catch(err){e.initEvent(e,type,options.bubbles,options.cancelable,options.view)}return e}function createHtmlEvent(type,options){var e=document.createEvent("HTMLEvents"),newOptions=eventOptions(type,options);return(e.initEvent||e.initHtmlEvent).call(e,type,newOptions.bubbles,newOptions.cancelable,newOptions.view),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.triggerClick=triggerClick,exports.fillInput=fillInput,exports.triggerEvent=triggerEvent,exports.createEvent=createEvent,exports.createIeEvent=createIeEvent,exports.createKeyboardEvent=createKeyboardEvent,exports.createHtmlEvent=createHtmlEvent;var FILL_EVENT_IN_PROGRESS_ATTRIBUTE=exports.FILL_EVENT_IN_PROGRESS_ATTRIBUTE="hercules-fillInputInProgress"}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],208:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function createLoginPromptTooltip(_ref){var fieldId=_ref.fieldId,lastLoggedOutAction=_ref.lastLoggedOutAction;global.hercules.state.lastLoggedOutAction=lastLoggedOutAction,tooltipFactory.create(LOGIN_PROMPT,{fieldId:fieldId})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ACTIONS=void 0,exports.createLoginPromptTooltip=createLoginPromptTooltip;var _tooltip=require("../factories/tooltip.factory"),tooltipFactory=_interopRequireWildcard(_tooltip),_constants=require("../modules/constants.module"),LOGIN_PROMPT=_constants.TOOLTIP_TYPES.LOGIN_PROMPT;exports.ACTIONS={PASSWORD_FOCUSED:"password_focused",ICON_CLICKED:"icon_clicked"}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../factories/tooltip.factory":173,"../modules/constants.module":178}],209:[function(require,module,exports){module.exports={main:{"default":"data:image/svg+xml,%3Csvg%20width%3D%2222%22%20height%3D%2222%22%20viewBox%3D%220%200%2022%2022%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20d%3D%22M0%200h22v22H0z%22%20fill%3D%22%23000%22/%3E%3Cpath%20d%3D%22M0%200h22v22H0z%22%20fill%3D%22%230071C5%22/%3E%3Cg%20fill%3D%22%23FFF%22%3E%3Cpath%20d%3D%22M9.463%206.938c.035.115.137.188.246.188.025%200%20.052-.005.08-.014.135-.046.21-.2.165-.342l-.8-2.582c-.044-.143-.19-.22-.326-.175-.137.047-.21.2-.167.342l.8%202.583zM5.392%207.056l2.094%201.596c.046.035.1.052.152.052.08%200%20.16-.04.21-.112.084-.122.058-.29-.057-.38L5.697%206.616c-.115-.088-.277-.06-.36.06-.085.122-.06.292.056.38M7.106%2010.985c0-.15-.116-.27-.26-.27H4.26c-.144%200-.26.12-.26.27%200%20.15.116.272.26.272h2.587c.143%200%20.26-.122.26-.272M7.848%2013.38c-.084-.122-.246-.15-.362-.06l-2.094%201.595c-.116.088-.14.258-.057.38.05.072.13.11.21.11.052%200%20.105-.016.15-.05l2.096-1.597c.116-.088.142-.258.058-.38M11.95%2013.21c.828-.39%201.368-1.254%201.368-2.225%200-1.347-1.045-2.443-2.33-2.443-1.284%200-2.33%201.096-2.33%202.443%200%20.97.54%201.835%201.37%202.227l-1.365%204.403c-.044.143.03.296.166.342.026.01.053.014.08.014.108%200%20.21-.072.245-.187l1.44-4.647v-.002l.08-.257-.246-.083c-.75-.256-1.253-.982-1.253-1.81%200-1.047.813-1.9%201.812-1.9.998%200%201.81.853%201.81%201.9%200%20.828-.502%201.554-1.25%201.81h-.002l-.245.083.16.517%201.36%204.39c.035.114.136.187.245.187.027%200%20.054-.004.08-.013.136-.046.21-.2.167-.342L11.95%2013.21zM16.585%2014.915L14.49%2013.32c-.114-.09-.276-.062-.36.06-.084.12-.06.29.057.378l2.094%201.596c.047.035.1.052.153.052.08%200%20.16-.04.21-.112.084-.12.058-.29-.058-.38M17.72%2010.714h-2.59c-.143%200-.26.12-.26.27%200%20.15.117.273.26.273h2.59c.142%200%20.258-.122.258-.272%200-.15-.116-.27-.26-.27M14.13%208.592c.05.073.13.112.21.112.052%200%20.105-.017.15-.052l2.096-1.596c.115-.088.14-.258.057-.38-.084-.12-.246-.148-.362-.06l-2.093%201.596c-.116.09-.14.258-.057.38M12.19%207.112c.025.01.052.013.08.013.108%200%20.21-.072.245-.187l.8-2.582c.044-.143-.03-.296-.167-.343-.136-.046-.282.032-.326.175l-.8%202.582c-.044.143.03.296.167.342%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E",
active:"data:image/svg+xml,%3Csvg%20width%3D%2222%22%20height%3D%2222%22%20viewBox%3D%220%200%2022%2022%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20fill%3D%22%230E4D96%22%20d%3D%22M0%200h22v22H0z%22/%3E%3Cg%20fill%3D%22%23FFF%22%3E%3Cpath%20d%3D%22M9.463%206.938c.035.115.137.188.246.188.025%200%20.052-.005.08-.014.135-.046.21-.2.165-.342l-.8-2.582c-.044-.143-.19-.22-.326-.175-.137.047-.21.2-.167.342l.8%202.583zM5.392%207.056l2.094%201.596c.046.035.1.052.152.052.08%200%20.16-.04.21-.112.084-.122.058-.29-.057-.38L5.697%206.616c-.115-.088-.277-.06-.36.06-.085.122-.06.292.056.38M7.106%2010.985c0-.15-.116-.27-.26-.27H4.26c-.144%200-.26.12-.26.27%200%20.15.116.272.26.272h2.587c.143%200%20.26-.122.26-.272M7.848%2013.38c-.084-.122-.246-.15-.362-.06l-2.094%201.595c-.116.088-.14.258-.057.38.05.072.13.11.21.11.052%200%20.105-.016.15-.05l2.096-1.597c.116-.088.142-.258.058-.38M11.95%2013.21c.828-.39%201.368-1.254%201.368-2.225%200-1.347-1.045-2.443-2.33-2.443-1.284%200-2.33%201.096-2.33%202.443%200%20.97.54%201.835%201.37%202.227l-1.365%204.403c-.044.143.03.296.166.342.026.01.053.014.08.014.108%200%20.21-.072.245-.187l1.44-4.647v-.002l.08-.257-.246-.083c-.75-.256-1.253-.982-1.253-1.81%200-1.047.813-1.9%201.812-1.9.998%200%201.81.853%201.81%201.9%200%20.828-.502%201.554-1.25%201.81h-.002l-.245.083.16.517%201.36%204.39c.035.114.136.187.245.187.027%200%20.054-.004.08-.013.136-.046.21-.2.167-.342L11.95%2013.21zM16.585%2014.915L14.49%2013.32c-.114-.09-.276-.062-.36.06-.084.12-.06.29.057.378l2.094%201.596c.047.035.1.052.153.052.08%200%20.16-.04.21-.112.084-.12.058-.29-.058-.38M17.72%2010.714h-2.59c-.143%200-.26.12-.26.27%200%20.15.117.273.26.273h2.59c.142%200%20.258-.122.258-.272%200-.15-.116-.27-.26-.27M14.13%208.592c.05.073.13.112.21.112.052%200%20.105-.017.15-.052l2.096-1.596c.115-.088.14-.258.057-.38-.084-.12-.246-.148-.362-.06l-2.093%201.596c-.116.09-.14.258-.057.38M12.19%207.112c.025.01.052.013.08.013.108%200%20.21-.072.245-.187l.8-2.582c.044-.143-.03-.296-.167-.343-.136-.046-.282.032-.326.175l-.8%202.582c-.044.143.03.296.167.342%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E",hover:"data:image/svg+xml,%3Csvg%20width%3D%2222%22%20height%3D%2222%22%20viewBox%3D%220%200%2022%2022%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20fill%3D%22%230071C5%22%20d%3D%22M0%200h22v22H0z%22/%3E%3Cg%20fill%3D%22%23FFF%22%3E%3Cpath%20d%3D%22M9.463%206.938c.035.115.137.188.246.188.025%200%20.052-.005.08-.014.135-.046.21-.2.165-.342l-.8-2.582c-.044-.143-.19-.22-.326-.175-.137.047-.21.2-.167.342l.8%202.583zM5.392%207.056l2.094%201.596c.046.035.1.052.152.052.08%200%20.16-.04.21-.112.084-.122.058-.29-.057-.38L5.697%206.616c-.115-.088-.277-.06-.36.06-.085.122-.06.292.056.38M7.106%2010.985c0-.15-.116-.27-.26-.27H4.26c-.144%200-.26.12-.26.27%200%20.15.116.272.26.272h2.587c.143%200%20.26-.122.26-.272M7.848%2013.38c-.084-.122-.246-.15-.362-.06l-2.094%201.595c-.116.088-.14.258-.057.38.05.072.13.11.21.11.052%200%20.105-.016.15-.05l2.096-1.597c.116-.088.142-.258.058-.38M11.95%2013.21c.828-.39%201.368-1.254%201.368-2.225%200-1.347-1.045-2.443-2.33-2.443-1.284%200-2.33%201.096-2.33%202.443%200%20.97.54%201.835%201.37%202.227l-1.365%204.403c-.044.143.03.296.166.342.026.01.053.014.08.014.108%200%20.21-.072.245-.187l1.44-4.647v-.002l.08-.257-.246-.083c-.75-.256-1.253-.982-1.253-1.81%200-1.047.813-1.9%201.812-1.9.998%200%201.81.853%201.81%201.9%200%20.828-.502%201.554-1.25%201.81h-.002l-.245.083.16.517%201.36%204.39c.035.114.136.187.245.187.027%200%20.054-.004.08-.013.136-.046.21-.2.167-.342L11.95%2013.21zM16.585%2014.915L14.49%2013.32c-.114-.09-.276-.062-.36.06-.084.12-.06.29.057.378l2.094%201.596c.047.035.1.052.153.052.08%200%20.16-.04.21-.112.084-.12.058-.29-.058-.38M17.72%2010.714h-2.59c-.143%200-.26.12-.26.27%200%20.15.117.273.26.273h2.59c.142%200%20.258-.122.258-.272%200-.15-.116-.27-.26-.27M14.13%208.592c.05.073.13.112.21.112.052%200%20.105-.017.15-.052l2.096-1.596c.115-.088.14-.258.057-.38-.084-.12-.246-.148-.362-.06l-2.093%201.596c-.116.09-.14.258-.057.38M12.19%207.112c.025.01.052.013.08.013.108%200%20.21-.072.245-.187l.8-2.582c.044-.143-.03-.296-.167-.343-.136-.046-.282.032-.326.175l-.8%202.582c-.044.143.03.296.167.342%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"}}},{}],210:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _eventemitter=require("eventemitter2"),_eventemitter2=_interopRequireDefault(_eventemitter),_logger=require("../utils/logger.util"),_logger2=_interopRequireDefault(_logger),emitter=new _eventemitter2["default"]({wildcard:!0,delimiter:":"});emitter.onAny(function(event,value){(0,_logger2["default"])(event),value&&(0,_logger2["default"])("called with:",value)}),exports["default"]=emitter},{"../utils/logger.util":211,eventemitter2:152}],211:[function(require,module,exports){"use strict";function init(_ref){config={browser:_ref.browser,environment:_ref.environment,loggerOverride:_ref.loggerOverride,contentscriptInitMoment:_ref.contentscriptInitMoment}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=init,exports["default"]=function(){if("production"!==config.environment||config.loggerOverride){for(var out="IE"===config.browser?window.self.console:console,_len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];args.push("after "+(Date.now()-config.contentscriptInitMoment)+" ms"),out.log.apply(out,args)}};var config={}},{}],212:[function(require,module,exports){function hoist(ast){function walkAll(nodes){for(var i=0;i<nodes.length;i++){var childNode=nodes[i];if("EmptyStatement"!==childNode.type){"remove"===walk(childNode)&&nodes.splice(i--,1)}}}function walk(node){var parent=parentStack[parentStack.length-1],remove=!1;parentStack.push(node);var excludeBody=!1;shouldScope(node,parent)&&(hoist(node.body),excludeBody=!0),"VariableDeclarator"===node.type&&variables.push(node),"FunctionDeclaration"===node.type&&(functions.push(node),remove=!0);for(var key in node)"type"===key||excludeBody&&"body"===key||key in node&&node[key]&&"object"==typeof node[key]&&(node[key].type?walk(node[key]):Array.isArray(node[key])&&walkAll(node[key]));if(parentStack.pop(),remove)return"remove"}var parentStack=[],variables=[],functions=[];return Array.isArray(ast)?(walkAll(ast),prependScope(ast,variables,functions)):walk(ast),ast}function shouldScope(node,parent){return"Program"===node.type||(!("BlockStatement"!==node.type||!parent||"FunctionExpression"!==parent.type&&"FunctionDeclaration"!==parent.type)||void 0)}function prependScope(nodes,variables,functions){if(variables&&variables.length){for(var declarations=[],i=0;i<variables.length;i++)declarations.push({type:"VariableDeclarator",id:variables[i].id,init:null});nodes.unshift({type:"VariableDeclaration",kind:"var",declarations:declarations})}if(functions&&functions.length)for(var i=0;i<functions.length;i++)nodes.unshift(functions[i])}module.exports=hoist},{}],213:[function(require,module,exports){function parse(str){if(str=""+str,!(str.length>1e4)){var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]);switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function short(ms){return ms>=d?Math.round(ms/d)+"d":ms>=h?Math.round(ms/h)+"h":ms>=m?Math.round(ms/m)+"m":ms>=s?Math.round(ms/s)+"s":ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(!(ms<n))return ms<1.5*n?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}var s=1e3,m=6e4,h=36e5,d=24*h;module.exports=function(val,options){return options=options||{},"string"==typeof val?parse(val):options.long?long(val):short(val)}},{}],214:[function(require,module,exports){(function(){function parse(s,buf,offset){var i=buf&&offset||0,ii=0;for(buf=buf||[],s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){ii<16&&(buf[i+ii++]=_hexToByte[oct])});ii<16;)buf[i+ii++]=0;return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}function v1(options,buf,offset){var i=buf&&offset||0,b=buf||[];options=options||{};var clockseq=null!=options.clockseq?options.clockseq:_clockseq,msecs=null!=options.msecs?options.msecs:(new Date).getTime(),nsecs=null!=options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&null==options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||msecs>_lastMSecs)&&null==options.nsecs&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq,msecs+=122192928e5;var tl=(1e4*(268435455&msecs)+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var node=options.node||_nodeId,n=0;n<6;n++)b[i+n]=node[n];return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"==options?new BufferClass(16):null,options=null),options=options||{};var rnds=options.random||(options.rng||_rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;ii<16;ii++)buf[i+ii]=rnds[ii];return buf||unparse(rnds)}var _rng,_global=this;if("function"==typeof _global.require)try{var _rb=_global.require("crypto").randomBytes;_rng=_rb&&function(){return _rb(16)}}catch(e){}if(!_rng&&_global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);_rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!_rng){var _rnds=new Array(16);_rng=function(){for(var r,i=0;i<16;i++)0===(3&i)&&(r=4294967296*Math.random()),_rnds[i]=r>>>((3&i)<<3)&255;return _rnds}}for(var BufferClass="function"==typeof _global.Buffer?_global.Buffer:Array,_byteToHex=[],_hexToByte={},i=0;i<256;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0,uuid=v4;if(uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse,uuid.BufferClass=BufferClass,"function"==typeof define&&define.amd)define(function(){return uuid});else if(void 0!==module&&module.exports)module.exports=uuid;else{var _previousRoot=_global.uuid;uuid.noConflict=function(){return _global.uuid=_previousRoot,uuid},_global.uuid=uuid}}).call(this)},{}],215:[function(require,module,exports){(function(global){function safeEval(src,parentContext){return finalValue(evaluateAst(prepareAst(src),Object.create(parentContext||{})))}function FunctionFactory(parentContext){var context=Object.create(parentContext||{});return function(){var args=Array.prototype.slice.call(arguments),src=args.slice(-1)[0];return args=args.slice(0,-1),"string"==typeof src&&(src=parse("function a(){"+src+"}").body[0].body),getFunction(prepareAst(src),args,context)}}function prepareAst(src){return hoist("string"==typeof src?parse(src):src)}function evaluateAst(tree,context){function walkAll(nodes){for(var result=void 0,i=0;i<nodes.length;i++){var childNode=nodes[i];if("EmptyStatement"!==childNode.type&&(result=walk(childNode),result instanceof ReturnValue))return result}return result}function walk(node){if(node)switch(node.type){case"Program":return walkAll(node.body);case"BlockStatement":enterBlock();var result=walkAll(node.body);return leaveBlock(),result;case"FunctionDeclaration":var params=node.params.map(getName),value=getFunction(node.body,params,blockContext);return context[node.id.name]=value;case"FunctionExpression":var params=node.params.map(getName);return getFunction(node.body,params,blockContext);case"ReturnStatement":var value=walk(node.argument);return new ReturnValue("return",value);case"BreakStatement":return new ReturnValue("break");case"ContinueStatement":return new ReturnValue("continue");case"ExpressionStatement":return walk(node.expression);case"AssignmentExpression":return setValue(blockContext,node.left,node.right,node.operator);case"UpdateExpression":return setValue(blockContext,node.argument,null,node.operator);case"VariableDeclaration":node.declarations.forEach(function(declaration){var target="let"===node.kind?blockContext:context;declaration.init?target[declaration.id.name]=walk(declaration.init):target[declaration.id.name]=void 0});break;case"SwitchStatement":var defaultHandler=null,matched=!1,value=walk(node.discriminant),result=void 0;enterBlock();for(var i=0;null==result;)if(i<node.cases.length){if(node.cases[i].test?matched=matched||walk(node.cases[i].test)===value:null==defaultHandler&&(defaultHandler=i),matched){var r=walkAll(node.cases[i].consequent);if(r instanceof ReturnValue){if("break"==r.type)break;result=r}}i+=1}else{if(matched||null==defaultHandler)break;i=defaultHandler,matched=!0}return leaveBlock(),result;case"IfStatement":if(walk(node.test))return walk(node.consequent);if(node.alternate)return walk(node.alternate);case"ForStatement":var infinite=InfiniteChecker(1e6),result=void 0;for(enterBlock(),walk(node.init);walk(node.test);walk(node.update)){var r=walk(node.body);if(r instanceof ReturnValue){if("continue"==r.type)continue;if("break"==r.type)break;result=r;break}infinite.check()}return leaveBlock(),result;case"ForInStatement":var infinite=InfiniteChecker(1e6),result=void 0,value=walk(node.right),property=node.left,target=context;enterBlock(),"VariableDeclaration"==property.type&&(walk(property),property=property.declarations[0].id,"let"===property.kind&&(target=blockContext));for(var key in value){setValue(target,property,{type:"Literal",value:key});var r=walk(node.body);if(r instanceof ReturnValue){if("continue"==r.type)continue;if("break"==r.type)break;result=r;break}infinite.check()}return leaveBlock(),result;case"WhileStatement":for(var infinite=InfiniteChecker(1e6);walk(node.test);)walk(node.body),infinite.check();break;case"TryStatement":try{walk(node.block)}catch(error){enterBlock();var catchClause=node.handlers[0];catchClause&&(blockContext[catchClause.param.name]=error,walk(catchClause.body)),leaveBlock()}finally{node.finalizer&&walk(node.finalizer)}break;case"Literal":return node.value;case"UnaryExpression":var val=walk(node.argument);switch(node.operator){case"+":return+val;case"-":return-val;case"~":return~val;case"!":return!val;case"typeof":return typeof val;default:return unsupportedExpression(node)}case"ArrayExpression":for(var obj=blockContext.Array(),i=0;i<node.elements.length;i++)obj.push(walk(node.elements[i]));return obj;case"ObjectExpression":for(var obj=blockContext.Object(),i=0;i<node.properties.length;i++){var prop=node.properties[i],value=null===prop.value?prop.value:walk(prop.value);obj[prop.key.value||prop.key.name]=value}return obj;case"NewExpression":var args=node.arguments.map(function(arg){return walk(arg)}),target=walk(node.callee);return primitives.applyNew(target,args);case"BinaryExpression":var l=walk(node.left),r=walk(node.right);switch(node.operator){case"==":return l===r;case"===":return l===r;case"!=":return l!=r;case"!==":return l!==r;case"+":return l+r;case"-":return l-r;case"*":return l*r;case"/":return l/r;case"%":return l%r;case"<":return l<r;case"<=":return l<=r;case">":return l>r;case">=":return l>=r;case"|":return l|r;case"&":return l&r;case"^":return l^r;case"instanceof":return l instanceof r;default:return unsupportedExpression(node)}case"LogicalExpression":switch(node.operator){case"&&":return walk(node.left)&&walk(node.right);case"||":return walk(node.left)||walk(node.right);default:return unsupportedExpression(node)}case"ThisExpression":return blockContext["this"];case"Identifier":if("undefined"===node.name)return;if(hasProperty(blockContext,node.name,primitives))return finalValue(blockContext[node.name]);throw new ReferenceError(node.name+" is not defined");case"CallExpression":var args=node.arguments.map(function(arg){return walk(arg)}),object=null,target=walk(node.callee);return"MemberExpression"===node.callee.type&&(object=walk(node.callee.object)),target.apply(object,args);case"MemberExpression":var obj=walk(node.object);if(node.computed)var prop=walk(node.property);else var prop=node.property.name;return obj=primitives.getPropertyObject(obj,prop),checkValue(obj[prop]);case"ConditionalExpression":var val=walk(node.test);return walk(val?node.consequent:node.alternate);case"EmptyStatement":return;default:return unsupportedExpression(node)}}function checkValue(value){return value===Function&&(value=safeFunction),finalValue(value)}function enterBlock(){blockContext=Object.create(blockContext)}function leaveBlock(){blockContext=Object.getPrototypeOf(blockContext)}function setValue(object,left,right,operator){var name=null;if("Identifier"===left.type?(name=left.name,object=objectForKey(object,name,primitives)):"MemberExpression"===left.type&&(name=left.computed?walk(left.property):left.property.name,object=walk(left.object)),canSetProperty(object,name,primitives))switch(operator){case void 0:return object[name]=walk(right);case"=":return object[name]=walk(right);case"+=":return object[name]+=walk(right);case"-=":return object[name]-=walk(right);case"++":return object[name]++;case"--":return object[name]--}}var safeFunction=FunctionFactory(context),primitives=Primitives(context),blockContext=context;return walk(tree)}function unsupportedExpression(node){console.error(node);var err=new Error("Unsupported expression: "+node.type);throw err.node=node,err}function objectForKey(object,key,primitives){var proto=primitives.getPrototypeOf(object);return!proto||hasOwnProperty(object,key)?object:objectForKey(proto,key,primitives)}function hasProperty(object,key,primitives){var proto=primitives.getPrototypeOf(object),hasOwn=hasOwnProperty(object,key);return void 0!==object[key]||(!proto||hasOwn?hasOwn:hasProperty(proto,key,primitives))}function hasOwnProperty(object,key){return Object.prototype.hasOwnProperty.call(object,key)}function propertyIsEnumerable(object,key){return Object.prototype.propertyIsEnumerable.call(object,key)}function canSetProperty(object,property,primitives){return"__proto__"!==property&&!primitives.isPrimitive(object)&&(null==object||(hasOwnProperty(object,property)?!!propertyIsEnumerable(object,property):canSetProperty(primitives.getPrototypeOf(object),property,primitives)))}function getFunction(body,params,parentContext){return function(){var context=Object.create(parentContext),scope=global;/Firefox/.test(navigator.userAgent)&&!/Trident/.test(navigator.userAgent)&&(scope=window),context["this"]=this==scope?null:this;var args=Array.prototype.slice.call(arguments);context.arguments=arguments,args.forEach(function(arg,idx){var param=params[idx];param&&(context[param]=arg)});var result=evaluateAst(body,context);if(result instanceof ReturnValue)return result.value}}function finalValue(value){return value instanceof ReturnValue?value.value:value}function getName(identifier){return identifier.name}function ReturnValue(type,value){this.type=type,this.value=value}var parse=require("esprima").parse,hoist=require("hoister"),InfiniteChecker=require("./lib/infinite-checker"),Primitives=require("./lib/primitives");module.exports=safeEval,module.exports.eval=safeEval,module.exports.FunctionFactory=FunctionFactory,module.exports.Function=FunctionFactory()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/infinite-checker":216,"./lib/primitives":217,esprima:150,hoister:212}],216:[function(require,module,exports){function InfiniteChecker(maxIterations){if(!(this instanceof InfiniteChecker))return new InfiniteChecker(maxIterations);this.maxIterations=maxIterations,this.count=0}module.exports=InfiniteChecker,InfiniteChecker.prototype.check=function(){if(this.count+=1,this.count>this.maxIterations)throw new Error("Infinite loop detected - reached max iterations")}},{}],217:[function(require,module,exports){(function(global){function Primitives(context){if(!(this instanceof Primitives))return new Primitives(context);this.context=context;for(var i=0;i<names.length;i++)this.context[names[i]]||(this.context[names[i]]=wrap(primitives[i]))}function getProto(func){return func.prototype}function getGlobal(str){var scope=global;return/Firefox/.test(navigator.userAgent)&&!/Trident/.test(navigator.userAgent)&&(scope=window),scope[str]}function setProto(obj,proto){obj.__proto__=proto}function wrap(prim){var proto=Object.create(prim.prototype),result=function(){if(!(this instanceof result)){var instance=prim.apply(null,arguments);return setProto(instance,proto),instance}prim.apply(this,arguments)};return setProto(result,prim),result.prototype=proto,result.wrapped=!0,result}var names=["Object","String","Boolean","Number","RegExp","Date","Array"],immutable={string:"String",boolean:"Boolean",number:"Number"},primitives=names.map(getGlobal),protos=primitives.map(getProto);module.exports=Primitives,Primitives.prototype.replace=function(value){var primIndex=primitives.indexOf(value),protoIndex=protos.indexOf(value);if(~primIndex){var name=names[primIndex];return this.context[name]}if(~protoIndex){var name=names[protoIndex];return this.context[name].prototype}return value},Primitives.prototype.getPropertyObject=function(object,property){return immutable[typeof object]?this.getPrototypeOf(object):object},Primitives.prototype.isPrimitive=function(value){return!!~primitives.indexOf(value)||!!~protos.indexOf(value)},Primitives.prototype.getPrototypeOf=function(value){if(null==value)return value;var immutableType=immutable[typeof value];if(immutableType)var proto=this.context[immutableType].prototype;else var proto=Object.getPrototypeOf(value);if(proto&&proto!==Object.prototype){var replacement=this.replace(proto);return replacement===value&&(replacement=this.replace(Object.prototype)),replacement}return null},Primitives.prototype.applyNew=function(func,args){if(func.wrapped){var prim=Object.getPrototypeOf(func),instance=new(Function.prototype.bind.apply(prim,arguments));return setProto(instance,func.prototype),instance}return new(Function.prototype.bind.apply(func,arguments))}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],218:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],219:[function(require,module,exports){(function(global){!function(root){function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";return parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(/[\x2E\u3002\uFF0E\uFF61]/g,"."),result+map(string.split("."),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)value=string.charCodeAt(counter++),value>=55296&&value<=56319&&counter<length?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function basicToDigit(codePoint){return codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:36}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/700):delta>>1,delta+=floor(delta/numPoints);delta>455;k+=36)delta=floor(delta/35);return floor(k+36*delta/(delta+38))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=128,bias=72;for(basic=input.lastIndexOf("-"),basic<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=36;index>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index++)),(digit>=36||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=k<=bias?1:k>=bias+26?26:k-bias,!(digit<t);k+=36)baseMinusT=36-t,w>floor(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(input=ucs2decode(input),inputLength=input.length,n=128,delta=0,bias=72,j=0;j<inputLength;++j)currentValue=input[j],currentValue<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push("-");handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)currentValue=input[j],currentValue>=n&&currentValue<m&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if(currentValue=input[j],currentValue<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=36;t=k<=bias?1:k>=bias+26?26:k-bias,!(q<t);k+=36)qMinusT=q-t,baseMinusT=36-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule="object"==typeof module&&module&&!module.nodeType&&module,freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var punycode,key,maxInt=2147483647,regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},floor=Math.floor,stringFromCharCode=String.fromCharCode;if(punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],220:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(/\+/g,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],221:[function(require,module,exports){"use strict";function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){
return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],222:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":220,"./encode":221}],223:[function(require,module,exports){"use strict";var tld=require("./lib/tld.js").init();tld.rules=require("./rules.json"),module.exports=tld},{"./lib/tld.js":225,"./rules.json":226}],224:[function(require,module,exports){"use strict";function Rule(data){data=data||{},this.exception=data.exception||!1,this.firstLevel=data.firstLevel||"",this.secondLevel=data.secondLevel||null,this.isHost=data.isHost||!1,this.source=data.source||"",this.wildcard=data.wildcard||!1}Rule.prototype.getNormalXld=function(){return(this.secondLevel?"."+this.secondLevel:"")+"."+this.firstLevel},Rule.prototype.getNormalPattern=function(){return(this.secondLevel?"\\."+this.secondLevel:"")+"\\."+this.firstLevel},Rule.prototype.getWildcardPattern=function(){return"\\.[^\\.]+"+this.getNormalXld().replace(/\./g,"\\.")},Rule.prototype.getExceptionPattern=function(){return(this.secondLevel||"")+"\\."+this.firstLevel},Rule.prototype.getPattern=function(before,after){var pattern="";return before=void 0===before?"(":before+"",after=void 0===after?")$":after+"",pattern=this.exception===!0?this.getExceptionPattern():this.isHost===!0?this.firstLevel:"[^\\.]+"+(this.wildcard?this.getWildcardPattern():this.getNormalPattern()),before+pattern+after},module.exports=Rule},{}],225:[function(require,module,exports){"use strict";function tld(){this.validHosts=[],this.rules=[]}function trim(value){return String(value).replace(/(^\s+|\s+$)/g,"")}function _someFunction(value,fun){if(void 0===value||null===value)throw new TypeError;var t=Object(value),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;for(var thisArg=arguments.length>=3?arguments[2]:void 0,i=0;i<len;i++)if(i in t&&fun.call(thisArg,t[i],i,t))return!0;return!1}function _mapFunction(thisVal,fun){if(void 0===thisVal||null===thisVal)throw new TypeError;var t=Object(thisVal),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;for(var res=new Array(len),thisArg=arguments.length>=3?arguments[2]:void 0,i=0;i<len;i++)i in t&&(res[i]=fun.call(thisArg,t[i],i,t));return res}var Rule=require("./rule.js"),URL=require("url");tld.init=function(){return new tld},tld.getCandidateRule=function(host,rules,options){var rule={normal:null,exception:null};return options=options||{lazy:!1},_someFunction(rules,function(r){var pattern;return"."+host===r.getNormalXld()?((options.lazy||r.exception||r.isHost)&&(rule.normal=r),!0):(pattern=".+"+r.getNormalPattern()+"$",!!new RegExp(pattern).test(host)&&(rule[r.exception?"exception":"normal"]=r,!r.exception))}),rule.normal&&rule.exception?rule.exception:rule.normal},tld.prototype.getRulesForTld=function(tld,default_rule){var append_tld_rule=!0,rules=this.rules[tld];return"[object Array]"===Object.prototype.toString.call(rules)?rules:void 0===rules?default_rule?[default_rule]:[]:(rules=_mapFunction(rules.split("|"),function(sld){var first_bit=sld[0];return"!"!==first_bit&&"*"!==first_bit||(sld=sld.slice(1),sld||(append_tld_rule=!1)),new Rule({firstLevel:tld,secondLevel:sld,exception:"!"===first_bit,wildcard:"*"===first_bit})}),append_tld_rule&&rules.unshift(new Rule({firstLevel:tld})),this.rules[tld]=rules.reverse(),rules)},tld.prototype.tldExists=function(host){var hostTld;return host=tld.cleanHostValue(host),!!this.rules[host]||(hostTld=tld.extractTldFromHost(host),void 0!==this.rules[hostTld])},tld.prototype.getPublicSuffix=function(host){var hostTld,rules,rule;return host in this.rules?host:(host=tld.cleanHostValue(host),hostTld=tld.extractTldFromHost(host),rules=this.getRulesForTld(hostTld),rule=tld.getCandidateRule(host,rules,{lazy:!0}),null===rule?null:rule.getNormalXld().slice(1))},tld.prototype.getDomain=function(host){var hostTld,rules,rule,domain=null;return this.isValid(host)===!1?null:(host=tld.cleanHostValue(host),hostTld=tld.extractTldFromHost(host),rules=this.getRulesForTld(hostTld,new Rule({firstLevel:hostTld,isHost:this.validHosts.indexOf(hostTld)!==-1})),rule=tld.getCandidateRule(host,rules),null===rule?null:(host.replace(new RegExp(rule.getPattern()),function(m,d){domain=d}),domain))},tld.prototype.getSubdomain=function(host){var domain,r;return host=tld.cleanHostValue(host),domain=this.getDomain(host),null===domain?null:(r="\\.?"+tld.escapeRegExp(domain)+"$",host.replace(new RegExp(r,"i"),""))},tld.prototype.isValid=function(host){return"string"==typeof host&&(this.validHosts.indexOf(host)!==-1||host.indexOf(".")!==-1&&"."!==host[0])};var hasPrefixRE=/^(([a-z][a-z0-9+.-]*)?:)?\/\//,invalidHostnameChars=/[^A-Za-z0-9.-]/;tld.cleanHostValue=function(value){value=trim(value).toLowerCase();var parts=URL.parse(hasPrefixRE.test(value)?value:"//"+value,null,!0);return parts.hostname&&!invalidHostnameChars.test(parts.hostname)?parts.hostname:invalidHostnameChars.test(value)?"":value},tld.extractTldFromHost=function(host){return host.split(".").pop()},tld.escapeRegExp=function(s){return String(s).replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},module.exports=tld},{"./rule.js":224,url:234}],226:[function(require,module,exports){module.exports={ac:"com|edu|gov|net|mil|org",ad:"nom",ae:"co|net|org|sch|ac|gov|mil|blogspot",aero:"accident-investigation|accident-prevention|aerobatic|aeroclub|aerodrome|agents|aircraft|airline|airport|air-surveillance|airtraffic|air-traffic-control|ambulance|amusement|association|author|ballooning|broker|caa|cargo|catering|certification|championship|charter|civilaviation|club|conference|consultant|consulting|control|council|crew|design|dgca|educator|emergency|engine|engineer|entertainment|equipment|exchange|express|federation|flight|freight|fuel|gliding|government|groundhandling|group|hanggliding|homebuilt|insurance|journal|journalist|leasing|logistics|magazine|maintenance|marketplace|media|microlight|modelling|navigation|parachuting|paragliding|passenger-association|pilot|press|production|recreation|repbody|res|research|rotorcraft|safety|scientist|services|show|skydiving|software|student|taxi|trader|trading|trainer|union|workinggroup|works",af:"gov|com|org|net|edu",ag:"com|org|net|co|nom",ai:"off|com|net|org",al:"com|edu|gov|mil|net|org|blogspot",am:"blogspot",ao:"ed|gv|og|co|pb|it",aq:"",ar:"com|edu|gob|gov|int|mil|net|org|tur|blogspot.com",arpa:"e164|in-addr|ip6|iris|uri|urn",as:"gov",asia:"",at:"ac|co|gv|or|blogspot.co|biz|info|priv",au:"com|net|org|edu|gov|asn|id|info|conf|oz|act|nsw|nt|qld|sa|tas|vic|wa|act.edu|nsw.edu|nt.edu|qld.edu|sa.edu|tas.edu|vic.edu|wa.edu|qld.gov|sa.gov|tas.gov|vic.gov|wa.gov|blogspot.com",aw:"com",ax:"",az:"com|net|int|gov|org|edu|info|pp|mil|name|pro|biz",ba:"org|net|edu|gov|mil|unsa|unbi|co|com|rs|blogspot",bb:"biz|co|com|edu|gov|info|net|org|store|tv",bd:"*",be:"ac|blogspot",bf:"gov",bg:"a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z|0|1|2|3|4|5|6|7|8|9|blogspot",bh:"com|edu|net|org|gov",bi:"co|com|edu|or|org",biz:"dyndns|for-better|for-more|for-some|for-the|selfip|webhop",bj:"asso|barreau|gouv|blogspot",bm:"com|edu|gov|net|org",bn:"*",bo:"com|edu|gov|gob|int|org|net|mil|tv",br:"adm|adv|agr|am|arq|art|ato|b|bio|blog|bmd|cim|cng|cnt|com|coop|ecn|eco|edu|emp|eng|esp|etc|eti|far|flog|fm|fnd|fot|fst|g12|ggf|gov|imb|ind|inf|jor|jus|leg|lel|mat|med|mil|mp|mus|net|*nom|not|ntr|odo|org|ppg|pro|psc|psi|qsl|radio|rec|slg|srv|taxi|teo|tmp|trd|tur|tv|vet|vlog|wiki|zlg|blogspot.com",bs:"com|net|org|edu|gov",bt:"com|edu|gov|net|org",bv:"",bw:"co|org",by:"gov|mil|com|of|blogspot.com",bz:"com|net|org|edu|gov|za",ca:"ab|bc|mb|nb|nf|nl|ns|nt|nu|on|pe|qc|sk|yk|gc|co|blogspot",cat:"",cc:"ftpaccess|game-server|myphotos|scrapping",cd:"gov",cf:"blogspot",cg:"",ch:"blogspot",ci:"org|or|com|co|edu|ed|ac|net|go|asso|xn--aroport-bya|int|presse|md|gouv",ck:"*|!www",cl:"gov|gob|co|mil|blogspot",cm:"co|com|gov|net",cn:"ac|com|edu|gov|net|org|mil|xn--55qx5d|xn--io0a7i|xn--od0alg|ah|bj|cq|fj|gd|gs|gz|gx|ha|hb|he|hi|hl|hn|jl|js|jx|ln|nm|nx|qh|sc|sd|sh|sn|sx|tj|xj|xz|yn|zj|hk|mo|tw|cn-north-1.compute.amazonaws|compute.amazonaws|s3.cn-north-1.amazonaws.com",co:"arts|com|edu|firm|gov|info|int|mil|net|nom|org|rec|web|blogspot.com",com:"ap-northeast-1.compute.amazonaws|ap-southeast-1.compute.amazonaws|ap-southeast-2.compute.amazonaws|compute.amazonaws|compute-1.amazonaws|eu-west-1.compute.amazonaws|eu-central-1.compute.amazonaws|sa-east-1.compute.amazonaws|us-east-1.amazonaws|us-gov-west-1.compute.amazonaws|us-west-1.compute.amazonaws|us-west-2.compute.amazonaws|z-1.compute-1.amazonaws|z-2.compute-1.amazonaws|elasticbeanstalk|elb.amazonaws|s3.amazonaws|s3-ap-northeast-1.amazonaws|s3-ap-southeast-1.amazonaws|s3-ap-southeast-2.amazonaws|s3-external-1.amazonaws|s3-external-2.amazonaws|s3-fips-us-gov-west-1.amazonaws|s3-eu-central-1.amazonaws|s3-eu-west-1.amazonaws|s3-sa-east-1.amazonaws|s3-us-gov-west-1.amazonaws|s3-us-west-1.amazonaws|s3-us-west-2.amazonaws|s3.eu-central-1.amazonaws|betainabox|ar|br|cn|de|eu|gb|hu|jpn|kr|mex|no|qc|ru|sa|se|uk|us|uy|za|africa|gr|co|cloudcontrolled|cloudcontrolapp|dreamhosters|dyndns-at-home|dyndns-at-work|dyndns-blog|dyndns-free|dyndns-home|dyndns-ip|dyndns-mail|dyndns-office|dyndns-pics|dyndns-remote|dyndns-server|dyndns-web|dyndns-wiki|dyndns-work|blogdns|cechire|dnsalias|dnsdojo|doesntexist|dontexist|doomdns|dyn-o-saur|dynalias|est-a-la-maison|est-a-la-masion|est-le-patron|est-mon-blogueur|from-ak|from-al|from-ar|from-ca|from-ct|from-dc|from-de|from-fl|from-ga|from-hi|from-ia|from-id|from-il|from-in|from-ks|from-ky|from-ma|from-md|from-mi|from-mn|from-mo|from-ms|from-mt|from-nc|from-nd|from-ne|from-nh|from-nj|from-nm|from-nv|from-oh|from-ok|from-or|from-pa|from-pr|from-ri|from-sc|from-sd|from-tn|from-tx|from-ut|from-va|from-vt|from-wa|from-wi|from-wv|from-wy|getmyip|gotdns|hobby-site|homelinux|homeunix|iamallama|is-a-anarchist|is-a-blogger|is-a-bookkeeper|is-a-bulls-fan|is-a-caterer|is-a-chef|is-a-conservative|is-a-cpa|is-a-cubicle-slave|is-a-democrat|is-a-designer|is-a-doctor|is-a-financialadvisor|is-a-geek|is-a-green|is-a-guru|is-a-hard-worker|is-a-hunter|is-a-landscaper|is-a-lawyer|is-a-liberal|is-a-libertarian|is-a-llama|is-a-musician|is-a-nascarfan|is-a-nurse|is-a-painter|is-a-personaltrainer|is-a-photographer|is-a-player|is-a-republican|is-a-rockstar|is-a-socialist|is-a-student|is-a-teacher|is-a-techie|is-a-therapist|is-an-accountant|is-an-actor|is-an-actress|is-an-anarchist|is-an-artist|is-an-engineer|is-an-entertainer|is-certified|is-gone|is-into-anime|is-into-cars|is-into-cartoons|is-into-games|is-leet|is-not-certified|is-slick|is-uberleet|is-with-theband|isa-geek|isa-hockeynut|issmarterthanyou|likes-pie|likescandy|neat-url|saves-the-whales|selfip|sells-for-less|sells-for-u|servebbs|simple-url|space-to-rent|teaches-yoga|writesthisblog|firebaseapp|flynnhub|githubusercontent|ro|appspot|blogspot|codespot|googleapis|googlecode|pagespeedmobilizer|withgoogle|withyoutube|herokuapp|herokussl|4u|nfshost|operaunite|outsystemscloud|gotpantheon|qa2|rhcloud|sinaapp|vipsinaapp|1kapp|hk|yolasite",coop:"",cr:"ac|co|ed|fi|go|or|sa",cu:"com|edu|org|net|gov|inf",cv:"blogspot",cw:"com|edu|net|org",cx:"gov|ath",cy:"ac|biz|com|ekloges|gov|ltd|name|net|org|parliament|press|pro|tm|blogspot.com",cz:"blogspot",de:"com|fuettertdasnetz|isteingeek|istmein|lebtimnetz|leitungsen|traeumtgerade|blogspot",dj:"",dk:"blogspot",dm:"com|net|org|edu|gov","do":"art|com|edu|gob|gov|mil|net|org|sld|web",dz:"com|org|net|gov|edu|asso|pol|art",ec:"com|info|net|fin|k12|med|pro|org|edu|gov|gob|mil",edu:"",ee:"edu|gov|riik|lib|med|com|pri|aip|org|fie|blogspot.com",eg:"com|edu|eun|gov|mil|name|net|org|sci|blogspot.com",er:"*",es:"com|nom|org|gob|edu|blogspot.com",et:"com|gov|org|edu|biz|name|info|net",eu:"",fi:"aland|blogspot|iki",fj:"*",fk:"*",fm:"",fo:"",fr:"com|asso|nom|prd|presse|tm|aeroport|assedic|avocat|avoues|cci|chambagri|chirurgiens-dentistes|experts-comptables|geometre-expert|gouv|greta|huissier-justice|medecin|notaires|pharmacien|port|veterinaire|blogspot",ga:"",gb:"",gd:"",ge:"com|edu|gov|org|mil|net|pvt",gf:"",gg:"co|net|org",gh:"com|edu|gov|org|mil",gi:"com|ltd|gov|mod|edu|org",gl:"co|com|edu|net|org",gm:"",gn:"ac|com|edu|gov|org|net",gov:"",gp:"com|net|mobi|edu|org|asso",gq:"",gr:"com|edu|net|org|gov|blogspot",gs:"",gt:"com|edu|gob|ind|mil|net|org",gu:"*",gw:"",gy:"co|com|net",hk:"com|edu|gov|idv|net|org|xn--55qx5d|xn--wcvs22d|xn--lcvr32d|xn--mxtq1m|xn--gmqw5a|xn--ciqpn|xn--gmq050i|xn--zf0avx|xn--io0a7i|xn--mk0axi|xn--od0alg|xn--od0aq3b|xn--tn0ag|xn--uc0atv|xn--uc0ay4a|blogspot|ltd|inc",hm:"",hn:"com|edu|org|net|mil|gob",hr:"iz|from|name|com|blogspot",ht:"com|shop|firm|info|adult|net|pro|org|med|art|coop|pol|asso|edu|rel|gouv|perso",hu:"co|info|org|priv|sport|tm|2000|agrar|bolt|casino|city|erotica|erotika|film|forum|games|hotel|ingatlan|jogasz|konyvelo|lakas|media|news|reklam|sex|shop|suli|szex|tozsde|utazas|video|blogspot",id:"ac|biz|co|desa|go|mil|my|net|or|sch|web|blogspot.co",ie:"gov|blogspot",il:"ac|co|gov|idf|k12|muni|net|org|blogspot.co",im:"ac|co|com|ltd.co|net|org|plc.co|tt|tv","in":"co|firm|net|org|gen|ind|nic|ac|edu|res|gov|mil|blogspot",info:"dyndns|barrel-of-knowledge|barrell-of-knowledge|for-our|groks-the|groks-this|here-for-more|knowsitall|selfip|webhop",int:"eu",io:"com|github|ngrok|nid|pantheon|sandcats",iq:"gov|edu|mil|com|org|net",ir:"ac|co|gov|id|net|org|sch|xn--mgba3a4f16a|xn--mgba3a4fra",is:"net|com|edu|gov|org|int|cupcake|blogspot",it:"gov|edu|abr|abruzzo|aosta-valley|aostavalley|bas|basilicata|cal|calabria|cam|campania|emilia-romagna|emiliaromagna|emr|friuli-v-giulia|friuli-ve-giulia|friuli-vegiulia|friuli-venezia-giulia|friuli-veneziagiulia|friuli-vgiulia|friuliv-giulia|friulive-giulia|friulivegiulia|friulivenezia-giulia|friuliveneziagiulia|friulivgiulia|fvg|laz|lazio|lig|liguria|lom|lombardia|lombardy|lucania|mar|marche|mol|molise|piedmont|piemonte|pmn|pug|puglia|sar|sardegna|sardinia|sic|sicilia|sicily|taa|tos|toscana|trentino-a-adige|trentino-aadige|trentino-alto-adige|trentino-altoadige|trentino-s-tirol|trentino-stirol|trentino-sud-tirol|trentino-sudtirol|trentino-sued-tirol|trentino-suedtirol|trentinoa-adige|trentinoaadige|trentinoalto-adige|trentinoaltoadige|trentinos-tirol|trentinostirol|trentinosud-tirol|trentinosudtirol|trentinosued-tirol|trentinosuedtirol|tuscany|umb|umbria|val-d-aosta|val-daosta|vald-aosta|valdaosta|valle-aosta|valle-d-aosta|valle-daosta|valleaosta|valled-aosta|valledaosta|vallee-aoste|valleeaoste|vao|vda|ven|veneto|ag|agrigento|al|alessandria|alto-adige|altoadige|an|ancona|andria-barletta-trani|andria-trani-barletta|andriabarlettatrani|andriatranibarletta|ao|aosta|aoste|ap|aq|aquila|ar|arezzo|ascoli-piceno|ascolipiceno|asti|at|av|avellino|ba|balsan|bari|barletta-trani-andria|barlettatraniandria|belluno|benevento|bergamo|bg|bi|biella|bl|bn|bo|bologna|bolzano|bozen|br|brescia|brindisi|bs|bt|bz|ca|cagliari|caltanissetta|campidano-medio|campidanomedio|campobasso|carbonia-iglesias|carboniaiglesias|carrara-massa|carraramassa|caserta|catania|catanzaro|cb|ce|cesena-forli|cesenaforli|ch|chieti|ci|cl|cn|co|como|cosenza|cr|cremona|crotone|cs|ct|cuneo|cz|dell-ogliastra|dellogliastra|en|enna|fc|fe|fermo|ferrara|fg|fi|firenze|florence|fm|foggia|forli-cesena|forlicesena|fr|frosinone|ge|genoa|genova|go|gorizia|gr|grosseto|iglesias-carbonia|iglesiascarbonia|im|imperia|is|isernia|kr|la-spezia|laquila|laspezia|latina|lc|le|lecce|lecco|li|livorno|lo|lodi|lt|lu|lucca|macerata|mantova|massa-carrara|massacarrara|matera|mb|mc|me|medio-campidano|mediocampidano|messina|mi|milan|milano|mn|mo|modena|monza-brianza|monza-e-della-brianza|monza|monzabrianza|monzaebrianza|monzaedellabrianza|ms|mt|na|naples|napoli|no|novara|nu|nuoro|og|ogliastra|olbia-tempio|olbiatempio|or|oristano|ot|pa|padova|padua|palermo|parma|pavia|pc|pd|pe|perugia|pesaro-urbino|pesarourbino|pescara|pg|pi|piacenza|pisa|pistoia|pn|po|pordenone|potenza|pr|prato|pt|pu|pv|pz|ra|ragusa|ravenna|rc|re|reggio-calabria|reggio-emilia|reggiocalabria|reggioemilia|rg|ri|rieti|rimini|rm|rn|ro|roma|rome|rovigo|sa|salerno|sassari|savona|si|siena|siracusa|so|sondrio|sp|sr|ss|suedtirol|sv|ta|taranto|te|tempio-olbia|tempioolbia|teramo|terni|tn|to|torino|tp|tr|trani-andria-barletta|trani-barletta-andria|traniandriabarletta|tranibarlettaandria|trapani|trentino|trento|treviso|trieste|ts|turin|tv|ud|udine|urbino-pesaro|urbinopesaro|va|varese|vb|vc|ve|venezia|venice|verbania|vercelli|verona|vi|vibo-valentia|vibovalentia|vicenza|viterbo|vr|vs|vt|vv|blogspot",je:"co|net|org",jm:"*",jo:"com|org|net|edu|sch|gov|mil|name",jobs:"",
jp:"ac|ad|co|ed|go|gr|lg|ne|or|aichi|akita|aomori|chiba|ehime|fukui|fukuoka|fukushima|gifu|gunma|hiroshima|hokkaido|hyogo|ibaraki|ishikawa|iwate|kagawa|kagoshima|kanagawa|kochi|kumamoto|kyoto|mie|miyagi|miyazaki|nagano|nagasaki|nara|niigata|oita|okayama|okinawa|osaka|saga|saitama|shiga|shimane|shizuoka|tochigi|tokushima|tokyo|tottori|toyama|wakayama|yamagata|yamaguchi|yamanashi|xn--4pvxs|xn--vgu402c|xn--c3s14m|xn--f6qx53a|xn--8pvr4u|xn--uist22h|xn--djrs72d6uy|xn--mkru45i|xn--0trq7p7nn|xn--8ltr62k|xn--2m4a15e|xn--efvn9s|xn--32vp30h|xn--4it797k|xn--1lqs71d|xn--5rtp49c|xn--5js045d|xn--ehqz56n|xn--1lqs03n|xn--qqqt11m|xn--kbrq7o|xn--pssu33l|xn--ntsq17g|xn--uisz3g|xn--6btw5a|xn--1ctwo|xn--6orx2r|xn--rht61e|xn--rht27z|xn--djty4k|xn--nit225k|xn--rht3d|xn--klty5x|xn--kltx9a|xn--kltp7d|xn--uuwu58a|xn--zbx025d|xn--ntso0iqx3a|xn--elqq16h|xn--4it168d|xn--klt787d|xn--rny31h|xn--7t0a264c|xn--5rtq34k|xn--k7yn95e|xn--tor131o|xn--d5qv7z876c|*kawasaki|*kitakyushu|*kobe|*nagoya|*sapporo|*sendai|*yokohama|!city.kawasaki|!city.kitakyushu|!city.kobe|!city.nagoya|!city.sapporo|!city.sendai|!city.yokohama|aisai.aichi|ama.aichi|anjo.aichi|asuke.aichi|chiryu.aichi|chita.aichi|fuso.aichi|gamagori.aichi|handa.aichi|hazu.aichi|hekinan.aichi|higashiura.aichi|ichinomiya.aichi|inazawa.aichi|inuyama.aichi|isshiki.aichi|iwakura.aichi|kanie.aichi|kariya.aichi|kasugai.aichi|kira.aichi|kiyosu.aichi|komaki.aichi|konan.aichi|kota.aichi|mihama.aichi|miyoshi.aichi|nishio.aichi|nisshin.aichi|obu.aichi|oguchi.aichi|oharu.aichi|okazaki.aichi|owariasahi.aichi|seto.aichi|shikatsu.aichi|shinshiro.aichi|shitara.aichi|tahara.aichi|takahama.aichi|tobishima.aichi|toei.aichi|togo.aichi|tokai.aichi|tokoname.aichi|toyoake.aichi|toyohashi.aichi|toyokawa.aichi|toyone.aichi|toyota.aichi|tsushima.aichi|yatomi.aichi|akita.akita|daisen.akita|fujisato.akita|gojome.akita|hachirogata.akita|happou.akita|higashinaruse.akita|honjo.akita|honjyo.akita|ikawa.akita|kamikoani.akita|kamioka.akita|katagami.akita|kazuno.akita|kitaakita.akita|kosaka.akita|kyowa.akita|misato.akita|mitane.akita|moriyoshi.akita|nikaho.akita|noshiro.akita|odate.akita|oga.akita|ogata.akita|semboku.akita|yokote.akita|yurihonjo.akita|aomori.aomori|gonohe.aomori|hachinohe.aomori|hashikami.aomori|hiranai.aomori|hirosaki.aomori|itayanagi.aomori|kuroishi.aomori|misawa.aomori|mutsu.aomori|nakadomari.aomori|noheji.aomori|oirase.aomori|owani.aomori|rokunohe.aomori|sannohe.aomori|shichinohe.aomori|shingo.aomori|takko.aomori|towada.aomori|tsugaru.aomori|tsuruta.aomori|abiko.chiba|asahi.chiba|chonan.chiba|chosei.chiba|choshi.chiba|chuo.chiba|funabashi.chiba|futtsu.chiba|hanamigawa.chiba|ichihara.chiba|ichikawa.chiba|ichinomiya.chiba|inzai.chiba|isumi.chiba|kamagaya.chiba|kamogawa.chiba|kashiwa.chiba|katori.chiba|katsuura.chiba|kimitsu.chiba|kisarazu.chiba|kozaki.chiba|kujukuri.chiba|kyonan.chiba|matsudo.chiba|midori.chiba|mihama.chiba|minamiboso.chiba|mobara.chiba|mutsuzawa.chiba|nagara.chiba|nagareyama.chiba|narashino.chiba|narita.chiba|noda.chiba|oamishirasato.chiba|omigawa.chiba|onjuku.chiba|otaki.chiba|sakae.chiba|sakura.chiba|shimofusa.chiba|shirako.chiba|shiroi.chiba|shisui.chiba|sodegaura.chiba|sosa.chiba|tako.chiba|tateyama.chiba|togane.chiba|tohnosho.chiba|tomisato.chiba|urayasu.chiba|yachimata.chiba|yachiyo.chiba|yokaichiba.chiba|yokoshibahikari.chiba|yotsukaido.chiba|ainan.ehime|honai.ehime|ikata.ehime|imabari.ehime|iyo.ehime|kamijima.ehime|kihoku.ehime|kumakogen.ehime|masaki.ehime|matsuno.ehime|matsuyama.ehime|namikata.ehime|niihama.ehime|ozu.ehime|saijo.ehime|seiyo.ehime|shikokuchuo.ehime|tobe.ehime|toon.ehime|uchiko.ehime|uwajima.ehime|yawatahama.ehime|echizen.fukui|eiheiji.fukui|fukui.fukui|ikeda.fukui|katsuyama.fukui|mihama.fukui|minamiechizen.fukui|obama.fukui|ohi.fukui|ono.fukui|sabae.fukui|sakai.fukui|takahama.fukui|tsuruga.fukui|wakasa.fukui|ashiya.fukuoka|buzen.fukuoka|chikugo.fukuoka|chikuho.fukuoka|chikujo.fukuoka|chikushino.fukuoka|chikuzen.fukuoka|chuo.fukuoka|dazaifu.fukuoka|fukuchi.fukuoka|hakata.fukuoka|higashi.fukuoka|hirokawa.fukuoka|hisayama.fukuoka|iizuka.fukuoka|inatsuki.fukuoka|kaho.fukuoka|kasuga.fukuoka|kasuya.fukuoka|kawara.fukuoka|keisen.fukuoka|koga.fukuoka|kurate.fukuoka|kurogi.fukuoka|kurume.fukuoka|minami.fukuoka|miyako.fukuoka|miyama.fukuoka|miyawaka.fukuoka|mizumaki.fukuoka|munakata.fukuoka|nakagawa.fukuoka|nakama.fukuoka|nishi.fukuoka|nogata.fukuoka|ogori.fukuoka|okagaki.fukuoka|okawa.fukuoka|oki.fukuoka|omuta.fukuoka|onga.fukuoka|onojo.fukuoka|oto.fukuoka|saigawa.fukuoka|sasaguri.fukuoka|shingu.fukuoka|shinyoshitomi.fukuoka|shonai.fukuoka|soeda.fukuoka|sue.fukuoka|tachiarai.fukuoka|tagawa.fukuoka|takata.fukuoka|toho.fukuoka|toyotsu.fukuoka|tsuiki.fukuoka|ukiha.fukuoka|umi.fukuoka|usui.fukuoka|yamada.fukuoka|yame.fukuoka|yanagawa.fukuoka|yukuhashi.fukuoka|aizubange.fukushima|aizumisato.fukushima|aizuwakamatsu.fukushima|asakawa.fukushima|bandai.fukushima|date.fukushima|fukushima.fukushima|furudono.fukushima|futaba.fukushima|hanawa.fukushima|higashi.fukushima|hirata.fukushima|hirono.fukushima|iitate.fukushima|inawashiro.fukushima|ishikawa.fukushima|iwaki.fukushima|izumizaki.fukushima|kagamiishi.fukushima|kaneyama.fukushima|kawamata.fukushima|kitakata.fukushima|kitashiobara.fukushima|koori.fukushima|koriyama.fukushima|kunimi.fukushima|miharu.fukushima|mishima.fukushima|namie.fukushima|nango.fukushima|nishiaizu.fukushima|nishigo.fukushima|okuma.fukushima|omotego.fukushima|ono.fukushima|otama.fukushima|samegawa.fukushima|shimogo.fukushima|shirakawa.fukushima|showa.fukushima|soma.fukushima|sukagawa.fukushima|taishin.fukushima|tamakawa.fukushima|tanagura.fukushima|tenei.fukushima|yabuki.fukushima|yamato.fukushima|yamatsuri.fukushima|yanaizu.fukushima|yugawa.fukushima|anpachi.gifu|ena.gifu|gifu.gifu|ginan.gifu|godo.gifu|gujo.gifu|hashima.gifu|hichiso.gifu|hida.gifu|higashishirakawa.gifu|ibigawa.gifu|ikeda.gifu|kakamigahara.gifu|kani.gifu|kasahara.gifu|kasamatsu.gifu|kawaue.gifu|kitagata.gifu|mino.gifu|minokamo.gifu|mitake.gifu|mizunami.gifu|motosu.gifu|nakatsugawa.gifu|ogaki.gifu|sakahogi.gifu|seki.gifu|sekigahara.gifu|shirakawa.gifu|tajimi.gifu|takayama.gifu|tarui.gifu|toki.gifu|tomika.gifu|wanouchi.gifu|yamagata.gifu|yaotsu.gifu|yoro.gifu|annaka.gunma|chiyoda.gunma|fujioka.gunma|higashiagatsuma.gunma|isesaki.gunma|itakura.gunma|kanna.gunma|kanra.gunma|katashina.gunma|kawaba.gunma|kiryu.gunma|kusatsu.gunma|maebashi.gunma|meiwa.gunma|midori.gunma|minakami.gunma|naganohara.gunma|nakanojo.gunma|nanmoku.gunma|numata.gunma|oizumi.gunma|ora.gunma|ota.gunma|shibukawa.gunma|shimonita.gunma|shinto.gunma|showa.gunma|takasaki.gunma|takayama.gunma|tamamura.gunma|tatebayashi.gunma|tomioka.gunma|tsukiyono.gunma|tsumagoi.gunma|ueno.gunma|yoshioka.gunma|asaminami.hiroshima|daiwa.hiroshima|etajima.hiroshima|fuchu.hiroshima|fukuyama.hiroshima|hatsukaichi.hiroshima|higashihiroshima.hiroshima|hongo.hiroshima|jinsekikogen.hiroshima|kaita.hiroshima|kui.hiroshima|kumano.hiroshima|kure.hiroshima|mihara.hiroshima|miyoshi.hiroshima|naka.hiroshima|onomichi.hiroshima|osakikamijima.hiroshima|otake.hiroshima|saka.hiroshima|sera.hiroshima|seranishi.hiroshima|shinichi.hiroshima|shobara.hiroshima|takehara.hiroshima|abashiri.hokkaido|abira.hokkaido|aibetsu.hokkaido|akabira.hokkaido|akkeshi.hokkaido|asahikawa.hokkaido|ashibetsu.hokkaido|ashoro.hokkaido|assabu.hokkaido|atsuma.hokkaido|bibai.hokkaido|biei.hokkaido|bifuka.hokkaido|bihoro.hokkaido|biratori.hokkaido|chippubetsu.hokkaido|chitose.hokkaido|date.hokkaido|ebetsu.hokkaido|embetsu.hokkaido|eniwa.hokkaido|erimo.hokkaido|esan.hokkaido|esashi.hokkaido|fukagawa.hokkaido|fukushima.hokkaido|furano.hokkaido|furubira.hokkaido|haboro.hokkaido|hakodate.hokkaido|hamatonbetsu.hokkaido|hidaka.hokkaido|higashikagura.hokkaido|higashikawa.hokkaido|hiroo.hokkaido|hokuryu.hokkaido|hokuto.hokkaido|honbetsu.hokkaido|horokanai.hokkaido|horonobe.hokkaido|ikeda.hokkaido|imakane.hokkaido|ishikari.hokkaido|iwamizawa.hokkaido|iwanai.hokkaido|kamifurano.hokkaido|kamikawa.hokkaido|kamishihoro.hokkaido|kamisunagawa.hokkaido|kamoenai.hokkaido|kayabe.hokkaido|kembuchi.hokkaido|kikonai.hokkaido|kimobetsu.hokkaido|kitahiroshima.hokkaido|kitami.hokkaido|kiyosato.hokkaido|koshimizu.hokkaido|kunneppu.hokkaido|kuriyama.hokkaido|kuromatsunai.hokkaido|kushiro.hokkaido|kutchan.hokkaido|kyowa.hokkaido|mashike.hokkaido|matsumae.hokkaido|mikasa.hokkaido|minamifurano.hokkaido|mombetsu.hokkaido|moseushi.hokkaido|mukawa.hokkaido|muroran.hokkaido|naie.hokkaido|nakagawa.hokkaido|nakasatsunai.hokkaido|nakatombetsu.hokkaido|nanae.hokkaido|nanporo.hokkaido|nayoro.hokkaido|nemuro.hokkaido|niikappu.hokkaido|niki.hokkaido|nishiokoppe.hokkaido|noboribetsu.hokkaido|numata.hokkaido|obihiro.hokkaido|obira.hokkaido|oketo.hokkaido|okoppe.hokkaido|otaru.hokkaido|otobe.hokkaido|otofuke.hokkaido|otoineppu.hokkaido|oumu.hokkaido|ozora.hokkaido|pippu.hokkaido|rankoshi.hokkaido|rebun.hokkaido|rikubetsu.hokkaido|rishiri.hokkaido|rishirifuji.hokkaido|saroma.hokkaido|sarufutsu.hokkaido|shakotan.hokkaido|shari.hokkaido|shibecha.hokkaido|shibetsu.hokkaido|shikabe.hokkaido|shikaoi.hokkaido|shimamaki.hokkaido|shimizu.hokkaido|shimokawa.hokkaido|shinshinotsu.hokkaido|shintoku.hokkaido|shiranuka.hokkaido|shiraoi.hokkaido|shiriuchi.hokkaido|sobetsu.hokkaido|sunagawa.hokkaido|taiki.hokkaido|takasu.hokkaido|takikawa.hokkaido|takinoue.hokkaido|teshikaga.hokkaido|tobetsu.hokkaido|tohma.hokkaido|tomakomai.hokkaido|tomari.hokkaido|toya.hokkaido|toyako.hokkaido|toyotomi.hokkaido|toyoura.hokkaido|tsubetsu.hokkaido|tsukigata.hokkaido|urakawa.hokkaido|urausu.hokkaido|uryu.hokkaido|utashinai.hokkaido|wakkanai.hokkaido|wassamu.hokkaido|yakumo.hokkaido|yoichi.hokkaido|aioi.hyogo|akashi.hyogo|ako.hyogo|amagasaki.hyogo|aogaki.hyogo|asago.hyogo|ashiya.hyogo|awaji.hyogo|fukusaki.hyogo|goshiki.hyogo|harima.hyogo|himeji.hyogo|ichikawa.hyogo|inagawa.hyogo|itami.hyogo|kakogawa.hyogo|kamigori.hyogo|kamikawa.hyogo|kasai.hyogo|kasuga.hyogo|kawanishi.hyogo|miki.hyogo|minamiawaji.hyogo|nishinomiya.hyogo|nishiwaki.hyogo|ono.hyogo|sanda.hyogo|sannan.hyogo|sasayama.hyogo|sayo.hyogo|shingu.hyogo|shinonsen.hyogo|shiso.hyogo|sumoto.hyogo|taishi.hyogo|taka.hyogo|takarazuka.hyogo|takasago.hyogo|takino.hyogo|tamba.hyogo|tatsuno.hyogo|toyooka.hyogo|yabu.hyogo|yashiro.hyogo|yoka.hyogo|yokawa.hyogo|ami.ibaraki|asahi.ibaraki|bando.ibaraki|chikusei.ibaraki|daigo.ibaraki|fujishiro.ibaraki|hitachi.ibaraki|hitachinaka.ibaraki|hitachiomiya.ibaraki|hitachiota.ibaraki|ibaraki.ibaraki|ina.ibaraki|inashiki.ibaraki|itako.ibaraki|iwama.ibaraki|joso.ibaraki|kamisu.ibaraki|kasama.ibaraki|kashima.ibaraki|kasumigaura.ibaraki|koga.ibaraki|miho.ibaraki|mito.ibaraki|moriya.ibaraki|naka.ibaraki|namegata.ibaraki|oarai.ibaraki|ogawa.ibaraki|omitama.ibaraki|ryugasaki.ibaraki|sakai.ibaraki|sakuragawa.ibaraki|shimodate.ibaraki|shimotsuma.ibaraki|shirosato.ibaraki|sowa.ibaraki|suifu.ibaraki|takahagi.ibaraki|tamatsukuri.ibaraki|tokai.ibaraki|tomobe.ibaraki|tone.ibaraki|toride.ibaraki|tsuchiura.ibaraki|tsukuba.ibaraki|uchihara.ibaraki|ushiku.ibaraki|yachiyo.ibaraki|yamagata.ibaraki|yawara.ibaraki|yuki.ibaraki|anamizu.ishikawa|hakui.ishikawa|hakusan.ishikawa|kaga.ishikawa|kahoku.ishikawa|kanazawa.ishikawa|kawakita.ishikawa|komatsu.ishikawa|nakanoto.ishikawa|nanao.ishikawa|nomi.ishikawa|nonoichi.ishikawa|noto.ishikawa|shika.ishikawa|suzu.ishikawa|tsubata.ishikawa|tsurugi.ishikawa|uchinada.ishikawa|wajima.ishikawa|fudai.iwate|fujisawa.iwate|hanamaki.iwate|hiraizumi.iwate|hirono.iwate|ichinohe.iwate|ichinoseki.iwate|iwaizumi.iwate|iwate.iwate|joboji.iwate|kamaishi.iwate|kanegasaki.iwate|karumai.iwate|kawai.iwate|kitakami.iwate|kuji.iwate|kunohe.iwate|kuzumaki.iwate|miyako.iwate|mizusawa.iwate|morioka.iwate|ninohe.iwate|noda.iwate|ofunato.iwate|oshu.iwate|otsuchi.iwate|rikuzentakata.iwate|shiwa.iwate|shizukuishi.iwate|sumita.iwate|tanohata.iwate|tono.iwate|yahaba.iwate|yamada.iwate|ayagawa.kagawa|higashikagawa.kagawa|kanonji.kagawa|kotohira.kagawa|manno.kagawa|marugame.kagawa|mitoyo.kagawa|naoshima.kagawa|sanuki.kagawa|tadotsu.kagawa|takamatsu.kagawa|tonosho.kagawa|uchinomi.kagawa|utazu.kagawa|zentsuji.kagawa|akune.kagoshima|amami.kagoshima|hioki.kagoshima|isa.kagoshima|isen.kagoshima|izumi.kagoshima|kagoshima.kagoshima|kanoya.kagoshima|kawanabe.kagoshima|kinko.kagoshima|kouyama.kagoshima|makurazaki.kagoshima|matsumoto.kagoshima|minamitane.kagoshima|nakatane.kagoshima|nishinoomote.kagoshima|satsumasendai.kagoshima|soo.kagoshima|tarumizu.kagoshima|yusui.kagoshima|aikawa.kanagawa|atsugi.kanagawa|ayase.kanagawa|chigasaki.kanagawa|ebina.kanagawa|fujisawa.kanagawa|hadano.kanagawa|hakone.kanagawa|hiratsuka.kanagawa|isehara.kanagawa|kaisei.kanagawa|kamakura.kanagawa|kiyokawa.kanagawa|matsuda.kanagawa|minamiashigara.kanagawa|miura.kanagawa|nakai.kanagawa|ninomiya.kanagawa|odawara.kanagawa|oi.kanagawa|oiso.kanagawa|sagamihara.kanagawa|samukawa.kanagawa|tsukui.kanagawa|yamakita.kanagawa|yamato.kanagawa|yokosuka.kanagawa|yugawara.kanagawa|zama.kanagawa|zushi.kanagawa|aki.kochi|geisei.kochi|hidaka.kochi|higashitsuno.kochi|ino.kochi|kagami.kochi|kami.kochi|kitagawa.kochi|kochi.kochi|mihara.kochi|motoyama.kochi|muroto.kochi|nahari.kochi|nakamura.kochi|nankoku.kochi|nishitosa.kochi|niyodogawa.kochi|ochi.kochi|okawa.kochi|otoyo.kochi|otsuki.kochi|sakawa.kochi|sukumo.kochi|susaki.kochi|tosa.kochi|tosashimizu.kochi|toyo.kochi|tsuno.kochi|umaji.kochi|yasuda.kochi|yusuhara.kochi|amakusa.kumamoto|arao.kumamoto|aso.kumamoto|choyo.kumamoto|gyokuto.kumamoto|hitoyoshi.kumamoto|kamiamakusa.kumamoto|kashima.kumamoto|kikuchi.kumamoto|kosa.kumamoto|kumamoto.kumamoto|mashiki.kumamoto|mifune.kumamoto|minamata.kumamoto|minamioguni.kumamoto|nagasu.kumamoto|nishihara.kumamoto|oguni.kumamoto|ozu.kumamoto|sumoto.kumamoto|takamori.kumamoto|uki.kumamoto|uto.kumamoto|yamaga.kumamoto|yamato.kumamoto|yatsushiro.kumamoto|ayabe.kyoto|fukuchiyama.kyoto|higashiyama.kyoto|ide.kyoto|ine.kyoto|joyo.kyoto|kameoka.kyoto|kamo.kyoto|kita.kyoto|kizu.kyoto|kumiyama.kyoto|kyotamba.kyoto|kyotanabe.kyoto|kyotango.kyoto|maizuru.kyoto|minami.kyoto|minamiyamashiro.kyoto|miyazu.kyoto|muko.kyoto|nagaokakyo.kyoto|nakagyo.kyoto|nantan.kyoto|oyamazaki.kyoto|sakyo.kyoto|seika.kyoto|tanabe.kyoto|uji.kyoto|ujitawara.kyoto|wazuka.kyoto|yamashina.kyoto|yawata.kyoto|asahi.mie|inabe.mie|ise.mie|kameyama.mie|kawagoe.mie|kiho.mie|kisosaki.mie|kiwa.mie|komono.mie|kumano.mie|kuwana.mie|matsusaka.mie|meiwa.mie|mihama.mie|minamiise.mie|misugi.mie|miyama.mie|nabari.mie|shima.mie|suzuka.mie|tado.mie|taiki.mie|taki.mie|tamaki.mie|toba.mie|tsu.mie|udono.mie|ureshino.mie|watarai.mie|yokkaichi.mie|furukawa.miyagi|higashimatsushima.miyagi|ishinomaki.miyagi|iwanuma.miyagi|kakuda.miyagi|kami.miyagi|kawasaki.miyagi|kesennuma.miyagi|marumori.miyagi|matsushima.miyagi|minamisanriku.miyagi|misato.miyagi|murata.miyagi|natori.miyagi|ogawara.miyagi|ohira.miyagi|onagawa.miyagi|osaki.miyagi|rifu.miyagi|semine.miyagi|shibata.miyagi|shichikashuku.miyagi|shikama.miyagi|shiogama.miyagi|shiroishi.miyagi|tagajo.miyagi|taiwa.miyagi|tome.miyagi|tomiya.miyagi|wakuya.miyagi|watari.miyagi|yamamoto.miyagi|zao.miyagi|aya.miyazaki|ebino.miyazaki|gokase.miyazaki|hyuga.miyazaki|kadogawa.miyazaki|kawaminami.miyazaki|kijo.miyazaki|kitagawa.miyazaki|kitakata.miyazaki|kitaura.miyazaki|kobayashi.miyazaki|kunitomi.miyazaki|kushima.miyazaki|mimata.miyazaki|miyakonojo.miyazaki|miyazaki.miyazaki|morotsuka.miyazaki|nichinan.miyazaki|nishimera.miyazaki|nobeoka.miyazaki|saito.miyazaki|shiiba.miyazaki|shintomi.miyazaki|takaharu.miyazaki|takanabe.miyazaki|takazaki.miyazaki|tsuno.miyazaki|achi.nagano|agematsu.nagano|anan.nagano|aoki.nagano|asahi.nagano|azumino.nagano|chikuhoku.nagano|chikuma.nagano|chino.nagano|fujimi.nagano|hakuba.nagano|hara.nagano|hiraya.nagano|iida.nagano|iijima.nagano|iiyama.nagano|iizuna.nagano|ikeda.nagano|ikusaka.nagano|ina.nagano|karuizawa.nagano|kawakami.nagano|kiso.nagano|kisofukushima.nagano|kitaaiki.nagano|komagane.nagano|komoro.nagano|matsukawa.nagano|matsumoto.nagano|miasa.nagano|minamiaiki.nagano|minamimaki.nagano|minamiminowa.nagano|minowa.nagano|miyada.nagano|miyota.nagano|mochizuki.nagano|nagano.nagano|nagawa.nagano|nagiso.nagano|nakagawa.nagano|nakano.nagano|nozawaonsen.nagano|obuse.nagano|ogawa.nagano|okaya.nagano|omachi.nagano|omi.nagano|ookuwa.nagano|ooshika.nagano|otaki.nagano|otari.nagano|sakae.nagano|sakaki.nagano|saku.nagano|sakuho.nagano|shimosuwa.nagano|shinanomachi.nagano|shiojiri.nagano|suwa.nagano|suzaka.nagano|takagi.nagano|takamori.nagano|takayama.nagano|tateshina.nagano|tatsuno.nagano|togakushi.nagano|togura.nagano|tomi.nagano|ueda.nagano|wada.nagano|yamagata.nagano|yamanouchi.nagano|yasaka.nagano|yasuoka.nagano|chijiwa.nagasaki|futsu.nagasaki|goto.nagasaki|hasami.nagasaki|hirado.nagasaki|iki.nagasaki|isahaya.nagasaki|kawatana.nagasaki|kuchinotsu.nagasaki|matsuura.nagasaki|nagasaki.nagasaki|obama.nagasaki|omura.nagasaki|oseto.nagasaki|saikai.nagasaki|sasebo.nagasaki|seihi.nagasaki|shimabara.nagasaki|shinkamigoto.nagasaki|togitsu.nagasaki|tsushima.nagasaki|unzen.nagasaki|ando.nara|gose.nara|heguri.nara|higashiyoshino.nara|ikaruga.nara|ikoma.nara|kamikitayama.nara|kanmaki.nara|kashiba.nara|kashihara.nara|katsuragi.nara|kawai.nara|kawakami.nara|kawanishi.nara|koryo.nara|kurotaki.nara|mitsue.nara|miyake.nara|nara.nara|nosegawa.nara|oji.nara|ouda.nara|oyodo.nara|sakurai.nara|sango.nara|shimoichi.nara|shimokitayama.nara|shinjo.nara|soni.nara|takatori.nara|tawaramoto.nara|tenkawa.nara|tenri.nara|uda.nara|yamatokoriyama.nara|yamatotakada.nara|yamazoe.nara|yoshino.nara|aga.niigata|agano.niigata|gosen.niigata|itoigawa.niigata|izumozaki.niigata|joetsu.niigata|kamo.niigata|kariwa.niigata|kashiwazaki.niigata|minamiuonuma.niigata|mitsuke.niigata|muika.niigata|murakami.niigata|myoko.niigata|nagaoka.niigata|niigata.niigata|ojiya.niigata|omi.niigata|sado.niigata|sanjo.niigata|seiro.niigata|seirou.niigata|sekikawa.niigata|shibata.niigata|tagami.niigata|tainai.niigata|tochio.niigata|tokamachi.niigata|tsubame.niigata|tsunan.niigata|uonuma.niigata|yahiko.niigata|yoita.niigata|yuzawa.niigata|beppu.oita|bungoono.oita|bungotakada.oita|hasama.oita|hiji.oita|himeshima.oita|hita.oita|kamitsue.oita|kokonoe.oita|kuju.oita|kunisaki.oita|kusu.oita|oita.oita|saiki.oita|taketa.oita|tsukumi.oita|usa.oita|usuki.oita|yufu.oita|akaiwa.okayama|asakuchi.okayama|bizen.okayama|hayashima.okayama|ibara.okayama|kagamino.okayama|kasaoka.okayama|kibichuo.okayama|kumenan.okayama|kurashiki.okayama|maniwa.okayama|misaki.okayama|nagi.okayama|niimi.okayama|nishiawakura.okayama|okayama.okayama|satosho.okayama|setouchi.okayama|shinjo.okayama|shoo.okayama|soja.okayama|takahashi.okayama|tamano.okayama|tsuyama.okayama|wake.okayama|yakage.okayama|aguni.okinawa|ginowan.okinawa|ginoza.okinawa|gushikami.okinawa|haebaru.okinawa|higashi.okinawa|hirara.okinawa|iheya.okinawa|ishigaki.okinawa|ishikawa.okinawa|itoman.okinawa|izena.okinawa|kadena.okinawa|kin.okinawa|kitadaito.okinawa|kitanakagusuku.okinawa|kumejima.okinawa|kunigami.okinawa|minamidaito.okinawa|motobu.okinawa|nago.okinawa|naha.okinawa|nakagusuku.okinawa|nakijin.okinawa|nanjo.okinawa|nishihara.okinawa|ogimi.okinawa|okinawa.okinawa|onna.okinawa|shimoji.okinawa|taketomi.okinawa|tarama.okinawa|tokashiki.okinawa|tomigusuku.okinawa|tonaki.okinawa|urasoe.okinawa|uruma.okinawa|yaese.okinawa|yomitan.okinawa|yonabaru.okinawa|yonaguni.okinawa|zamami.okinawa|abeno.osaka|chihayaakasaka.osaka|chuo.osaka|daito.osaka|fujiidera.osaka|habikino.osaka|hannan.osaka|higashiosaka.osaka|higashisumiyoshi.osaka|higashiyodogawa.osaka|hirakata.osaka|ibaraki.osaka|ikeda.osaka|izumi.osaka|izumiotsu.osaka|izumisano.osaka|kadoma.osaka|kaizuka.osaka|kanan.osaka|kashiwara.osaka|katano.osaka|kawachinagano.osaka|kishiwada.osaka|kita.osaka|kumatori.osaka|matsubara.osaka|minato.osaka|minoh.osaka|misaki.osaka|moriguchi.osaka|neyagawa.osaka|nishi.osaka|nose.osaka|osakasayama.osaka|sakai.osaka|sayama.osaka|sennan.osaka|settsu.osaka|shijonawate.osaka|shimamoto.osaka|suita.osaka|tadaoka.osaka|taishi.osaka|tajiri.osaka|takaishi.osaka|takatsuki.osaka|tondabayashi.osaka|toyonaka.osaka|toyono.osaka|yao.osaka|ariake.saga|arita.saga|fukudomi.saga|genkai.saga|hamatama.saga|hizen.saga|imari.saga|kamimine.saga|kanzaki.saga|karatsu.saga|kashima.saga|kitagata.saga|kitahata.saga|kiyama.saga|kouhoku.saga|kyuragi.saga|nishiarita.saga|ogi.saga|omachi.saga|ouchi.saga|saga.saga|shiroishi.saga|taku.saga|tara.saga|tosu.saga|yoshinogari.saga|arakawa.saitama|asaka.saitama|chichibu.saitama|fujimi.saitama|fujimino.saitama|fukaya.saitama|hanno.saitama|hanyu.saitama|hasuda.saitama|hatogaya.saitama|hatoyama.saitama|hidaka.saitama|higashichichibu.saitama|higashimatsuyama.saitama|honjo.saitama|ina.saitama|iruma.saitama|iwatsuki.saitama|kamiizumi.saitama|kamikawa.saitama|kamisato.saitama|kasukabe.saitama|kawagoe.saitama|kawaguchi.saitama|kawajima.saitama|kazo.saitama|kitamoto.saitama|koshigaya.saitama|kounosu.saitama|kuki.saitama|kumagaya.saitama|matsubushi.saitama|minano.saitama|misato.saitama|miyashiro.saitama|miyoshi.saitama|moroyama.saitama|nagatoro.saitama|namegawa.saitama|niiza.saitama|ogano.saitama|ogawa.saitama|ogose.saitama|okegawa.saitama|omiya.saitama|otaki.saitama|ranzan.saitama|ryokami.saitama|saitama.saitama|sakado.saitama|satte.saitama|sayama.saitama|shiki.saitama|shiraoka.saitama|soka.saitama|sugito.saitama|toda.saitama|tokigawa.saitama|tokorozawa.saitama|tsurugashima.saitama|urawa.saitama|warabi.saitama|yashio.saitama|yokoze.saitama|yono.saitama|yorii.saitama|yoshida.saitama|yoshikawa.saitama|yoshimi.saitama|aisho.shiga|gamo.shiga|higashiomi.shiga|hikone.shiga|koka.shiga|konan.shiga|kosei.shiga|koto.shiga|kusatsu.shiga|maibara.shiga|moriyama.shiga|nagahama.shiga|nishiazai.shiga|notogawa.shiga|omihachiman.shiga|otsu.shiga|ritto.shiga|ryuoh.shiga|takashima.shiga|takatsuki.shiga|torahime.shiga|toyosato.shiga|yasu.shiga|akagi.shimane|ama.shimane|gotsu.shimane|hamada.shimane|higashiizumo.shimane|hikawa.shimane|hikimi.shimane|izumo.shimane|kakinoki.shimane|masuda.shimane|matsue.shimane|misato.shimane|nishinoshima.shimane|ohda.shimane|okinoshima.shimane|okuizumo.shimane|shimane.shimane|tamayu.shimane|tsuwano.shimane|unnan.shimane|yakumo.shimane|yasugi.shimane|yatsuka.shimane|arai.shizuoka|atami.shizuoka|fuji.shizuoka|fujieda.shizuoka|fujikawa.shizuoka|fujinomiya.shizuoka|fukuroi.shizuoka|gotemba.shizuoka|haibara.shizuoka|hamamatsu.shizuoka|higashiizu.shizuoka|ito.shizuoka|iwata.shizuoka|izu.shizuoka|izunokuni.shizuoka|kakegawa.shizuoka|kannami.shizuoka|kawanehon.shizuoka|kawazu.shizuoka|kikugawa.shizuoka|kosai.shizuoka|makinohara.shizuoka|matsuzaki.shizuoka|minamiizu.shizuoka|mishima.shizuoka|morimachi.shizuoka|nishiizu.shizuoka|numazu.shizuoka|omaezaki.shizuoka|shimada.shizuoka|shimizu.shizuoka|shimoda.shizuoka|shizuoka.shizuoka|susono.shizuoka|yaizu.shizuoka|yoshida.shizuoka|ashikaga.tochigi|bato.tochigi|haga.tochigi|ichikai.tochigi|iwafune.tochigi|kaminokawa.tochigi|kanuma.tochigi|karasuyama.tochigi|kuroiso.tochigi|mashiko.tochigi|mibu.tochigi|moka.tochigi|motegi.tochigi|nasu.tochigi|nasushiobara.tochigi|nikko.tochigi|nishikata.tochigi|nogi.tochigi|ohira.tochigi|ohtawara.tochigi|oyama.tochigi|sakura.tochigi|sano.tochigi|shimotsuke.tochigi|shioya.tochigi|takanezawa.tochigi|tochigi.tochigi|tsuga.tochigi|ujiie.tochigi|utsunomiya.tochigi|yaita.tochigi|aizumi.tokushima|anan.tokushima|ichiba.tokushima|itano.tokushima|kainan.tokushima|komatsushima.tokushima|matsushige.tokushima|mima.tokushima|minami.tokushima|miyoshi.tokushima|mugi.tokushima|nakagawa.tokushima|naruto.tokushima|sanagochi.tokushima|shishikui.tokushima|tokushima.tokushima|wajiki.tokushima|adachi.tokyo|akiruno.tokyo|akishima.tokyo|aogashima.tokyo|arakawa.tokyo|bunkyo.tokyo|chiyoda.tokyo|chofu.tokyo|chuo.tokyo|edogawa.tokyo|fuchu.tokyo|fussa.tokyo|hachijo.tokyo|hachioji.tokyo|hamura.tokyo|higashikurume.tokyo|higashimurayama.tokyo|higashiyamato.tokyo|hino.tokyo|hinode.tokyo|hinohara.tokyo|inagi.tokyo|itabashi.tokyo|katsushika.tokyo|kita.tokyo|kiyose.tokyo|kodaira.tokyo|koganei.tokyo|kokubunji.tokyo|komae.tokyo|koto.tokyo|kouzushima.tokyo|kunitachi.tokyo|machida.tokyo|meguro.tokyo|minato.tokyo|mitaka.tokyo|mizuho.tokyo|musashimurayama.tokyo|musashino.tokyo|nakano.tokyo|nerima.tokyo|ogasawara.tokyo|okutama.tokyo|ome.tokyo|oshima.tokyo|ota.tokyo|setagaya.tokyo|shibuya.tokyo|shinagawa.tokyo|shinjuku.tokyo|suginami.tokyo|sumida.tokyo|tachikawa.tokyo|taito.tokyo|tama.tokyo|toshima.tokyo|chizu.tottori|hino.tottori|kawahara.tottori|koge.tottori|kotoura.tottori|misasa.tottori|nanbu.tottori|nichinan.tottori|sakaiminato.tottori|tottori.tottori|wakasa.tottori|yazu.tottori|yonago.tottori|asahi.toyama|fuchu.toyama|fukumitsu.toyama|funahashi.toyama|himi.toyama|imizu.toyama|inami.toyama|johana.toyama|kamiichi.toyama|kurobe.toyama|nakaniikawa.toyama|namerikawa.toyama|nanto.toyama|nyuzen.toyama|oyabe.toyama|taira.toyama|takaoka.toyama|tateyama.toyama|toga.toyama|tonami.toyama|toyama.toyama|unazuki.toyama|uozu.toyama|yamada.toyama|arida.wakayama|aridagawa.wakayama|gobo.wakayama|hashimoto.wakayama|hidaka.wakayama|hirogawa.wakayama|inami.wakayama|iwade.wakayama|kainan.wakayama|kamitonda.wakayama|katsuragi.wakayama|kimino.wakayama|kinokawa.wakayama|kitayama.wakayama|koya.wakayama|koza.wakayama|kozagawa.wakayama|kudoyama.wakayama|kushimoto.wakayama|mihama.wakayama|misato.wakayama|nachikatsuura.wakayama|shingu.wakayama|shirahama.wakayama|taiji.wakayama|tanabe.wakayama|wakayama.wakayama|yuasa.wakayama|yura.wakayama|asahi.yamagata|funagata.yamagata|higashine.yamagata|iide.yamagata|kahoku.yamagata|kaminoyama.yamagata|kaneyama.yamagata|kawanishi.yamagata|mamurogawa.yamagata|mikawa.yamagata|murayama.yamagata|nagai.yamagata|nakayama.yamagata|nanyo.yamagata|nishikawa.yamagata|obanazawa.yamagata|oe.yamagata|oguni.yamagata|ohkura.yamagata|oishida.yamagata|sagae.yamagata|sakata.yamagata|sakegawa.yamagata|shinjo.yamagata|shirataka.yamagata|shonai.yamagata|takahata.yamagata|tendo.yamagata|tozawa.yamagata|tsuruoka.yamagata|yamagata.yamagata|yamanobe.yamagata|yonezawa.yamagata|yuza.yamagata|abu.yamaguchi|hagi.yamaguchi|hikari.yamaguchi|hofu.yamaguchi|iwakuni.yamaguchi|kudamatsu.yamaguchi|mitou.yamaguchi|nagato.yamaguchi|oshima.yamaguchi|shimonoseki.yamaguchi|shunan.yamaguchi|tabuse.yamaguchi|tokuyama.yamaguchi|toyota.yamaguchi|ube.yamaguchi|yuu.yamaguchi|chuo.yamanashi|doshi.yamanashi|fuefuki.yamanashi|fujikawa.yamanashi|fujikawaguchiko.yamanashi|fujiyoshida.yamanashi|hayakawa.yamanashi|hokuto.yamanashi|ichikawamisato.yamanashi|kai.yamanashi|kofu.yamanashi|koshu.yamanashi|kosuge.yamanashi|minami-alps.yamanashi|minobu.yamanashi|nakamichi.yamanashi|nanbu.yamanashi|narusawa.yamanashi|nirasaki.yamanashi|nishikatsura.yamanashi|oshino.yamanashi|otsuki.yamanashi|showa.yamanashi|tabayama.yamanashi|tsuru.yamanashi|uenohara.yamanashi|yamanakako.yamanashi|yamanashi.yamanashi|blogspot",ke:"*|blogspot.co",kg:"org|net|com|edu|gov|mil",kh:"*",ki:"edu|biz|net|org|gov|info|com",km:"org|nom|gov|prd|tm|edu|mil|ass|com|coop|asso|presse|medecin|notaires|pharmaciens|veterinaire|gouv",kn:"net|org|edu|gov",kp:"com|edu|gov|org|rep|tra",kr:"ac|co|es|go|hs|kg|mil|ms|ne|or|pe|re|sc|busan|chungbuk|chungnam|daegu|daejeon|gangwon|gwangju|gyeongbuk|gyeonggi|gyeongnam|incheon|jeju|jeonbuk|jeonnam|seoul|ulsan|blogspot",kw:"*",ky:"edu|gov|com|org|net",kz:"org|edu|net|gov|mil|com",la:"int|net|info|edu|gov|per|com|org|c",lb:"com|edu|gov|net|org",lc:"com|net|co|org|edu|gov",li:"blogspot",lk:"gov|sch|net|int|com|org|edu|ngo|soc|web|ltd|assn|grp|hotel|ac",lr:"com|edu|gov|org|net",ls:"co|org",lt:"gov|blogspot",lu:"blogspot",lv:"com|edu|gov|org|mil|id|net|asn|conf",ly:"com|net|gov|plc|edu|sch|med|org|id",ma:"co|net|gov|org|ac|press",mc:"tm|asso",md:"blogspot",me:"co|net|org|edu|ac|gov|its|priv",mg:"org|nom|gov|prd|tm|edu|mil|com|co",mh:"",mil:"",mk:"com|org|net|edu|gov|inf|name|blogspot",ml:"com|edu|gouv|gov|net|org|presse",mm:"*",mn:"gov|edu|org|nyc",mo:"com|net|org|edu|gov",mobi:"",mp:"",mq:"",mr:"gov|blogspot",ms:"com|edu|gov|net|org",mt:"com|edu|net|org|blogspot.com",mu:"com|net|org|gov|ac|co|or",
museum:"academy|agriculture|air|airguard|alabama|alaska|amber|ambulance|american|americana|americanantiques|americanart|amsterdam|and|annefrank|anthro|anthropology|antiques|aquarium|arboretum|archaeological|archaeology|architecture|art|artanddesign|artcenter|artdeco|arteducation|artgallery|arts|artsandcrafts|asmatart|assassination|assisi|association|astronomy|atlanta|austin|australia|automotive|aviation|axis|badajoz|baghdad|bahn|bale|baltimore|barcelona|baseball|basel|baths|bauern|beauxarts|beeldengeluid|bellevue|bergbau|berkeley|berlin|bern|bible|bilbao|bill|birdart|birthplace|bonn|boston|botanical|botanicalgarden|botanicgarden|botany|brandywinevalley|brasil|bristol|british|britishcolumbia|broadcast|brunel|brussel|brussels|bruxelles|building|burghof|bus|bushey|cadaques|california|cambridge|can|canada|capebreton|carrier|cartoonart|casadelamoneda|castle|castres|celtic|center|chattanooga|cheltenham|chesapeakebay|chicago|children|childrens|childrensgarden|chiropractic|chocolate|christiansburg|cincinnati|cinema|circus|civilisation|civilization|civilwar|clinton|clock|coal|coastaldefence|cody|coldwar|collection|colonialwilliamsburg|coloradoplateau|columbia|columbus|communication|communications|community|computer|computerhistory|xn--comunicaes-v6a2o|contemporary|contemporaryart|convent|copenhagen|corporation|xn--correios-e-telecomunicaes-ghc29a|corvette|costume|countryestate|county|crafts|cranbrook|creation|cultural|culturalcenter|culture|cyber|cymru|dali|dallas|database|ddr|decorativearts|delaware|delmenhorst|denmark|depot|design|detroit|dinosaur|discovery|dolls|donostia|durham|eastafrica|eastcoast|education|educational|egyptian|eisenbahn|elburg|elvendrell|embroidery|encyclopedic|england|entomology|environment|environmentalconservation|epilepsy|essex|estate|ethnology|exeter|exhibition|family|farm|farmequipment|farmers|farmstead|field|figueres|filatelia|film|fineart|finearts|finland|flanders|florida|force|fortmissoula|fortworth|foundation|francaise|frankfurt|franziskaner|freemasonry|freiburg|fribourg|frog|fundacio|furniture|gallery|garden|gateway|geelvinck|gemological|geology|georgia|giessen|glas|glass|gorge|grandrapids|graz|guernsey|halloffame|hamburg|handson|harvestcelebration|hawaii|health|heimatunduhren|hellas|helsinki|hembygdsforbund|heritage|histoire|historical|historicalsociety|historichouses|historisch|historisches|history|historyofscience|horology|house|humanities|illustration|imageandsound|indian|indiana|indianapolis|indianmarket|intelligence|interactive|iraq|iron|isleofman|jamison|jefferson|jerusalem|jewelry|jewish|jewishart|jfk|journalism|judaica|judygarland|juedisches|juif|karate|karikatur|kids|koebenhavn|koeln|kunst|kunstsammlung|kunstunddesign|labor|labour|lajolla|lancashire|landes|lans|xn--lns-qla|larsson|lewismiller|lincoln|linz|living|livinghistory|localhistory|london|losangeles|louvre|loyalist|lucerne|luxembourg|luzern|mad|madrid|mallorca|manchester|mansion|mansions|manx|marburg|maritime|maritimo|maryland|marylhurst|media|medical|medizinhistorisches|meeres|memorial|mesaverde|michigan|midatlantic|military|mill|miners|mining|minnesota|missile|missoula|modern|moma|money|monmouth|monticello|montreal|moscow|motorcycle|muenchen|muenster|mulhouse|muncie|museet|museumcenter|museumvereniging|music|national|nationalfirearms|nationalheritage|nativeamerican|naturalhistory|naturalhistorymuseum|naturalsciences|nature|naturhistorisches|natuurwetenschappen|naumburg|naval|nebraska|neues|newhampshire|newjersey|newmexico|newport|newspaper|newyork|niepce|norfolk|north|nrw|nuernberg|nuremberg|nyc|nyny|oceanographic|oceanographique|omaha|online|ontario|openair|oregon|oregontrail|otago|oxford|pacific|paderborn|palace|paleo|palmsprings|panama|paris|pasadena|pharmacy|philadelphia|philadelphiaarea|philately|phoenix|photography|pilots|pittsburgh|planetarium|plantation|plants|plaza|portal|portland|portlligat|posts-and-telecommunications|preservation|presidio|press|project|public|pubol|quebec|railroad|railway|research|resistance|riodejaneiro|rochester|rockart|roma|russia|saintlouis|salem|salvadordali|salzburg|sandiego|sanfrancisco|santabarbara|santacruz|santafe|saskatchewan|satx|savannahga|schlesisches|schoenbrunn|schokoladen|school|schweiz|science|scienceandhistory|scienceandindustry|sciencecenter|sciencecenters|science-fiction|sciencehistory|sciences|sciencesnaturelles|scotland|seaport|settlement|settlers|shell|sherbrooke|sibenik|silk|ski|skole|society|sologne|soundandvision|southcarolina|southwest|space|spy|square|stadt|stalbans|starnberg|state|stateofdelaware|station|steam|steiermark|stjohn|stockholm|stpetersburg|stuttgart|suisse|surgeonshall|surrey|svizzera|sweden|sydney|tank|tcm|technology|telekommunikation|television|texas|textile|theater|time|timekeeping|topology|torino|touch|town|transport|tree|trolley|trust|trustee|uhren|ulm|undersea|university|usa|usantiques|usarts|uscountryestate|usculture|usdecorativearts|usgarden|ushistory|ushuaia|uslivinghistory|utah|uvic|valley|vantaa|versailles|viking|village|virginia|virtual|virtuel|vlaanderen|volkenkunde|wales|wallonie|war|washingtondc|watchandclock|watch-and-clock|western|westfalen|whaling|wildlife|williamsburg|windmill|workshop|york|yorkshire|yosemite|youth|zoological|zoology|xn--9dbhblg6di|xn--h1aegh",mv:"aero|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro",mw:"ac|biz|co|com|coop|edu|gov|int|museum|net|org",mx:"com|org|gob|edu|net|blogspot",my:"com|net|org|gov|edu|mil|name|blogspot",mz:"*|!teledata",na:"info|pro|name|school|or|dr|us|mx|ca|in|cc|tv|ws|mobi|co|com|org",name:"forgot.her|forgot.his",nc:"asso",ne:"",net:"cloudfront|gb|hu|jp|se|uk|in|cdn77-ssl|r.cdn77|at-band-camp|blogdns|broke-it|buyshouses|dnsalias|dnsdojo|does-it|dontexist|dynalias|dynathome|endofinternet|from-az|from-co|from-la|from-ny|gets-it|ham-radio-op|homeftp|homeip|homelinux|homeunix|in-the-band|is-a-chef|is-a-geek|isa-geek|kicks-ass|office-on-the|podzone|scrapper-site|selfip|sells-it|servebbs|serveftp|thruhere|webhop|a.ssl.fastly|b.ssl.fastly|global.ssl.fastly|a.prod.fastly|global.prod.fastly|azurewebsites|azure-mobile|cloudapp|za",nf:"com|net|per|rec|web|arts|firm|info|other|store",ng:"com|edu|name|net|org|sch|gov|mil|mobi|blogspot.com",ni:"*",nl:"bv|co|blogspot",no:"fhs|vgs|fylkesbibl|folkebibl|museum|idrett|priv|mil|stat|dep|kommune|herad|aa|ah|bu|fm|hl|hm|jan-mayen|mr|nl|nt|of|ol|oslo|rl|sf|st|svalbard|tm|tr|va|vf|gs.aa|gs.ah|gs.bu|gs.fm|gs.hl|gs.hm|gs.jan-mayen|gs.mr|gs.nl|gs.nt|gs.of|gs.ol|gs.oslo|gs.rl|gs.sf|gs.st|gs.svalbard|gs.tm|gs.tr|gs.va|gs.vf|akrehamn|xn--krehamn-dxa|algard|xn--lgrd-poac|arna|brumunddal|bryne|bronnoysund|xn--brnnysund-m8ac|drobak|xn--drbak-wua|egersund|fetsund|floro|xn--flor-jra|fredrikstad|hokksund|honefoss|xn--hnefoss-q1a|jessheim|jorpeland|xn--jrpeland-54a|kirkenes|kopervik|krokstadelva|langevag|xn--langevg-jxa|leirvik|mjondalen|xn--mjndalen-64a|mo-i-rana|mosjoen|xn--mosjen-eya|nesoddtangen|orkanger|osoyro|xn--osyro-wua|raholt|xn--rholt-mra|sandnessjoen|xn--sandnessjen-ogb|skedsmokorset|slattum|spjelkavik|stathelle|stavern|stjordalshalsen|xn--stjrdalshalsen-sqb|tananger|tranby|vossevangen|afjord|xn--fjord-lra|agdenes|al|xn--l-1fa|alesund|xn--lesund-hua|alstahaug|alta|xn--lt-liac|alaheadju|xn--laheadju-7ya|alvdal|amli|xn--mli-tla|amot|xn--mot-tla|andebu|andoy|xn--andy-ira|andasuolo|ardal|xn--rdal-poa|aremark|arendal|xn--s-1fa|aseral|xn--seral-lra|asker|askim|askvoll|askoy|xn--asky-ira|asnes|xn--snes-poa|audnedaln|aukra|aure|aurland|aurskog-holand|xn--aurskog-hland-jnb|austevoll|austrheim|averoy|xn--avery-yua|balestrand|ballangen|balat|xn--blt-elab|balsfjord|bahccavuotna|xn--bhccavuotna-k7a|bamble|bardu|beardu|beiarn|bajddar|xn--bjddar-pta|baidar|xn--bidr-5nac|berg|bergen|berlevag|xn--berlevg-jxa|bearalvahki|xn--bearalvhki-y4a|bindal|birkenes|bjarkoy|xn--bjarky-fya|bjerkreim|bjugn|bodo|xn--bod-2na|badaddja|xn--bdddj-mrabd|budejju|bokn|bremanger|bronnoy|xn--brnny-wuac|bygland|bykle|barum|xn--brum-voa|bo.telemark|xn--b-5ga.telemark|bo.nordland|xn--b-5ga.nordland|bievat|xn--bievt-0qa|bomlo|xn--bmlo-gra|batsfjord|xn--btsfjord-9za|bahcavuotna|xn--bhcavuotna-s4a|dovre|drammen|drangedal|dyroy|xn--dyry-ira|donna|xn--dnna-gra|eid|eidfjord|eidsberg|eidskog|eidsvoll|eigersund|elverum|enebakk|engerdal|etne|etnedal|evenes|evenassi|xn--eveni-0qa01ga|evje-og-hornnes|farsund|fauske|fuossko|fuoisku|fedje|fet|finnoy|xn--finny-yua|fitjar|fjaler|fjell|flakstad|flatanger|flekkefjord|flesberg|flora|fla|xn--fl-zia|folldal|forsand|fosnes|frei|frogn|froland|frosta|frana|xn--frna-woa|froya|xn--frya-hra|fusa|fyresdal|forde|xn--frde-gra|gamvik|gangaviika|xn--ggaviika-8ya47h|gaular|gausdal|gildeskal|xn--gildeskl-g0a|giske|gjemnes|gjerdrum|gjerstad|gjesdal|gjovik|xn--gjvik-wua|gloppen|gol|gran|grane|granvin|gratangen|grimstad|grong|kraanghke|xn--kranghke-b0a|grue|gulen|hadsel|halden|halsa|hamar|hamaroy|habmer|xn--hbmer-xqa|hapmir|xn--hpmir-xqa|hammerfest|hammarfeasta|xn--hmmrfeasta-s4ac|haram|hareid|harstad|hasvik|aknoluokta|xn--koluokta-7ya57h|hattfjelldal|aarborte|haugesund|hemne|hemnes|hemsedal|heroy.more-og-romsdal|xn--hery-ira.xn--mre-og-romsdal-qqb|heroy.nordland|xn--hery-ira.nordland|hitra|hjartdal|hjelmeland|hobol|xn--hobl-ira|hof|hol|hole|holmestrand|holtalen|xn--holtlen-hxa|hornindal|horten|hurdal|hurum|hvaler|hyllestad|hagebostad|xn--hgebostad-g3a|hoyanger|xn--hyanger-q1a|hoylandet|xn--hylandet-54a|ha|xn--h-2fa|ibestad|inderoy|xn--indery-fya|iveland|jevnaker|jondal|jolster|xn--jlster-bya|karasjok|karasjohka|xn--krjohka-hwab49j|karlsoy|galsa|xn--gls-elac|karmoy|xn--karmy-yua|kautokeino|guovdageaidnu|klepp|klabu|xn--klbu-woa|kongsberg|kongsvinger|kragero|xn--krager-gya|kristiansand|kristiansund|krodsherad|xn--krdsherad-m8a|kvalsund|rahkkeravju|xn--rhkkervju-01af|kvam|kvinesdal|kvinnherad|kviteseid|kvitsoy|xn--kvitsy-fya|kvafjord|xn--kvfjord-nxa|giehtavuoatna|kvanangen|xn--kvnangen-k0a|navuotna|xn--nvuotna-hwa|kafjord|xn--kfjord-iua|gaivuotna|xn--givuotna-8ya|larvik|lavangen|lavagis|loabat|xn--loabt-0qa|lebesby|davvesiida|leikanger|leirfjord|leka|leksvik|lenvik|leangaviika|xn--leagaviika-52b|lesja|levanger|lier|lierne|lillehammer|lillesand|lindesnes|lindas|xn--linds-pra|lom|loppa|lahppi|xn--lhppi-xqa|lund|lunner|luroy|xn--lury-ira|luster|lyngdal|lyngen|ivgu|lardal|lerdal|xn--lrdal-sra|lodingen|xn--ldingen-q1a|lorenskog|xn--lrenskog-54a|loten|xn--lten-gra|malvik|masoy|xn--msy-ula0h|muosat|xn--muost-0qa|mandal|marker|marnardal|masfjorden|meland|meldal|melhus|meloy|xn--mely-ira|meraker|xn--merker-kua|moareke|xn--moreke-jua|midsund|midtre-gauldal|modalen|modum|molde|moskenes|moss|mosvik|malselv|xn--mlselv-iua|malatvuopmi|xn--mlatvuopmi-s4a|namdalseid|aejrie|namsos|namsskogan|naamesjevuemie|xn--nmesjevuemie-tcba|laakesvuemie|nannestad|narvik|narviika|naustdal|nedre-eiker|nes.akershus|nes.buskerud|nesna|nesodden|nesseby|unjarga|xn--unjrga-rta|nesset|nissedal|nittedal|nord-aurdal|nord-fron|nord-odal|norddal|nordkapp|davvenjarga|xn--davvenjrga-y4a|nordre-land|nordreisa|raisa|xn--risa-5na|nore-og-uvdal|notodden|naroy|xn--nry-yla5g|notteroy|xn--nttery-byae|odda|oksnes|xn--ksnes-uua|oppdal|oppegard|xn--oppegrd-ixa|orkdal|orland|xn--rland-uua|orskog|xn--rskog-uua|orsta|xn--rsta-fra|os.hedmark|os.hordaland|osen|osteroy|xn--ostery-fya|ostre-toten|xn--stre-toten-zcb|overhalla|ovre-eiker|xn--vre-eiker-k8a|oyer|xn--yer-zna|oygarden|xn--ygarden-p1a|oystre-slidre|xn--ystre-slidre-ujb|porsanger|porsangu|xn--porsgu-sta26f|porsgrunn|radoy|xn--rady-ira|rakkestad|rana|ruovat|randaberg|rauma|rendalen|rennebu|rennesoy|xn--rennesy-v1a|rindal|ringebu|ringerike|ringsaker|rissa|risor|xn--risr-ira|roan|rollag|rygge|ralingen|xn--rlingen-mxa|rodoy|xn--rdy-0nab|romskog|xn--rmskog-bya|roros|xn--rros-gra|rost|xn--rst-0na|royken|xn--ryken-vua|royrvik|xn--ryrvik-bya|rade|xn--rde-ula|salangen|siellak|saltdal|salat|xn--slt-elab|xn--slat-5na|samnanger|sande.more-og-romsdal|sande.xn--mre-og-romsdal-qqb|sande.vestfold|sandefjord|sandnes|sandoy|xn--sandy-yua|sarpsborg|sauda|sauherad|sel|selbu|selje|seljord|sigdal|siljan|sirdal|skaun|skedsmo|ski|skien|skiptvet|skjervoy|xn--skjervy-v1a|skierva|xn--skierv-uta|skjak|xn--skjk-soa|skodje|skanland|xn--sknland-fxa|skanit|xn--sknit-yqa|smola|xn--smla-hra|snillfjord|snasa|xn--snsa-roa|snoasa|snaase|xn--snase-nra|sogndal|sokndal|sola|solund|songdalen|sortland|spydeberg|stange|stavanger|steigen|steinkjer|stjordal|xn--stjrdal-s1a|stokke|stor-elvdal|stord|stordal|storfjord|omasvuotna|strand|stranda|stryn|sula|suldal|sund|sunndal|surnadal|sveio|svelvik|sykkylven|sogne|xn--sgne-gra|somna|xn--smna-gra|sondre-land|xn--sndre-land-0cb|sor-aurdal|xn--sr-aurdal-l8a|sor-fron|xn--sr-fron-q1a|sor-odal|xn--sr-odal-q1a|sor-varanger|xn--sr-varanger-ggb|matta-varjjat|xn--mtta-vrjjat-k7af|sorfold|xn--srfold-bya|sorreisa|xn--srreisa-q1a|sorum|xn--srum-gra|tana|deatnu|time|tingvoll|tinn|tjeldsund|dielddanuorri|tjome|xn--tjme-hra|tokke|tolga|torsken|tranoy|xn--trany-yua|tromso|xn--troms-zua|tromsa|romsa|trondheim|troandin|trysil|trana|xn--trna-woa|trogstad|xn--trgstad-r1a|tvedestrand|tydal|tynset|tysfjord|divtasvuodna|divttasvuotna|tysnes|tysvar|xn--tysvr-vra|tonsberg|xn--tnsberg-q1a|ullensaker|ullensvang|ulvik|utsira|vadso|xn--vads-jra|cahcesuolo|xn--hcesuolo-7ya35b|vaksdal|valle|vang|vanylven|vardo|xn--vard-jra|varggat|xn--vrggt-xqad|vefsn|vaapste|vega|vegarshei|xn--vegrshei-c0a|vennesla|verdal|verran|vestby|vestnes|vestre-slidre|vestre-toten|vestvagoy|xn--vestvgy-ixa6o|vevelstad|vik|vikna|vindafjord|volda|voss|varoy|xn--vry-yla5g|vagan|xn--vgan-qoa|voagat|vagsoy|xn--vgsy-qoa0j|vaga|xn--vg-yiab|valer.ostfold|xn--vler-qoa.xn--stfold-9xa|valer.hedmark|xn--vler-qoa.hedmark|co|blogspot",np:"*",nr:"biz|info|gov|edu|org|net|com",nu:"merseine|mine|shacknet",nz:"ac|co|cri|geek|gen|govt|health|iwi|kiwi|maori|mil|xn--mori-qsa|net|org|parliament|school|blogspot.co",om:"co|com|edu|gov|med|museum|net|org|pro",org:"ae|us|c.cdn77|rsc.cdn77|ssl.origin.cdn77-secure|duckdns|dyndns|blogdns|blogsite|boldlygoingnowhere|dnsalias|dnsdojo|doesntexist|dontexist|doomdns|dvrdns|dynalias|endofinternet|endoftheinternet|from-me|game-host|go.dyndns|gotdns|hobby-site|home.dyndns|homedns|homeftp|homelinux|homeunix|is-a-bruinsfan|is-a-candidate|is-a-celticsfan|is-a-chef|is-a-geek|is-a-knight|is-a-linux-user|is-a-patsfan|is-a-soxfan|is-found|is-lost|is-saved|is-very-bad|is-very-evil|is-very-good|is-very-nice|is-very-sweet|isa-geek|kicks-ass|misconfused|podzone|readmyblog|selfip|sellsyourhome|servebbs|serveftp|servegame|stuff-4-sale|webhop|eu|al.eu|asso.eu|at.eu|au.eu|be.eu|bg.eu|ca.eu|cd.eu|ch.eu|cn.eu|cy.eu|cz.eu|de.eu|dk.eu|edu.eu|ee.eu|es.eu|fi.eu|fr.eu|gr.eu|hr.eu|hu.eu|ie.eu|il.eu|in.eu|int.eu|is.eu|it.eu|jp.eu|kr.eu|lt.eu|lu.eu|lv.eu|mc.eu|me.eu|mk.eu|mt.eu|my.eu|net.eu|ng.eu|nl.eu|no.eu|nz.eu|paris.eu|pl.eu|pt.eu|q-a.eu|ro.eu|ru.eu|se.eu|si.eu|sk.eu|tr.eu|uk.eu|us.eu|bmoattachments|hk|za",pa:"ac|gob|com|org|sld|edu|net|ing|abo|med|nom",pe:"edu|gob|nom|mil|org|com|net|blogspot",pf:"com|org|edu",pg:"*",ph:"com|net|org|gov|edu|ngo|mil|i",pk:"com|net|edu|org|fam|biz|web|gov|gob|gok|gon|gop|gos|info",pl:"com|net|org|aid|agro|atm|auto|biz|edu|gmina|gsm|info|mail|miasta|media|mil|nieruchomosci|nom|pc|powiat|priv|realestate|rel|sex|shop|sklep|sos|szkola|targi|tm|tourism|travel|turystyka|gov|ap.gov|ic.gov|is.gov|us.gov|kmpsp.gov|kppsp.gov|kwpsp.gov|psp.gov|wskr.gov|kwp.gov|mw.gov|ug.gov|um.gov|umig.gov|ugim.gov|upow.gov|uw.gov|starostwo.gov|pa.gov|po.gov|psse.gov|pup.gov|rzgw.gov|sa.gov|so.gov|sr.gov|wsa.gov|sko.gov|uzs.gov|wiih.gov|winb.gov|pinb.gov|wios.gov|witd.gov|wzmiuw.gov|piw.gov|wiw.gov|griw.gov|wif.gov|oum.gov|sdn.gov|zp.gov|uppo.gov|mup.gov|wuoz.gov|konsulat.gov|oirm.gov|augustow|babia-gora|bedzin|beskidy|bialowieza|bialystok|bielawa|bieszczady|boleslawiec|bydgoszcz|bytom|cieszyn|czeladz|czest|dlugoleka|elblag|elk|glogow|gniezno|gorlice|grajewo|ilawa|jaworzno|jelenia-gora|jgora|kalisz|kazimierz-dolny|karpacz|kartuzy|kaszuby|katowice|kepno|ketrzyn|klodzko|kobierzyce|kolobrzeg|konin|konskowola|kutno|lapy|lebork|legnica|lezajsk|limanowa|lomza|lowicz|lubin|lukow|malbork|malopolska|mazowsze|mazury|mielec|mielno|mragowo|naklo|nowaruda|nysa|olawa|olecko|olkusz|olsztyn|opoczno|opole|ostroda|ostroleka|ostrowiec|ostrowwlkp|pila|pisz|podhale|podlasie|polkowice|pomorze|pomorskie|prochowice|pruszkow|przeworsk|pulawy|radom|rawa-maz|rybnik|rzeszow|sanok|sejny|slask|slupsk|sosnowiec|stalowa-wola|skoczow|starachowice|stargard|suwalki|swidnica|swiebodzin|swinoujscie|szczecin|szczytno|tarnobrzeg|tgory|turek|tychy|ustka|walbrzych|warmia|warszawa|waw|wegrow|wielun|wlocl|wloclawek|wodzislaw|wolomin|wroclaw|zachpomor|zagan|zarow|zgora|zgorzelec|co|art|gliwice|krakow|poznan|wroc|zakopane|gda|gdansk|gdynia|med|sopot",pm:"",pn:"gov|co|org|edu|net",post:"",pr:"com|net|org|gov|edu|isla|pro|biz|info|name|est|prof|ac",pro:"aca|bar|cpa|jur|law|med|eng",ps:"edu|gov|sec|plo|com|org|net",pt:"net|gov|org|edu|int|publ|com|nome|blogspot",pw:"co|ne|or|ed|go|belau",py:"com|coop|edu|gov|mil|net|org",qa:"com|edu|gov|mil|name|net|org|sch|blogspot",re:"com|asso|nom|blogspot",ro:"com|org|tm|nt|nom|info|rec|arts|firm|store|www|blogspot",rs:"co|org|edu|ac|gov|in|blogspot",ru:"ac|com|edu|int|net|org|pp|adygeya|altai|amur|arkhangelsk|astrakhan|bashkiria|belgorod|bir|bryansk|buryatia|cbg|chel|chelyabinsk|chita|chukotka|chuvashia|dagestan|dudinka|e-burg|grozny|irkutsk|ivanovo|izhevsk|jar|joshkar-ola|kalmykia|kaluga|kamchatka|karelia|kazan|kchr|kemerovo|khabarovsk|khakassia|khv|kirov|koenig|komi|kostroma|krasnoyarsk|kuban|kurgan|kursk|lipetsk|magadan|mari|mari-el|marine|mordovia|msk|murmansk|nalchik|nnov|nov|novosibirsk|nsk|omsk|orenburg|oryol|palana|penza|perm|ptz|rnd|ryazan|sakhalin|samara|saratov|simbirsk|smolensk|spb|stavropol|stv|surgut|tambov|tatarstan|tom|tomsk|tsaritsyn|tsk|tula|tuva|tver|tyumen|udm|udmurtia|ulan-ude|vladikavkaz|vladimir|vladivostok|volgograd|vologda|voronezh|vrn|vyatka|yakutia|yamal|yaroslavl|yekaterinburg|yuzhno-sakhalinsk|amursk|baikal|cmw|fareast|jamal|kms|k-uralsk|kustanai|kuzbass|magnitka|mytis|nakhodka|nkz|norilsk|oskol|pyatigorsk|rubtsovsk|snz|syzran|vdonsk|zgrad|gov|mil|test|blogspot",rw:"gov|net|edu|ac|com|co|int|mil|gouv",sa:"com|net|org|gov|med|pub|edu|sch",sb:"com|edu|gov|net|org",sc:"com|gov|net|org|edu",sd:"com|net|org|edu|med|tv|gov|info",se:"a|ac|b|bd|brand|c|d|e|f|fh|fhsk|fhv|g|h|i|k|komforb|kommunalforbund|komvux|l|lanbib|m|n|naturbruksgymn|o|org|p|parti|pp|press|r|s|t|tm|u|w|x|y|z|com|blogspot",sg:"com|net|org|gov|edu|per|blogspot",sh:"com|net|gov|org|mil|*platform",si:"blogspot",sj:"",sk:"blogspot",sl:"com|net|edu|gov|org",sm:"",sn:"art|com|edu|gouv|org|perso|univ|blogspot",so:"com|net|org",sr:"",st:"co|com|consulado|edu|embaixada|gov|mil|net|org|principe|saotome|store",su:"adygeya|arkhangelsk|balashov|bashkiria|bryansk|dagestan|grozny|ivanovo|kalmykia|kaluga|karelia|khakassia|krasnodar|kurgan|lenug|mordovia|msk|murmansk|nalchik|nov|obninsk|penza|pokrovsk|sochi|spb|togliatti|troitsk|tula|tuva|vladikavkaz|vladimir|vologda",sv:"com|edu|gob|org|red",sx:"gov",sy:"edu|gov|net|mil|com|org",sz:"co|ac|org",tc:"",td:"blogspot",tel:"",tf:"",tg:"",th:"ac|co|go|in|mi|net|or",tj:"ac|biz|co|com|edu|go|gov|int|mil|name|net|nic|org|test|web",tk:"",tl:"gov",tm:"com|co|org|net|nom|gov|mil|edu",tn:"com|ens|fin|gov|ind|intl|nat|net|org|info|perso|tourism|edunet|rnrt|rns|rnu|mincom|agrinet|defense|turen",to:"com|gov|net|org|edu|mil",tp:"",tr:"com|info|biz|net|org|web|gen|tv|av|dr|bbs|name|tel|gov|bel|pol|mil|k12|edu|kep|nc|gov.nc|blogspot.com",travel:"",tt:"co|com|org|net|biz|info|pro|int|coop|jobs|mobi|travel|museum|aero|name|gov|edu",tv:"dyndns|better-than|on-the-web|worse-than",tw:"edu|gov|mil|com|net|org|idv|game|ebiz|club|xn--zf0ao64a|xn--uc0atv|xn--czrw28b|blogspot",tz:"ac|co|go|hotel|info|me|mil|mobi|ne|or|sc|tv",ua:"com|edu|gov|in|net|org|cherkassy|cherkasy|chernigov|chernihiv|chernivtsi|chernovtsy|ck|cn|cr|crimea|cv|dn|dnepropetrovsk|dnipropetrovsk|dominic|donetsk|dp|if|ivano-frankivsk|kh|kharkiv|kharkov|kherson|khmelnitskiy|khmelnytskyi|kiev|kirovograd|km|kr|krym|ks|kv|kyiv|lg|lt|lugansk|lutsk|lv|lviv|mk|mykolaiv|nikolaev|od|odesa|odessa|pl|poltava|rivne|rovno|rv|sb|sebastopol|sevastopol|sm|sumy|te|ternopil|uz|uzhgorod|vinnica|vinnytsia|vn|volyn|yalta|zaporizhzhe|zaporizhzhia|zhitomir|zhytomyr|zp|zt|biz|co|pp",ug:"co|or|ac|sc|go|ne|com|org|blogspot",uk:"ac|co|gov|ltd|me|net|nhs|org|plc|police|*sch|service.gov|blogspot.co",us:"dni|fed|isa|kids|nsn|ak|al|ar|as|az|ca|co|ct|dc|de|fl|ga|gu|hi|ia|id|il|in|ks|ky|la|ma|md|me|mi|mn|mo|ms|mt|nc|nd|ne|nh|nj|nm|nv|ny|oh|ok|or|pa|pr|ri|sc|sd|tn|tx|ut|vi|vt|va|wa|wi|wv|wy|k12.ak|k12.al|k12.ar|k12.as|k12.az|k12.ca|k12.co|k12.ct|k12.dc|k12.de|k12.fl|k12.ga|k12.gu|k12.ia|k12.id|k12.il|k12.in|k12.ks|k12.ky|k12.la|k12.ma|k12.md|k12.me|k12.mi|k12.mn|k12.mo|k12.ms|k12.mt|k12.nc|k12.ne|k12.nh|k12.nj|k12.nm|k12.nv|k12.ny|k12.oh|k12.ok|k12.or|k12.pa|k12.pr|k12.ri|k12.sc|k12.tn|k12.tx|k12.ut|k12.vi|k12.vt|k12.va|k12.wa|k12.wi|k12.wy|cc.ak|cc.al|cc.ar|cc.as|cc.az|cc.ca|cc.co|cc.ct|cc.dc|cc.de|cc.fl|cc.ga|cc.gu|cc.hi|cc.ia|cc.id|cc.il|cc.in|cc.ks|cc.ky|cc.la|cc.ma|cc.md|cc.me|cc.mi|cc.mn|cc.mo|cc.ms|cc.mt|cc.nc|cc.nd|cc.ne|cc.nh|cc.nj|cc.nm|cc.nv|cc.ny|cc.oh|cc.ok|cc.or|cc.pa|cc.pr|cc.ri|cc.sc|cc.sd|cc.tn|cc.tx|cc.ut|cc.vi|cc.vt|cc.va|cc.wa|cc.wi|cc.wv|cc.wy|lib.ak|lib.al|lib.ar|lib.as|lib.az|lib.ca|lib.co|lib.ct|lib.dc|lib.de|lib.fl|lib.ga|lib.gu|lib.hi|lib.ia|lib.id|lib.il|lib.in|lib.ks|lib.ky|lib.la|lib.ma|lib.md|lib.me|lib.mi|lib.mn|lib.mo|lib.ms|lib.mt|lib.nc|lib.nd|lib.ne|lib.nh|lib.nj|lib.nm|lib.nv|lib.ny|lib.oh|lib.ok|lib.or|lib.pa|lib.pr|lib.ri|lib.sc|lib.sd|lib.tn|lib.tx|lib.ut|lib.vi|lib.vt|lib.va|lib.wa|lib.wi|lib.wy|pvt.k12.ma|chtr.k12.ma|paroch.k12.ma|is-by|land-4-sale|stuff-4-sale",uy:"com|edu|gub|mil|net|org|blogspot.com",uz:"co|com|net|org",va:"",vc:"com|net|org|gov|mil|edu",ve:"arts|co|com|e12|edu|firm|gob|gov|info|int|mil|net|org|rec|store|tec|web",vg:"",vi:"co|com|k12|net|org",vn:"com|net|org|edu|gov|int|ac|biz|info|name|pro|health|blogspot",vu:"com|edu|net|org",wf:"",ws:"com|net|org|gov|edu|dyndns|mypets",yt:"","xn--mgbaam7a8h":"","xn--y9a3aq":"","xn--54b7fta0cc":"","xn--90ais":"","xn--fiqs8s":"","xn--fiqz9s":"","xn--lgbbat1ad8j":"","xn--wgbh1c":"","xn--node":"","xn--qxam":"","xn--j6w193g":"","xn--h2brj9c":"","xn--mgbbh1a71e":"","xn--fpcrj9c3d":"","xn--gecrj9c":"","xn--s9brj9c":"","xn--45brj9c":"","xn--xkc2dl3a5ee0h":"","xn--mgba3a4f16a":"","xn--mgba3a4fra":"","xn--mgbtx2b":"","xn--mgbayh7gpa":"","xn--3e0b707e":"","xn--80ao21a":"","xn--fzc2c9e2c":"","xn--xkc2al3hye2a":"","xn--mgbc0a9azcg":"","xn--d1alf":"","xn--l1acc":"","xn--mix891f":"","xn--mix082f":"","xn--mgbx4cd0ab":"","xn--mgb9awbf":"","xn--mgbai9azgqp6j":"","xn--mgbai9a5eva00b":"","xn--ygbi2ammx":"","xn--90a3ac":"xn--o1ac|xn--c1avg|xn--90azh|xn--d1at|xn--o1ach|xn--80au","xn--p1ai":"","xn--wgbl6a":"","xn--mgberp4a5d4ar":"","xn--mgberp4a5d4a87g":"","xn--mgbqly7c0a67fbc":"","xn--mgbqly7cvafr":"","xn--mgbpl2fh":"","xn--yfro4i67o":"","xn--clchc0ea0b2g2a9gcd":"","xn--ogbpf8fl":"","xn--mgbtf8fl":"","xn--o3cw4h":"","xn--pgbs0dh":"","xn--kpry57d":"","xn--kprw13d":"","xn--nnx388a":"","xn--j1amh":"","xn--mgb2ddes":"",xxx:"",ye:"*",za:"ac|agrica|alt|co|edu|gov|grondar|law|mil|net|ngo|nis|nom|org|school|tm|web|blogspot.co",zm:"*",zw:"*",aaa:"",aarp:"",abarth:"",abb:"",abbott:"",abbvie:"",abc:"",able:"",abogado:"",abudhabi:"",academy:"",accenture:"",accountant:"",accountants:"",aco:"",active:"",actor:"",adac:"",ads:"",adult:"",aeg:"",aetna:"",afamilycompany:"",afl:"",africa:"",africamagic:"",agakhan:"",agency:"",aig:"",aigo:"",airbus:"",airforce:"",airtel:"",akdn:"",alfaromeo:"",alibaba:"",alipay:"",allfinanz:"",allstate:"",ally:"",alsace:"",alstom:"",americanexpress:"",americanfamily:"",amex:"",amfam:"",amica:"",amsterdam:"",analytics:"",android:"",anquan:"",anz:"",aol:"",apartments:"",app:"",apple:"",aquarelle:"",aramco:"",archi:"",army:"",arte:"",asda:"",associates:"",athleta:"",attorney:"",auction:"",audi:"",audible:"",audio:"",auspost:"",author:"",auto:"",autos:"",avianca:"",aws:"",axa:"",azure:"",baby:"",baidu:"",banamex:"",bananarepublic:"",band:"",bank:"",bar:"",barcelona:"",barclaycard:"",barclays:"",barefoot:"",bargains:"",baseball:"",basketball:"",bauhaus:"",bayern:"",bbc:"",bbt:"",bbva:"",bcg:"",bcn:"",beats:"",beer:"",bentley:"",berlin:"",best:"",bestbuy:"",bet:"",bharti:"",bible:"",bid:"",bike:"",bing:"",bingo:"",bio:"",black:"",blackfriday:"",blanco:"",blockbuster:"",blog:"",bloomberg:"",blue:"",bms:"",bmw:"",bnl:"",bnpparibas:"",boats:"",boehringer:"",bofa:"",bom:"",bond:"",boo:"",book:"",booking:"",boots:"",bosch:"",bostik:"",bot:"",boutique:"",bradesco:"",bridgestone:"",broadway:"",broker:"",brother:"",brussels:"",budapest:"",bugatti:"",build:"",builders:"",business:"",buy:"",buzz:"",bzh:"",cab:"",cafe:"",cal:"",call:"",calvinklein:"",camera:"",camp:"",cancerresearch:"",canon:"",capetown:"",capital:"",capitalone:"",car:"",caravan:"",cards:"",care:"",career:"",careers:"",cars:"",cartier:"",casa:"","case":"",caseih:"",cash:"",casino:"",catering:"",catholic:"",cba:"",cbn:"",cbre:"",cbs:"",ceb:"",center:"",ceo:"",cern:"",cfa:"",cfd:"",chanel:"",channel:"",chase:"",chat:"",cheap:"",chintai:"",chloe:"",christmas:"",chrome:"",chrysler:"",church:"",cipriani:"",circle:"",cisco:"",citadel:"",citi:"",citic:"",city:"",cityeats:"",claims:"",cleaning:"",click:"",clinic:"",clinique:"",clothing:"",cloud:"",club:"",clubmed:"",coach:"",codes:"",coffee:"",college:"",cologne:"",comcast:"",commbank:"",community:"",company:"",compare:"",computer:"",comsec:"",condos:"",construction:"",consulting:"",contact:"",contractors:"",cooking:"",cookingchannel:"",cool:"",corsica:"",country:"",coupon:"",coupons:"",courses:"",credit:"",creditcard:"",creditunion:"",cricket:"",crown:"",crs:"",cruises:"",csc:"",cuisinella:"",cymru:"",cyou:"",dabur:"",dad:"",dance:"",date:"",dating:"",datsun:"",day:"",dclk:"",dds:"",deal:"",dealer:"",deals:"",degree:"",delivery:"",dell:"",deloitte:"",delta:"",democrat:"",dental:"",dentist:"",desi:"",design:"",dev:"",dhl:"",diamonds:"",diet:"",digital:"",direct:"",directory:"",discount:"",discover:"",dish:"",diy:"",dnp:"",docs:"",dodge:"",dog:"",doha:"",domains:"",doosan:"",dot:"",download:"",drive:"",dstv:"",dtv:"",dubai:"",duck:"",dunlop:"",duns:"",dupont:"",durban:"",dvag:"",dwg:"",earth:"",eat:"",edeka:"",education:"",email:"",emerck:"",emerson:"",energy:"",engineer:"",engineering:"",enterprises:"",epost:"",epson:"",equipment:"",ericsson:"",erni:"",esq:"",estate:"",esurance:"",etisalat:"",eurovision:"",eus:"",events:"",everbank:"",exchange:"",expert:"",exposed:"",express:"",extraspace:"",fage:"",fail:"",fairwinds:"",faith:"",family:"",fan:"",fans:"",farm:"",farmers:"",fashion:"",fast:"",fedex:"",feedback:"",ferrari:"",ferrero:"",fiat:"",fidelity:"",fido:"",film:"",final:"",finance:"",financial:"",fire:"",firestone:"",firmdale:"",fish:"",fishing:"",fit:"",fitness:"",flickr:"",flights:"",flir:"",florist:"",flowers:"",flsmidth:"",fly:"",foo:"",foodnetwork:"",football:"",ford:"",forex:"",forsale:"",forum:"",foundation:"",fox:"",fresenius:"",frl:"",frogans:"",frontdoor:"",frontier:"",ftr:"",fujitsu:"",fujixerox:"",fund:"",furniture:"",futbol:"",fyi:"",gal:"",gallery:"",gallo:"",gallup:"",game:"",games:"",gap:"",garden:"",gbiz:"",gdn:"",gea:"",gent:"",genting:"",george:"",ggee:"",gift:"",gifts:"",gives:"",giving:"",glade:"",glass:"",gle:"",global:"",globo:"",gmail:"",gmo:"",gmx:"",godaddy:"",gold:"",goldpoint:"",golf:"",goo:"",goodhands:"",goodyear:"",goog:"",google:"",gop:"",got:"",gotv:"",grainger:"",graphics:"",gratis:"",green:"",gripe:"",group:"",guardian:"",gucci:"",guge:"",guide:"",guitars:"",guru:"",hamburg:"",hangout:"",haus:"",hbo:"",hdfc:"",hdfcbank:"",health:"",healthcare:"",help:"",helsinki:"",here:"",hermes:"",hgtv:"",hiphop:"",hisamitsu:"",hitachi:"",hiv:"",hkt:"",hockey:"",holdings:"",holiday:"",homedepot:"",homegoods:"",homes:"",homesense:"",honda:"",honeywell:"",horse:"",host:"",hosting:"",hot:"",hoteles:"",hotmail:"",house:"",how:"",hsbc:"",htc:"",hughes:"",hyatt:"",hyundai:"",ibm:"",icbc:"",ice:"",icu:"",ieee:"",ifm:"",iinet:"",ikano:"",imamat:"",imdb:"",immo:"",immobilien:"",industries:"",infiniti:"",ing:"",ink:"",institute:"",insurance:"",insure:"",intel:"",international:"",intuit:"",investments:"",ipiranga:"",irish:"",iselect:"",ismaili:"",ist:"",istanbul:"",itau:"",itv:"",iveco:"",iwc:"",jaguar:"",java:"",jcb:"",jcp:"",jeep:"",jetzt:"",jewelry:"",jio:"",jlc:"",jll:"",jmp:"",jnj:"",joburg:"",jot:"",joy:"",jpmorgan:"",jprs:"",juegos:"",juniper:"",kaufen:"",kddi:"",kerryhotels:"",kerrylogistics:"",kerryproperties:"",kfh:"",kia:"",kim:"",kinder:"",kindle:"",kitchen:"",kiwi:"",koeln:"",komatsu:"",kosher:"",kpmg:"",kpn:"",krd:"",kred:"",kuokgroup:"",kyknet:"",kyoto:"",lacaixa:"",ladbrokes:"",lamborghini:"",lamer:"",lancaster:"",lancia:"",lancome:"",land:"",landrover:"",lanxess:"",lasalle:"",lat:"",latino:"",latrobe:"",law:"",lawyer:"",lds:"",lease:"",leclerc:"",lefrak:"",legal:"",lego:"",lexus:"",lgbt:"",liaison:"",lidl:"",life:"",lifeinsurance:"",lifestyle:"",lighting:"",like:"",lilly:"",limited:"",limo:"",lincoln:"",linde:"",link:"",lipsy:"",live:"",living:"",lixil:"",loan:"",loans:"",locker:"",locus:"",loft:"",lol:"",london:"",lotte:"",lotto:"",love:"",lpl:"",lplfinancial:"",ltd:"",ltda:"",lundbeck:"",lupin:"",luxe:"",luxury:"",macys:"",madrid:"",maif:"",maison:"",makeup:"",man:"",management:"",mango:"",market:"",marketing:"",markets:"",marriott:"",marshalls:"",maserati:"",mattel:"",mba:"",mcd:"",mcdonalds:"",mckinsey:"",med:"",media:"",meet:"",melbourne:"",meme:"",memorial:"",men:"",menu:"",meo:"",metlife:"",miami:"",microsoft:"",mini:"",mint:"",mit:"",mitsubishi:"",mlb:"",mls:"",mma:"",mnet:"",mobily:"",moda:"",moe:"",moi:"",mom:"",monash:"",money:"",monster:"",montblanc:"",mopar:"",mormon:"",mortgage:"",moscow:"",moto:"",motorcycles:"",mov:"",movie:"",movistar:"",msd:"",mtn:"",mtpc:"",mtr:"",multichoice:"",mutual:"",mutuelle:"",mzansimagic:"",nab:"",nadex:"",nagoya:"",naspers:"",nationwide:"",natura:"",navy:"",nba:"",nec:"",netbank:"",netflix:"",network:"",neustar:"","new":"",newholland:"",news:"",next:"",nextdirect:"",nexus:"",nfl:"",ngo:"",nhk:"",nico:"",nike:"",nikon:"",ninja:"",nissan:"",nissay:"",nokia:"",northwesternmutual:"",norton:"",now:"",nowruz:"",nowtv:"",nra:"",nrw:"",ntt:"",nyc:"",obi:"",observer:"",off:"",office:"",okinawa:"",olayan:"",olayangroup:"",oldnavy:"",ollo:"",omega:"",one:"",ong:"",onl:"",online:"",onyourside:"",ooo:"",open:"",oracle:"",orange:"",organic:"",orientexpress:"",origins:"",osaka:"",otsuka:"",ott:"",ovh:"",page:"",pamperedchef:"",panasonic:"",panerai:"",paris:"",pars:"",partners:"",parts:"",party:"",passagens:"",pay:"",payu:"",pccw:"",pet:"",pfizer:"",pharmacy:"",philips:"",photo:"",photography:"",photos:"",physio:"",piaget:"",pics:"",pictet:"",pictures:"",pid:"",pin:"",ping:"",pink:"",pioneer:"",pizza:"",place:"",play:"",playstation:"",plumbing:"",plus:"",pnc:"",pohl:"",poker:"",politie:"",porn:"",pramerica:"",praxi:"",press:"",prime:"",prod:"",productions:"",prof:"",progressive:"",promo:"",properties:"",property:"",protection:"",pru:"",prudential:"",pub:"",pwc:"",qpon:"",quebec:"",quest:"",qvc:"",racing:"",raid:"",read:"",realestate:"",realtor:"",realty:"",recipes:"",red:"",redstone:"",redumbrella:"",rehab:"",reise:"",reisen:"",reit:"",reliance:"",ren:"",rent:"",rentals:"",repair:"",report:"",republican:"",rest:"",restaurant:"",review:"",reviews:"",rexroth:"",rich:"",richardli:"",ricoh:"",rightathome:"",ril:"",rio:"",rip:"",rocher:"",rocks:"",rodeo:"",rogers:"",room:"",rsvp:"",ruhr:"",run:"",rwe:"",ryukyu:"",saarland:"",safe:"",safety:"",sakura:"",sale:"",salon:"",samsclub:"",samsung:"",sandvik:"",sandvikcoromant:"",sanofi:"",sap:"",sapo:"",sarl:"",sas:"",save:"",saxo:"",sbi:"",sbs:"",sca:"",scb:"",schaeffler:"",schmidt:"",scholarships:"",school:"",schule:"",schwarz:"",science:"",scjohnson:"",scor:"",scot:"",seat:"",secure:"",security:"",seek:"",select:"",sener:"",services:"",ses:"",seven:"",sew:"",sex:"",sexy:"",sfr:"",shangrila:"",sharp:"",shaw:"",shell:"",shia:"",shiksha:"",shoes:"",shouji:"",show:"",showtime:"",shriram:"",silk:"",sina:"",singles:"",
site:"",ski:"",skin:"",sky:"",skype:"",sling:"",smart:"",smile:"",sncf:"",soccer:"",social:"",softbank:"",software:"",sohu:"",solar:"",solutions:"",song:"",sony:"",soy:"",space:"",spiegel:"",spot:"",spreadbetting:"",srl:"",srt:"",stada:"",staples:"",star:"",starhub:"",statebank:"",statefarm:"",statoil:"",stc:"",stcgroup:"",stockholm:"",storage:"",store:"",studio:"",study:"",style:"",sucks:"",supersport:"",supplies:"",supply:"",support:"",surf:"",surgery:"",suzuki:"",swatch:"",swiftcover:"",swiss:"",sydney:"",symantec:"",systems:"",tab:"",taipei:"",talk:"",taobao:"",target:"",tatamotors:"",tatar:"",tattoo:"",tax:"",taxi:"",tci:"",tdk:"",team:"",tech:"",technology:"",telecity:"",telefonica:"",temasek:"",tennis:"",teva:"",thd:"",theater:"",theatre:"",theguardian:"",tiaa:"",tickets:"",tienda:"",tiffany:"",tips:"",tires:"",tirol:"",tjmaxx:"",tjx:"",tkmaxx:"",tmall:"",today:"",tokyo:"",tools:"",top:"",toray:"",toshiba:"",total:"",tours:"",town:"",toyota:"",toys:"",trade:"",trading:"",training:"",travelchannel:"",travelers:"",travelersinsurance:"",trust:"",trv:"",tube:"",tui:"",tunes:"",tushu:"",tvs:"",ubank:"",ubs:"",uconnect:"",unicom:"",university:"",uno:"",uol:"",ups:"",vacations:"",vana:"",vanguard:"",vegas:"",ventures:"",verisign:"",versicherung:"",vet:"",viajes:"",video:"",vig:"",viking:"",villas:"",vin:"",vip:"",virgin:"",visa:"",vision:"",vista:"",vistaprint:"",viva:"",vivo:"",vlaanderen:"",vodka:"",volkswagen:"",vote:"",voting:"",voto:"",voyage:"",vuelos:"",wales:"",walmart:"",walter:"",wang:"",wanggou:"",warman:"",watch:"",watches:"",weather:"",weatherchannel:"",webcam:"",weber:"",website:"",wed:"",wedding:"",weibo:"",weir:"",whoswho:"",wien:"",wiki:"",williamhill:"",win:"",windows:"",wine:"",winners:"",wme:"",wolterskluwer:"",woodside:"",work:"",works:"",world:"",wow:"",wtc:"",wtf:"",xbox:"",xerox:"",xfinity:"",xihuan:"",xin:"","xn--11b4c3d":"","xn--1ck2e1b":"","xn--1qqw23a":"","xn--30rr7y":"","xn--3bst00m":"","xn--3ds443g":"","xn--3oq18vl8pn36a":"","xn--3pxu8k":"","xn--42c2d9a":"","xn--45q11c":"","xn--4gbrim":"","xn--4gq48lf9j":"","xn--55qw42g":"","xn--55qx5d":"","xn--5su34j936bgsg":"","xn--5tzm5g":"","xn--6frz82g":"","xn--6qq986b3xl":"","xn--80adxhks":"","xn--80aqecdr1a":"","xn--80asehdb":"","xn--80aswg":"","xn--8y0a063a":"","xn--9dbq2a":"","xn--9et52u":"","xn--9krt00a":"","xn--b4w605ferd":"","xn--bck1b9a5dre4c":"","xn--c1avg":"","xn--c2br7g":"","xn--cck2b3b":"","xn--cg4bki":"","xn--czr694b":"","xn--czrs0t":"","xn--czru2d":"","xn--d1acj3b":"","xn--eckvdtc9d":"","xn--efvy88h":"","xn--estv75g":"","xn--fct429k":"","xn--fhbei":"","xn--fiq228c5hs":"","xn--fiq64b":"","xn--fjq720a":"","xn--flw351e":"","xn--fzys8d69uvgm":"","xn--g2xx48c":"","xn--gckr3f0f":"","xn--gk3at1e":"","xn--hxt814e":"","xn--i1b6b1a6a2e":"","xn--imr513n":"","xn--io0a7i":"","xn--j1aef":"","xn--jlq61u9w7b":"","xn--jvr189m":"","xn--kcrx77d1x4a":"","xn--kpu716f":"","xn--kput3i":"","xn--mgba3a3ejt":"","xn--mgba7c0bbn0a":"","xn--mgbaakc7dvf":"","xn--mgbab2bd":"","xn--mgbb9fbpob":"","xn--mgbca7dzdo":"","xn--mgbi4ecexp":"","xn--mgbt3dhd":"","xn--mk1bu44c":"","xn--mxtq1m":"","xn--ngbc5azd":"","xn--ngbe9e0a":"","xn--nqv7f":"","xn--nqv7fs00ema":"","xn--nyqy26a":"","xn--p1acf":"","xn--pbt977c":"","xn--pssy2u":"","xn--q9jyb4c":"","xn--qcka1pmc":"","xn--rhqv96g":"","xn--rovu88b":"","xn--ses554g":"","xn--t60b56a":"","xn--tckwe":"","xn--tiq49xqyj":"","xn--unup4y":"","xn--vermgensberater-ctb":"","xn--vermgensberatung-pwb":"","xn--vhquv":"","xn--vuq861b":"","xn--w4r85el8fhu5dnra":"","xn--w4rs40l":"","xn--xhq521b":"","xn--zfr164b":"",xperia:"",xyz:"",yachts:"",yahoo:"",yamaxun:"",yandex:"",yodobashi:"",yoga:"",yokohama:"",you:"",youtube:"",yun:"",zappos:"",zara:"",zero:"",zip:"",zippo:"",zone:"",zuerich:""}},{}],227:[function(require,module,exports){!function(window,undefined){"use strict";var MODEL="model",NAME="name",TYPE="type",VENDOR="vendor",VERSION="version",MOBILE="mobile",TABLET="tablet",util={extend:function(regexes,extensions){for(var i in extensions)"browser cpu device engine os".indexOf(i)!==-1&&extensions[i].length%2===0&&(regexes[i]=extensions[i].concat(regexes[i]));return regexes},has:function(str1,str2){return"string"==typeof str1&&str2.toLowerCase().indexOf(str1.toLowerCase())!==-1},lowerize:function(str){return str.toLowerCase()},major:function(version){return"string"==typeof version?version.split(".")[0]:void 0}},mapper={rgx:function(){for(var result,j,k,p,q,matches,match,i=0,args=arguments;i<args.length&&!matches;){var regex=args[i],props=args[i+1];if(void 0===result){result={};for(p in props)props.hasOwnProperty(p)&&(q=props[p],"object"==typeof q?result[q[0]]=void 0:result[q]=void 0)}for(j=k=0;j<regex.length&&!matches;)if(matches=regex[j++].exec(this.getUA()))for(p=0;p<props.length;p++)match=matches[++k],q=props[p],"object"==typeof q&&q.length>0?2==q.length?"function"==typeof q[1]?result[q[0]]=q[1].call(this,match):result[q[0]]=q[1]:3==q.length?"function"!=typeof q[1]||q[1].exec&&q[1].test?result[q[0]]=match?match.replace(q[1],q[2]):void 0:result[q[0]]=match?q[1].call(this,match,q[2]):void 0:4==q.length&&(result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):void 0):result[q]=match?match:void 0;i+=2}return result},str:function(str,map){for(var i in map)if("object"==typeof map[i]&&map[i].length>0){for(var j=0;j<map[i].length;j++)if(util.has(map[i][j],str))return"?"===i?void 0:i}else if(util.has(map[i],str))return"?"===i?void 0:i;return str}},maps={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},regexes={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[NAME,VERSION],[/\s(opr)\/([\w\.]+)/i],[[NAME,"Opera"],VERSION],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[NAME,VERSION],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[NAME,"IE"],VERSION],[/(edge)\/((\d+)?[\w\.]+)/i],[NAME,VERSION],[/(yabrowser)\/([\w\.]+)/i],[[NAME,"Yandex"],VERSION],[/(comodo_dragon)\/([\w\.]+)/i],[[NAME,/_/g," "],VERSION],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[NAME,VERSION],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/JUC.+(ucweb)[\/\s]?([\w\.]+)/i],[[NAME,"UCBrowser"],VERSION],[/(dolfin)\/([\w\.]+)/i],[[NAME,"Dolphin"],VERSION],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[NAME,"Chrome"],VERSION],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[VERSION,[NAME,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[VERSION,[NAME,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[VERSION,[NAME,"Facebook"]],[/fxios\/([\w\.-]+)/i],[VERSION,[NAME,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,[NAME,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,NAME],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[NAME,[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[NAME,VERSION],[/(navigator|netscape)\/([\w\.-]+)/i],[[NAME,"Netscape"],VERSION],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[NAME,VERSION]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",util.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",util.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",util.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[MODEL,VENDOR,[TYPE,TABLET]],[/applecoremedia\/[\w\.]+ \((ipad)/],[MODEL,[VENDOR,"Apple"],[TYPE,TABLET]],[/(apple\s{0,1}tv)/i],[[MODEL,"Apple TV"],[VENDOR,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[MODEL,[VENDOR,"Amazon"],[TYPE,TABLET]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[MODEL,mapper.str,maps.device.amazon.model],[VENDOR,"Amazon"],[TYPE,MOBILE]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[MODEL,VENDOR,[TYPE,MOBILE]],[/\((ip[honed|\s\w*]+);/i],[MODEL,[VENDOR,"Apple"],[TYPE,MOBILE]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/\(bb10;\s(\w+)/i],[MODEL,[VENDOR,"BlackBerry"],[TYPE,MOBILE]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[MODEL,[VENDOR,"Asus"],[TYPE,TABLET]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[VENDOR,"Sony"],[MODEL,"Xperia Tablet"],[TYPE,TABLET]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[VENDOR,"Sony"],[MODEL,"Xperia Phone"],[TYPE,MOBILE]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[VENDOR,MODEL,[TYPE,"console"]],[/android.+;\s(shield)\sbuild/i],[MODEL,[VENDOR,"Nvidia"],[TYPE,"console"]],[/(playstation\s[34portablevi]+)/i],[MODEL,[VENDOR,"Sony"],[TYPE,"console"]],[/(sprint\s(\w+))/i],[[VENDOR,mapper.str,maps.device.sprint.vendor],[MODEL,mapper.str,maps.device.sprint.model],[TYPE,MOBILE]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[VENDOR,[MODEL,/_/g," "],[TYPE,MOBILE]],[/(nexus\s9)/i],[MODEL,[VENDOR,"HTC"],[TYPE,TABLET]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[MODEL,[VENDOR,"Microsoft"],[TYPE,"console"]],[/(kin\.[onetw]{3})/i],[[MODEL,/\./g," "],[VENDOR,"Microsoft"],[TYPE,MOBILE]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s[6])/i],[MODEL,[VENDOR,"Motorola"],[TYPE,MOBILE]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[MODEL,[VENDOR,"Motorola"],[TYPE,TABLET]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,TABLET]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,MOBILE]],[/(samsung);smarttv/i],[VENDOR,MODEL,[TYPE,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[MODEL,[VENDOR,"Sharp"],[TYPE,"smarttv"]],[/sie-(\w+)*/i],[MODEL,[VENDOR,"Siemens"],[TYPE,MOBILE]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[VENDOR,"Nokia"],MODEL,[TYPE,MOBILE]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[MODEL,[VENDOR,"Acer"],[TYPE,TABLET]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[VENDOR,"LG"],MODEL,[TYPE,TABLET]],[/(lg) netcast\.tv/i],[VENDOR,MODEL,[TYPE,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[MODEL,[VENDOR,"LG"],[TYPE,MOBILE]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[MODEL,[VENDOR,"Lenovo"],[TYPE,TABLET]],[/linux;.+((jolla));/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/((pebble))app\/[\d\.]+\s/i],[VENDOR,MODEL,[TYPE,"wearable"]],[/android.+;\s(glass)\s\d/i],[MODEL,[VENDOR,"Google"],[TYPE,"wearable"]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[MODEL,/_/g," "],[VENDOR,"Xiaomi"],[TYPE,MOBILE]],[/\s(tablet)[;\/\s]/i,/\s(mobile)[;\/\s]/i],[[TYPE,util.lowerize],VENDOR,MODEL]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[VERSION,[NAME,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[NAME,VERSION],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,"Windows"],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,"BlackBerry"],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,"Symbian"],VERSION],[/\((series40);/i],[NAME],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,"Firefox OS"],VERSION],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,"Chromium OS"],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,"Solaris"],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[NAME,"iOS"],[VERSION,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[NAME,"Mac OS"],[VERSION,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]},UAParser=function(uastring,extensions){if(!(this instanceof UAParser))return new UAParser(uastring,extensions).getResult();var ua=uastring||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""),rgxmap=extensions?util.extend(regexes,extensions):regexes;return this.getBrowser=function(){var browser=mapper.rgx.apply(this,rgxmap.browser);return browser.major=util.major(browser.version),browser},this.getCPU=function(){return mapper.rgx.apply(this,rgxmap.cpu)},this.getDevice=function(){return mapper.rgx.apply(this,rgxmap.device)},this.getEngine=function(){return mapper.rgx.apply(this,rgxmap.engine)},this.getOS=function(){return mapper.rgx.apply(this,rgxmap.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ua},this.setUA=function(uastring){return ua=uastring,this},this.setUA(ua),this};UAParser.VERSION="0.7.10",UAParser.BROWSER={NAME:NAME,MAJOR:"major",VERSION:VERSION},UAParser.CPU={ARCHITECTURE:"architecture"},UAParser.DEVICE={MODEL:MODEL,VENDOR:VENDOR,TYPE:TYPE,CONSOLE:"console",MOBILE:MOBILE,SMARTTV:"smarttv",TABLET:TABLET,WEARABLE:"wearable",EMBEDDED:"embedded"},UAParser.ENGINE={NAME:NAME,VERSION:VERSION},UAParser.OS={NAME:NAME,VERSION:VERSION},void 0!==exports?(void 0!==module&&module.exports&&(exports=module.exports=UAParser),exports.UAParser=UAParser):"function"==typeof define&&define.amd?define(function(){return UAParser}):window.UAParser=UAParser;var $=window.jQuery||window.Zepto;if(void 0!==$){var parser=new UAParser;$.ua=parser.getResult(),$.ua.get=function(){return parser.getUA()},$.ua.set=function(uastring){parser.setUA(uastring);var result=parser.getResult();for(var prop in result)$.ua[prop]=result[prop]}}}("object"==typeof window?window:this)},{}],228:[function(require,module,exports){module.exports=require("./lib/")},{"./lib/":229}],229:[function(require,module,exports){var Stringify=require("./stringify"),Parse=require("./parse");module.exports={stringify:Stringify,parse:Parse}},{"./parse":230,"./stringify":231}],230:[function(require,module,exports){var Utils=require("./utils"),internals={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3,strictNullHandling:!1};internals.parseValues=function(str,options){for(var obj={},parts=str.split(options.delimiter,options.parameterLimit===1/0?void 0:options.parameterLimit),i=0,il=parts.length;i<il;++i){var part=parts[i],pos=part.indexOf("]=")===-1?part.indexOf("="):part.indexOf("]=")+1;if(pos===-1)obj[Utils.decode(part)]="",options.strictNullHandling&&(obj[Utils.decode(part)]=null);else{var key=Utils.decode(part.slice(0,pos)),val=Utils.decode(part.slice(pos+1));Object.prototype.hasOwnProperty.call(obj,key)?obj[key]=[].concat(obj[key]).concat(val):obj[key]=val}}return obj},internals.parseObject=function(chain,val,options){if(!chain.length)return val;var obj,root=chain.shift();if("[]"===root)obj=[],obj=obj.concat(internals.parseObject(chain,val,options));else{obj=Object.create(null);var cleanRoot="["===root[0]&&"]"===root[root.length-1]?root.slice(1,root.length-1):root,index=parseInt(cleanRoot,10),indexString=""+index;!isNaN(index)&&root!==cleanRoot&&indexString===cleanRoot&&index>=0&&options.parseArrays&&index<=options.arrayLimit?(obj=[],obj[index]=internals.parseObject(chain,val,options)):obj[cleanRoot]=internals.parseObject(chain,val,options)}return obj},internals.parseKeys=function(key,val,options){if(key){options.allowDots&&(key=key.replace(/\.([^\.\[]+)/g,"[$1]"));var parent=/^([^\[\]]*)/,child=/(\[[^\[\]]*\])/g,segment=parent.exec(key),keys=[];segment[1]&&keys.push(segment[1]);for(var i=0;null!==(segment=child.exec(key))&&i<options.depth;)++i,keys.push(segment[1]);return segment&&keys.push("["+key.slice(segment.index)+"]"),internals.parseObject(keys,val,options)}},module.exports=function(str,options){if(""===str||null===str||void 0===str)return Object.create(null);options=options||{},options.delimiter="string"==typeof options.delimiter||Utils.isRegExp(options.delimiter)?options.delimiter:internals.delimiter,options.depth="number"==typeof options.depth?options.depth:internals.depth,options.arrayLimit="number"==typeof options.arrayLimit?options.arrayLimit:internals.arrayLimit,options.parseArrays=options.parseArrays!==!1,options.allowDots=options.allowDots!==!1,options.parameterLimit="number"==typeof options.parameterLimit?options.parameterLimit:internals.parameterLimit,options.strictNullHandling="boolean"==typeof options.strictNullHandling?options.strictNullHandling:internals.strictNullHandling;for(var tempObj="string"==typeof str?internals.parseValues(str,options):str,obj=Object.create(null),keys=Object.keys(tempObj),i=0,il=keys.length;i<il;++i){var key=keys[i],newObj=internals.parseKeys(key,tempObj[key],options);obj=Utils.merge(obj,newObj)}return Utils.compact(obj)}},{"./utils":232}],231:[function(require,module,exports){var Utils=require("./utils"),internals={delimiter:"&",arrayPrefixGenerators:{brackets:function(prefix,key){return prefix+"[]"},indices:function(prefix,key){return prefix+"["+key+"]"},repeat:function(prefix,key){return prefix}},strictNullHandling:!1};internals.stringify=function(obj,prefix,generateArrayPrefix,strictNullHandling,filter){if("function"==typeof filter)obj=filter(prefix,obj);else if(Utils.isBuffer(obj))obj=obj.toString();else if(obj instanceof Date)obj=obj.toISOString();else if(null===obj){if(strictNullHandling)return Utils.encode(prefix);obj=""}if("string"==typeof obj||"number"==typeof obj||"boolean"==typeof obj)return[Utils.encode(prefix)+"="+Utils.encode(obj)];var values=[];if(void 0===obj)return values;for(var objKeys=Array.isArray(filter)?filter:Object.keys(obj),i=0,il=objKeys.length;i<il;++i){var key=objKeys[i];values=Array.isArray(obj)?values.concat(internals.stringify(obj[key],generateArrayPrefix(prefix,key),generateArrayPrefix,strictNullHandling,filter)):values.concat(internals.stringify(obj[key],prefix+"["+key+"]",generateArrayPrefix,strictNullHandling,filter))}return values},module.exports=function(obj,options){options=options||{};var objKeys,filter,delimiter="undefined"==typeof options.delimiter?internals.delimiter:options.delimiter,strictNullHandling="boolean"==typeof options.strictNullHandling?options.strictNullHandling:internals.strictNullHandling;"function"==typeof options.filter?(filter=options.filter,obj=filter("",obj)):Array.isArray(options.filter)&&(objKeys=filter=options.filter);var keys=[];if("object"!=typeof obj||null===obj)return"";var arrayFormat;arrayFormat=options.arrayFormat in internals.arrayPrefixGenerators?options.arrayFormat:"indices"in options?options.indices?"indices":"repeat":"indices";var generateArrayPrefix=internals.arrayPrefixGenerators[arrayFormat];objKeys||(objKeys=Object.keys(obj));for(var i=0,il=objKeys.length;i<il;++i){var key=objKeys[i];keys=keys.concat(internals.stringify(obj[key],key,generateArrayPrefix,strictNullHandling,filter))}return keys.join(delimiter)}},{"./utils":232}],232:[function(require,module,exports){var internals={};internals.hexTable=new Array(256);for(var i=0;i<256;++i)internals.hexTable[i]="%"+((i<16?"0":"")+i.toString(16)).toUpperCase();exports.arrayToObject=function(source){for(var obj=Object.create(null),i=0,il=source.length;i<il;++i)"undefined"!=typeof source[i]&&(obj[i]=source[i]);return obj},exports.merge=function(target,source){if(!source)return target;if("object"!=typeof source)return Array.isArray(target)?target.push(source):"object"==typeof target?target[source]=!0:target=[target,source],target;if("object"!=typeof target)return target=[target].concat(source);Array.isArray(target)&&!Array.isArray(source)&&(target=exports.arrayToObject(target));for(var keys=Object.keys(source),k=0,kl=keys.length;k<kl;++k){var key=keys[k],value=source[key];target[key]?target[key]=exports.merge(target[key],value):target[key]=value}return target},exports.decode=function(str){try{return decodeURIComponent(str.replace(/\+/g," "))}catch(e){return str}},exports.encode=function(str){if(0===str.length)return str;"string"!=typeof str&&(str=""+str);for(var out="",i=0,il=str.length;i<il;++i){var c=str.charCodeAt(i);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122?out+=str[i]:c<128?out+=internals.hexTable[c]:c<2048?out+=internals.hexTable[192|c>>6]+internals.hexTable[128|63&c]:c<55296||c>=57344?out+=internals.hexTable[224|c>>12]+internals.hexTable[128|c>>6&63]+internals.hexTable[128|63&c]:(++i,c=65536+((1023&c)<<10|1023&str.charCodeAt(i)),out+=internals.hexTable[240|c>>18]+internals.hexTable[128|c>>12&63]+internals.hexTable[128|c>>6&63]+internals.hexTable[128|63&c])}return out},exports.compact=function(obj,refs){if("object"!=typeof obj||null===obj)return obj;refs=refs||[];var lookup=refs.indexOf(obj);if(lookup!==-1)return refs[lookup];if(refs.push(obj),Array.isArray(obj)){for(var compacted=[],i=0,il=obj.length;i<il;++i)"undefined"!=typeof obj[i]&&compacted.push(obj[i]);return compacted}var keys=Object.keys(obj);for(i=0,il=keys.length;i<il;++i){var key=keys[i];obj[key]=exports.compact(obj[key],refs)}return obj},exports.isRegExp=function(obj){return"[object RegExp]"===Object.prototype.toString.call(obj)},exports.isBuffer=function(obj){return null!==obj&&void 0!==obj&&!!(obj.constructor&&obj.constructor.isBuffer&&obj.constructor.isBuffer(obj))}},{}],233:[function(require,module,exports){function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null,this.domain=null,this.subdomain=null}function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}function urlFormat(obj){return isString(obj)&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)}function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}function isString(arg){return"string"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}var punycode=require("punycode"),tld=require("tldjs");exports.parse=urlParse,exports.resolve=urlResolve,exports.resolveObject=urlResolveObject,exports.format=urlFormat,exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring"),ipv4=/(?:\d{1,3}\.){3}\d{1,3}/;Url.prototype.toJSON=function(){return{protocol:this.protocol,slashes:this.slashes,auth:this.auth,host:this.host,port:this.port,hostname:this.hostname,hash:this.hash,search:this.search,query:this.query,pathname:this.pathname,path:this.path,href:this.href,domain:this.domain,subdomain:this.subdomain}},Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}var auth,atSign;atSign=hostEnd===-1?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd),atSign!==-1&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}hostEnd===-1&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(part&&!part.match(/^[a-z0-9A-Z_-]{0,63}$/)){for(var newpart="",j=0,k=part.length;j<k;j++)newpart+=part.charCodeAt(j)>127?"x":part[j];if(!newpart.match(/^[a-z0-9A-Z_-]{0,63}$/)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(/^([a-z0-9A-Z_-]{0,63})(.*)$/);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}if(this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),!ipv6Hostname){for(var domainArray=this.hostname.split("."),newOut=[],i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}this.hostname=newOut.join(".")}var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i],esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}var hash=rest.indexOf("#");hash!==-1&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(qm!==-1?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.parseDomain(),this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}var result=new Url;if(Object.keys(this).forEach(function(k){result[k]=this[k]},this),result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol)return Object.keys(relative).forEach(function(k){"protocol"!==k&&(result[k]=relative[k])}),slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.parseDomain(),result.href=result.format(),result;if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol])return Object.keys(relative).forEach(function(k){result[k]=relative[k]}),result.parseDomain(),result.href=result.format(),result;if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.parseDomain(),result.href=result.format(),result}
var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@");authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.parseDomain(),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.parseDomain(),result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],"."==last?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@");authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.parseDomain(),result.href=result.format(),result},Url.prototype.parseDomain=function(){if(this.hostname)if(ipv4.test(this.hostname))this.domain=this.hostname;else{var domain=tld.getDomain(this.hostname),subdomain=tld.getSubdomain(this.hostname);this.domain=domain?domain:null,this.subdomain=subdomain?subdomain:null}else this.domain=null,this.subdomain=null},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],":"!==port&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{punycode:219,querystring:228,tldjs:223}],234:[function(require,module,exports){"use strict";function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}function urlFormat(obj){return util.isString(obj)&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)}function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}var punycode=require("punycode"),util=require("./util");exports.parse=urlParse,exports.resolve=urlResolve,exports.resolveObject=urlResolveObject,exports.format=urlFormat,exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring");Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/"),url=uSplit.join(splitter);var rest=url;if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}var auth,atSign;atSign=hostEnd===-1?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd),atSign!==-1&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}hostEnd===-1&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(part&&!part.match(/^[+a-z0-9A-Z_-]{0,63}$/)){for(var newpart="",j=0,k=part.length;j<k;j++)newpart+=part.charCodeAt(j)>127?"x":part[j];if(!newpart.match(/^[+a-z0-9A-Z_-]{0,63}$/)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(/^([+a-z0-9A-Z_-]{0,63})(.*)$/);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)!==-1){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");hash!==-1&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(qm!==-1?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@");authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],"."===last?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@");authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],":"!==port&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{"./util":235,punycode:219,querystring:222}],235:[function(require,module,exports){"use strict";module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},{}],236:[function(require,module,exports){function isVisible(el){var style=el.currentStyle||getComputedStyle(el),visible=el.offsetLeft>-999&&el.offsetTop>-999&&"hidden"!=style.visibility&&"none"!=style.display;return visible&&"hidden"==style.overflow&&(visible=el.offsetHeight>1&&el.offsetWidth>1),visible&&el.parentElement&&(visible=isVisible(el.parentElement)),visible}module.exports=isVisible},{}],237:[function(require,module,exports){module.exports={name:"truekey-soup",version:"1.29.0","private":!0,description:"Cross platform Content-Script for True Key",main:"lib/index.js",directories:{test:"test"},bin:{escapeExceptionForIE:"./scripts/escape-exception-for-ie.js"},scripts:{test:"gulp test:jenkins --ci",build:"node_modules/gulp/bin/gulp.js",preinstall:"npm update -g mocha-phantomjs"},dependencies:{backbone:"1.1.2","backbone.marionette":"1.8.8",bluebird:"3.4.1","component-emitter":"1.2.1","component-inherit":"0.0.3",debug:"2.2.0","es5-shim":"4.5.9","es6-shim":"0.35.1",eventemitter2:"1.0.0",handlebars:"4.0.5",hbsfy:"2.2.1",hercules:"git+ssh://git@github-lvs.corpzone.internalzone.com/safeidentity/hercules#final-hercules-with-soup-release",jquery:"1.11.3","node-polyglot":"0.4.1","node-uuid":"1.4.2",notevil:"git+ssh://git@github-lvs.corpzone.internalzone.com/safeidentity/notevil.git",promise:"7.1.1",setimmediate:"1.0.5","sync-exec":"^0.6.2","ua-parser-js":"0.7.10",underscore:"*","url-parser":"git+ssh://git@github-lvs.corpzone.internalzone.com/safeidentity/url-parser#0.0.11",visible:"git+ssh://git@github-lvs.corpzone.internalzone.com/safeidentity/visible#production"},devDependencies:{"amo-reviewify":"git+ssh://git@github-lvs.corpzone.internalzone.com/safeidentity/amo-reviewify","babel-preset-es2015":"6.16.0","babel-preset-es2015-loose":"7.0.0",babelify:"7.3.0",brfs:"1.4.3",browserify:"13.0.0","browserify-istanbul":"2.0.0",chai:"3.5.0","copy-paste":"1.2.0",domify:"1.4.0",envify:"3.4.1",exorcist:"0.4.0",falafel:"1.2.0","fs-extra":"0.29.0",gulp:"3.9.1","gulp-concat":"2.6.0","gulp-rename":"1.2.2","gulp-replace":"0.5.4","gulp-uglify":"1.5.4",istanbul:"0.4.5",karma:"^1.5.0","karma-browserify":"5.0.5","karma-chai":"0.1.0","karma-chrome-launcher":"0.2.3","karma-coverage":"0.5.5","karma-junit-reporter":"1.2.0","karma-mocha":"1.3.0","karma-mocha-reporter":"2.2.2","karma-notify-reporter":"0.1.1","karma-phantomjs-launcher":"1.0.2","karma-sinon-chai":"1.2.4","karma-teamcity-reporter":"0.2.2",lolex:"1.4.0",mocha:"2.5.3","mocha-phantomjs":"4.0.2","mocha-teamcity-reporter":"1.1.1","phantom-ownpropertynames":"1.0.0","phantomjs-prebuilt":"2.1.14",prompt:"1.0.0",proxyquire:"1.7.9","proxyquire-universal":"1.0.8",proxyquireify:"3.2.0","simple-statistics":"0.9.2",sinon:"1.17.4","sinon-chai":"2.8.0",snyk:"1.14.2","sync-exec":"^0.6.2",through2:"2.0.1","vinyl-buffer":"1.0.0","vinyl-source-stream":"1.1.0",watchify:"3.7.0",yargs:"4.7.0","z-schema":"3.18.0"},browser:{"prototype-extender":"./vendor/prototype-extender.js"},author:"Mcafee Security"}},{}]},{},[122]);
//# sourceMappingURL=content-script.js.map